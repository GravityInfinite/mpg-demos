"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=_superPropBase(t,e);if(s){var n=Object.getOwnPropertyDescriptor(s,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _construct(t,e,i){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,e,i){var s=[null];s.push.apply(s,e);var n=new(Function.bind.apply(t,s));return i&&_setPrototypeOf(n,i.prototype),n}).apply(null,arguments)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var box2d=window.box2d=function(t){var e,i=function(){function b2Color(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;_classCallCheck(this,b2Color),this.r=t,this.g=e,this.b=i,this.a=s}return _createClass(b2Color,[{key:"Clone",value:function(){return(new b2Color).Copy(this)}},{key:"Copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"Set",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.a;this.SetRGBA(t,e,i,s)}},{key:"SetByteRGB",value:function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}},{key:"SetByteRGBA",value:function(t,e,i,s){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=s/255,this}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,s){return this.r=t,this.g=e,this.b=i,this.a=s,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}},{key:"Mix",value:function(t,e){b2Color.MixColors(this,t,e)}},{key:"MakeStyleString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return b2Color.MakeStyleString(this.r,this.g,this.b,t)}}],[{key:"MixColors",value:function(t,e,i){var s=i*(e.r-t.r),n=i*(e.g-t.g),o=i*(e.b-t.b),r=i*(e.a-t.a);t.r+=s,t.g+=n,t.b+=o,t.a+=r,e.r-=s,e.g-=n,e.b-=o,e.a-=r}},{key:"MakeStyleString",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t*=255,e*=255,i*=255,s<1?"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(s,")"):"rgb(".concat(t,",").concat(e,",").concat(i,")")}}]),b2Color}();i.ZERO=new i(0,0,0,0),i.RED=new i(1,0,0),i.GREEN=new i(0,1,0),i.BLUE=new i(0,0,1),t.b2DrawFlags=void 0,(e=t.b2DrawFlags||(t.b2DrawFlags={}))[e.e_none=0]="e_none",e[e.e_shapeBit=1]="e_shapeBit",e[e.e_jointBit=2]="e_jointBit",e[e.e_aabbBit=4]="e_aabbBit",e[e.e_pairBit=8]="e_pairBit",e[e.e_centerOfMassBit=16]="e_centerOfMassBit",e[e.e_all=63]="e_all";var s=function(){function b2Draw(){_classCallCheck(this,b2Draw),this.m_drawFlags=0}return _createClass(b2Draw,[{key:"SetFlags",value:function(t){this.m_drawFlags=t}},{key:"GetFlags",value:function(){return this.m_drawFlags}},{key:"AppendFlags",value:function(t){this.m_drawFlags|=t}},{key:"ClearFlags",value:function(t){this.m_drawFlags&=~t}}]),b2Draw}();function b2Maybe(t,e){return void 0!==t?t:e}var n=1e37,o=1e-5,r=o*o,a=3.14159265359,l=1,h=8,_=2,u=.1*l,m=.005*l,c=2/180*a,y=2*m,d=.2*l,p=8/180*a,f=2*l,v=f*f,b=.5*a,C=b*b,x=.01*l,A=2/180*a,S=function(){function b2Version(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,b2Version),this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}return _createClass(b2Version,[{key:"toString",value:function(){return this.major+"."+this.minor+"."+this.revision}}]),b2Version}(),g=new S(2,4,1);function b2MakeArray(t,e){for(var i=new Array(t),s=0;s<t;++s)i[s]=e(s);return i}function b2MakeNumberArray(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new Array(t),s=0;s<t;++s)i[s]=e;return i}var w=function(){function b2GrowableStack(t){_classCallCheck(this,b2GrowableStack),this.m_stack=[],this.m_count=0,this.m_stack=b2MakeArray(t,function(t){return null}),this.m_count=0}return _createClass(b2GrowableStack,[{key:"Reset",value:function(){return this.m_count=0,this}},{key:"Push",value:function(t){this.m_stack[this.m_count]=t,this.m_count++}},{key:"Pop",value:function(){this.m_count--;var t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}},{key:"GetCount",value:function(){return this.m_count}}]),b2GrowableStack}(),V=a/180,B=180/a,M=2*a,k=Math.abs;function b2Min(t,e){return t<e?t:e}function b2Max(t,e){return t>e?t:e}function b2Clamp(t,e,i){return t<e?e:t>i?i:t}var I=isFinite;function b2Sq(t){return t*t}var D=Math.sqrt,P=Math.pow;var T=Math.cos,G=Math.sin,R=Math.acos,J=Math.asin,L=Math.atan2;var F=function(){function b2Vec2(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,b2Vec2),this.x=t,this.y=e}return _createClass(b2Vec2,[{key:"Clone",value:function(){return new b2Vec2(this.x,this.y)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=o){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=o){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),s=this.x;return this.x=e*s-i*this.y,this.y=i*s+e*this.y,this}},{key:"SelfRotateCosSin",value:function(t,e){var i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=b2Min(this.x,t.x),this.y=b2Min(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=b2Max(this.x,t.x),this.y=b2Max(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=k(this.x),this.y=k(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}],[{key:"MakeArray",value:function(t){return b2MakeArray(t,function(t){return new b2Vec2})}},{key:"AbsV",value:function(t,e){return e.x=k(t.x),e.y=k(t.y),e}},{key:"MinV",value:function(t,e,i){return i.x=b2Min(t.x,e.x),i.y=b2Min(t.y,e.y),i}},{key:"MaxV",value:function(t,e,i){return i.x=b2Max(t.x,e.x),i.y=b2Max(t.y,e.y),i}},{key:"ClampV",value:function(t,e,i,s){return s.x=b2Clamp(t.x,e.x,i.x),s.y=b2Clamp(t.y,e.y,i.y),s}},{key:"RotateV",value:function(t,e,i){var s=t.x,n=t.y,o=Math.cos(e),r=Math.sin(e);return i.x=o*s-r*n,i.y=r*s+o*n,i}},{key:"DotVV",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"CrossVV",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"CrossVS",value:function(t,e,i){var s=t.x;return i.x=e*t.y,i.y=-e*s,i}},{key:"CrossVOne",value:function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}},{key:"CrossSV",value:function(t,e,i){var s=e.x;return i.x=-t*e.y,i.y=t*s,i}},{key:"CrossOneV",value:function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}},{key:"AddVV",value:function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}},{key:"SubVV",value:function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}},{key:"MulSV",value:function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}},{key:"MulVS",value:function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}},{key:"AddVMulSV",value:function(t,e,i,s){return s.x=t.x+e*i.x,s.y=t.y+e*i.y,s}},{key:"SubVMulSV",value:function(t,e,i,s){return s.x=t.x-e*i.x,s.y=t.y-e*i.y,s}},{key:"AddVCrossSV",value:function(t,e,i,s){var n=i.x;return s.x=t.x-e*i.y,s.y=t.y+e*n,s}},{key:"MidVV",value:function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}},{key:"ExtVV",value:function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}},{key:"IsEqualToV",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"DistanceVV",value:function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}},{key:"DistanceSquaredVV",value:function(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s}},{key:"NegV",value:function(t,e){return e.x=-t.x,e.y=-t.y,e}}]),b2Vec2}();F.ZERO=new F(0,0),F.UNITX=new F(1,0),F.UNITY=new F(0,1),F.s_t0=new F,F.s_t1=new F,F.s_t2=new F,F.s_t3=new F;var O=new F(0,0),j=function(){function b2Vec3(){_classCallCheck(this,b2Vec3);for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(e[0]instanceof Float32Array){if(3!==e[0].length)throw new Error;this.data=e[0]}else{var s="number"==typeof e[0]?e[0]:0,n="number"==typeof e[1]?e[1]:0,o="number"==typeof e[2]?e[2]:0;this.data=new Float32Array([s,n,o])}}return _createClass(b2Vec3,[{key:"Clone",value:function(){return new b2Vec3(this.x,this.y,this.z)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this.z=0,this}},{key:"SetXYZ",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"SelfAddXYZ",value:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"SelfSubXYZ",value:function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"x",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"y",get:function(){return this.data[1]},set:function(t){this.data[1]=t}},{key:"z",get:function(){return this.data[2]},set:function(t){this.data[2]=t}}],[{key:"DotV3V3",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"CrossV3V3",value:function(t,e,i){var s=t.x,n=t.y,o=t.z,r=e.x,a=e.y,l=e.z;return i.x=n*l-o*a,i.y=o*r-s*l,i.z=s*a-n*r,i}}]),b2Vec3}();j.ZERO=new j(0,0,0),j.s_t0=new j;var E=function(){function b2Mat22(){_classCallCheck(this,b2Mat22),this.ex=new F(1,0),this.ey=new F(0,1)}return _createClass(b2Mat22,[{key:"Clone",value:function(){return(new b2Mat22).Copy(this)}},{key:"SetSSSS",value:function(t,e,i,s){return this.ex.Set(t,i),this.ey.Set(e,s),this}},{key:"SetVV",value:function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}},{key:"SetAngle",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}},{key:"SetIdentity",value:function(){return this.ex.Set(1,0),this.ey.Set(0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this}},{key:"GetAngle",value:function(){return Math.atan2(this.ex.y,this.ex.x)}},{key:"GetInverse",value:function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y,o=e*n-i*s;return 0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.y=-o*s,t.ey.y=o*e,t}},{key:"Solve",value:function(t,e,i){var s=this.ex.x,n=this.ey.x,o=this.ex.y,r=this.ey.y,a=s*r-n*o;return 0!==a&&(a=1/a),i.x=a*(r*t-n*e),i.y=a*(s*e-o*t),i}},{key:"SelfAbs",value:function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}},{key:"SelfInv",value:function(){return this.GetInverse(this),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}},{key:"SelfSubM",value:function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}],[{key:"FromVV",value:function(t,e){return(new b2Mat22).SetVV(t,e)}},{key:"FromSSSS",value:function(t,e,i,s){return(new b2Mat22).SetSSSS(t,e,i,s)}},{key:"FromAngle",value:function(t){return(new b2Mat22).SetAngle(t)}},{key:"AbsM",value:function(t,e){var i=t.ex,s=t.ey;return e.ex.x=k(i.x),e.ex.y=k(i.y),e.ey.x=k(s.x),e.ey.y=k(s.y),e}},{key:"MulMV",value:function(t,e,i){var s=t.ex,n=t.ey,o=e.x,r=e.y;return i.x=s.x*o+n.x*r,i.y=s.y*o+n.y*r,i}},{key:"MulTMV",value:function(t,e,i){var s=t.ex,n=t.ey,o=e.x,r=e.y;return i.x=s.x*o+s.y*r,i.y=n.x*o+n.y*r,i}},{key:"AddMM",value:function(t,e,i){var s=t.ex,n=t.ey,o=e.ex,r=e.ey;return i.ex.x=s.x+o.x,i.ex.y=s.y+o.y,i.ey.x=n.x+r.x,i.ey.y=n.y+r.y,i}},{key:"MulMM",value:function(t,e,i){var s=t.ex.x,n=t.ex.y,o=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,h=e.ey.x,_=e.ey.y;return i.ex.x=s*a+o*l,i.ex.y=n*a+r*l,i.ey.x=s*h+o*_,i.ey.y=n*h+r*_,i}},{key:"MulTMM",value:function(t,e,i){var s=t.ex.x,n=t.ex.y,o=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,h=e.ey.x,_=e.ey.y;return i.ex.x=s*a+n*l,i.ex.y=o*a+r*l,i.ey.x=s*h+n*_,i.ey.y=o*h+r*_,i}}]),b2Mat22}();E.IDENTITY=new E;var q=function(){function b2Mat33(){_classCallCheck(this,b2Mat33),this.data=new Float32Array([1,0,0,0,1,0,0,0,1]),this.ex=new j(this.data.subarray(0,3)),this.ey=new j(this.data.subarray(3,6)),this.ez=new j(this.data.subarray(6,9))}return _createClass(b2Mat33,[{key:"Clone",value:function(){return(new b2Mat33).Copy(this)}},{key:"SetVVV",value:function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}},{key:"SetIdentity",value:function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}},{key:"Solve33",value:function(t,e,i,s){var n=this.ex.x,o=this.ex.y,r=this.ex.z,a=this.ey.x,l=this.ey.y,h=this.ey.z,_=this.ez.x,u=this.ez.y,m=this.ez.z,c=n*(l*m-h*u)+o*(h*_-a*m)+r*(a*u-l*_);return 0!==c&&(c=1/c),s.x=c*(t*(l*m-h*u)+e*(h*_-a*m)+i*(a*u-l*_)),s.y=c*(n*(e*m-i*u)+o*(i*_-t*m)+r*(t*u-e*_)),s.z=c*(n*(l*i-h*e)+o*(h*t-a*i)+r*(a*e-l*t)),s}},{key:"Solve22",value:function(t,e,i){var s=this.ex.x,n=this.ey.x,o=this.ex.y,r=this.ey.y,a=s*r-n*o;return 0!==a&&(a=1/a),i.x=a*(r*t-n*e),i.y=a*(s*e-o*t),i}},{key:"GetInverse22",value:function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y,o=e*n-i*s;0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.z=0,t.ex.y=-o*s,t.ey.y=o*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}},{key:"GetSymInverse33",value:function(t){var e=j.DotV3V3(this.ex,j.CrossV3V3(this.ey,this.ez,j.s_t0));0!==e&&(e=1/e);var i=this.ex.x,s=this.ey.x,n=this.ez.x,o=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(o*a-r*r),t.ex.y=e*(n*r-s*a),t.ex.z=e*(s*r-n*o),t.ey.x=t.ex.y,t.ey.y=e*(i*a-n*n),t.ey.z=e*(n*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*o-s*s)}}],[{key:"MulM33V3",value:function(t,e,i){var s=e.x,n=e.y,o=e.z;return i.x=t.ex.x*s+t.ey.x*n+t.ez.x*o,i.y=t.ex.y*s+t.ey.y*n+t.ez.y*o,i.z=t.ex.z*s+t.ey.z*n+t.ez.z*o,i}},{key:"MulM33XYZ",value:function(t,e,i,s,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*s,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*s,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*s,n}},{key:"MulM33V2",value:function(t,e,i){var s=e.x,n=e.y;return i.x=t.ex.x*s+t.ey.x*n,i.y=t.ex.y*s+t.ey.y*n,i}},{key:"MulM33XY",value:function(t,e,i,s){return s.x=t.ex.x*e+t.ey.x*i,s.y=t.ex.y*e+t.ey.y*i,s}}]),b2Mat33}();q.IDENTITY=new q;var z=function(){function b2Rot(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;_classCallCheck(this,b2Rot),this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}return _createClass(b2Rot,[{key:"Clone",value:function(){return(new b2Rot).Copy(this)}},{key:"Copy",value:function(t){return this.s=t.s,this.c=t.c,this}},{key:"SetAngle",value:function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}},{key:"SetIdentity",value:function(){return this.s=0,this.c=1,this}},{key:"GetAngle",value:function(){return Math.atan2(this.s,this.c)}},{key:"GetXAxis",value:function(t){return t.x=this.c,t.y=this.s,t}},{key:"GetYAxis",value:function(t){return t.x=-this.s,t.y=this.c,t}}],[{key:"MulRR",value:function(t,e,i){var s=t.c,n=t.s,o=e.c,r=e.s;return i.s=n*o+s*r,i.c=s*o-n*r,i}},{key:"MulTRR",value:function(t,e,i){var s=t.c,n=t.s,o=e.c,r=e.s;return i.s=s*r-n*o,i.c=s*o+n*r,i}},{key:"MulRV",value:function(t,e,i){var s=t.c,n=t.s,o=e.x,r=e.y;return i.x=s*o-n*r,i.y=n*o+s*r,i}},{key:"MulTRV",value:function(t,e,i){var s=t.c,n=t.s,o=e.x,r=e.y;return i.x=s*o+n*r,i.y=-n*o+s*r,i}}]),b2Rot}();z.IDENTITY=new z;var X=function(){function b2Transform(){_classCallCheck(this,b2Transform),this.p=new F,this.q=new z}return _createClass(b2Transform,[{key:"Clone",value:function(){return(new b2Transform).Copy(this)}},{key:"Copy",value:function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}},{key:"SetIdentity",value:function(){return this.p.SetZero(),this.q.SetIdentity(),this}},{key:"SetPositionRotation",value:function(t,e){return this.p.Copy(t),this.q.Copy(e),this}},{key:"SetPositionAngle",value:function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}},{key:"SetPosition",value:function(t){return this.p.Copy(t),this}},{key:"SetPositionXY",value:function(t,e){return this.p.Set(t,e),this}},{key:"SetRotation",value:function(t){return this.q.Copy(t),this}},{key:"SetRotationAngle",value:function(t){return this.q.SetAngle(t),this}},{key:"GetPosition",value:function(){return this.p}},{key:"GetRotation",value:function(){return this.q}},{key:"GetRotationAngle",value:function(){return this.q.GetAngle()}},{key:"GetAngle",value:function(){return this.q.GetAngle()}}],[{key:"MulXV",value:function(t,e,i){var s=t.q.c,n=t.q.s,o=e.x,r=e.y;return i.x=s*o-n*r+t.p.x,i.y=n*o+s*r+t.p.y,i}},{key:"MulTXV",value:function(t,e,i){var s=t.q.c,n=t.q.s,o=e.x-t.p.x,r=e.y-t.p.y;return i.x=s*o+n*r,i.y=-n*o+s*r,i}},{key:"MulXX",value:function(t,e,i){return z.MulRR(t.q,e.q,i.q),F.AddVV(z.MulRV(t.q,e.p,i.p),t.p,i.p),i}},{key:"MulTXX",value:function(t,e,i){return z.MulTRR(t.q,e.q,i.q),z.MulTRV(t.q,F.SubVV(e.p,t.p,i.p),i.p),i}}]),b2Transform}();X.IDENTITY=new X;var W,N=function(){function b2Sweep(){_classCallCheck(this,b2Sweep),this.localCenter=new F,this.c0=new F,this.c=new F,this.a0=0,this.a=0,this.alpha0=0}return _createClass(b2Sweep,[{key:"Clone",value:function(){return(new b2Sweep).Copy(this)}},{key:"Copy",value:function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}},{key:"GetTransform",value:function(t,e){t.p.x=(1-e)*this.c0.x+e*this.c.x,t.p.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;return t.q.SetAngle(i),t.p.SelfSub(z.MulRV(t.q,this.localCenter,F.s_t0)),t}},{key:"Advance",value:function(t){var e=(t-this.alpha0)/(1-this.alpha0);this.c0.SelfMulAdd(e,this.c.Clone().SelfSub(this.c0)),this.a0+=e*(this.a-this.a0),this.alpha0=t}},{key:"Normalize",value:function(){var t=M*Math.floor(this.a0/M);this.a0-=t,this.a-=t}}]),b2Sweep}(),Z=function(){function b2Timer(){_classCallCheck(this,b2Timer),this.m_start=Date.now()}return _createClass(b2Timer,[{key:"Reset",value:function(){return this.m_start=Date.now(),this}},{key:"GetMilliseconds",value:function(){return Date.now()-this.m_start}}]),b2Timer}(),U=function(){function b2Counter(){_classCallCheck(this,b2Counter),this.m_count=0,this.m_min_count=0,this.m_max_count=0}return _createClass(b2Counter,[{key:"GetCount",value:function(){return this.m_count}},{key:"GetMinCount",value:function(){return this.m_min_count}},{key:"GetMaxCount",value:function(){return this.m_max_count}},{key:"ResetCount",value:function(){var t=this.m_count;return this.m_count=0,t}},{key:"ResetMinCount",value:function(){this.m_min_count=0}},{key:"ResetMaxCount",value:function(){this.m_max_count=0}},{key:"Increment",value:function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}},{key:"Decrement",value:function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}}]),b2Counter}(),Y=function b2MassData(){_classCallCheck(this,b2MassData),this.mass=0,this.center=new F(0,0),this.I=0};t.b2ShapeType=void 0,(W=t.b2ShapeType||(t.b2ShapeType={}))[W.e_unknown=-1]="e_unknown",W[W.e_circleShape=0]="e_circleShape",W[W.e_edgeShape=1]="e_edgeShape",W[W.e_polygonShape=2]="e_polygonShape",W[W.e_chainShape=3]="e_chainShape",W[W.e_shapeTypeCount=4]="e_shapeTypeCount";var Q=function(){function b2Shape(e,i){_classCallCheck(this,b2Shape),this.m_type=t.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=e,this.m_radius=i}return _createClass(b2Shape,[{key:"Copy",value:function(t){return this.m_radius=t.m_radius,this}},{key:"GetType",value:function(){return this.m_type}}]),b2Shape}(),K=function(){function b2DistanceProxy(){_classCallCheck(this,b2DistanceProxy),this.m_buffer=F.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}return _createClass(b2DistanceProxy,[{key:"Copy",value:function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}},{key:"Reset",value:function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}},{key:"SetShape",value:function(t,e){t.SetupDistanceProxy(this,e)}},{key:"SetVerticesRadius",value:function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}},{key:"Set",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof Q?this.SetShape(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this.SetVerticesRadius(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},{key:"GetSupport",value:function(t){for(var e=0,i=F.DotVV(this.m_vertices[0],t),s=1;s<this.m_count;++s){var n=F.DotVV(this.m_vertices[s],t);n>i&&(e=s,i=n)}return e}},{key:"GetSupportVertex",value:function(t){for(var e=0,i=F.DotVV(this.m_vertices[0],t),s=1;s<this.m_count;++s){var n=F.DotVV(this.m_vertices[s],t);n>i&&(e=s,i=n)}return this.m_vertices[e]}},{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertex",value:function(t){return this.m_vertices[t]}}]),b2DistanceProxy}(),H=function(){function b2SimplexCache(){_classCallCheck(this,b2SimplexCache),this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return _createClass(b2SimplexCache,[{key:"Reset",value:function(){return this.metric=0,this.count=0,this}}]),b2SimplexCache}(),$=function(){function b2DistanceInput(){_classCallCheck(this,b2DistanceInput),this.proxyA=new K,this.proxyB=new K,this.transformA=new X,this.transformB=new X,this.useRadii=!1}return _createClass(b2DistanceInput,[{key:"Reset",value:function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}]),b2DistanceInput}(),tt=function(){function b2DistanceOutput(){_classCallCheck(this,b2DistanceOutput),this.pointA=new F,this.pointB=new F,this.distance=0,this.iterations=0}return _createClass(b2DistanceOutput,[{key:"Reset",value:function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}]),b2DistanceOutput}();t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0;var et=function(){function b2SimplexVertex(){_classCallCheck(this,b2SimplexVertex),this.wA=new F,this.wB=new F,this.w=new F,this.a=0,this.indexA=0,this.indexB=0}return _createClass(b2SimplexVertex,[{key:"Copy",value:function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}]),b2SimplexVertex}(),it=function(){function b2Simplex(){_classCallCheck(this,b2Simplex),this.m_v1=new et,this.m_v2=new et,this.m_v3=new et,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}return _createClass(b2Simplex,[{key:"ReadCache",value:function(t,e,i,s,n){this.m_count=t.count;for(var r=this.m_vertices,a=0;a<this.m_count;++a){var l=r[a];l.indexA=t.indexA[a],l.indexB=t.indexB[a];var h=e.GetVertex(l.indexA),_=s.GetVertex(l.indexB);X.MulXV(i,h,l.wA),X.MulXV(n,_,l.wB),F.SubVV(l.wB,l.wA,l.w),l.a=0}if(this.m_count>1){var u=t.metric,m=this.GetMetric();(m<.5*u||2*u<m||m<o)&&(this.m_count=0)}if(0===this.m_count){var c=r[0];c.indexA=0,c.indexB=0;var y=e.GetVertex(0),d=s.GetVertex(0);X.MulXV(i,y,c.wA),X.MulXV(n,d,c.wB),F.SubVV(c.wB,c.wA,c.w),c.a=1,this.m_count=1}}},{key:"WriteCache",value:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}},{key:"GetSearchDirection",value:function(t){switch(this.m_count){case 1:return F.NegV(this.m_v1.w,t);case 2:var e=F.SubVV(this.m_v2.w,this.m_v1.w,t);return F.CrossVV(e,F.NegV(this.m_v1.w,F.s_t0))>0?F.CrossOneV(e,t):F.CrossVOne(e,t);default:return t.SetZero()}}},{key:"GetClosestPoint",value:function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}}},{key:"GetWitnessPoints",value:function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}},{key:"GetMetric",value:function(){switch(this.m_count){case 0:case 1:return 0;case 2:return F.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return F.CrossVV(F.SubVV(this.m_v2.w,this.m_v1.w,F.s_t0),F.SubVV(this.m_v3.w,this.m_v1.w,F.s_t1));default:return 0}}},{key:"Solve2",value:function(){var t=this.m_v1.w,e=this.m_v2.w,i=F.SubVV(e,t,b2Simplex.s_e12),s=-F.DotVV(t,i);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);var n=F.DotVV(e,i);if(n<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var o=1/(n+s);this.m_v1.a=n*o,this.m_v2.a=s*o,this.m_count=2}},{key:"Solve3",value:function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,s=F.SubVV(e,t,b2Simplex.s_e12),n=F.DotVV(t,s),o=F.DotVV(e,s),r=-n,a=F.SubVV(i,t,b2Simplex.s_e13),l=F.DotVV(t,a),h=F.DotVV(i,a),_=-l,u=F.SubVV(i,e,b2Simplex.s_e23),m=F.DotVV(e,u),c=F.DotVV(i,u),y=-m,d=F.CrossVV(s,a),p=d*F.CrossVV(e,i),f=d*F.CrossVV(i,t),v=d*F.CrossVV(t,e);if(r<=0&&_<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&r>0&&v<=0){var b=1/(o+r);return this.m_v1.a=o*b,this.m_v2.a=r*b,void(this.m_count=2)}if(h>0&&_>0&&f<=0){var C=1/(h+_);return this.m_v1.a=h*C,this.m_v3.a=_*C,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(o<=0&&y<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&c<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(c>0&&y>0&&p<=0){var x=1/(c+y);return this.m_v2.a=c*x,this.m_v3.a=y*x,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var A=1/(p+f+v);this.m_v1.a=p*A,this.m_v2.a=f*A,this.m_v3.a=v*A,this.m_count=3}}]),b2Simplex}();it.s_e12=new F,it.s_e13=new F,it.s_e23=new F;var st=new it,nt=[0,0,0],ot=[0,0,0],rt=new F,at=new F,lt=new F,ht=new F,_t=new F;function b2Distance(e,i,s){++t.b2_gjkCalls;var n=s.proxyA,a=s.proxyB,l=s.transformA,h=s.transformB,_=st;_.ReadCache(i,n,l,a,h);for(var u=_.m_vertices,m=nt,c=ot,y=0,d=0;d<20;){y=_.m_count;for(var p=0;p<y;++p)m[p]=u[p].indexA,c[p]=u[p].indexB;switch(_.m_count){case 1:break;case 2:_.Solve2();break;case 3:_.Solve3()}if(3===_.m_count)break;var f=_.GetSearchDirection(at);if(f.LengthSquared()<r)break;var v=u[_.m_count];v.indexA=n.GetSupport(z.MulTRV(l.q,F.NegV(f,F.s_t0),ht)),X.MulXV(l,n.GetVertex(v.indexA),v.wA),v.indexB=a.GetSupport(z.MulTRV(h.q,f,_t)),X.MulXV(h,a.GetVertex(v.indexB),v.wB),F.SubVV(v.wB,v.wA,v.w),++d,++t.b2_gjkIters;for(var b=!1,C=0;C<y;++C)if(v.indexA===m[C]&&v.indexB===c[C]){b=!0;break}if(b)break;++_.m_count}if(t.b2_gjkMaxIters=b2Max(t.b2_gjkMaxIters,d),_.GetWitnessPoints(e.pointA,e.pointB),e.distance=F.DistanceVV(e.pointA,e.pointB),e.iterations=d,_.WriteCache(i),s.useRadii){var x=n.m_radius,A=a.m_radius;if(e.distance>x+A&&e.distance>o){e.distance-=x+A;var S=F.SubVV(e.pointB,e.pointA,lt);S.Normalize(),e.pointA.SelfMulAdd(x,S),e.pointB.SelfMulSub(A,S)}else{var g=F.MidVV(e.pointA,e.pointB,rt);e.pointA.Copy(g),e.pointB.Copy(g),e.distance=0}}}var ut,mt=new F,ct=new it,yt=new F,dt=new F,pt=new F,ft=new F,vt=new F,bt=new F;t.b2ContactFeatureType=void 0,(ut=t.b2ContactFeatureType||(t.b2ContactFeatureType={}))[ut.e_vertex=0]="e_vertex",ut[ut.e_face=1]="e_face";var Ct,xt=function(){function b2ContactFeature(){_classCallCheck(this,b2ContactFeature),this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return _createClass(b2ContactFeature,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0}}]),b2ContactFeature}(),At=function(){function b2ContactID(){_classCallCheck(this,b2ContactID),this.cf=new xt}return _createClass(b2ContactID,[{key:"Copy",value:function(t){return this.key=t.key,this}},{key:"Clone",value:function(){return(new b2ContactID).Copy(this)}},{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),b2ContactID}(),St=function(){function b2ManifoldPoint(){_classCallCheck(this,b2ManifoldPoint),this.localPoint=new F,this.normalImpulse=0,this.tangentImpulse=0,this.id=new At}return _createClass(b2ManifoldPoint,[{key:"Reset",value:function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}},{key:"Copy",value:function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(t){return b2MakeArray(t,function(t){return new b2ManifoldPoint})}}]),b2ManifoldPoint}();t.b2ManifoldType=void 0,(Ct=t.b2ManifoldType||(t.b2ManifoldType={}))[Ct.e_unknown=-1]="e_unknown",Ct[Ct.e_circles=0]="e_circles",Ct[Ct.e_faceA=1]="e_faceA",Ct[Ct.e_faceB=2]="e_faceB";var gt,wt=function(){function b2Manifold(){_classCallCheck(this,b2Manifold),this.points=St.MakeArray(_),this.localNormal=new F,this.localPoint=new F,this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}return _createClass(b2Manifold,[{key:"Reset",value:function(){for(var e=0;e<_;++e)this.points[e].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}},{key:"Copy",value:function(t){this.pointCount=t.pointCount;for(var e=0;e<_;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}},{key:"Clone",value:function(){return(new b2Manifold).Copy(this)}}]),b2Manifold}(),Vt=function(){function b2WorldManifold(){_classCallCheck(this,b2WorldManifold),this.normal=new F,this.points=F.MakeArray(_),this.separations=b2MakeNumberArray(_)}return _createClass(b2WorldManifold,[{key:"Initialize",value:function(e,i,s,n,o){if(0!==e.pointCount)switch(e.type){case t.b2ManifoldType.e_circles:this.normal.Set(1,0);var a=X.MulXV(i,e.localPoint,b2WorldManifold.Initialize_s_pointA),l=X.MulXV(n,e.points[0].localPoint,b2WorldManifold.Initialize_s_pointB);F.DistanceSquaredVV(a,l)>r&&F.SubVV(l,a,this.normal).SelfNormalize();var h=F.AddVMulSV(a,s,this.normal,b2WorldManifold.Initialize_s_cA),_=F.SubVMulSV(l,o,this.normal,b2WorldManifold.Initialize_s_cB);F.MidVV(h,_,this.points[0]),this.separations[0]=F.DotVV(F.SubVV(_,h,F.s_t0),this.normal);break;case t.b2ManifoldType.e_faceA:z.MulRV(i.q,e.localNormal,this.normal);for(var u=X.MulXV(i,e.localPoint,b2WorldManifold.Initialize_s_planePoint),m=0;m<e.pointCount;++m){var c=X.MulXV(n,e.points[m].localPoint,b2WorldManifold.Initialize_s_clipPoint),y=s-F.DotVV(F.SubVV(c,u,F.s_t0),this.normal),d=F.AddVMulSV(c,y,this.normal,b2WorldManifold.Initialize_s_cA),p=F.SubVMulSV(c,o,this.normal,b2WorldManifold.Initialize_s_cB);F.MidVV(d,p,this.points[m]),this.separations[m]=F.DotVV(F.SubVV(p,d,F.s_t0),this.normal)}break;case t.b2ManifoldType.e_faceB:z.MulRV(n.q,e.localNormal,this.normal);for(var f=X.MulXV(n,e.localPoint,b2WorldManifold.Initialize_s_planePoint),v=0;v<e.pointCount;++v){var b=X.MulXV(i,e.points[v].localPoint,b2WorldManifold.Initialize_s_clipPoint),C=o-F.DotVV(F.SubVV(b,f,F.s_t0),this.normal),x=F.AddVMulSV(b,C,this.normal,b2WorldManifold.Initialize_s_cB),A=F.SubVMulSV(b,s,this.normal,b2WorldManifold.Initialize_s_cA);F.MidVV(A,x,this.points[v]),this.separations[v]=F.DotVV(F.SubVV(A,x,F.s_t0),this.normal)}this.normal.SelfNeg()}}}]),b2WorldManifold}();Vt.Initialize_s_pointA=new F,Vt.Initialize_s_pointB=new F,Vt.Initialize_s_cA=new F,Vt.Initialize_s_cB=new F,Vt.Initialize_s_planePoint=new F,Vt.Initialize_s_clipPoint=new F,t.b2PointState=void 0,(gt=t.b2PointState||(t.b2PointState={}))[gt.b2_nullState=0]="b2_nullState",gt[gt.b2_addState=1]="b2_addState",gt[gt.b2_persistState=2]="b2_persistState",gt[gt.b2_removeState=3]="b2_removeState";var Bt=function(){function b2ClipVertex(){_classCallCheck(this,b2ClipVertex),this.v=new F,this.id=new At}return _createClass(b2ClipVertex,[{key:"Copy",value:function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(t){return b2MakeArray(t,function(t){return new b2ClipVertex})}}]),b2ClipVertex}(),Mt=function(){function b2RayCastInput(){_classCallCheck(this,b2RayCastInput),this.p1=new F,this.p2=new F,this.maxFraction=1}return _createClass(b2RayCastInput,[{key:"Copy",value:function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}]),b2RayCastInput}(),kt=function(){function b2RayCastOutput(){_classCallCheck(this,b2RayCastOutput),this.normal=new F,this.fraction=0}return _createClass(b2RayCastOutput,[{key:"Copy",value:function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}]),b2RayCastOutput}(),It=function(){function b2AABB(){_classCallCheck(this,b2AABB),this.lowerBound=new F,this.upperBound=new F,this.m_cache_center=new F,this.m_cache_extent=new F}return _createClass(b2AABB,[{key:"Copy",value:function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}},{key:"IsValid",value:function(){return!!this.lowerBound.IsValid()&&(!!this.upperBound.IsValid()&&(!(this.upperBound.x<this.lowerBound.x)&&!(this.upperBound.y<this.lowerBound.y)))}},{key:"GetCenter",value:function(){return F.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}},{key:"GetExtents",value:function(){return F.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}},{key:"GetPerimeter",value:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}},{key:"Combine1",value:function(t){return this.lowerBound.x=b2Min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=b2Min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=b2Max(this.upperBound.x,t.upperBound.x),this.upperBound.y=b2Max(this.upperBound.y,t.upperBound.y),this}},{key:"Combine2",value:function(t,e){return this.lowerBound.x=b2Min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=b2Min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=b2Max(t.upperBound.x,e.upperBound.x),this.upperBound.y=b2Max(t.upperBound.y,e.upperBound.y),this}},{key:"Contains",value:function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y}},{key:"RayCast",value:function(t,e){var i=-n,s=n,r=e.p1.x,a=e.p1.y,l=e.p2.x-e.p1.x,h=e.p2.y-e.p1.y,_=k(l),u=k(h),m=t.normal;if(_<o){if(r<this.lowerBound.x||this.upperBound.x<r)return!1}else{var c=1/l,y=(this.lowerBound.x-r)*c,d=(this.upperBound.x-r)*c,p=-1;if(y>d){var f=y;y=d,d=f,p=1}if(y>i&&(m.x=p,m.y=0,i=y),i>(s=b2Min(s,d)))return!1}if(u<o){if(a<this.lowerBound.y||this.upperBound.y<a)return!1}else{var v=1/h,b=(this.lowerBound.y-a)*v,C=(this.upperBound.y-a)*v,x=-1;if(b>C){var A=b;b=C,C=A,x=1}if(b>i&&(m.x=0,m.y=x,i=b),i>(s=b2Min(s,C)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)}},{key:"TestContain",value:function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x)&&!(t.y<this.lowerBound.y||this.upperBound.y<t.y)}},{key:"TestOverlap",value:function(t){return!(this.upperBound.x<t.lowerBound.x)&&(!(this.upperBound.y<t.lowerBound.y)&&(!(t.upperBound.x<this.lowerBound.x)&&!(t.upperBound.y<this.lowerBound.y)))}}],[{key:"Combine",value:function(t,e,i){return i.Combine2(t,e),i}}]),b2AABB}();function b2TestOverlapAABB(t,e){return!(t.upperBound.x<e.lowerBound.x)&&(!(t.upperBound.y<e.lowerBound.y)&&(!(e.upperBound.x<t.lowerBound.x)&&!(e.upperBound.y<t.lowerBound.y)))}function b2ClipSegmentToLine(e,i,s,n,o){var r=0,a=i[0],l=i[1],h=F.DotVV(s,a.v)-n,_=F.DotVV(s,l.v)-n;if(h<=0&&e[r++].Copy(a),_<=0&&e[r++].Copy(l),h*_<0){var u=h/(h-_),m=e[r].v;m.x=a.v.x+u*(l.v.x-a.v.x),m.y=a.v.y+u*(l.v.y-a.v.y);var c=e[r].id;c.cf.indexA=o,c.cf.indexB=a.id.cf.indexB,c.cf.typeA=t.b2ContactFeatureType.e_vertex,c.cf.typeB=t.b2ContactFeatureType.e_face,++r}return r}var Dt=new $,Pt=new H,Tt=new tt;function b2TestOverlapShape(t,e,i,s,n,r){var a=Dt.Reset();a.proxyA.SetShape(t,e),a.proxyB.SetShape(i,s),a.transformA.Copy(n),a.transformB.Copy(r),a.useRadii=!0;var l=Pt.Reset();l.count=0;var h=Tt.Reset();return b2Distance(h,l,a),h.distance<10*o}function verify(t){if(null===t)throw new Error;return t}var Gt=function(){function b2TreeNode(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;_classCallCheck(this,b2TreeNode),this.m_id=0,this.aabb=new It,this._userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.moved=!1,this.m_id=t}return _createClass(b2TreeNode,[{key:"Reset",value:function(){this._userData=null}},{key:"IsLeaf",value:function(){return null===this.child1}},{key:"userData",get:function(){if(null===this._userData)throw new Error;return this._userData},set:function(t){if(null!==this._userData)throw new Error;this._userData=t}}]),b2TreeNode}(),Rt=function(){function b2DynamicTree(){_classCallCheck(this,b2DynamicTree),this.m_root=null,this.m_freeList=null,this.m_insertionCount=0,this.m_stack=new w(256)}return _createClass(b2DynamicTree,[{key:"Query",value:function(){var t,e;(arguments.length<=0?void 0:arguments[0])instanceof It?(t=arguments.length<=0?void 0:arguments[0],e=arguments.length<=1?void 0:arguments[1]):(t=arguments.length<=1?void 0:arguments[1],e=arguments.length<=0?void 0:arguments[0]);var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var s=i.Pop();if(null!==s)if(s.aabb.TestOverlap(t))if(s.IsLeaf()){if(!e(s))return}else i.Push(s.child1),i.Push(s.child2)}}},{key:"QueryPoint",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var s=i.Pop();if(null!==s)if(s.aabb.TestContain(t))if(s.IsLeaf()){if(!e(s))return}else i.Push(s.child1),i.Push(s.child2)}}},{key:"RayCast",value:function(){var t,e;(arguments.length<=0?void 0:arguments[0])instanceof Mt?(e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1]):(e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=0?void 0:arguments[0]);var i=e.p1,s=e.p2,n=F.SubVV(s,i,b2DynamicTree.s_r);n.Normalize();var o=F.CrossOneV(n,b2DynamicTree.s_v),r=F.AbsV(o,b2DynamicTree.s_abs_v),a=e.maxFraction,l=b2DynamicTree.s_segmentAABB,h=i.x+a*(s.x-i.x),_=i.y+a*(s.y-i.y);l.lowerBound.x=b2Min(i.x,h),l.lowerBound.y=b2Min(i.y,_),l.upperBound.x=b2Max(i.x,h),l.upperBound.y=b2Max(i.y,_);var u=this.m_stack.Reset();for(u.Push(this.m_root);u.GetCount()>0;){var m=u.Pop();if(null!==m&&b2TestOverlapAABB(m.aabb,l)){var c=m.aabb.GetCenter(),y=m.aabb.GetExtents();if(!(k(F.DotVV(o,F.SubVV(i,c,F.s_t0)))-F.DotVV(r,y)>0))if(m.IsLeaf()){var d=b2DynamicTree.s_subInput;d.p1.Copy(e.p1),d.p2.Copy(e.p2),d.maxFraction=a;var p=t(d,m);if(0===p)return;p>0&&(a=p,h=i.x+a*(s.x-i.x),_=i.y+a*(s.y-i.y),l.lowerBound.x=b2Min(i.x,h),l.lowerBound.y=b2Min(i.y,_),l.upperBound.x=b2Max(i.x,h),l.upperBound.y=b2Max(i.y,_))}else u.Push(m.child1),u.Push(m.child2)}}}},{key:"AllocateNode",value:function(){if(null!==this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.moved=!1,t}return new Gt(b2DynamicTree.s_node_id++)}},{key:"FreeNode",value:function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.Reset(),this.m_freeList=t}},{key:"CreateProxy",value:function(t,e){var i=this.AllocateNode(),s=u,n=u;return i.aabb.lowerBound.x=t.lowerBound.x-s,i.aabb.lowerBound.y=t.lowerBound.y-n,i.aabb.upperBound.x=t.upperBound.x+s,i.aabb.upperBound.y=t.upperBound.y+n,i.userData=e,i.height=0,i.moved=!0,this.InsertLeaf(i),i}},{key:"DestroyProxy",value:function(t){this.RemoveLeaf(t),this.FreeNode(t)}},{key:"MoveProxy",value:function(t,e,i){var s=b2DynamicTree.MoveProxy_s_fatAABB,n=u,o=u;s.lowerBound.x=e.lowerBound.x-n,s.lowerBound.y=e.lowerBound.y-o,s.upperBound.x=e.upperBound.x+n,s.upperBound.y=e.upperBound.y+o;var r=4*i.x,a=4*i.y;r<0?s.lowerBound.x+=r:s.upperBound.x+=r,a<0?s.lowerBound.y+=a:s.upperBound.y+=a;var l=t.aabb;if(l.Contains(e)){var h=b2DynamicTree.MoveProxy_s_hugeAABB;if(h.lowerBound.x=s.lowerBound.x-4*n,h.lowerBound.y=s.lowerBound.y-4*o,h.upperBound.x=s.upperBound.x+4*n,h.upperBound.y=s.upperBound.y+4*o,h.Contains(l))return!1}return this.RemoveLeaf(t),t.aabb.Copy(s),this.InsertLeaf(t),t.moved=!0,!0}},{key:"InsertLeaf",value:function(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;!i.IsLeaf();){var s=verify(i.child1),n=verify(i.child2),o=i.aabb.GetPerimeter(),r=b2DynamicTree.s_combinedAABB;r.Combine2(i.aabb,e);var a=r.GetPerimeter(),l=2*a,h=2*(a-o),_=void 0,u=b2DynamicTree.s_aabb,m=void 0;s.IsLeaf()?(u.Combine2(e,s.aabb),_=u.GetPerimeter()+h):(u.Combine2(e,s.aabb),m=s.aabb.GetPerimeter(),_=u.GetPerimeter()-m+h);var c=void 0;if(n.IsLeaf()?(u.Combine2(e,n.aabb),c=u.GetPerimeter()+h):(u.Combine2(e,n.aabb),m=n.aabb.GetPerimeter(),c=u.GetPerimeter()-m+h),l<_&&l<c)break;i=_<c?s:n}var y=i.parent,d=this.AllocateNode();d.parent=y,d.aabb.Combine2(e,i.aabb),d.height=i.height+1,null!==y?(y.child1===i?y.child1=d:y.child2=d,d.child1=i,d.child2=t,i.parent=d,t.parent=d):(d.child1=i,d.child2=t,i.parent=d,t.parent=d,this.m_root=d);for(var p=t.parent;null!==p;){var f=verify((p=this.Balance(p)).child1),v=verify(p.child2);p.height=1+b2Max(f.height,v.height),p.aabb.Combine2(f.aabb,v.aabb),p=p.parent}}},{key:"RemoveLeaf",value:function(t){if(t!==this.m_root){var e=verify(t.parent),i=e&&e.parent,s=verify(e.child1===t?e.child2:e.child1);if(null!==i){i.child1===e?i.child1=s:i.child2=s,s.parent=i,this.FreeNode(e);for(var n=i;null!==n;){var o=verify((n=this.Balance(n)).child1),r=verify(n.child2);n.aabb.Combine2(o.aabb,r.aabb),n.height=1+b2Max(o.height,r.height),n=n.parent}}else this.m_root=s,s.parent=null,this.FreeNode(e)}else this.m_root=null}},{key:"Balance",value:function(t){if(t.IsLeaf()||t.height<2)return t;var e=verify(t.child1),i=verify(t.child2),s=i.height-e.height;if(s>1){var n=verify(i.child1),o=verify(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,n.height>o.height?(i.child2=n,t.child2=o,o.parent=t,t.aabb.Combine2(e.aabb,o.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+b2Max(e.height,o.height),i.height=1+b2Max(t.height,n.height)):(i.child2=o,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,o.aabb),t.height=1+b2Max(e.height,n.height),i.height=1+b2Max(t.height,o.height)),i}if(s<-1){var r=verify(e.child1),a=verify(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>a.height?(e.child2=r,t.child1=a,a.parent=t,t.aabb.Combine2(i.aabb,a.aabb),e.aabb.Combine2(t.aabb,r.aabb),t.height=1+b2Max(i.height,a.height),e.height=1+b2Max(t.height,r.height)):(e.child2=a,t.child1=r,r.parent=t,t.aabb.Combine2(i.aabb,r.aabb),e.aabb.Combine2(t.aabb,a.aabb),t.height=1+b2Max(i.height,r.height),e.height=1+b2Max(t.height,a.height)),e}return t}},{key:"GetHeight",value:function(){return null===this.m_root?0:this.m_root.height}},{key:"GetAreaRatio",value:function(){if(null===this.m_root)return 0;var t=this.m_root.aabb.GetPerimeter();return b2DynamicTree.GetAreaNode(this.m_root)/t}},{key:"ComputeHeight",value:function(){return b2DynamicTree.ComputeHeightNode(this.m_root)}},{key:"ValidateStructure",value:function(t){if(null!==t&&(this.m_root,!t.IsLeaf())){var e=verify(t.child1),i=verify(t.child2);this.ValidateStructure(e),this.ValidateStructure(i)}}},{key:"ValidateMetrics",value:function(t){if(null!==t&&!t.IsLeaf()){var e=verify(t.child1),i=verify(t.child2);b2DynamicTree.s_aabb.Combine2(e.aabb,i.aabb),this.ValidateMetrics(e),this.ValidateMetrics(i)}}},{key:"Validate",value:function(){}},{key:"GetMaxBalance",value:function(){return b2DynamicTree.GetMaxBalanceNode(this.m_root,0)}},{key:"RebuildBottomUp",value:function(){this.Validate()}},{key:"ShiftOrigin",value:function(t){b2DynamicTree.ShiftOriginNode(this.m_root,t)}}],[{key:"GetAreaNode",value:function(t){if(null===t)return 0;if(t.IsLeaf())return 0;var e=t.aabb.GetPerimeter();return e+=b2DynamicTree.GetAreaNode(t.child1),e+=b2DynamicTree.GetAreaNode(t.child2)}},{key:"ComputeHeightNode",value:function(t){return null===t?0:t.IsLeaf()?0:1+b2Max(b2DynamicTree.ComputeHeightNode(t.child1),b2DynamicTree.ComputeHeightNode(t.child2))}},{key:"GetMaxBalanceNode",value:function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=verify(t.child1),s=verify(t.child2);return b2Max(e,k(s.height-i.height))}},{key:"ShiftOriginNode",value:function(t,e){if(null!==t&&!(t.height<=1)){var i=t.child1,s=t.child2;b2DynamicTree.ShiftOriginNode(i,e),b2DynamicTree.ShiftOriginNode(s,e),t.aabb.lowerBound.SelfSub(e),t.aabb.upperBound.SelfSub(e)}}}]),b2DynamicTree}();Rt.s_r=new F,Rt.s_v=new F,Rt.s_abs_v=new F,Rt.s_segmentAABB=new It,Rt.s_subInput=new Mt,Rt.s_combinedAABB=new It,Rt.s_aabb=new It,Rt.s_node_id=0,Rt.MoveProxy_s_fatAABB=new It,Rt.MoveProxy_s_hugeAABB=new It;var Jt=function b2Pair(t,e){_classCallCheck(this,b2Pair),this.proxyA=t,this.proxyB=e},Lt=function(){function b2BroadPhase(){_classCallCheck(this,b2BroadPhase),this.m_tree=new Rt,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return _createClass(b2BroadPhase,[{key:"CreateProxy",value:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}},{key:"DestroyProxy",value:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}},{key:"MoveProxy",value:function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}},{key:"TouchProxy",value:function(t){this.BufferMove(t)}},{key:"GetProxyCount",value:function(){return this.m_proxyCount}},{key:"UpdatePairs",value:function(t){var e=this;this.m_pairCount=0;for(var i=function(t){var i=e.m_moveBuffer[t];if(null===i)return"continue";var s=i.aabb;e.m_tree.Query(s,function(t){if(t.m_id===i.m_id)return!0;var s,n;if(t.moved&&t.m_id>i.m_id)return!0;if(t.m_id<i.m_id?(s=t,n=i):(s=i,n=t),e.m_pairCount===e.m_pairBuffer.length)e.m_pairBuffer[e.m_pairCount]=new Jt(s,n);else{var o=e.m_pairBuffer[e.m_pairCount];o.proxyA=s,o.proxyB=n}return++e.m_pairCount,!0})},s=0;s<this.m_moveCount;++s)i(s);for(var n=0;n<this.m_pairCount;++n){var o=this.m_pairBuffer[n];t(o.proxyA.userData,o.proxyB.userData)}for(var r=0;r<this.m_moveCount;++r){var a=this.m_moveBuffer[r];null!==a&&(a.moved=!1)}this.m_moveCount=0}},{key:"Query",value:function(){this.m_tree.Query(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"QueryPoint",value:function(t,e){this.m_tree.QueryPoint(t,e)}},{key:"RayCast",value:function(t,e){this.m_tree.RayCast(t,e)}},{key:"GetTreeHeight",value:function(){return this.m_tree.GetHeight()}},{key:"GetTreeBalance",value:function(){return this.m_tree.GetMaxBalance()}},{key:"GetTreeQuality",value:function(){return this.m_tree.GetAreaRatio()}},{key:"ShiftOrigin",value:function(t){this.m_tree.ShiftOrigin(t)}},{key:"BufferMove",value:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}},{key:"UnBufferMove",value:function(t){for(var e=0;e<this.m_moveCount;e++)this.m_moveBuffer[e]==t&&(this.m_moveBuffer[e]=null)}}]),b2BroadPhase}(),Ft=function(e){function b2EdgeShape(){var e;return _classCallCheck(this,b2EdgeShape),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2EdgeShape).call(this,t.b2ShapeType.e_edgeShape,y))).m_vertex1=new F,e.m_vertex2=new F,e.m_vertex0=new F,e.m_vertex3=new F,e.m_oneSided=!1,e}return _inherits(b2EdgeShape,Q),_createClass(b2EdgeShape,[{key:"SetOneSided",value:function(t,e,i,s){return this.m_vertex0.Copy(t),this.m_vertex1.Copy(e),this.m_vertex2.Copy(i),this.m_vertex3.Copy(s),this.m_oneSided=!0,this}},{key:"SetTwoSided",value:function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_oneSided=!1,this}},{key:"Clone",value:function(){return(new b2EdgeShape).Copy(this)}},{key:"Copy",value:function(t){return _get(_getPrototypeOf(b2EdgeShape.prototype),"Copy",this).call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_oneSided=t.m_oneSided,this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){return!1}},{key:"RayCast",value:function(t,e,i,s){var n=X.MulTXV(i,e.p1,b2EdgeShape.RayCast_s_p1),o=X.MulTXV(i,e.p2,b2EdgeShape.RayCast_s_p2),r=F.SubVV(o,n,b2EdgeShape.RayCast_s_d),a=this.m_vertex1,l=this.m_vertex2,h=F.SubVV(l,a,b2EdgeShape.RayCast_s_e),_=t.normal.Set(h.y,-h.x).SelfNormalize(),u=F.DotVV(_,F.SubVV(a,n,F.s_t0));if(this.m_oneSided&&u>0)return!1;var m=F.DotVV(_,r);if(0===m)return!1;var c=u/m;if(c<0||e.maxFraction<c)return!1;var y=F.AddVMulSV(n,c,r,b2EdgeShape.RayCast_s_q),d=F.SubVV(l,a,b2EdgeShape.RayCast_s_r),p=F.DotVV(d,d);if(0===p)return!1;var f=F.DotVV(F.SubVV(y,a,F.s_t0),d)/p;return!(f<0||1<f)&&(t.fraction=c,z.MulRV(i.q,t.normal,t.normal),u>0&&t.normal.SelfNeg(),!0)}},{key:"ComputeAABB",value:function(t,e,i){var s=X.MulXV(e,this.m_vertex1,b2EdgeShape.ComputeAABB_s_v1),n=X.MulXV(e,this.m_vertex2,b2EdgeShape.ComputeAABB_s_v2);F.MinV(s,n,t.lowerBound),F.MaxV(s,n,t.upperBound);var o=this.m_radius;t.lowerBound.SelfSubXY(o,o),t.upperBound.SelfAddXY(o,o)}},{key:"ComputeMass",value:function(t,e){t.mass=0,F.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,s){return s.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_oneSided = %s;\n",this.m_oneSided)}}]),b2EdgeShape}();Ft.RayCast_s_p1=new F,Ft.RayCast_s_p2=new F,Ft.RayCast_s_d=new F,Ft.RayCast_s_e=new F,Ft.RayCast_s_q=new F,Ft.RayCast_s_r=new F,Ft.ComputeAABB_s_v1=new F,Ft.ComputeAABB_s_v2=new F;var Ot=function(e){function b2ChainShape(){var e;return _classCallCheck(this,b2ChainShape),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2ChainShape).call(this,t.b2ShapeType.e_chainShape,y))).m_vertices=[],e.m_count=0,e.m_prevVertex=new F,e.m_nextVertex=new F,e}return _inherits(b2ChainShape,Q),_createClass(b2ChainShape,[{key:"CreateLoop",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var s=e[0];if(s.length%2!=0)throw new Error;return this._CreateLoop(function(t){return{x:s[2*t],y:s[2*t+1]}},s.length/2)}var n=e[0],o=e[1]||n.length;return this._CreateLoop(function(t){return n[t]},o)}},{key:"_CreateLoop",value:function(t,e){if(e<3)return this;this.m_count=e+1,this.m_vertices=F.MakeArray(this.m_count);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this}},{key:"CreateChain",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var s=e[0],n=e[1],o=e[2];if(s.length%2!=0)throw new Error;return this._CreateChain(function(t){return{x:s[2*t],y:s[2*t+1]}},s.length/2,n,o)}var r=e[0],a=e[1]||r.length,l=e[2],h=e[3];return this._CreateChain(function(t){return r[t]},a,l,h)}},{key:"_CreateChain",value:function(t,e,i,s){this.m_count=e,this.m_vertices=F.MakeArray(e);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t(n));return this.m_prevVertex.Copy(i),this.m_nextVertex.Copy(s),this}},{key:"Clone",value:function(){return(new b2ChainShape).Copy(this)}},{key:"Copy",value:function(t){return _get(_getPrototypeOf(b2ChainShape.prototype),"Copy",this).call(this,t),this._CreateChain(function(e){return t.m_vertices[e]},t.m_count,t.m_prevVertex,t.m_nextVertex),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this}},{key:"GetChildCount",value:function(){return this.m_count-1}},{key:"GetChildEdge",value:function(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),t.m_oneSided=!0,e>0?t.m_vertex0.Copy(this.m_vertices[e-1]):t.m_vertex0.Copy(this.m_prevVertex),e<this.m_count-2?t.m_vertex3.Copy(this.m_vertices[e+2]):t.m_vertex3.Copy(this.m_nextVertex)}},{key:"TestPoint",value:function(t,e){return!1}},{key:"RayCast",value:function(t,e,i,s){var n=b2ChainShape.RayCast_s_edgeShape;return n.m_vertex1.Copy(this.m_vertices[s]),n.m_vertex2.Copy(this.m_vertices[(s+1)%this.m_count]),n.RayCast(t,e,i,0)}},{key:"ComputeAABB",value:function(t,e,i){var s=this.m_vertices[i],n=this.m_vertices[(i+1)%this.m_count],o=X.MulXV(e,s,b2ChainShape.ComputeAABB_s_v1),r=X.MulXV(e,n,b2ChainShape.ComputeAABB_s_v2),a=F.MinV(o,r,b2ChainShape.ComputeAABB_s_lower),l=F.MaxV(o,r,b2ChainShape.ComputeAABB_s_upper);t.lowerBound.x=a.x-this.m_radius,t.lowerBound.y=a.y-this.m_radius,t.upperBound.x=l.x+this.m_radius,t.upperBound.y=l.y+this.m_radius}},{key:"ComputeMass",value:function(t,e){t.mass=0,t.center.SetZero(),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,s){return s.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y)}}]),b2ChainShape}();Ot.RayCast_s_edgeShape=new Ft,Ot.ComputeAABB_s_v1=new F,Ot.ComputeAABB_s_v2=new F,Ot.ComputeAABB_s_lower=new F,Ot.ComputeAABB_s_upper=new F;var jt=function(e){function b2CircleShape(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return _classCallCheck(this,b2CircleShape),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2CircleShape).call(this,t.b2ShapeType.e_circleShape,i))).m_p=new F,e}return _inherits(b2CircleShape,Q),_createClass(b2CircleShape,[{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.m_radius;return this.m_p.Copy(t),this.m_radius=e,this}},{key:"Clone",value:function(){return(new b2CircleShape).Copy(this)}},{key:"Copy",value:function(t){return _get(_getPrototypeOf(b2CircleShape.prototype),"Copy",this).call(this,t),this.m_p.Copy(t.m_p),this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){var i=X.MulXV(t,this.m_p,b2CircleShape.TestPoint_s_center),s=F.SubVV(e,i,b2CircleShape.TestPoint_s_d);return F.DotVV(s,s)<=b2Sq(this.m_radius)}},{key:"RayCast",value:function(t,e,i,s){var n=X.MulXV(i,this.m_p,b2CircleShape.RayCast_s_position),r=F.SubVV(e.p1,n,b2CircleShape.RayCast_s_s),a=F.DotVV(r,r)-b2Sq(this.m_radius),l=F.SubVV(e.p2,e.p1,b2CircleShape.RayCast_s_r),h=F.DotVV(r,l),_=F.DotVV(l,l),u=h*h-_*a;if(u<0||_<o)return!1;var m=-(h+D(u));return 0<=m&&m<=e.maxFraction*_&&(m/=_,t.fraction=m,F.AddVMulSV(r,m,l,t.normal).SelfNormalize(),!0)}},{key:"ComputeAABB",value:function(t,e,i){var s=X.MulXV(e,this.m_p,b2CircleShape.ComputeAABB_s_p);t.lowerBound.Set(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.Set(s.x+this.m_radius,s.y+this.m_radius)}},{key:"ComputeMass",value:function(t,e){var i=b2Sq(this.m_radius);t.mass=e*a*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+F.DotVV(this.m_p,this.m_p))}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,s){var n=X.MulXV(i,this.m_p,new F),r=-(F.DotVV(t,n)-e);if(r<-this.m_radius+o)return 0;if(r>this.m_radius)return s.Copy(n),a*this.m_radius*this.m_radius;var l=this.m_radius*this.m_radius,h=r*r,_=l*(J(r/this.m_radius)+a/2)+r*D(l-h),u=-2/3*P(l-h,1.5)/_;return s.x=n.x+t.x*u,s.y=n.y+t.y*u,_}},{key:"Dump",value:function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}]),b2CircleShape}();jt.TestPoint_s_center=new F,jt.TestPoint_s_d=new F,jt.RayCast_s_position=new F,jt.RayCast_s_s=new F,jt.RayCast_s_r=new F,jt.ComputeAABB_s_p=new F;var Et=new F,qt=new F;function b2CollideCircles(e,i,s,n,o){e.pointCount=0;var r=X.MulXV(s,i.m_p,Et),a=X.MulXV(o,n.m_p,qt),l=F.DistanceSquaredVV(r,a),h=i.m_radius+n.m_radius;l>h*h||(e.type=t.b2ManifoldType.e_circles,e.localPoint.Copy(i.m_p),e.localNormal.SetZero(),e.pointCount=1,e.points[0].localPoint.Copy(n.m_p),e.points[0].id.key=0)}var zt=new F,Xt=new F,Wt=new F;function b2CollidePolygonAndCircle(e,i,s,r,a){e.pointCount=0;for(var l=X.MulXV(a,r.m_p,zt),h=X.MulTXV(s,l,Xt),_=0,u=-n,m=i.m_radius+r.m_radius,c=i.m_count,y=i.m_vertices,d=i.m_normals,p=0;p<c;++p){var f=F.DotVV(d[p],F.SubVV(h,y[p],F.s_t0));if(f>m)return;f>u&&(u=f,_=p)}var v=_,b=(v+1)%c,C=y[v],x=y[b];if(u<o)return e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(d[_]),F.MidVV(C,x,e.localPoint),e.points[0].localPoint.Copy(r.m_p),void(e.points[0].id.key=0);var A=F.DotVV(F.SubVV(h,C,F.s_t0),F.SubVV(x,C,F.s_t1)),S=F.DotVV(F.SubVV(h,x,F.s_t0),F.SubVV(C,x,F.s_t1));if(A<=0){if(F.DistanceSquaredVV(h,C)>m*m)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,F.SubVV(h,C,e.localNormal).SelfNormalize(),e.localPoint.Copy(C),e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0}else if(S<=0){if(F.DistanceSquaredVV(h,x)>m*m)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,F.SubVV(h,x,e.localNormal).SelfNormalize(),e.localPoint.Copy(x),e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0}else{var g=F.MidVV(C,x,Wt);if(F.DotVV(F.SubVV(h,g,F.s_t1),d[v])>m)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(d[v]).SelfNormalize(),e.localPoint.Copy(g),e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0}}var Nt,Zt=new F,Ut=new F,Yt=new F,Qt=new F,Kt=new F,Ht=new F,$t=new F,te=new At;function b2CollideEdgeAndCircle(e,i,s,n,o){e.pointCount=0;var r=X.MulTXV(s,X.MulXV(o,n.m_p,F.s_t0),Zt),a=i.m_vertex1,l=i.m_vertex2,h=F.SubVV(l,a,Ut),_=$t.Set(h.y,-h.x),u=F.DotVV(_,F.SubVV(r,a,F.s_t0));if(!(i.m_oneSided&&u<0)){var m=F.DotVV(h,F.SubVV(l,r,F.s_t0)),c=F.DotVV(h,F.SubVV(r,a,F.s_t0)),y=i.m_radius+n.m_radius,d=te;if(d.cf.indexB=0,d.cf.typeB=t.b2ContactFeatureType.e_vertex,c<=0){var p=a,f=F.SubVV(r,p,Yt);if(F.DotVV(f,f)>y*y)return;if(i.m_oneSided){var v=i.m_vertex0,b=a,C=F.SubVV(b,v,Qt);if(F.DotVV(C,F.SubVV(b,r,F.s_t0))>0)return}return d.cf.indexA=0,d.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(p),e.points[0].id.Copy(d),void e.points[0].localPoint.Copy(n.m_p)}if(m<=0){var x=l,A=F.SubVV(r,x,Yt);if(F.DotVV(A,A)>y*y)return;if(i.m_oneSided){var S=i.m_vertex3,g=l,w=F.SubVV(S,g,Kt);if(F.DotVV(w,F.SubVV(r,g,F.s_t0))>0)return}return d.cf.indexA=1,d.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(x),e.points[0].id.Copy(d),void e.points[0].localPoint.Copy(n.m_p)}var V=F.DotVV(h,h),B=Ht;B.x=1/V*(m*a.x+c*l.x),B.y=1/V*(m*a.y+c*l.y);var M=F.SubVV(r,B,Yt);F.DotVV(M,M)>y*y||(u<0&&_.Set(-_.x,-_.y),_.Normalize(),d.cf.indexA=0,d.cf.typeA=t.b2ContactFeatureType.e_face,e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(_),e.localPoint.Copy(a),e.points[0].id.Copy(d),e.points[0].localPoint.Copy(n.m_p))}}!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(Nt||(Nt={}));var ee=function b2EPAxis(){_classCallCheck(this,b2EPAxis),this.normal=new F,this.type=Nt.e_unknown,this.index=0,this.separation=0},ie=new ee,se=[new F,new F];var ne=new ee,oe=new F;var re=new X,ae=new F,le=new F,he=new F,_e=new F,ue=new F,me=new F,ce=new F,ye=new function b2TempPolygon(){_classCallCheck(this,b2TempPolygon),this.vertices=[],this.normals=[],this.count=0},de=new function b2ReferenceFace(){_classCallCheck(this,b2ReferenceFace),this.i1=0,this.i2=0,this.v1=new F,this.v2=new F,this.normal=new F,this.sideNormal1=new F,this.sideOffset1=0,this.sideNormal2=new F,this.sideOffset2=0},pe=[new Bt,new Bt],fe=[new Bt,new Bt],ve=[new Bt,new Bt];function b2CollideEdgeAndPolygon(e,i,s,n,o){e.pointCount=0;var r=X.MulTXX(s,o,re),a=X.MulXV(r,n.m_centroid,ae),l=i.m_vertex1,h=i.m_vertex2,u=F.SubVV(h,l,le);u.Normalize();var m=he.Set(u.y,-u.x),c=F.DotVV(m,F.SubVV(a,l,F.s_t0)),y=i.m_oneSided;if(!(y&&c<0)){var d=ye;d.count=n.m_count;for(var p=0;p<n.m_count;++p)d.vertices.length<=p&&d.vertices.push(new F),d.normals.length<=p&&d.normals.push(new F),X.MulXV(r,n.m_vertices[p],d.vertices[p]),z.MulRV(r.q,n.m_normals[p],d.normals[p]);var f=n.m_radius+i.m_radius,v=function(t,e,i){var s=ie;s.type=Nt.e_edgeA,s.index=-1,s.separation=-Number.MAX_VALUE,s.normal.SetZero();var n=se;n[0].Copy(i),n[1].Copy(i).SelfNeg();for(var o=0;o<2;++o){for(var r=Number.MAX_VALUE,a=0;a<t.count;++a){var l=F.DotVV(n[o],F.SubVV(t.vertices[a],e,F.s_t0));l<r&&(r=l)}r>s.separation&&(s.index=o,s.separation=r,s.normal.Copy(n[o]))}return s}(d,l,m);if(!(v.separation>f)){var b=function(t,e,i){var s=ne;s.type=Nt.e_unknown,s.index=-1,s.separation=-Number.MAX_VALUE,s.normal.SetZero();for(var n=0;n<t.count;++n){var o=F.NegV(t.normals[n],oe),r=b2Min(F.DotVV(o,F.SubVV(t.vertices[n],e,F.s_t0)),F.DotVV(o,F.SubVV(t.vertices[n],i,F.s_t0)));r>s.separation&&(s.type=Nt.e_edgeB,s.index=n,s.separation=r,s.normal.Copy(o))}return s}(d,l,h);if(!(b.separation>f)){var C;if(C=b.separation-f>.98*(v.separation-f)+.001?b:v,y){var x=F.SubVV(l,i.m_vertex0,_e);x.Normalize();var A=ue.Set(x.y,-x.x),S=F.CrossVV(x,u)>=0,g=F.SubVV(i.m_vertex3,h,me);g.Normalize();var w=ce.Set(g.y,-g.x),V=F.CrossVV(u,g)>=0;if(F.DotVV(C.normal,u)<=0)if(S){if(F.CrossVV(C.normal,A)>.1)return}else C=v;else if(V){if(F.CrossVV(w,C.normal)>.1)return}else C=v}var B=pe,M=de;if(C.type===Nt.e_edgeA){e.type=t.b2ManifoldType.e_faceA;for(var k=0,I=F.DotVV(C.normal,d.normals[0]),D=1;D<d.count;++D){var P=F.DotVV(C.normal,d.normals[D]);P<I&&(I=P,k=D)}var T=k,G=T+1<d.count?T+1:0;B[0].v.Copy(d.vertices[T]),B[0].id.cf.indexA=0,B[0].id.cf.indexB=T,B[0].id.cf.typeA=t.b2ContactFeatureType.e_face,B[0].id.cf.typeB=t.b2ContactFeatureType.e_vertex,B[1].v.Copy(d.vertices[G]),B[1].id.cf.indexA=0,B[1].id.cf.indexB=G,B[1].id.cf.typeA=t.b2ContactFeatureType.e_face,B[1].id.cf.typeB=t.b2ContactFeatureType.e_vertex,M.i1=0,M.i2=1,M.v1.Copy(l),M.v2.Copy(h),M.normal.Copy(C.normal),M.sideNormal1.Copy(u).SelfNeg(),M.sideNormal2.Copy(u)}else e.type=t.b2ManifoldType.e_faceB,B[0].v.Copy(h),B[0].id.cf.indexA=1,B[0].id.cf.indexB=C.index,B[0].id.cf.typeA=t.b2ContactFeatureType.e_vertex,B[0].id.cf.typeB=t.b2ContactFeatureType.e_face,B[1].v.Copy(l),B[1].id.cf.indexA=0,B[1].id.cf.indexB=C.index,B[1].id.cf.typeA=t.b2ContactFeatureType.e_vertex,B[1].id.cf.typeB=t.b2ContactFeatureType.e_face,M.i1=C.index,M.i2=M.i1+1<d.count?M.i1+1:0,M.v1.Copy(d.vertices[M.i1]),M.v2.Copy(d.vertices[M.i2]),M.normal.Copy(d.normals[M.i1]),M.sideNormal1.Set(M.normal.y,-M.normal.x),M.sideNormal2.Copy(M.sideNormal1).SelfNeg();M.sideOffset1=F.DotVV(M.sideNormal1,M.v1),M.sideOffset2=F.DotVV(M.sideNormal2,M.v2);var R=fe,J=ve;if(!(b2ClipSegmentToLine(R,B,M.sideNormal1,M.sideOffset1,M.i1)<_||b2ClipSegmentToLine(J,R,M.sideNormal2,M.sideOffset2,M.i2)<_)){C.type===Nt.e_edgeA?(e.localNormal.Copy(M.normal),e.localPoint.Copy(M.v1)):(e.localNormal.Copy(n.m_normals[M.i1]),e.localPoint.Copy(n.m_vertices[M.i1]));for(var L=0,O=0;O<_;++O){if(F.DotVV(M.normal,F.SubVV(J[O].v,M.v1,F.s_t0))<=f){var j=e.points[L];C.type===Nt.e_edgeA?(X.MulTXV(r,J[O].v,j.localPoint),j.id.Copy(J[O].id)):(j.localPoint.Copy(J[O].v),j.id.cf.typeA=J[O].id.cf.typeB,j.id.cf.typeB=J[O].id.cf.typeA,j.id.cf.indexA=J[O].id.cf.indexB,j.id.cf.indexB=J[O].id.cf.indexA),++L}}e.pointCount=L}}}}}var be=new X,Ce=new F,xe=new F;function b2FindMaxSeparation(t,e,i,s,o){for(var r=e.m_count,a=s.m_count,l=e.m_normals,h=e.m_vertices,_=s.m_vertices,u=X.MulTXX(o,i,be),m=0,c=-n,y=0;y<r;++y){for(var d=z.MulRV(u.q,l[y],Ce),p=X.MulXV(u,h[y],xe),f=n,v=0;v<a;++v){var b=F.DotVV(d,F.SubVV(_[v],p,F.s_t0));b<f&&(f=b)}f>c&&(c=f,m=y)}return t[0]=m,c}var Ae=new F;var Se=[new Bt,new Bt],ge=[new Bt,new Bt],we=[new Bt,new Bt],Ve=[0],Be=[0],Me=new F,ke=new F,Ie=new F,De=new F,Pe=new F,Te=new F,Ge=new F,Re=new F;function b2CollidePolygons(e,i,s,o,r){e.pointCount=0;var a=i.m_radius+o.m_radius,l=Ve;l[0]=0;var h=b2FindMaxSeparation(l,i,s,o,r);if(!(h>a)){var u=Be;u[0]=0;var c=b2FindMaxSeparation(u,o,r,i,s);if(!(c>a)){var y,d,p,f,v=0,b=0;c>h+.1*m?(y=o,d=i,p=r,f=s,v=u[0],e.type=t.b2ManifoldType.e_faceB,b=1):(y=i,d=o,p=s,f=r,v=l[0],e.type=t.b2ManifoldType.e_faceA,b=0);var C=Se;!function(e,i,s,o,r,a){for(var l=i.m_normals,h=r.m_count,_=r.m_vertices,u=r.m_normals,m=z.MulTRV(a.q,z.MulRV(s.q,l[o],F.s_t0),Ae),c=0,y=n,d=0;d<h;++d){var p=F.DotVV(m,u[d]);p<y&&(y=p,c=d)}var f=c,v=f+1<h?f+1:0,b=e[0];X.MulXV(a,_[f],b.v);var C=b.id.cf;C.indexA=o,C.indexB=f,C.typeA=t.b2ContactFeatureType.e_face,C.typeB=t.b2ContactFeatureType.e_vertex;var x=e[1];X.MulXV(a,_[v],x.v);var A=x.id.cf;A.indexA=o,A.indexB=v,A.typeA=t.b2ContactFeatureType.e_face,A.typeB=t.b2ContactFeatureType.e_vertex}(C,y,p,v,d,f);var x=y.m_count,A=y.m_vertices,S=v,g=v+1<x?v+1:0,w=A[S],V=A[g],B=F.SubVV(V,w,Me);B.Normalize();var M=F.CrossVOne(B,ke),k=F.MidVV(w,V,Ie),I=z.MulRV(p.q,B,Pe),D=F.CrossVOne(I,De),P=X.MulXV(p,w,Ge),T=X.MulXV(p,V,Re),G=F.DotVV(D,P),R=-F.DotVV(I,P)+a,J=F.DotVV(I,T)+a,L=ge,O=we;if(!(b2ClipSegmentToLine(L,C,F.NegV(I,Te),R,S)<2||b2ClipSegmentToLine(O,L,I,J,g)<2)){e.localNormal.Copy(M),e.localPoint.Copy(k);for(var j=0,E=0;E<_;++E){var q=O[E];if(F.DotVV(D,q.v)-G<=a){var W=e.points[j];if(X.MulTXV(f,q.v,W.localPoint),W.id.Copy(q.id),b){var N=W.id.cf;W.id.cf.indexA=N.indexB,W.id.cf.indexB=N.indexA,W.id.cf.typeA=N.typeB,W.id.cf.typeB=N.typeA}++j}}e.pointCount=j}}}}var Je=function(e){function b2PolygonShape(){var e;return _classCallCheck(this,b2PolygonShape),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2PolygonShape).call(this,t.b2ShapeType.e_polygonShape,y))).m_centroid=new F(0,0),e.m_vertices=[],e.m_normals=[],e.m_count=0,e}return _inherits(b2PolygonShape,Q),_createClass(b2PolygonShape,[{key:"Clone",value:function(){return(new b2PolygonShape).Copy(this)}},{key:"Copy",value:function(t){_get(_getPrototypeOf(b2PolygonShape.prototype),"Copy",this).call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=F.MakeArray(this.m_count),this.m_normals=F.MakeArray(this.m_count);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}},{key:"GetChildCount",value:function(){return 1}},{key:"Set",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var s=e[0];if(s.length%2!=0)throw new Error;return this._Set(function(t){return{x:s[2*t],y:s[2*t+1]}},s.length/2)}var n=e[0],o=e[1]||n.length;return this._Set(function(t){return n[t]},o)}},{key:"_Set",value:function(t,e){if(e<3)return this.SetAsBox(1,1);for(var i=e,s=[],n=0;n<i;++n){for(var o=t(n),r=!0,a=0;a<s.length;++a)if(F.DistanceSquaredVV(o,s[a])<.5*m*(.5*m)){r=!1;break}r&&s.push(o)}if((i=s.length)<3)return this.SetAsBox(1,1);for(var l=0,h=s[0].x,_=1;_<i;++_){var u=s[_].x;(u>h||u===h&&s[_].y<s[l].y)&&(l=_,h=u)}for(var c=[],y=0,d=l;;){c[y]=d;for(var p=0,f=1;f<i;++f)if(p!==d){var v=F.SubVV(s[p],s[c[y]],b2PolygonShape.Set_s_r),b=F.SubVV(s[f],s[c[y]],b2PolygonShape.Set_s_v),C=F.CrossVV(v,b);C<0&&(p=f),0===C&&b.LengthSquared()>v.LengthSquared()&&(p=f)}else p=f;if(++y,d=p,p===l)break}this.m_count=y,this.m_vertices=F.MakeArray(this.m_count),this.m_normals=F.MakeArray(this.m_count);for(var x=0;x<y;++x)this.m_vertices[x].Copy(s[c[x]]);for(var A=0;A<y;++A){var S=this.m_vertices[A],g=this.m_vertices[(A+1)%y],w=F.SubVV(g,S,F.s_t0);F.CrossVOne(w,this.m_normals[A]).SelfNormalize()}return b2PolygonShape.ComputeCentroid(this.m_vertices,y,this.m_centroid),this}},{key:"SetAsBox",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.m_count=4,this.m_vertices=F.MakeArray(this.m_count),this.m_normals=F.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var n=new X;n.SetPosition(i),n.SetRotationAngle(s);for(var o=0;o<this.m_count;++o)X.MulXV(n,this.m_vertices[o],this.m_vertices[o]),z.MulRV(n.q,this.m_normals[o],this.m_normals[o])}return this}},{key:"TestPoint",value:function(t,e){for(var i=X.MulTXV(t,e,b2PolygonShape.TestPoint_s_pLocal),s=0;s<this.m_count;++s){if(F.DotVV(this.m_normals[s],F.SubVV(i,this.m_vertices[s],F.s_t0))>0)return!1}return!0}},{key:"RayCast",value:function(t,e,i,s){for(var n=X.MulTXV(i,e.p1,b2PolygonShape.RayCast_s_p1),o=X.MulTXV(i,e.p2,b2PolygonShape.RayCast_s_p2),r=F.SubVV(o,n,b2PolygonShape.RayCast_s_d),a=0,l=e.maxFraction,h=-1,_=0;_<this.m_count;++_){var u=F.DotVV(this.m_normals[_],F.SubVV(this.m_vertices[_],n,F.s_t0)),m=F.DotVV(this.m_normals[_],r);if(0===m){if(u<0)return!1}else m<0&&u<a*m?(a=u/m,h=_):m>0&&u<l*m&&(l=u/m);if(l<a)return!1}return h>=0&&(t.fraction=a,z.MulRV(i.q,this.m_normals[h],t.normal),!0)}},{key:"ComputeAABB",value:function(t,e,i){for(var s=X.MulXV(e,this.m_vertices[0],t.lowerBound),n=t.upperBound.Copy(s),o=0;o<this.m_count;++o){var r=X.MulXV(e,this.m_vertices[o],b2PolygonShape.ComputeAABB_s_v);F.MinV(r,s,s),F.MaxV(r,n,n)}var a=this.m_radius;s.SelfSubXY(a,a),n.SelfAddXY(a,a)}},{key:"ComputeMass",value:function(t,e){for(var i=b2PolygonShape.ComputeMass_s_center.SetZero(),s=0,n=0,o=b2PolygonShape.ComputeMass_s_s.Copy(this.m_vertices[0]),r=0;r<this.m_count;++r){var a=F.SubVV(this.m_vertices[r],o,b2PolygonShape.ComputeMass_s_e1),l=F.SubVV(this.m_vertices[(r+1)%this.m_count],o,b2PolygonShape.ComputeMass_s_e2),h=F.CrossVV(a,l),_=.5*h;s+=_,i.SelfAdd(F.MulSV(_*(1/3),F.AddVV(a,l,F.s_t0),F.s_t1));var u=a.x,m=a.y,c=l.x,y=l.y;n+=1/3*.25*h*(u*u+c*u+c*c+(m*m+y*m+y*y))}t.mass=e*s,i.SelfMul(1/s),F.AddVV(i,o,t.center),t.I=e*n,t.I+=t.mass*(F.DotVV(t.center,t.center)-F.DotVV(i,i))}},{key:"Validate",value:function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=(t+1)%this.m_count,s=this.m_vertices[e],n=F.SubVV(this.m_vertices[i],s,b2PolygonShape.Validate_s_e),o=0;o<this.m_count;++o)if(o!==e&&o!==i){var r=F.SubVV(this.m_vertices[o],s,b2PolygonShape.Validate_s_v);if(F.CrossVV(n,r)<0)return!1}return!0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,s){for(var n=z.MulTRV(i.q,t,b2PolygonShape.ComputeSubmergedArea_s_normalL),r=e-F.DotVV(t,i.p),a=[],l=0,h=-1,_=-1,u=!1,m=0;m<this.m_count;++m){a[m]=F.DotVV(n,this.m_vertices[m])-r;var c=a[m]<-o;m>0&&(c?u||(h=m-1,l++):u&&(_=m-1,l++)),u=c}switch(l){case 0:if(u){var y=b2PolygonShape.ComputeSubmergedArea_s_md;return this.ComputeMass(y,1),X.MulXV(i,y.center,s),y.mass}return 0;case 1:-1===h?h=this.m_count-1:_=this.m_count-1}for(var d,p=(h+1)%this.m_count,f=(_+1)%this.m_count,v=(0-a[h])/(a[p]-a[h]),b=(0-a[_])/(a[f]-a[_]),C=b2PolygonShape.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[h].x*(1-v)+this.m_vertices[p].x*v,this.m_vertices[h].y*(1-v)+this.m_vertices[p].y*v),x=b2PolygonShape.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[_].x*(1-b)+this.m_vertices[f].x*b,this.m_vertices[_].y*(1-b)+this.m_vertices[f].y*b),A=0,S=b2PolygonShape.ComputeSubmergedArea_s_center.SetZero(),g=this.m_vertices[p],w=p;w!==f;){d=(w=(w+1)%this.m_count)===f?x:this.m_vertices[w];var V=.5*((g.x-C.x)*(d.y-C.y)-(g.y-C.y)*(d.x-C.x));A+=V,S.x+=V*(C.x+g.x+d.x)/3,S.y+=V*(C.y+g.y+d.y)/3,g=d}return S.SelfMul(1/A),X.MulXV(i,S,s),A}},{key:"Dump",value:function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}}],[{key:"ComputeCentroid",value:function(t,e,i){var s=i;s.SetZero();for(var n=0,o=b2PolygonShape.ComputeCentroid_s_s.Copy(t[0]),r=0;r<e;++r){var a=F.SubVV(t[0],o,b2PolygonShape.ComputeCentroid_s_p1),l=F.SubVV(t[r],o,b2PolygonShape.ComputeCentroid_s_p2),h=F.SubVV(t[(r+1)%e],o,b2PolygonShape.ComputeCentroid_s_p3),_=F.SubVV(l,a,b2PolygonShape.ComputeCentroid_s_e1),u=F.SubVV(h,a,b2PolygonShape.ComputeCentroid_s_e2),m=.5*F.CrossVV(_,u);n+=m,s.x+=m*(1/3)*(a.x+l.x+h.x),s.y+=m*(1/3)*(a.y+l.y+h.y)}return s.x=1/n*s.x+o.x,s.y=1/n*s.y+o.y,s}}]),b2PolygonShape}();Je.Set_s_r=new F,Je.Set_s_v=new F,Je.TestPoint_s_pLocal=new F,Je.RayCast_s_p1=new F,Je.RayCast_s_p2=new F,Je.RayCast_s_d=new F,Je.ComputeAABB_s_v=new F,Je.ComputeMass_s_center=new F,Je.ComputeMass_s_s=new F,Je.ComputeMass_s_e1=new F,Je.ComputeMass_s_e2=new F,Je.Validate_s_e=new F,Je.Validate_s_v=new F,Je.ComputeSubmergedArea_s_normalL=new F,Je.ComputeSubmergedArea_s_md=new Y,Je.ComputeSubmergedArea_s_intoVec=new F,Je.ComputeSubmergedArea_s_outoVec=new F,Je.ComputeSubmergedArea_s_center=new F,Je.ComputeCentroid_s_s=new F,Je.ComputeCentroid_s_p1=new F,Je.ComputeCentroid_s_p2=new F,Je.ComputeCentroid_s_p3=new F,Je.ComputeCentroid_s_e1=new F,Je.ComputeCentroid_s_e2=new F,t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0;var Le,Fe=new X,Oe=new X,je=new F,Ee=new F,qe=new F,ze=new F,Xe=new F,We=function b2TOIInput(){_classCallCheck(this,b2TOIInput),this.proxyA=new K,this.proxyB=new K,this.sweepA=new N,this.sweepB=new N,this.tMax=0};t.b2TOIOutputState=void 0,(Le=t.b2TOIOutputState||(t.b2TOIOutputState={}))[Le.e_unknown=0]="e_unknown",Le[Le.e_failed=1]="e_failed",Le[Le.e_overlapped=2]="e_overlapped",Le[Le.e_touching=3]="e_touching",Le[Le.e_separated=4]="e_separated";var Ne,Ze=function b2TOIOutput(){_classCallCheck(this,b2TOIOutput),this.state=t.b2TOIOutputState.e_unknown,this.t=0};t.b2SeparationFunctionType=void 0,(Ne=t.b2SeparationFunctionType||(t.b2SeparationFunctionType={}))[Ne.e_unknown=-1]="e_unknown",Ne[Ne.e_points=0]="e_points",Ne[Ne.e_faceA=1]="e_faceA",Ne[Ne.e_faceB=2]="e_faceB";var Ue,Ye=function(){function b2SeparationFunction(){_classCallCheck(this,b2SeparationFunction),this.m_sweepA=new N,this.m_sweepB=new N,this.m_type=t.b2SeparationFunctionType.e_unknown,this.m_localPoint=new F,this.m_axis=new F}return _createClass(b2SeparationFunction,[{key:"Initialize",value:function(e,i,s,n,o,r){this.m_proxyA=i,this.m_proxyB=n;var a=e.count;this.m_sweepA.Copy(s),this.m_sweepB.Copy(o);var l=Fe,h=Oe;if(this.m_sweepA.GetTransform(l,r),this.m_sweepB.GetTransform(h,r),1===a){this.m_type=t.b2SeparationFunctionType.e_points;var _=this.m_proxyA.GetVertex(e.indexA[0]),u=this.m_proxyB.GetVertex(e.indexB[0]),m=X.MulXV(l,_,je),c=X.MulXV(h,u,Ee);return F.SubVV(c,m,this.m_axis),this.m_axis.Normalize()}if(e.indexA[0]===e.indexA[1]){this.m_type=t.b2SeparationFunctionType.e_faceB;var y=this.m_proxyB.GetVertex(e.indexB[0]),d=this.m_proxyB.GetVertex(e.indexB[1]);F.CrossVOne(F.SubVV(d,y,F.s_t0),this.m_axis).SelfNormalize();var p=z.MulRV(h.q,this.m_axis,qe);F.MidVV(y,d,this.m_localPoint);var f=X.MulXV(h,this.m_localPoint,Ee),v=this.m_proxyA.GetVertex(e.indexA[0]),b=X.MulXV(l,v,je),C=F.DotVV(F.SubVV(b,f,F.s_t0),p);return C<0&&(this.m_axis.SelfNeg(),C=-C),C}this.m_type=t.b2SeparationFunctionType.e_faceA;var x=this.m_proxyA.GetVertex(e.indexA[0]),A=this.m_proxyA.GetVertex(e.indexA[1]);F.CrossVOne(F.SubVV(A,x,F.s_t0),this.m_axis).SelfNormalize();var S=z.MulRV(l.q,this.m_axis,qe);F.MidVV(x,A,this.m_localPoint);var g=X.MulXV(l,this.m_localPoint,je),w=this.m_proxyB.GetVertex(e.indexB[0]),V=X.MulXV(h,w,Ee),B=F.DotVV(F.SubVV(V,g,F.s_t0),S);return B<0&&(this.m_axis.SelfNeg(),B=-B),B}},{key:"FindMinSeparation",value:function(e,i,s){var n=Fe,o=Oe;switch(this.m_sweepA.GetTransform(n,s),this.m_sweepB.GetTransform(o,s),this.m_type){case t.b2SeparationFunctionType.e_points:var r=z.MulTRV(n.q,this.m_axis,ze),a=z.MulTRV(o.q,F.NegV(this.m_axis,F.s_t0),Xe);e[0]=this.m_proxyA.GetSupport(r),i[0]=this.m_proxyB.GetSupport(a);var l=this.m_proxyA.GetVertex(e[0]),h=this.m_proxyB.GetVertex(i[0]),_=X.MulXV(n,l,je),u=X.MulXV(o,h,Ee);return F.DotVV(F.SubVV(u,_,F.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var m=z.MulRV(n.q,this.m_axis,qe),c=X.MulXV(n,this.m_localPoint,je),y=z.MulTRV(o.q,F.NegV(m,F.s_t0),Xe);e[0]=-1,i[0]=this.m_proxyB.GetSupport(y);var d=this.m_proxyB.GetVertex(i[0]),p=X.MulXV(o,d,Ee);return F.DotVV(F.SubVV(p,c,F.s_t0),m);case t.b2SeparationFunctionType.e_faceB:var f=z.MulRV(o.q,this.m_axis,qe),v=X.MulXV(o,this.m_localPoint,Ee),b=z.MulTRV(n.q,F.NegV(f,F.s_t0),ze);i[0]=-1,e[0]=this.m_proxyA.GetSupport(b);var C=this.m_proxyA.GetVertex(e[0]),x=X.MulXV(n,C,je);return F.DotVV(F.SubVV(x,v,F.s_t0),f);default:return e[0]=-1,i[0]=-1,0}}},{key:"Evaluate",value:function(e,i,s){var n=Fe,o=Oe;switch(this.m_sweepA.GetTransform(n,s),this.m_sweepB.GetTransform(o,s),this.m_type){case t.b2SeparationFunctionType.e_points:var r=this.m_proxyA.GetVertex(e),a=this.m_proxyB.GetVertex(i),l=X.MulXV(n,r,je),h=X.MulXV(o,a,Ee);return F.DotVV(F.SubVV(h,l,F.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var _=z.MulRV(n.q,this.m_axis,qe),u=X.MulXV(n,this.m_localPoint,je),m=this.m_proxyB.GetVertex(i),c=X.MulXV(o,m,Ee);return F.DotVV(F.SubVV(c,u,F.s_t0),_);case t.b2SeparationFunctionType.e_faceB:var y=z.MulRV(o.q,this.m_axis,qe),d=X.MulXV(o,this.m_localPoint,Ee),p=this.m_proxyA.GetVertex(e),f=X.MulXV(n,p,je);return F.DotVV(F.SubVV(f,d,F.s_t0),y);default:return 0}}}]),b2SeparationFunction}(),Qe=new Z,Ke=new H,He=new $,$e=new tt,ti=new Ye,ei=[0],ii=[0],si=new N,ni=new N;function b2TimeOfImpact(e,i){var s=Qe.Reset();++t.b2_toiCalls,e.state=t.b2TOIOutputState.e_unknown,e.t=i.tMax;var n=i.proxyA,o=i.proxyB,r=b2Max(h,b2Max(n.m_count,o.m_count)),a=si.Copy(i.sweepA),l=ni.Copy(i.sweepB);a.Normalize(),l.Normalize();var _=i.tMax,u=n.m_radius+o.m_radius,c=b2Max(m,u-3*m),y=.25*m,d=0,p=0,f=Ke;f.count=0;var v=He;for(v.proxyA.Copy(i.proxyA),v.proxyB.Copy(i.proxyB),v.useRadii=!1;;){var b=Fe,C=Oe;a.GetTransform(b,d),l.GetTransform(C,d),v.transformA.Copy(b),v.transformB.Copy(C);var x=$e;if(b2Distance(x,f,v),x.distance<=0){e.state=t.b2TOIOutputState.e_overlapped,e.t=0;break}if(x.distance<c+y){e.state=t.b2TOIOutputState.e_touching,e.t=d;break}var A=ti;A.Initialize(f,n,a,o,l,d);for(var S=!1,g=_,w=0;;){var V=ei,B=ii,M=A.FindMinSeparation(V,B,g);if(M>c+y){e.state=t.b2TOIOutputState.e_separated,e.t=_,S=!0;break}if(M>c-y){d=g;break}var I=A.Evaluate(V[0],B[0],d);if(I<c-y){e.state=t.b2TOIOutputState.e_failed,e.t=d,S=!0;break}if(I<=c+y){e.state=t.b2TOIOutputState.e_touching,e.t=d,S=!0;break}for(var D=0,P=d,T=g;;){var G=0;G=1&D?P+(c-I)*(T-P)/(M-I):.5*(P+T),++D,++t.b2_toiRootIters;var R=A.Evaluate(V[0],B[0],G);if(k(R-c)<y){g=G;break}if(R>c?(P=G,I=R):(T=G,M=R),50===D)break}if(t.b2_toiMaxRootIters=b2Max(t.b2_toiMaxRootIters,D),++w===r)break}if(++p,++t.b2_toiIters,S)break;if(20===p){e.state=t.b2TOIOutputState.e_failed,e.t=d;break}}t.b2_toiMaxIters=b2Max(t.b2_toiMaxIters,p);var J=s.GetMilliseconds();t.b2_toiMaxTime=b2Max(t.b2_toiMaxTime,J),t.b2_toiTime+=J}t.b2JointType=void 0,(Ue=t.b2JointType||(t.b2JointType={}))[Ue.e_unknownJoint=0]="e_unknownJoint",Ue[Ue.e_revoluteJoint=1]="e_revoluteJoint",Ue[Ue.e_prismaticJoint=2]="e_prismaticJoint",Ue[Ue.e_distanceJoint=3]="e_distanceJoint",Ue[Ue.e_pulleyJoint=4]="e_pulleyJoint",Ue[Ue.e_mouseJoint=5]="e_mouseJoint",Ue[Ue.e_gearJoint=6]="e_gearJoint",Ue[Ue.e_wheelJoint=7]="e_wheelJoint",Ue[Ue.e_weldJoint=8]="e_weldJoint",Ue[Ue.e_frictionJoint=9]="e_frictionJoint",Ue[Ue.e_ropeJoint=10]="e_ropeJoint",Ue[Ue.e_motorJoint=11]="e_motorJoint",Ue[Ue.e_areaJoint=12]="e_areaJoint";var oi=function(){function b2Jacobian(){_classCallCheck(this,b2Jacobian),this.linear=new F,this.angularA=0,this.angularB=0}return _createClass(b2Jacobian,[{key:"SetZero",value:function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this}},{key:"Set",value:function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this}}]),b2Jacobian}(),ri=function(){function b2JointEdge(t){_classCallCheck(this,b2JointEdge),this._other=null,this.prev=null,this.next=null,this.joint=t}return _createClass(b2JointEdge,[{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}},{key:"other",get:function(){if(null===this._other)throw new Error;return this._other},set:function(t){if(null!==this._other)throw new Error;this._other=t}}]),b2JointEdge}(),ai=function b2JointDef(e){_classCallCheck(this,b2JointDef),this.type=t.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=e};var li=function(){function b2Joint(e){_classCallCheck(this,b2Joint),this.m_type=t.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_edgeA=new ri(this),this.m_edgeB=new ri(this),this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=e.type,this.m_edgeA.other=e.bodyB,this.m_edgeB.other=e.bodyA,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=b2Maybe(e.collideConnected,!1),this.m_userData=b2Maybe(e.userData,null)}return _createClass(b2Joint,[{key:"GetType",value:function(){return this.m_type}},{key:"GetBodyA",value:function(){return this.m_bodyA}},{key:"GetBodyB",value:function(){return this.m_bodyB}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"IsEnabled",value:function(){return this.m_bodyA.IsEnabled()&&this.m_bodyB.IsEnabled()}},{key:"GetCollideConnected",value:function(){return this.m_collideConnected}},{key:"Dump",value:function(t){t("// Dump is not supported for this joint type.\n")}},{key:"ShiftOrigin",value:function(t){}},{key:"Draw",value:function(e){var i=this.m_bodyA.GetTransform(),s=this.m_bodyB.GetTransform(),n=i.p,o=s.p,r=this.GetAnchorA(b2Joint.Draw_s_p1),a=this.GetAnchorB(b2Joint.Draw_s_p2),l=b2Joint.Draw_s_color.SetRGB(.5,.8,.8);switch(this.m_type){case t.b2JointType.e_distanceJoint:e.DrawSegment(r,a,l);break;case t.b2JointType.e_pulleyJoint:var h=this.GetGroundAnchorA(),_=this.GetGroundAnchorB();e.DrawSegment(h,r,l),e.DrawSegment(_,a,l),e.DrawSegment(h,_,l);break;case t.b2JointType.e_mouseJoint:var u=b2Joint.Draw_s_c;u.Set(0,1,0),e.DrawPoint(r,4,u),e.DrawPoint(a,4,u),u.Set(.8,.8,.8),e.DrawSegment(r,a,u);break;default:e.DrawSegment(n,r,l),e.DrawSegment(r,a,l),e.DrawSegment(o,a,l)}}}]),b2Joint}();li.Draw_s_p1=new F,li.Draw_s_p2=new F,li.Draw_s_color=new i(.5,.8,.8),li.Draw_s_c=new i;var hi=function(e){function b2DistanceJointDef(){var e;return _classCallCheck(this,b2DistanceJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2DistanceJointDef).call(this,t.b2JointType.e_distanceJoint))).localAnchorA=new F,e.localAnchorB=new F,e.length=1,e.minLength=0,e.maxLength=n,e.stiffness=0,e.damping=0,e}return _inherits(b2DistanceJointDef,ai),_createClass(b2DistanceJointDef,[{key:"Initialize",value:function(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.length=b2Max(F.DistanceVV(i,s),m),this.minLength=this.length,this.maxLength=this.length}}]),b2DistanceJointDef}(),_i=function(t){function b2DistanceJoint(t){var e;return _classCallCheck(this,b2DistanceJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2DistanceJoint).call(this,t))).m_stiffness=0,e.m_damping=0,e.m_bias=0,e.m_length=0,e.m_minLength=0,e.m_maxLength=0,e.m_localAnchorA=new F,e.m_localAnchorB=new F,e.m_gamma=0,e.m_impulse=0,e.m_lowerImpulse=0,e.m_upperImpulse=0,e.m_indexA=0,e.m_indexB=0,e.m_u=new F,e.m_rA=new F,e.m_rB=new F,e.m_localCenterA=new F,e.m_localCenterB=new F,e.m_currentLength=0,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_softMass=0,e.m_mass=0,e.m_qA=new z,e.m_qB=new z,e.m_lalcA=new F,e.m_lalcB=new F,e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,F.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,F.ZERO)),e.m_length=b2Max(b2Maybe(t.length,e.GetCurrentLength()),m),e.m_minLength=b2Max(b2Maybe(t.minLength,e.m_length),m),e.m_maxLength=b2Max(b2Maybe(t.maxLength,e.m_length),e.m_minLength),e.m_stiffness=b2Maybe(t.stiffness,0),e.m_damping=b2Maybe(t.damping,0),e}return _inherits(b2DistanceJoint,li),_createClass(b2DistanceJoint,[{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_u.x,e.y=t*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_u.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetLength",value:function(t){return this.m_impulse=0,this.m_length=b2Max(m,t),this.m_length}},{key:"GetLength",value:function(){return this.m_length}},{key:"SetMinLength",value:function(t){return this.m_lowerImpulse=0,this.m_minLength=b2Clamp(t,m,this.m_maxLength),this.m_minLength}},{key:"SetMaxLength",value:function(t){return this.m_upperImpulse=0,this.m_maxLength=b2Max(t,this.m_minLength),this.m_maxLength}},{key:"GetCurrentLength",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,new F),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,new F);return F.DistanceVV(t,e)}},{key:"SetStiffness",value:function(t){this.m_stiffness=t}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.minLength = %.15f;\n",this.m_minLength),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(r);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),z.MulRV(h,this.m_lalcA,this.m_rA),F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),z.MulRV(_,this.m_lalcB,this.m_rB),this.m_u.x=o.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=o.y+this.m_rB.y-e.y-this.m_rA.y,this.m_currentLength=this.m_u.Length(),this.m_currentLength>m?this.m_u.SelfMul(1/this.m_currentLength):(this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0);var u=F.CrossVV(this.m_rA,this.m_u),c=F.CrossVV(this.m_rB,this.m_u),y=this.m_invMassA+this.m_invIA*u*u+this.m_invMassB+this.m_invIB*c*c;if(this.m_mass=0!==y?1/y:0,this.m_stiffness>0&&this.m_minLength<this.m_maxLength){var d=this.m_currentLength-this.m_length,p=this.m_damping,f=this.m_stiffness,v=t.step.dt;this.m_gamma=v*(p+v*f),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=d*v*f*this.m_gamma,y+=this.m_gamma,this.m_softMass=0!==y?1/y:0}else this.m_gamma=0,this.m_bias=0,this.m_softMass=this.m_mass;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;var b=F.MulSV(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse,this.m_u,b2DistanceJoint.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,b),n-=this.m_invIA*F.CrossVV(this.m_rA,b),a.SelfMulAdd(this.m_invMassB,b),l+=this.m_invIB*F.CrossVV(this.m_rB,b)}else this.m_impulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w;if(this.m_minLength<this.m_maxLength){if(this.m_stiffness>0){var o=F.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA),r=F.AddVCrossSV(s,n,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB),a=F.DotVV(this.m_u,F.SubVV(r,o,F.s_t0)),l=-this.m_softMass*(a+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=l;var h=F.MulSV(l,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,h),i-=this.m_invIA*F.CrossVV(this.m_rA,h),s.SelfMulAdd(this.m_invMassB,h),n+=this.m_invIB*F.CrossVV(this.m_rB,h)}var _=b2Max(0,this.m_currentLength-this.m_minLength)*t.step.inv_dt,u=F.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA),m=F.AddVCrossSV(s,n,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB),c=F.DotVV(this.m_u,F.SubVV(m,u,F.s_t0)),y=-this.m_mass*(c+_),d=this.m_lowerImpulse;this.m_lowerImpulse=b2Max(0,this.m_lowerImpulse+y),y=this.m_lowerImpulse-d;var p=F.MulSV(y,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,p),i-=this.m_invIA*F.CrossVV(this.m_rA,p),s.SelfMulAdd(this.m_invMassB,p),n+=this.m_invIB*F.CrossVV(this.m_rB,p);var f=b2Max(0,this.m_maxLength-this.m_currentLength)*t.step.inv_dt,v=F.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA),b=F.AddVCrossSV(s,n,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB),C=F.DotVV(this.m_u,F.SubVV(v,b,F.s_t0)),x=-this.m_mass*(C+f),A=this.m_upperImpulse;this.m_upperImpulse=b2Max(0,this.m_upperImpulse+x),x=this.m_upperImpulse-A;var S=F.MulSV(-x,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,S),i-=this.m_invIA*F.CrossVV(this.m_rA,S),s.SelfMulAdd(this.m_invMassB,S),n+=this.m_invIB*F.CrossVV(this.m_rB,S)}else{var g=F.AddVCrossSV(e,i,this.m_rA,b2DistanceJoint.SolveVelocityConstraints_s_vpA),w=F.AddVCrossSV(s,n,this.m_rB,b2DistanceJoint.SolveVelocityConstraints_s_vpB),V=F.DotVV(this.m_u,F.SubVV(w,g,F.s_t0)),B=-this.m_mass*V;this.m_impulse+=B;var M=F.MulSV(B,this.m_u,b2DistanceJoint.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,M),i-=this.m_invIA*F.CrossVV(this.m_rA,M),s.SelfMulAdd(this.m_invMassB,M),n+=this.m_invIB*F.CrossVV(this.m_rB,M)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,n=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),r=this.m_qB.SetAngle(n),a=z.MulRV(o,this.m_lalcA,this.m_rA),l=z.MulRV(r,this.m_lalcB,this.m_rB),h=this.m_u;h.x=s.x+l.x-e.x-a.x,h.y=s.y+l.y-e.y-a.y;var _,u=this.m_u.Normalize();if(this.m_minLength==this.m_maxLength)_=u-this.m_minLength;else if(u<this.m_minLength)_=u-this.m_minLength;else{if(!(this.m_maxLength<u))return!0;_=u-this.m_maxLength}var c=-this.m_mass*_,y=F.MulSV(c,h,b2DistanceJoint.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,y),i-=this.m_invIA*F.CrossVV(a,y),s.SelfMulAdd(this.m_invMassB,y),n+=this.m_invIB*F.CrossVV(l,y),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=n,k(_)<m}},{key:"Draw",value:function(t){var e=this.m_bodyA.GetTransform(),i=this.m_bodyB.GetTransform(),s=X.MulXV(e,this.m_localAnchorA,b2DistanceJoint.Draw_s_pA),o=X.MulXV(i,this.m_localAnchorB,b2DistanceJoint.Draw_s_pB),r=F.SubVV(o,s,b2DistanceJoint.Draw_s_axis);r.Normalize();var a=b2DistanceJoint.Draw_s_c1,l=b2DistanceJoint.Draw_s_c2,h=b2DistanceJoint.Draw_s_c3,_=b2DistanceJoint.Draw_s_c4;t.DrawSegment(s,o,_);var u=F.AddVMulSV(s,this.m_length,r,b2DistanceJoint.Draw_s_pRest);if(t.DrawPoint(u,8,a),this.m_minLength!=this.m_maxLength){if(this.m_minLength>m){var c=F.AddVMulSV(s,this.m_minLength,r,b2DistanceJoint.Draw_s_pMin);t.DrawPoint(c,4,l)}if(this.m_maxLength<n){var y=F.AddVMulSV(s,this.m_maxLength,r,b2DistanceJoint.Draw_s_pMax);t.DrawPoint(y,4,h)}}}}]),b2DistanceJoint}();_i.InitVelocityConstraints_s_P=new F,_i.SolveVelocityConstraints_s_vpA=new F,_i.SolveVelocityConstraints_s_vpB=new F,_i.SolveVelocityConstraints_s_P=new F,_i.SolvePositionConstraints_s_P=new F,_i.Draw_s_pA=new F,_i.Draw_s_pB=new F,_i.Draw_s_axis=new F,_i.Draw_s_c1=new i(.7,.7,.7),_i.Draw_s_c2=new i(.3,.9,.3),_i.Draw_s_c3=new i(.9,.3,.3),_i.Draw_s_c4=new i(.4,.4,.4),_i.Draw_s_pRest=new F,_i.Draw_s_pMin=new F,_i.Draw_s_pMax=new F;var ui=function(e){function b2AreaJointDef(){var e;return _classCallCheck(this,b2AreaJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2AreaJointDef).call(this,t.b2JointType.e_areaJoint))).bodies=[],e.stiffness=0,e.damping=0,e}return _inherits(b2AreaJointDef,ai),_createClass(b2AreaJointDef,[{key:"AddBody",value:function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}]),b2AreaJointDef}(),mi=function(t){function b2AreaJoint(t){var e;_classCallCheck(this,b2AreaJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2AreaJoint).call(this,t))).m_stiffness=0,e.m_damping=0,e.m_impulse=0,e.m_targetArea=0,e.m_delta=new F,e.m_bodies=t.bodies,e.m_stiffness=b2Maybe(t.stiffness,0),e.m_damping=b2Maybe(t.damping,0),e.m_targetLengths=b2MakeNumberArray(t.bodies.length),e.m_normals=F.MakeArray(t.bodies.length),e.m_joints=[],e.m_deltas=F.MakeArray(t.bodies.length);var i=new hi;i.stiffness=e.m_stiffness,i.damping=e.m_damping,e.m_targetArea=0;for(var s=0;s<e.m_bodies.length;++s){var n=e.m_bodies[s],o=e.m_bodies[(s+1)%e.m_bodies.length],r=n.GetWorldCenter(),a=o.GetWorldCenter();e.m_targetLengths[s]=F.DistanceVV(r,a),e.m_targetArea+=F.CrossVV(r,a),i.Initialize(n,o,r,a),e.m_joints[s]=n.GetWorld().CreateJoint(i)}return e.m_targetArea*=.5,e}return _inherits(b2AreaJoint,li),_createClass(b2AreaJoint,[{key:"GetAnchorA",value:function(t){return t}},{key:"GetAnchorB",value:function(t){return t}},{key:"GetReactionForce",value:function(t,e){return e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"SetStiffness",value:function(t){this.m_stiffness=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetStiffness(t)}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDamping(t)}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"Dump",value:function(t){t("Area joint dumping is not supported.\n")}},{key:"InitVelocityConstraints",value:function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],s=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,o=t.positions[s.m_islandIndex].c,r=this.m_deltas[e];F.SubVV(o,n,r)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var a=0;a<this.m_bodies.length;++a){var l=this.m_bodies[a],h=t.velocities[l.m_islandIndex].v,_=this.m_deltas[a];h.x+=l.m_invMass*_.y*.5*this.m_impulse,h.y+=l.m_invMass*-_.x*.5*this.m_impulse}}else this.m_impulse=0}},{key:"SolveVelocityConstraints",value:function(t){for(var e=0,i=0,s=0;s<this.m_bodies.length;++s){var n=this.m_bodies[s],o=t.velocities[n.m_islandIndex].v,r=this.m_deltas[s];e+=r.LengthSquared()/n.GetMass(),i+=F.CrossVV(o,r)}var a=-2*i/e;this.m_impulse+=a;for(var l=0;l<this.m_bodies.length;++l){var h=this.m_bodies[l],_=t.velocities[h.m_islandIndex].v,u=this.m_deltas[l];_.x+=h.m_invMass*u.y*.5*a,_.y+=h.m_invMass*-u.x*.5*a}}},{key:"SolvePositionConstraints",value:function(t){for(var e=0,i=0,s=0;s<this.m_bodies.length;++s){var n=this.m_bodies[s],r=this.m_bodies[(s+1)%this.m_bodies.length],a=t.positions[n.m_islandIndex].c,l=t.positions[r.m_islandIndex].c,h=F.SubVV(l,a,this.m_delta),_=h.Length();_<o&&(_=1),this.m_normals[s].x=h.y/_,this.m_normals[s].y=-h.x/_,e+=_,i+=F.CrossVV(a,l)}i*=.5;for(var u=.5*(this.m_targetArea-i)/e,c=!0,y=0;y<this.m_bodies.length;++y){var p=this.m_bodies[y],f=t.positions[p.m_islandIndex].c,v=(y+1)%this.m_bodies.length,b=F.AddVV(this.m_normals[y],this.m_normals[v],this.m_delta);b.SelfMul(u);var C=b.LengthSquared();C>b2Sq(d)&&b.SelfMul(d/D(C)),C>b2Sq(m)&&(c=!1),f.x+=b.x,f.y+=b.y}return c}}]),b2AreaJoint}(),ci=function(){function b2Filter(){_classCallCheck(this,b2Filter),this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return _createClass(b2Filter,[{key:"Clone",value:function(){return(new b2Filter).Copy(this)}},{key:"Copy",value:function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this}}]),b2Filter}();ci.DEFAULT=new ci;var yi=function b2FixtureDef(){_classCallCheck(this,b2FixtureDef),this.userData=null,this.friction=.2,this.restitution=0,this.restitutionThreshold=1*l,this.density=0,this.isSensor=!1,this.filter=new ci},di=function(){function b2FixtureProxy(t,e){_classCallCheck(this,b2FixtureProxy),this.aabb=new It,this.childIndex=0,this.fixture=t,this.childIndex=e,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),e),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}return _createClass(b2FixtureProxy,[{key:"Reset",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)}},{key:"Touch",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)}},{key:"Synchronize",value:function(t,e){if(t===e)this.fixture.m_shape.ComputeAABB(this.aabb,t,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,F.ZERO);else{var i=b2FixtureProxy.Synchronize_s_aabb1,s=b2FixtureProxy.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(i,t,this.childIndex),this.fixture.m_shape.ComputeAABB(s,e,this.childIndex),this.aabb.Combine2(i,s);var n=b2FixtureProxy.Synchronize_s_displacement;n.Copy(s.GetCenter()).SelfSub(i.GetCenter()),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,n)}}}]),b2FixtureProxy}();di.Synchronize_s_aabb1=new It,di.Synchronize_s_aabb2=new It,di.Synchronize_s_displacement=new F;var pi,fi=function(){function b2Fixture(t,e){_classCallCheck(this,b2Fixture),this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=1*l,this.m_proxies=[],this.m_filter=new ci,this.m_isSensor=!1,this.m_userData=null,this.m_body=t,this.m_shape=e.shape.Clone(),this.m_userData=b2Maybe(e.userData,null),this.m_friction=b2Maybe(e.friction,.2),this.m_restitution=b2Maybe(e.restitution,0),this.m_restitutionThreshold=b2Maybe(e.restitutionThreshold,0),this.m_filter.Copy(b2Maybe(e.filter,ci.DEFAULT)),this.m_isSensor=b2Maybe(e.isSensor,!1),this.m_density=b2Maybe(e.density,0)}return _createClass(b2Fixture,[{key:"Create",value:function(t,e,i){}},{key:"Destroy",value:function(){}},{key:"Reset",value:function(){}},{key:"GetType",value:function(){return this.m_shape.GetType()}},{key:"GetShape",value:function(){return this.m_shape}},{key:"SetSensor",value:function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}},{key:"IsSensor",value:function(){return this.m_isSensor}},{key:"SetFilterData",value:function(t){this.m_filter.Copy(t),this.Refilter()}},{key:"GetFilterData",value:function(){return this.m_filter}},{key:"Refilter",value:function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),s=e.GetFixtureB();i!==this&&s!==this||e.FlagForFiltering(),t=t.next}this.TouchProxies()}},{key:"GetBody",value:function(){return this.m_body}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"TestPoint",value:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}},{key:"RayCast",value:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}},{key:"GetMassData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Y;return this.m_shape.ComputeMass(t,this.m_density),t}},{key:"SetDensity",value:function(t){this.m_density=t}},{key:"GetDensity",value:function(){return this.m_density}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitutionThreshold",value:function(){return this.m_restitutionThreshold}},{key:"SetRestitutionThreshold",value:function(t){this.m_restitutionThreshold=t}},{key:"GetAABB",value:function(t){return this.m_proxies[t].aabb}},{key:"Dump",value:function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.restitutionThreshold = %.15f;\n",this.m_restitutionThreshold),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}},{key:"CreateProxies",value:function(){if(0!==this.m_proxies.length)throw new Error;for(var t=0;t<this.m_shape.GetChildCount();++t)this.m_proxies[t]=new di(this,t)}},{key:"DestroyProxies",value:function(){var t=!0,e=!1,i=void 0;try{for(var s,n=this.m_proxies[Symbol.iterator]();!(t=(s=n.next()).done);t=!0){s.value.Reset()}}catch(t){e=!0,i=t}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}this.m_proxies.length=0}},{key:"TouchProxies",value:function(){var t=!0,e=!1,i=void 0;try{for(var s,n=this.m_proxies[Symbol.iterator]();!(t=(s=n.next()).done);t=!0){s.value.Touch()}}catch(t){e=!0,i=t}finally{try{t||null==n.return||n.return()}finally{if(e)throw i}}}},{key:"Synchronize",value:function(t,e,i){this.SynchronizeProxies(e,i)}},{key:"SynchronizeProxies",value:function(t,e){var i=!0,s=!1,n=void 0;try{for(var o,r=this.m_proxies[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){o.value.Synchronize(t,e)}}catch(t){s=!0,n=t}finally{try{i||null==r.return||r.return()}finally{if(s)throw n}}}},{key:"m_proxyCount",get:function(){return this.m_proxies.length}}]),b2Fixture}();t.b2BodyType=void 0,(pi=t.b2BodyType||(t.b2BodyType={}))[pi.b2_unknown=-1]="b2_unknown",pi[pi.b2_staticBody=0]="b2_staticBody",pi[pi.b2_kinematicBody=1]="b2_kinematicBody",pi[pi.b2_dynamicBody=2]="b2_dynamicBody";var vi=function(){function b2Body(e,i){_classCallCheck(this,b2Body),this.m_type=t.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_enabledFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new X,this.m_sweep=new N,this.m_linearVelocity=new F,this.m_angularVelocity=0,this.m_force=new F,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_bulletFlag=b2Maybe(e.bullet,!1),this.m_fixedRotationFlag=b2Maybe(e.fixedRotation,!1),this.m_autoSleepFlag=b2Maybe(e.allowSleep,!0),b2Maybe(e.awake,!1)&&b2Maybe(e.type,t.b2BodyType.b2_staticBody)!==t.b2BodyType.b2_staticBody&&(this.m_awakeFlag=!0),this.m_enabledFlag=b2Maybe(e.enabled,!0),this.m_world=i,this.m_xf.p.Copy(b2Maybe(e.position,F.ZERO)),this.m_xf.q.SetAngle(b2Maybe(e.angle,0)),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(b2Maybe(e.linearVelocity,F.ZERO)),this.m_angularVelocity=b2Maybe(e.angularVelocity,0),this.m_linearDamping=b2Maybe(e.linearDamping,0),this.m_angularDamping=b2Maybe(e.angularDamping,0),this.m_gravityScale=b2Maybe(e.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=b2Maybe(e.type,t.b2BodyType.b2_staticBody),this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0}return _createClass(b2Body,[{key:"CreateFixture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t instanceof Q?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}},{key:"CreateFixtureDef",value:function(t){if(this.m_world.IsLocked())throw new Error;var e=new fi(this,t);return this.m_enabledFlag&&e.CreateProxies(),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newContacts=!0,e}},{key:"CreateFixtureShapeDensity",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=b2Body.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=e,this.CreateFixtureDef(i)}},{key:"DestroyFixture",value:function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}for(var s=this.m_contactList;s;){var n=s.contact;s=s.next;var o=n.GetFixtureA(),r=n.GetFixtureB();t!==o&&t!==r||this.m_world.m_contactManager.Destroy(n)}this.m_enabledFlag&&t.DestroyProxies(),t.m_next=null,t.Reset(),--this.m_fixtureCount,this.ResetMassData()}},{key:"SetTransformVec",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"SetTransformXY",value:function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),X.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var s=this.m_fixtureList;s;s=s.m_next)s.SynchronizeProxies(this.m_xf,this.m_xf);this.m_world.m_newContacts=!0}},{key:"SetTransform",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"GetTransform",value:function(){return this.m_xf}},{key:"GetPosition",value:function(){return this.m_xf.p}},{key:"SetPosition",value:function(t){this.SetTransformVec(t,this.GetAngle())}},{key:"SetPositionXY",value:function(t,e){this.SetTransformXY(t,e,this.GetAngle())}},{key:"GetAngle",value:function(){return this.m_sweep.a}},{key:"SetAngle",value:function(t){this.SetTransformVec(this.GetPosition(),t)}},{key:"GetWorldCenter",value:function(){return this.m_sweep.c}},{key:"GetLocalCenter",value:function(){return this.m_sweep.localCenter}},{key:"SetLinearVelocity",value:function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(F.DotVV(e,e)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(e))}},{key:"GetLinearVelocity",value:function(){return this.m_linearVelocity}},{key:"SetAngularVelocity",value:function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(e*e>0&&this.SetAwake(!0),this.m_angularVelocity=e)}},{key:"GetAngularVelocity",value:function(){return this.m_angularVelocity}},{key:"GetDefinition",value:function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}},{key:"ApplyForce",value:function(e,i){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===t.b2BodyType.b2_dynamicBody&&(s&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x))}},{key:"ApplyForceToCenter",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y))}},{key:"ApplyTorque",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=e))}},{key:"ApplyLinearImpulse",value:function(e,i){var s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===t.b2BodyType.b2_dynamicBody&&(s&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x)))}},{key:"ApplyLinearImpulseToCenter",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y))}},{key:"ApplyAngularImpulse",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*e))}},{key:"GetMass",value:function(){return this.m_mass}},{key:"GetInertia",value:function(){return this.m_I+this.m_mass*F.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}},{key:"GetMassData",value:function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*F.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}},{key:"SetMassData",value:function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type===t.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&!this.m_fixedRotationFlag&&(this.m_I=e.I-this.m_mass*F.DotVV(e.center,e.center),this.m_invI=1/this.m_I);var i=b2Body.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),X.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),F.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,F.SubVV(this.m_sweep.c,i,F.s_t0),this.m_linearVelocity)}}},{key:"ResetMassData",value:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===t.b2BodyType.b2_staticBody||this.m_type===t.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var e=b2Body.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!==i.m_density){var s=i.GetMassData(b2Body.ResetMassData_s_massData);this.m_mass+=s.mass,e.x+=s.center.x*s.mass,e.y+=s.center.y*s.mass,this.m_I+=s.I}this.m_mass>0&&(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*F.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=b2Body.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),X.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),F.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,F.SubVV(this.m_sweep.c,n,F.s_t0),this.m_linearVelocity)}},{key:"GetWorldPoint",value:function(t,e){return X.MulXV(this.m_xf,t,e)}},{key:"GetWorldVector",value:function(t,e){return z.MulRV(this.m_xf.q,t,e)}},{key:"GetLocalPoint",value:function(t,e){return X.MulTXV(this.m_xf,t,e)}},{key:"GetLocalVector",value:function(t,e){return z.MulTRV(this.m_xf.q,t,e)}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,e){return F.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,F.SubVV(t,this.m_sweep.c,F.s_t0),e)}},{key:"GetLinearVelocityFromLocalPoint",value:function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}},{key:"GetLinearDamping",value:function(){return this.m_linearDamping}},{key:"SetLinearDamping",value:function(t){this.m_linearDamping=t}},{key:"GetAngularDamping",value:function(){return this.m_angularDamping}},{key:"SetAngularDamping",value:function(t){this.m_angularDamping=t}},{key:"GetGravityScale",value:function(){return this.m_gravityScale}},{key:"SetGravityScale",value:function(t){this.m_gravityScale=t}},{key:"SetType",value:function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==e){this.m_type=e,this.ResetMassData(),this.m_type===t.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_awakeFlag=!1,this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var i=this.m_contactList;i;){var s=i;i=i.next,this.m_world.m_contactManager.Destroy(s.contact)}this.m_contactList=null;for(var n=this.m_fixtureList;n;n=n.m_next)n.TouchProxies()}}},{key:"GetType",value:function(){return this.m_type}},{key:"SetBullet",value:function(t){this.m_bulletFlag=t}},{key:"IsBullet",value:function(){return this.m_bulletFlag}},{key:"SetSleepingAllowed",value:function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}},{key:"IsSleepingAllowed",value:function(){return this.m_autoSleepFlag}},{key:"SetAwake",value:function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(e?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0))}},{key:"IsAwake",value:function(){return this.m_awakeFlag}},{key:"SetEnabled",value:function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsEnabled())if(this.m_enabledFlag=t,t){for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies();this.m_world.m_newContacts=!0}else{for(var i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies();for(var s=this.m_contactList;s;){var n=s;s=s.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"SetFixedRotation",value:function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}},{key:"IsFixedRotation",value:function(){return this.m_fixedRotationFlag}},{key:"GetFixtureList",value:function(){return this.m_fixtureList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactList}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"GetWorld",value:function(){return this.m_world}},{key:"Dump",value:function(e){var i=this.m_islandIndex;e("{\n"),e("  const bd: b2BodyDef = new b2BodyDef();\n");var s="";switch(this.m_type){case t.b2BodyType.b2_staticBody:s="b2BodyType.b2_staticBody";break;case t.b2BodyType.b2_kinematicBody:s="b2BodyType.b2_kinematicBody";break;case t.b2BodyType.b2_dynamicBody:s="b2BodyType.b2_dynamicBody"}e("  bd.type = %s;\n",s),e("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),e("  bd.angle = %.15f;\n",this.m_sweep.a),e("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),e("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),e("  bd.linearDamping = %.15f;\n",this.m_linearDamping),e("  bd.angularDamping = %.15f;\n",this.m_angularDamping),e("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),e("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),e("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),e("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),e("  bd.active = %s;\n",this.m_enabledFlag?"true":"false"),e("  bd.gravityScale = %.15f;\n",this.m_gravityScale),e("\n"),e("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),e("\n");for(var n=this.m_fixtureList;n;n=n.m_next)e("  {\n"),n.Dump(e,i),e("  }\n");e("}\n")}},{key:"SynchronizeFixtures",value:function(){if(this.m_awakeFlag){var t=b2Body.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),z.MulRV(t.q,this.m_sweep.localCenter,t.p),F.SubVV(this.m_sweep.c0,t.p,t.p);for(var e=this.m_fixtureList;e;e=e.m_next)e.SynchronizeProxies(t,this.m_xf)}else for(var i=this.m_fixtureList;i;i=i.m_next)i.SynchronizeProxies(this.m_xf,this.m_xf)}},{key:"SynchronizeTransform",value:function(){this.m_xf.q.SetAngle(this.m_sweep.a),z.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),F.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"ShouldCollide",value:function(e){return(this.m_type!==t.b2BodyType.b2_staticBody||e.m_type!==t.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(e)}},{key:"ShouldCollideConnected",value:function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}},{key:"Advance",value:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),z.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),F.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}}]),b2Body}();function b2MixFriction(t,e){return D(t*e)}function b2MixRestitution(t,e){return t>e?t:e}function b2MixRestitutionThreshold(t,e){return t<e?t:e}vi.CreateFixtureShapeDensity_s_def=new yi,vi.SetMassData_s_oldCenter=new F,vi.ResetMassData_s_localCenter=new F,vi.ResetMassData_s_oldCenter=new F,vi.ResetMassData_s_massData=new Y,vi.SynchronizeFixtures_s_xf1=new X;var bi=function(){function b2ContactEdge(t){_classCallCheck(this,b2ContactEdge),this._other=null,this.prev=null,this.next=null,this.contact=t}return _createClass(b2ContactEdge,[{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}},{key:"other",get:function(){if(null===this._other)throw new Error;return this._other},set:function(t){if(null!==this._other)throw new Error;this._other=t}}]),b2ContactEdge}(),Ci=function(){function b2Contact(){_classCallCheck(this,b2Contact),this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new bi(this),this.m_nodeB=new bi(this),this.m_indexA=0,this.m_indexB=0,this.m_manifold=new wt,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=0,this.m_tangentSpeed=0,this.m_oldManifold=new wt}return _createClass(b2Contact,[{key:"GetManifold",value:function(){return this.m_manifold}},{key:"GetWorldManifold",value:function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),s=this.GetShapeA(),n=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),s.m_radius,i.GetTransform(),n.m_radius)}},{key:"IsTouching",value:function(){return this.m_touchingFlag}},{key:"SetEnabled",value:function(t){this.m_enabledFlag=t}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetFixtureA",value:function(){return this.m_fixtureA}},{key:"GetChildIndexA",value:function(){return this.m_indexA}},{key:"GetShapeA",value:function(){return this.m_fixtureA.GetShape()}},{key:"GetFixtureB",value:function(){return this.m_fixtureB}},{key:"GetChildIndexB",value:function(){return this.m_indexB}},{key:"GetShapeB",value:function(){return this.m_fixtureB.GetShape()}},{key:"FlagForFiltering",value:function(){this.m_filterFlag=!0}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"ResetFriction",value:function(){this.m_friction=b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"ResetRestitution",value:function(){this.m_restitution=b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"SetRestitutionThreshold",value:function(t){this.m_restitutionThreshold=t}},{key:"GetRestitutionThreshold",value:function(){return this.m_restitutionThreshold}},{key:"ResetRestitutionThreshold",value:function(){this.m_restitutionThreshold=b2MixRestitutionThreshold(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}},{key:"SetTangentSpeed",value:function(t){this.m_tangentSpeed=t}},{key:"GetTangentSpeed",value:function(){return this.m_tangentSpeed}},{key:"Reset",value:function(t,e,i,s){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_restitutionThreshold=b2MixRestitutionThreshold(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}},{key:"Update",value:function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,s=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),o=this.m_fixtureB.IsSensor(),r=n||o,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),h=a.GetTransform(),_=l.GetTransform();if(r){var u=this.GetShapeA(),m=this.GetShapeB();i=b2TestOverlapShape(u,this.m_indexA,m,this.m_indexB,h,_),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,h,_),i=this.m_manifold.pointCount>0;for(var c=0;c<this.m_manifold.pointCount;++c){var y=this.m_manifold.points[c];y.normalImpulse=0,y.tangentImpulse=0;for(var d=y.id,p=0;p<this.m_oldManifold.pointCount;++p){var f=this.m_oldManifold.points[p];if(f.id.key===d.key){y.normalImpulse=f.normalImpulse,y.tangentImpulse=f.tangentImpulse;break}}}i!==s&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!s&&i&&t&&t.BeginContact(this),s&&!i&&t&&t.EndContact(this),!r&&i&&t&&t.PreSolve(this,this.m_oldManifold)}},{key:"ComputeTOI",value:function(t,e){var i=b2Contact.ComputeTOI_s_input;i.proxyA.SetShape(this.GetShapeA(),this.m_indexA),i.proxyB.SetShape(this.GetShapeB(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=m;var s=b2Contact.ComputeTOI_s_output;return b2TimeOfImpact(s,i),s.t}}]),b2Contact}();Ci.ComputeTOI_s_input=new We,Ci.ComputeTOI_s_output=new Ze;var xi=function(t){function b2ChainAndCircleContact(){return _classCallCheck(this,b2ChainAndCircleContact),_possibleConstructorReturn(this,_getPrototypeOf(b2ChainAndCircleContact).apply(this,arguments))}return _inherits(b2ChainAndCircleContact,Ci),_createClass(b2ChainAndCircleContact,[{key:"Evaluate",value:function(t,e,i){var s=b2ChainAndCircleContact.Evaluate_s_edge;this.GetShapeA().GetChildEdge(s,this.m_indexA),b2CollideEdgeAndCircle(t,s,e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new b2ChainAndCircleContact}},{key:"Destroy",value:function(t){}}]),b2ChainAndCircleContact}();xi.Evaluate_s_edge=new Ft;var Ai=function(t){function b2ChainAndPolygonContact(){return _classCallCheck(this,b2ChainAndPolygonContact),_possibleConstructorReturn(this,_getPrototypeOf(b2ChainAndPolygonContact).apply(this,arguments))}return _inherits(b2ChainAndPolygonContact,Ci),_createClass(b2ChainAndPolygonContact,[{key:"Evaluate",value:function(t,e,i){var s=b2ChainAndPolygonContact.Evaluate_s_edge;this.GetShapeA().GetChildEdge(s,this.m_indexA),b2CollideEdgeAndPolygon(t,s,e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new b2ChainAndPolygonContact}},{key:"Destroy",value:function(t){}}]),b2ChainAndPolygonContact}();Ai.Evaluate_s_edge=new Ft;var Si=function(t){function b2CircleContact(){return _classCallCheck(this,b2CircleContact),_possibleConstructorReturn(this,_getPrototypeOf(b2CircleContact).apply(this,arguments))}return _inherits(b2CircleContact,Ci),_createClass(b2CircleContact,[{key:"Evaluate",value:function(t,e,i){b2CollideCircles(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new b2CircleContact}},{key:"Destroy",value:function(t){}}]),b2CircleContact}(),gi=function(t){function b2PolygonContact(){return _classCallCheck(this,b2PolygonContact),_possibleConstructorReturn(this,_getPrototypeOf(b2PolygonContact).apply(this,arguments))}return _inherits(b2PolygonContact,Ci),_createClass(b2PolygonContact,[{key:"Evaluate",value:function(t,e,i){b2CollidePolygons(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new b2PolygonContact}},{key:"Destroy",value:function(t){}}]),b2PolygonContact}(),wi=function(t){function b2PolygonAndCircleContact(){return _classCallCheck(this,b2PolygonAndCircleContact),_possibleConstructorReturn(this,_getPrototypeOf(b2PolygonAndCircleContact).apply(this,arguments))}return _inherits(b2PolygonAndCircleContact,Ci),_createClass(b2PolygonAndCircleContact,[{key:"Evaluate",value:function(t,e,i){b2CollidePolygonAndCircle(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new b2PolygonAndCircleContact}},{key:"Destroy",value:function(t){}}]),b2PolygonAndCircleContact}(),Vi=function(t){function b2EdgeAndCircleContact(){return _classCallCheck(this,b2EdgeAndCircleContact),_possibleConstructorReturn(this,_getPrototypeOf(b2EdgeAndCircleContact).apply(this,arguments))}return _inherits(b2EdgeAndCircleContact,Ci),_createClass(b2EdgeAndCircleContact,[{key:"Evaluate",value:function(t,e,i){b2CollideEdgeAndCircle(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new b2EdgeAndCircleContact}},{key:"Destroy",value:function(t){}}]),b2EdgeAndCircleContact}(),Bi=function(t){function b2EdgeAndPolygonContact(){return _classCallCheck(this,b2EdgeAndPolygonContact),_possibleConstructorReturn(this,_getPrototypeOf(b2EdgeAndPolygonContact).apply(this,arguments))}return _inherits(b2EdgeAndPolygonContact,Ci),_createClass(b2EdgeAndPolygonContact,[{key:"Evaluate",value:function(t,e,i){b2CollideEdgeAndPolygon(t,this.GetShapeA(),e,this.GetShapeB(),i)}}],[{key:"Create",value:function(){return new b2EdgeAndPolygonContact}},{key:"Destroy",value:function(t){}}]),b2EdgeAndPolygonContact}(),Mi=function b2ContactRegister(){_classCallCheck(this,b2ContactRegister),this.pool=[],this.createFcn=null,this.destroyFcn=null,this.primary=!1},ki=function(){function b2ContactFactory(){_classCallCheck(this,b2ContactFactory),this.m_registers=[],this.InitializeRegisters()}return _createClass(b2ContactFactory,[{key:"AddType",value:function(t,e,i,s){var n=[];function poolCreateFcn(){return n.pop()||t()}function poolDestroyFcn(t){n.push(t)}this.m_registers[i][s].pool=n,this.m_registers[i][s].createFcn=poolCreateFcn,this.m_registers[i][s].destroyFcn=poolDestroyFcn,this.m_registers[i][s].primary=!0,i!==s&&(this.m_registers[s][i].pool=n,this.m_registers[s][i].createFcn=poolCreateFcn,this.m_registers[s][i].destroyFcn=poolDestroyFcn,this.m_registers[s][i].primary=!1)}},{key:"InitializeRegisters",value:function(){for(var e=0;e<t.b2ShapeType.e_shapeTypeCount;e++){this.m_registers[e]=[];for(var i=0;i<t.b2ShapeType.e_shapeTypeCount;i++)this.m_registers[e][i]=new Mi}this.AddType(Si.Create,Si.Destroy,t.b2ShapeType.e_circleShape,t.b2ShapeType.e_circleShape),this.AddType(wi.Create,wi.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_circleShape),this.AddType(gi.Create,gi.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_polygonShape),this.AddType(Vi.Create,Vi.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_circleShape),this.AddType(Bi.Create,Bi.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_polygonShape),this.AddType(xi.Create,xi.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_circleShape),this.AddType(Ai.Create,Ai.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_polygonShape)}},{key:"Create",value:function(t,e,i,s){var n=t.GetType(),o=i.GetType(),r=this.m_registers[n][o];if(r.createFcn){var a=r.createFcn();return r.primary?a.Reset(t,e,i,s):a.Reset(i,s,t,e),a}return null}},{key:"Destroy",value:function(t){var e=t.m_fixtureA.GetType(),i=t.m_fixtureB.GetType(),s=this.m_registers[e][i];s.destroyFcn&&s.destroyFcn(t)}}]),b2ContactFactory}(),Ii=function(){function b2DestructionListener(){_classCallCheck(this,b2DestructionListener)}return _createClass(b2DestructionListener,[{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}}]),b2DestructionListener}(),Di=function(){function b2ContactFilter(){_classCallCheck(this,b2ContactFilter)}return _createClass(b2ContactFilter,[{key:"ShouldCollide",value:function(e,i){var s=e.GetBody(),n=i.GetBody();if(n.GetType()===t.b2BodyType.b2_staticBody&&s.GetType()===t.b2BodyType.b2_staticBody)return!1;if(!n.ShouldCollideConnected(s))return!1;var o=e.GetFilterData(),r=i.GetFilterData();return o.groupIndex===r.groupIndex&&0!==o.groupIndex?o.groupIndex>0:0!=(o.maskBits&r.categoryBits)&&0!=(o.categoryBits&r.maskBits)}}]),b2ContactFilter}();Di.b2_defaultFilter=new Di;var Pi=function b2ContactImpulse(){_classCallCheck(this,b2ContactImpulse),this.normalImpulses=b2MakeNumberArray(_),this.tangentImpulses=b2MakeNumberArray(_),this.count=0},Ti=function(){function b2ContactListener(){_classCallCheck(this,b2ContactListener)}return _createClass(b2ContactListener,[{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),b2ContactListener}();Ti.b2_defaultListener=new Ti;var Gi=function(){function b2QueryCallback(){_classCallCheck(this,b2QueryCallback)}return _createClass(b2QueryCallback,[{key:"ReportFixture",value:function(t){return!0}}]),b2QueryCallback}(),Ri=function(){function b2RayCastCallback(){_classCallCheck(this,b2RayCastCallback)}return _createClass(b2RayCastCallback,[{key:"ReportFixture",value:function(t,e,i,s){return s}}]),b2RayCastCallback}(),Ji=function(){function b2ContactManager(){_classCallCheck(this,b2ContactManager),this.m_broadPhase=new Lt,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=Di.b2_defaultFilter,this.m_contactListener=Ti.b2_defaultListener,this.m_contactFactory=new ki}return _createClass(b2ContactManager,[{key:"AddPair",value:function(t,e){var i=t.fixture,s=e.fixture,n=t.childIndex,o=e.childIndex,r=i.GetBody(),a=s.GetBody();if(r!==a){for(var l=a.GetContactList();l;){if(l.other===r){var h=l.contact.GetFixtureA(),_=l.contact.GetFixtureB(),u=l.contact.GetChildIndexA(),m=l.contact.GetChildIndexB();if(h===i&&_===s&&u===n&&m===o)return;if(h===s&&_===i&&u===o&&m===n)return}l=l.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,s)){var c=this.m_contactFactory.Create(i,n,s,o);null!==c&&(i=c.GetFixtureA(),s=c.GetFixtureB(),n=c.GetChildIndexA(),o=c.GetChildIndexB(),r=i.m_body,a=s.m_body,c.m_prev=null,c.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=c),this.m_contactList=c,c.m_nodeA.other=a,c.m_nodeA.prev=null,c.m_nodeA.next=r.m_contactList,null!==r.m_contactList&&(r.m_contactList.prev=c.m_nodeA),r.m_contactList=c.m_nodeA,c.m_nodeB.other=r,c.m_nodeB.prev=null,c.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=c.m_nodeB),a.m_contactList=c.m_nodeB,++this.m_contactCount)}}}},{key:"FindNewContacts",value:function(){var t=this;this.m_broadPhase.UpdatePairs(function(e,i){t.AddPair(e,i)})}},{key:"Destroy",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),s=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}},{key:"Collide",value:function(){for(var e=this.m_contactList;e;){var i=e.GetFixtureA(),s=e.GetFixtureB(),n=e.GetChildIndexA(),o=e.GetChildIndexB(),r=i.GetBody(),a=s.GetBody();if(e.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,s)){var l=e;e=l.m_next,this.Destroy(l);continue}e.m_filterFlag=!1}var h=r.IsAwake()&&r.m_type!==t.b2BodyType.b2_staticBody,_=a.IsAwake()&&a.m_type!==t.b2BodyType.b2_staticBody;if(h||_){var u=i.m_proxies[n].treeNode,m=s.m_proxies[o].treeNode;if(b2TestOverlapAABB(u.aabb,m.aabb))e.Update(this.m_contactListener),e=e.m_next;else{var c=e;e=c.m_next,this.Destroy(c)}}else e=e.m_next}}}]),b2ContactManager}(),Li=function(){function b2Profile(){_classCallCheck(this,b2Profile),this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return _createClass(b2Profile,[{key:"Reset",value:function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}]),b2Profile}(),Fi=function(){function b2TimeStep(){_classCallCheck(this,b2TimeStep),this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1}return _createClass(b2TimeStep,[{key:"Copy",value:function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting,this}}]),b2TimeStep}(),Oi=function(){function b2Position(){_classCallCheck(this,b2Position),this.c=new F,this.a=0}return _createClass(b2Position,null,[{key:"MakeArray",value:function(t){return b2MakeArray(t,function(t){return new b2Position})}}]),b2Position}(),ji=function(){function b2Velocity(){_classCallCheck(this,b2Velocity),this.v=new F,this.w=0}return _createClass(b2Velocity,null,[{key:"MakeArray",value:function(t){return b2MakeArray(t,function(t){return new b2Velocity})}}]),b2Velocity}(),Ei=function b2SolverData(){_classCallCheck(this,b2SolverData),this.step=new Fi};t.g_blockSolve=!0;var qi=function(){function b2VelocityConstraintPoint(){_classCallCheck(this,b2VelocityConstraintPoint),this.rA=new F,this.rB=new F,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return _createClass(b2VelocityConstraintPoint,null,[{key:"MakeArray",value:function(t){return b2MakeArray(t,function(t){return new b2VelocityConstraintPoint})}}]),b2VelocityConstraintPoint}(),zi=function(){function b2ContactVelocityConstraint(){_classCallCheck(this,b2ContactVelocityConstraint),this.points=qi.MakeArray(_),this.normal=new F,this.tangent=new F,this.normalMass=new E,this.K=new E,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.threshold=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return _createClass(b2ContactVelocityConstraint,null,[{key:"MakeArray",value:function(t){return b2MakeArray(t,function(t){return new b2ContactVelocityConstraint})}}]),b2ContactVelocityConstraint}(),Xi=function(){function b2ContactPositionConstraint(){_classCallCheck(this,b2ContactPositionConstraint),this.localPoints=F.MakeArray(_),this.localNormal=new F,this.localPoint=new F,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new F,this.localCenterB=new F,this.invIA=0,this.invIB=0,this.type=t.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return _createClass(b2ContactPositionConstraint,null,[{key:"MakeArray",value:function(t){return b2MakeArray(t,function(t){return new b2ContactPositionConstraint})}}]),b2ContactPositionConstraint}(),Wi=function b2ContactSolverDef(){_classCallCheck(this,b2ContactSolverDef),this.step=new Fi,this.count=0},Ni=function(){function b2PositionSolverManifold(){_classCallCheck(this,b2PositionSolverManifold),this.normal=new F,this.point=new F,this.separation=0}return _createClass(b2PositionSolverManifold,[{key:"Initialize",value:function(e,i,s,n){var o=b2PositionSolverManifold.Initialize_s_pointA,r=b2PositionSolverManifold.Initialize_s_pointB,a=b2PositionSolverManifold.Initialize_s_planePoint,l=b2PositionSolverManifold.Initialize_s_clipPoint;switch(e.type){case t.b2ManifoldType.e_circles:X.MulXV(i,e.localPoint,o),X.MulXV(s,e.localPoints[0],r),F.SubVV(r,o,this.normal).SelfNormalize(),F.MidVV(o,r,this.point),this.separation=F.DotVV(F.SubVV(r,o,F.s_t0),this.normal)-e.radiusA-e.radiusB;break;case t.b2ManifoldType.e_faceA:z.MulRV(i.q,e.localNormal,this.normal),X.MulXV(i,e.localPoint,a),X.MulXV(s,e.localPoints[n],l),this.separation=F.DotVV(F.SubVV(l,a,F.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l);break;case t.b2ManifoldType.e_faceB:z.MulRV(s.q,e.localNormal,this.normal),X.MulXV(s,e.localPoint,a),X.MulXV(i,e.localPoints[n],l),this.separation=F.DotVV(F.SubVV(l,a,F.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l),this.normal.SelfNeg()}}}]),b2PositionSolverManifold}();Ni.Initialize_s_pointA=new F,Ni.Initialize_s_pointB=new F,Ni.Initialize_s_planePoint=new F,Ni.Initialize_s_clipPoint=new F;var Zi=function(){function b2ContactSolver(){_classCallCheck(this,b2ContactSolver),this.m_step=new Fi,this.m_positionConstraints=Xi.MakeArray(1024),this.m_velocityConstraints=zi.MakeArray(1024),this.m_count=0}return _createClass(b2ContactSolver,[{key:"Initialize",value:function(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=b2Max(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new Xi;if(this.m_velocityConstraints.length<this.m_count)for(var i=b2Max(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<i;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new zi;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var s=0;s<this.m_count;++s){var n=this.m_contacts[s],o=n.m_fixtureA,r=n.m_fixtureB,a=o.GetShape(),l=r.GetShape(),h=a.m_radius,_=l.m_radius,u=o.GetBody(),m=r.GetBody(),c=n.GetManifold(),y=c.pointCount,d=this.m_velocityConstraints[s];d.friction=n.m_friction,d.restitution=n.m_restitution,d.threshold=n.m_restitutionThreshold,d.tangentSpeed=n.m_tangentSpeed,d.indexA=u.m_islandIndex,d.indexB=m.m_islandIndex,d.invMassA=u.m_invMass,d.invMassB=m.m_invMass,d.invIA=u.m_invI,d.invIB=m.m_invI,d.contactIndex=s,d.pointCount=y,d.K.SetZero(),d.normalMass.SetZero();var p=this.m_positionConstraints[s];p.indexA=u.m_islandIndex,p.indexB=m.m_islandIndex,p.invMassA=u.m_invMass,p.invMassB=m.m_invMass,p.localCenterA.Copy(u.m_sweep.localCenter),p.localCenterB.Copy(m.m_sweep.localCenter),p.invIA=u.m_invI,p.invIB=m.m_invI,p.localNormal.Copy(c.localNormal),p.localPoint.Copy(c.localPoint),p.pointCount=y,p.radiusA=h,p.radiusB=_,p.type=c.type;for(var f=0;f<y;++f){var v=c.points[f],b=d.points[f];this.m_step.warmStarting?(b.normalImpulse=this.m_step.dtRatio*v.normalImpulse,b.tangentImpulse=this.m_step.dtRatio*v.tangentImpulse):(b.normalImpulse=0,b.tangentImpulse=0),b.rA.SetZero(),b.rB.SetZero(),b.normalMass=0,b.tangentMass=0,b.velocityBias=0,p.localPoints[f].Copy(v.localPoint)}}return this}},{key:"InitializeVelocityConstraints",value:function(){for(var e=b2ContactSolver.InitializeVelocityConstraints_s_xfA,i=b2ContactSolver.InitializeVelocityConstraints_s_xfB,s=b2ContactSolver.InitializeVelocityConstraints_s_worldManifold,n=0;n<this.m_count;++n){var o=this.m_velocityConstraints[n],r=this.m_positionConstraints[n],a=r.radiusA,l=r.radiusB,h=this.m_contacts[o.contactIndex].GetManifold(),_=o.indexA,u=o.indexB,m=o.invMassA,c=o.invMassB,y=o.invIA,d=o.invIB,p=r.localCenterA,f=r.localCenterB,v=this.m_positions[_].c,b=this.m_positions[_].a,C=this.m_velocities[_].v,x=this.m_velocities[_].w,A=this.m_positions[u].c,S=this.m_positions[u].a,g=this.m_velocities[u].v,w=this.m_velocities[u].w;e.q.SetAngle(b),i.q.SetAngle(S),F.SubVV(v,z.MulRV(e.q,p,F.s_t0),e.p),F.SubVV(A,z.MulRV(i.q,f,F.s_t0),i.p),s.Initialize(h,e,a,i,l),o.normal.Copy(s.normal),F.CrossVOne(o.normal,o.tangent);for(var V=o.pointCount,B=0;B<V;++B){var M=o.points[B];F.SubVV(s.points[B],v,M.rA),F.SubVV(s.points[B],A,M.rB);var k=F.CrossVV(M.rA,o.normal),I=F.CrossVV(M.rB,o.normal),D=m+c+y*k*k+d*I*I;M.normalMass=D>0?1/D:0;var P=o.tangent,T=F.CrossVV(M.rA,P),G=F.CrossVV(M.rB,P),R=m+c+y*T*T+d*G*G;M.tangentMass=R>0?1/R:0,M.velocityBias=0;var J=F.DotVV(o.normal,F.SubVV(F.AddVCrossSV(g,w,M.rB,F.s_t0),F.AddVCrossSV(C,x,M.rA,F.s_t1),F.s_t0));J<-o.threshold&&(M.velocityBias+=-o.restitution*J)}if(2===o.pointCount&&t.g_blockSolve){var L=o.points[0],O=o.points[1],j=F.CrossVV(L.rA,o.normal),E=F.CrossVV(L.rB,o.normal),q=F.CrossVV(O.rA,o.normal),X=F.CrossVV(O.rB,o.normal),W=m+c+y*j*j+d*E*E,N=m+c+y*q*q+d*X*X,Z=m+c+y*j*q+d*E*X;W*W<1e3*(W*N-Z*Z)?(o.K.ex.Set(W,Z),o.K.ey.Set(Z,N),o.K.GetInverse(o.normalMass)):o.pointCount=1}}}},{key:"WarmStart",value:function(){for(var t=b2ContactSolver.WarmStart_s_P,e=0;e<this.m_count;++e){for(var i=this.m_velocityConstraints[e],s=i.indexA,n=i.indexB,o=i.invMassA,r=i.invIA,a=i.invMassB,l=i.invIB,h=i.pointCount,_=this.m_velocities[s].v,u=this.m_velocities[s].w,m=this.m_velocities[n].v,c=this.m_velocities[n].w,y=i.normal,d=i.tangent,p=0;p<h;++p){var f=i.points[p];F.AddVV(F.MulSV(f.normalImpulse,y,F.s_t0),F.MulSV(f.tangentImpulse,d,F.s_t1),t),u-=r*F.CrossVV(f.rA,t),_.SelfMulSub(o,t),c+=l*F.CrossVV(f.rB,t),m.SelfMulAdd(a,t)}this.m_velocities[s].w=u,this.m_velocities[n].w=c}}},{key:"SolveVelocityConstraints",value:function(){for(var e=b2ContactSolver.SolveVelocityConstraints_s_dv,i=b2ContactSolver.SolveVelocityConstraints_s_dv1,s=b2ContactSolver.SolveVelocityConstraints_s_dv2,n=b2ContactSolver.SolveVelocityConstraints_s_P,o=b2ContactSolver.SolveVelocityConstraints_s_a,r=b2ContactSolver.SolveVelocityConstraints_s_b,a=b2ContactSolver.SolveVelocityConstraints_s_x,l=b2ContactSolver.SolveVelocityConstraints_s_d,h=b2ContactSolver.SolveVelocityConstraints_s_P1,_=b2ContactSolver.SolveVelocityConstraints_s_P2,u=b2ContactSolver.SolveVelocityConstraints_s_P1P2,m=0;m<this.m_count;++m){for(var c=this.m_velocityConstraints[m],y=c.indexA,d=c.indexB,p=c.invMassA,f=c.invIA,v=c.invMassB,b=c.invIB,C=c.pointCount,x=this.m_velocities[y].v,A=this.m_velocities[y].w,S=this.m_velocities[d].v,g=this.m_velocities[d].w,w=c.normal,V=c.tangent,B=c.friction,M=0;M<C;++M){var k=c.points[M];F.SubVV(F.AddVCrossSV(S,g,k.rB,F.s_t0),F.AddVCrossSV(x,A,k.rA,F.s_t1),e);var I=F.DotVV(e,V)-c.tangentSpeed,D=k.tangentMass*-I,P=B*k.normalImpulse,T=b2Clamp(k.tangentImpulse+D,-P,P);D=T-k.tangentImpulse,k.tangentImpulse=T,F.MulSV(D,V,n),x.SelfMulSub(p,n),A-=f*F.CrossVV(k.rA,n),S.SelfMulAdd(v,n),g+=b*F.CrossVV(k.rB,n)}if(1===c.pointCount||!1===t.g_blockSolve)for(var G=0;G<C;++G){var R=c.points[G];F.SubVV(F.AddVCrossSV(S,g,R.rB,F.s_t0),F.AddVCrossSV(x,A,R.rA,F.s_t1),e);var J=F.DotVV(e,w),L=-R.normalMass*(J-R.velocityBias),O=b2Max(R.normalImpulse+L,0);L=O-R.normalImpulse,R.normalImpulse=O,F.MulSV(L,w,n),x.SelfMulSub(p,n),A-=f*F.CrossVV(R.rA,n),S.SelfMulAdd(v,n),g+=b*F.CrossVV(R.rB,n)}else{var j=c.points[0],q=c.points[1];o.Set(j.normalImpulse,q.normalImpulse),F.SubVV(F.AddVCrossSV(S,g,j.rB,F.s_t0),F.AddVCrossSV(x,A,j.rA,F.s_t1),i),F.SubVV(F.AddVCrossSV(S,g,q.rB,F.s_t0),F.AddVCrossSV(x,A,q.rA,F.s_t1),s);var z=F.DotVV(i,w),X=F.DotVV(s,w);for(r.x=z-j.velocityBias,r.y=X-q.velocityBias,r.SelfSub(E.MulMV(c.K,o,F.s_t0));;){if(E.MulMV(c.normalMass,r,a).SelfNeg(),a.x>=0&&a.y>=0){F.SubVV(a,o,l),F.MulSV(l.x,w,h),F.MulSV(l.y,w,_),F.AddVV(h,_,u),x.SelfMulSub(p,u),A-=f*(F.CrossVV(j.rA,h)+F.CrossVV(q.rA,_)),S.SelfMulAdd(v,u),g+=b*(F.CrossVV(j.rB,h)+F.CrossVV(q.rB,_)),j.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=-j.normalMass*r.x,a.y=0,z=0,X=c.K.ex.y*a.x+r.y,a.x>=0&&X>=0){F.SubVV(a,o,l),F.MulSV(l.x,w,h),F.MulSV(l.y,w,_),F.AddVV(h,_,u),x.SelfMulSub(p,u),A-=f*(F.CrossVV(j.rA,h)+F.CrossVV(q.rA,_)),S.SelfMulAdd(v,u),g+=b*(F.CrossVV(j.rB,h)+F.CrossVV(q.rB,_)),j.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=0,a.y=-q.normalMass*r.y,z=c.K.ey.x*a.y+r.x,X=0,a.y>=0&&z>=0){F.SubVV(a,o,l),F.MulSV(l.x,w,h),F.MulSV(l.y,w,_),F.AddVV(h,_,u),x.SelfMulSub(p,u),A-=f*(F.CrossVV(j.rA,h)+F.CrossVV(q.rA,_)),S.SelfMulAdd(v,u),g+=b*(F.CrossVV(j.rB,h)+F.CrossVV(q.rB,_)),j.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=0,a.y=0,z=r.x,X=r.y,z>=0&&X>=0){F.SubVV(a,o,l),F.MulSV(l.x,w,h),F.MulSV(l.y,w,_),F.AddVV(h,_,u),x.SelfMulSub(p,u),A-=f*(F.CrossVV(j.rA,h)+F.CrossVV(q.rA,_)),S.SelfMulAdd(v,u),g+=b*(F.CrossVV(j.rB,h)+F.CrossVV(q.rB,_)),j.normalImpulse=a.x,q.normalImpulse=a.y;break}break}}this.m_velocities[y].w=A,this.m_velocities[d].w=g}}},{key:"StoreImpulses",value:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),s=0;s<e.pointCount;++s)i.points[s].normalImpulse=e.points[s].normalImpulse,i.points[s].tangentImpulse=e.points[s].tangentImpulse}},{key:"SolvePositionConstraints",value:function(){for(var t=b2ContactSolver.SolvePositionConstraints_s_xfA,e=b2ContactSolver.SolvePositionConstraints_s_xfB,i=b2ContactSolver.SolvePositionConstraints_s_psm,s=b2ContactSolver.SolvePositionConstraints_s_rA,n=b2ContactSolver.SolvePositionConstraints_s_rB,o=b2ContactSolver.SolvePositionConstraints_s_P,r=0,a=0;a<this.m_count;++a){for(var l=this.m_positionConstraints[a],h=l.indexA,_=l.indexB,u=l.localCenterA,c=l.invMassA,y=l.invIA,p=l.localCenterB,f=l.invMassB,v=l.invIB,b=l.pointCount,C=this.m_positions[h].c,x=this.m_positions[h].a,A=this.m_positions[_].c,S=this.m_positions[_].a,g=0;g<b;++g){t.q.SetAngle(x),e.q.SetAngle(S),F.SubVV(C,z.MulRV(t.q,u,F.s_t0),t.p),F.SubVV(A,z.MulRV(e.q,p,F.s_t0),e.p),i.Initialize(l,t,e,g);var w=i.normal,V=i.point,B=i.separation;F.SubVV(V,C,s),F.SubVV(V,A,n),r=b2Min(r,B);var M=b2Clamp(.2*(B+m),-d,0),k=F.CrossVV(s,w),I=F.CrossVV(n,w),D=c+f+y*k*k+v*I*I,P=D>0?-M/D:0;F.MulSV(P,w,o),C.SelfMulSub(c,o),x-=y*F.CrossVV(s,o),A.SelfMulAdd(f,o),S+=v*F.CrossVV(n,o)}this.m_positions[h].a=x,this.m_positions[_].a=S}return r>-3*m}},{key:"SolveTOIPositionConstraints",value:function(t,e){for(var i=b2ContactSolver.SolveTOIPositionConstraints_s_xfA,s=b2ContactSolver.SolveTOIPositionConstraints_s_xfB,n=b2ContactSolver.SolveTOIPositionConstraints_s_psm,o=b2ContactSolver.SolveTOIPositionConstraints_s_rA,r=b2ContactSolver.SolveTOIPositionConstraints_s_rB,a=b2ContactSolver.SolveTOIPositionConstraints_s_P,l=0,h=0;h<this.m_count;++h){var _=this.m_positionConstraints[h],u=_.indexA,c=_.indexB,y=_.localCenterA,p=_.localCenterB,f=_.pointCount,v=0,b=0;u!==t&&u!==e||(v=_.invMassA,b=_.invIA);var C=0,x=0;c!==t&&c!==e||(C=_.invMassB,x=_.invIB);for(var A=this.m_positions[u].c,S=this.m_positions[u].a,g=this.m_positions[c].c,w=this.m_positions[c].a,V=0;V<f;++V){i.q.SetAngle(S),s.q.SetAngle(w),F.SubVV(A,z.MulRV(i.q,y,F.s_t0),i.p),F.SubVV(g,z.MulRV(s.q,p,F.s_t0),s.p),n.Initialize(_,i,s,V);var B=n.normal,M=n.point,k=n.separation;F.SubVV(M,A,o),F.SubVV(M,g,r),l=b2Min(l,k);var I=b2Clamp(.75*(k+m),-d,0),D=F.CrossVV(o,B),P=F.CrossVV(r,B),T=v+C+b*D*D+x*P*P,G=T>0?-I/T:0;F.MulSV(G,B,a),A.SelfMulSub(v,a),S-=b*F.CrossVV(o,a),g.SelfMulAdd(C,a),w+=x*F.CrossVV(r,a)}this.m_positions[u].a=S,this.m_positions[c].a=w}return l>=-1.5*m}}]),b2ContactSolver}();Zi.InitializeVelocityConstraints_s_xfA=new X,Zi.InitializeVelocityConstraints_s_xfB=new X,Zi.InitializeVelocityConstraints_s_worldManifold=new Vt,Zi.WarmStart_s_P=new F,Zi.SolveVelocityConstraints_s_dv=new F,Zi.SolveVelocityConstraints_s_dv1=new F,Zi.SolveVelocityConstraints_s_dv2=new F,Zi.SolveVelocityConstraints_s_P=new F,Zi.SolveVelocityConstraints_s_a=new F,Zi.SolveVelocityConstraints_s_b=new F,Zi.SolveVelocityConstraints_s_x=new F,Zi.SolveVelocityConstraints_s_d=new F,Zi.SolveVelocityConstraints_s_P1=new F,Zi.SolveVelocityConstraints_s_P2=new F,Zi.SolveVelocityConstraints_s_P1P2=new F,Zi.SolvePositionConstraints_s_xfA=new X,Zi.SolvePositionConstraints_s_xfB=new X,Zi.SolvePositionConstraints_s_psm=new Ni,Zi.SolvePositionConstraints_s_rA=new F,Zi.SolvePositionConstraints_s_rB=new F,Zi.SolvePositionConstraints_s_P=new F,Zi.SolveTOIPositionConstraints_s_xfA=new X,Zi.SolveTOIPositionConstraints_s_xfB=new X,Zi.SolveTOIPositionConstraints_s_psm=new Ni,Zi.SolveTOIPositionConstraints_s_rA=new F,Zi.SolveTOIPositionConstraints_s_rB=new F,Zi.SolveTOIPositionConstraints_s_P=new F;var Ui=function(e){function b2FrictionJointDef(){var e;return _classCallCheck(this,b2FrictionJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2FrictionJointDef).call(this,t.b2JointType.e_frictionJoint))).localAnchorA=new F,e.localAnchorB=new F,e.maxForce=0,e.maxTorque=0,e}return _inherits(b2FrictionJointDef,ai),_createClass(b2FrictionJointDef,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}]),b2FrictionJointDef}(),Yi=function(t){function b2FrictionJoint(t){var e;return _classCallCheck(this,b2FrictionJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2FrictionJoint).call(this,t))).m_localAnchorA=new F,e.m_localAnchorB=new F,e.m_linearImpulse=new F,e.m_angularImpulse=0,e.m_maxForce=0,e.m_maxTorque=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new F,e.m_rB=new F,e.m_localCenterA=new F,e.m_localCenterB=new F,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_linearMass=new E,e.m_angularMass=0,e.m_qA=new z,e.m_qB=new z,e.m_lalcA=new F,e.m_lalcB=new F,e.m_K=new E,e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,F.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,F.ZERO)),e.m_linearImpulse.SetZero(),e.m_maxForce=b2Maybe(t.maxForce,0),e.m_maxTorque=b2Maybe(t.maxTorque,0),e.m_linearMass.SetZero(),e}return _inherits(b2FrictionJoint,li),_createClass(b2FrictionJoint,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var h=z.MulRV(a,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var _=z.MulRV(l,this.m_lalcB,this.m_rB),u=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,y=this.m_invIB,d=this.m_K;if(d.ex.x=u+m+c*h.y*h.y+y*_.y*_.y,d.ex.y=-c*h.x*h.y-y*_.x*_.y,d.ey.x=d.ex.y,d.ey.y=u+m+c*h.x*h.x+y*_.x*_.x,d.GetInverse(this.m_linearMass),this.m_angularMass=c+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var p=this.m_linearImpulse;i.SelfMulSub(u,p),s-=c*(F.CrossVV(this.m_rA,p)+this.m_angularImpulse),o.SelfMulAdd(m,p),r+=y*(F.CrossVV(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,h=t.step.dt,_=n-i,u=-this.m_angularMass*_,m=this.m_angularImpulse,c=h*this.m_maxTorque;this.m_angularImpulse=b2Clamp(this.m_angularImpulse+u,-c,c),i-=a*(u=this.m_angularImpulse-m),n+=l*u;var y=F.SubVV(F.AddVCrossSV(s,n,this.m_rB,F.s_t0),F.AddVCrossSV(e,i,this.m_rA,F.s_t1),b2FrictionJoint.SolveVelocityConstraints_s_Cdot_v2),d=E.MulMV(this.m_linearMass,y,b2FrictionJoint.SolveVelocityConstraints_s_impulseV).SelfNeg(),p=b2FrictionJoint.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(d);var f=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(f)),F.SubVV(this.m_linearImpulse,p,d),e.SelfMulSub(o,d),i-=a*F.CrossVV(this.m_rA,d),s.SelfMulAdd(r,d),n+=l*F.CrossVV(this.m_rB,d),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),b2FrictionJoint}();Yi.SolveVelocityConstraints_s_Cdot_v2=new F,Yi.SolveVelocityConstraints_s_impulseV=new F,Yi.SolveVelocityConstraints_s_oldImpulseV=new F;var Qi=function(e){function b2GearJointDef(){var e;return _classCallCheck(this,b2GearJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2GearJointDef).call(this,t.b2JointType.e_gearJoint))).ratio=1,e}return _inherits(b2GearJointDef,ai),b2GearJointDef}(),Ki=function(e){function b2GearJoint(e){var i,s,n;_classCallCheck(this,b2GearJoint),(i=_possibleConstructorReturn(this,_getPrototypeOf(b2GearJoint).call(this,e))).m_typeA=t.b2JointType.e_unknownJoint,i.m_typeB=t.b2JointType.e_unknownJoint,i.m_localAnchorA=new F,i.m_localAnchorB=new F,i.m_localAnchorC=new F,i.m_localAnchorD=new F,i.m_localAxisC=new F,i.m_localAxisD=new F,i.m_referenceAngleA=0,i.m_referenceAngleB=0,i.m_constant=0,i.m_ratio=0,i.m_impulse=0,i.m_indexA=0,i.m_indexB=0,i.m_indexC=0,i.m_indexD=0,i.m_lcA=new F,i.m_lcB=new F,i.m_lcC=new F,i.m_lcD=new F,i.m_mA=0,i.m_mB=0,i.m_mC=0,i.m_mD=0,i.m_iA=0,i.m_iB=0,i.m_iC=0,i.m_iD=0,i.m_JvAC=new F,i.m_JvBD=new F,i.m_JwA=0,i.m_JwB=0,i.m_JwC=0,i.m_JwD=0,i.m_mass=0,i.m_qA=new z,i.m_qB=new z,i.m_qC=new z,i.m_qD=new z,i.m_lalcA=new F,i.m_lalcB=new F,i.m_lalcC=new F,i.m_lalcD=new F,i.m_joint1=e.joint1,i.m_joint2=e.joint2,i.m_typeA=i.m_joint1.GetType(),i.m_typeB=i.m_joint2.GetType(),i.m_bodyC=i.m_joint1.GetBodyA(),i.m_bodyA=i.m_joint1.GetBodyB();var o=i.m_bodyA.m_xf,r=i.m_bodyA.m_sweep.a,a=i.m_bodyC.m_xf,l=i.m_bodyC.m_sweep.a;if(i.m_typeA===t.b2JointType.e_revoluteJoint){var h=e.joint1;i.m_localAnchorC.Copy(h.m_localAnchorA),i.m_localAnchorA.Copy(h.m_localAnchorB),i.m_referenceAngleA=h.m_referenceAngle,i.m_localAxisC.SetZero(),s=r-l-i.m_referenceAngleA}else{var _=e.joint1;i.m_localAnchorC.Copy(_.m_localAnchorA),i.m_localAnchorA.Copy(_.m_localAnchorB),i.m_referenceAngleA=_.m_referenceAngle,i.m_localAxisC.Copy(_.m_localXAxisA);var u=i.m_localAnchorC,m=z.MulTRV(a.q,F.AddVV(z.MulRV(o.q,i.m_localAnchorA,F.s_t0),F.SubVV(o.p,a.p,F.s_t1),F.s_t0),F.s_t0);s=F.DotVV(F.SubVV(m,u,F.s_t0),i.m_localAxisC)}i.m_bodyD=i.m_joint2.GetBodyA(),i.m_bodyB=i.m_joint2.GetBodyB();var c=i.m_bodyB.m_xf,y=i.m_bodyB.m_sweep.a,d=i.m_bodyD.m_xf,p=i.m_bodyD.m_sweep.a;if(i.m_typeB===t.b2JointType.e_revoluteJoint){var f=e.joint2;i.m_localAnchorD.Copy(f.m_localAnchorA),i.m_localAnchorB.Copy(f.m_localAnchorB),i.m_referenceAngleB=f.m_referenceAngle,i.m_localAxisD.SetZero(),n=y-p-i.m_referenceAngleB}else{var v=e.joint2;i.m_localAnchorD.Copy(v.m_localAnchorA),i.m_localAnchorB.Copy(v.m_localAnchorB),i.m_referenceAngleB=v.m_referenceAngle,i.m_localAxisD.Copy(v.m_localXAxisA);var b=i.m_localAnchorD,C=z.MulTRV(d.q,F.AddVV(z.MulRV(c.q,i.m_localAnchorB,F.s_t0),F.SubVV(c.p,d.p,F.s_t1),F.s_t0),F.s_t0);n=F.DotVV(F.SubVV(C,b,F.s_t0),i.m_localAxisD)}return i.m_ratio=b2Maybe(e.ratio,1),i.m_constant=s+i.m_ratio*n,i.m_impulse=0,i}return _inherits(b2GearJoint,li),_createClass(b2GearJoint,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=e.positions[this.m_indexA].a,s=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,r=e.velocities[this.m_indexB].v,a=e.velocities[this.m_indexB].w,l=e.positions[this.m_indexC].a,h=e.velocities[this.m_indexC].v,_=e.velocities[this.m_indexC].w,u=e.positions[this.m_indexD].a,m=e.velocities[this.m_indexD].v,c=e.velocities[this.m_indexD].w,y=this.m_qA.SetAngle(i),d=this.m_qB.SetAngle(o),p=this.m_qC.SetAngle(l),f=this.m_qD.SetAngle(u);if(this.m_mass=0,this.m_typeA===t.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var v=z.MulRV(p,this.m_localAxisC,b2GearJoint.InitVelocityConstraints_s_u);F.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var b=z.MulRV(p,this.m_lalcC,b2GearJoint.InitVelocityConstraints_s_rC);F.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var C=z.MulRV(y,this.m_lalcA,b2GearJoint.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(v),this.m_JwC=F.CrossVV(b,v),this.m_JwA=F.CrossVV(C,v),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===t.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var x=z.MulRV(f,this.m_localAxisD,b2GearJoint.InitVelocityConstraints_s_u);F.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var A=z.MulRV(f,this.m_lalcD,b2GearJoint.InitVelocityConstraints_s_rD);F.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var S=z.MulRV(d,this.m_lalcB,b2GearJoint.InitVelocityConstraints_s_rB);F.MulSV(this.m_ratio,x,this.m_JvBD),this.m_JwD=this.m_ratio*F.CrossVV(A,x),this.m_JwB=this.m_ratio*F.CrossVV(S,x),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(s.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,r.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,h.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),_-=this.m_iC*this.m_impulse*this.m_JwC,m.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),c-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=a,e.velocities[this.m_indexC].w=_,e.velocities[this.m_indexD].w=c}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=t.velocities[this.m_indexC].v,r=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,h=F.DotVV(this.m_JvAC,F.SubVV(e,o,F.s_t0))+F.DotVV(this.m_JvBD,F.SubVV(s,a,F.s_t0));h+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*n-this.m_JwD*l);var _=-this.m_mass*h;this.m_impulse+=_,e.SelfMulAdd(this.m_mA*_,this.m_JvAC),i+=this.m_iA*_*this.m_JwA,s.SelfMulAdd(this.m_mB*_,this.m_JvBD),n+=this.m_iB*_*this.m_JwB,o.SelfMulSub(this.m_mC*_,this.m_JvAC),r-=this.m_iC*_*this.m_JwC,a.SelfMulSub(this.m_mD*_,this.m_JvBD),l-=this.m_iD*_*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=r,t.velocities[this.m_indexD].w=l}},{key:"SolvePositionConstraints",value:function(e){var i,s,n,o,r,a,l=e.positions[this.m_indexA].c,h=e.positions[this.m_indexA].a,_=e.positions[this.m_indexB].c,u=e.positions[this.m_indexB].a,c=e.positions[this.m_indexC].c,y=e.positions[this.m_indexC].a,d=e.positions[this.m_indexD].c,p=e.positions[this.m_indexD].a,f=this.m_qA.SetAngle(h),v=this.m_qB.SetAngle(u),b=this.m_qC.SetAngle(y),C=this.m_qD.SetAngle(p),x=this.m_JvAC,A=this.m_JvBD,S=0;if(this.m_typeA===t.b2JointType.e_revoluteJoint)x.SetZero(),n=1,r=1,S+=this.m_iA+this.m_iC,i=h-y-this.m_referenceAngleA;else{var g=z.MulRV(b,this.m_localAxisC,b2GearJoint.SolvePositionConstraints_s_u),w=z.MulRV(b,this.m_lalcC,b2GearJoint.SolvePositionConstraints_s_rC),V=z.MulRV(f,this.m_lalcA,b2GearJoint.SolvePositionConstraints_s_rA);x.Copy(g),r=F.CrossVV(w,g),n=F.CrossVV(V,g),S+=this.m_mC+this.m_mA+this.m_iC*r*r+this.m_iA*n*n;var B=this.m_lalcC,M=z.MulTRV(b,F.AddVV(V,F.SubVV(l,c,F.s_t0),F.s_t0),F.s_t0);i=F.DotVV(F.SubVV(M,B,F.s_t0),this.m_localAxisC)}if(this.m_typeB===t.b2JointType.e_revoluteJoint)A.SetZero(),o=this.m_ratio,a=this.m_ratio,S+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),s=u-p-this.m_referenceAngleB;else{var k=z.MulRV(C,this.m_localAxisD,b2GearJoint.SolvePositionConstraints_s_u),I=z.MulRV(C,this.m_lalcD,b2GearJoint.SolvePositionConstraints_s_rD),D=z.MulRV(v,this.m_lalcB,b2GearJoint.SolvePositionConstraints_s_rB);F.MulSV(this.m_ratio,k,A),a=this.m_ratio*F.CrossVV(I,k),o=this.m_ratio*F.CrossVV(D,k),S+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*o*o;var P=this.m_lalcD,T=z.MulTRV(C,F.AddVV(D,F.SubVV(_,d,F.s_t0),F.s_t0),F.s_t0);s=F.DotVV(F.SubVV(T,P,F.s_t0),this.m_localAxisD)}var G=i+this.m_ratio*s-this.m_constant,R=0;return S>0&&(R=-G/S),l.SelfMulAdd(this.m_mA*R,x),h+=this.m_iA*R*n,_.SelfMulAdd(this.m_mB*R,A),u+=this.m_iB*R*o,c.SelfMulSub(this.m_mC*R,x),y-=this.m_iC*R*r,d.SelfMulSub(this.m_mD*R,A),p-=this.m_iD*R*a,e.positions[this.m_indexA].a=h,e.positions[this.m_indexB].a=u,e.positions[this.m_indexC].a=y,e.positions[this.m_indexD].a=p,0<m}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return F.MulSV(t*this.m_impulse,this.m_JvAC,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse*this.m_JwA}},{key:"GetJoint1",value:function(){return this.m_joint1}},{key:"GetJoint2",value:function(){return this.m_joint2}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"SetRatio",value:function(t){this.m_ratio=t}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,s=this.m_joint1.m_index,n=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",s),t("  jd.joint2 = joints[%d];\n",n),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),b2GearJoint}();Ki.InitVelocityConstraints_s_u=new F,Ki.InitVelocityConstraints_s_rA=new F,Ki.InitVelocityConstraints_s_rB=new F,Ki.InitVelocityConstraints_s_rC=new F,Ki.InitVelocityConstraints_s_rD=new F,Ki.SolvePositionConstraints_s_u=new F,Ki.SolvePositionConstraints_s_rA=new F,Ki.SolvePositionConstraints_s_rB=new F,Ki.SolvePositionConstraints_s_rC=new F,Ki.SolvePositionConstraints_s_rD=new F;var Hi=function(){function b2Island(){_classCallCheck(this,b2Island),this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=Oi.MakeArray(1024),this.m_velocities=ji.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return _createClass(b2Island,[{key:"Initialize",value:function(t,e,i,s){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=s,this.m_positions.length<t)for(var n=b2Max(2*this.m_positions.length,t);this.m_positions.length<n;)this.m_positions[this.m_positions.length]=new Oi;if(this.m_velocities.length<t)for(var o=b2Max(2*this.m_velocities.length,t);this.m_velocities.length<o;)this.m_velocities[this.m_velocities.length]=new ji}},{key:"Clear",value:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}},{key:"AddBody",value:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}},{key:"AddContact",value:function(t){this.m_contacts[this.m_contactCount++]=t}},{key:"AddJoint",value:function(t){this.m_joints[this.m_jointCount++]=t}},{key:"Solve",value:function(e,i,s,o){for(var r=b2Island.s_timer.Reset(),a=i.dt,l=0;l<this.m_bodyCount;++l){var h=this.m_bodies[l];this.m_positions[l].c.Copy(h.m_sweep.c);var _=h.m_sweep.a,u=this.m_velocities[l].v.Copy(h.m_linearVelocity),m=h.m_angularVelocity;h.m_sweep.c0.Copy(h.m_sweep.c),h.m_sweep.a0=h.m_sweep.a,h.m_type===t.b2BodyType.b2_dynamicBody&&(u.x+=a*h.m_invMass*(h.m_gravityScale*h.m_mass*s.x+h.m_force.x),u.y+=a*h.m_invMass*(h.m_gravityScale*h.m_mass*s.y+h.m_force.y),m+=a*h.m_invI*h.m_torque,u.SelfMul(1/(1+a*h.m_linearDamping)),m*=1/(1+a*h.m_angularDamping)),this.m_positions[l].a=_,this.m_velocities[l].w=m}r.Reset();var c=b2Island.s_solverData;c.step.Copy(i),c.positions=this.m_positions,c.velocities=this.m_velocities;var y=b2Island.s_contactSolverDef;y.step.Copy(i),y.contacts=this.m_contacts,y.count=this.m_contactCount,y.positions=this.m_positions,y.velocities=this.m_velocities;var d=b2Island.s_contactSolver.Initialize(y);d.InitializeVelocityConstraints(),i.warmStarting&&d.WarmStart();for(var p=0;p<this.m_jointCount;++p)this.m_joints[p].InitVelocityConstraints(c);e.solveInit=r.GetMilliseconds(),r.Reset();for(var S=0;S<i.velocityIterations;++S){for(var g=0;g<this.m_jointCount;++g)this.m_joints[g].SolveVelocityConstraints(c);d.SolveVelocityConstraints()}d.StoreImpulses(),e.solveVelocity=r.GetMilliseconds();for(var w=0;w<this.m_bodyCount;++w){var V=this.m_positions[w].c,B=this.m_positions[w].a,M=this.m_velocities[w].v,I=this.m_velocities[w].w,D=F.MulSV(a,M,b2Island.s_translation);if(F.DotVV(D,D)>v){var P=f/D.Length();M.SelfMul(P)}var T=a*I;if(T*T>C)I*=b/k(T);V.x+=a*M.x,V.y+=a*M.y,B+=a*I,this.m_positions[w].a=B,this.m_velocities[w].w=I}r.Reset();for(var G=!1,R=0;R<i.positionIterations;++R){for(var J=d.SolvePositionConstraints(),L=!0,O=0;O<this.m_jointCount;++O){var j=this.m_joints[O].SolvePositionConstraints(c);L=L&&j}if(J&&L){G=!0;break}}for(var E=0;E<this.m_bodyCount;++E){var q=this.m_bodies[E];q.m_sweep.c.Copy(this.m_positions[E].c),q.m_sweep.a=this.m_positions[E].a,q.m_linearVelocity.Copy(this.m_velocities[E].v),q.m_angularVelocity=this.m_velocities[E].w,q.SynchronizeTransform()}if(e.solvePosition=r.GetMilliseconds(),this.Report(d.m_velocityConstraints),o){for(var z=n,X=x*x,W=A*A,N=0;N<this.m_bodyCount;++N){var Z=this.m_bodies[N];Z.GetType()!==t.b2BodyType.b2_staticBody&&(!Z.m_autoSleepFlag||Z.m_angularVelocity*Z.m_angularVelocity>W||F.DotVV(Z.m_linearVelocity,Z.m_linearVelocity)>X?(Z.m_sleepTime=0,z=0):(Z.m_sleepTime+=a,z=b2Min(z,Z.m_sleepTime)))}if(z>=.5&&G)for(var U=0;U<this.m_bodyCount;++U){this.m_bodies[U].SetAwake(!1)}}}},{key:"SolveTOI",value:function(t,e,i){for(var s=0;s<this.m_bodyCount;++s){var n=this.m_bodies[s];this.m_positions[s].c.Copy(n.m_sweep.c),this.m_positions[s].a=n.m_sweep.a,this.m_velocities[s].v.Copy(n.m_linearVelocity),this.m_velocities[s].w=n.m_angularVelocity}var o=b2Island.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;for(var r=b2Island.s_contactSolver.Initialize(o),a=0;a<t.positionIterations;++a){if(r.SolveTOIPositionConstraints(e,i))break}this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,r.InitializeVelocityConstraints();for(var l=0;l<t.velocityIterations;++l)r.SolveVelocityConstraints();for(var h=t.dt,_=0;_<this.m_bodyCount;++_){var u=this.m_positions[_].c,m=this.m_positions[_].a,c=this.m_velocities[_].v,y=this.m_velocities[_].w,d=F.MulSV(h,c,b2Island.s_translation);if(F.DotVV(d,d)>v){var p=f/d.Length();c.SelfMul(p)}var x=h*y;if(x*x>C)y*=b/k(x);u.SelfMulAdd(h,c),m+=h*y,this.m_positions[_].a=m,this.m_velocities[_].w=y;var A=this.m_bodies[_];A.m_sweep.c.Copy(u),A.m_sweep.a=m,A.m_linearVelocity.Copy(c),A.m_angularVelocity=y,A.SynchronizeTransform()}this.Report(r.m_velocityConstraints)}},{key:"Report",value:function(t){if(null!==this.m_listener)for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e];if(i){var s=t[e],n=b2Island.s_impulse;n.count=s.pointCount;for(var o=0;o<s.pointCount;++o)n.normalImpulses[o]=s.points[o].normalImpulse,n.tangentImpulses[o]=s.points[o].tangentImpulse;this.m_listener.PostSolve(i,n)}}}}]),b2Island}();Hi.s_timer=new Z,Hi.s_solverData=new Ei,Hi.s_contactSolverDef=new Wi,Hi.s_contactSolver=new Zi,Hi.s_translation=new F,Hi.s_impulse=new Pi;var $i=function(e){function b2MotorJointDef(){var e;return _classCallCheck(this,b2MotorJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2MotorJointDef).call(this,t.b2JointType.e_motorJoint))).linearOffset=new F(0,0),e.angularOffset=0,e.maxForce=1,e.maxTorque=1,e.correctionFactor=.3,e}return _inherits(b2MotorJointDef,ai),_createClass(b2MotorJointDef,[{key:"Initialize",value:function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),s=this.bodyB.GetAngle();this.angularOffset=s-i}}]),b2MotorJointDef}(),ts=function(t){function b2MotorJoint(t){var e;return _classCallCheck(this,b2MotorJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2MotorJoint).call(this,t))).m_linearOffset=new F,e.m_angularOffset=0,e.m_linearImpulse=new F,e.m_angularImpulse=0,e.m_maxForce=0,e.m_maxTorque=0,e.m_correctionFactor=.3,e.m_indexA=0,e.m_indexB=0,e.m_rA=new F,e.m_rB=new F,e.m_localCenterA=new F,e.m_localCenterB=new F,e.m_linearError=new F,e.m_angularError=0,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_linearMass=new E,e.m_angularMass=0,e.m_qA=new z,e.m_qB=new z,e.m_K=new E,e.m_linearOffset.Copy(b2Maybe(t.linearOffset,F.ZERO)),e.m_angularOffset=b2Maybe(t.angularOffset,0),e.m_linearImpulse.SetZero(),e.m_maxForce=b2Maybe(t.maxForce,0),e.m_maxTorque=b2Maybe(t.maxTorque,0),e.m_correctionFactor=b2Maybe(t.correctionFactor,.3),e}return _inherits(b2MotorJoint,li),_createClass(b2MotorJoint,[{key:"GetAnchorA",value:function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetAnchorB",value:function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetReactionForce",value:function(t,e){return F.MulSV(t,this.m_linearImpulse,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"SetLinearOffset",value:function(t){F.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}},{key:"GetLinearOffset",value:function(){return this.m_linearOffset}},{key:"SetAngularOffset",value:function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}},{key:"GetAngularOffset",value:function(){return this.m_angularOffset}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(r),u=z.MulRV(h,F.SubVV(this.m_linearOffset,this.m_localCenterA,F.s_t0),this.m_rA),m=z.MulRV(_,F.NegV(this.m_localCenterB,F.s_t0),this.m_rB),c=this.m_invMassA,y=this.m_invMassB,d=this.m_invIA,p=this.m_invIB,f=this.m_K;if(f.ex.x=c+y+d*u.y*u.y+p*m.y*m.y,f.ex.y=-d*u.x*u.y-p*m.x*m.y,f.ey.x=f.ex.y,f.ey.y=c+y+d*u.x*u.x+p*m.x*m.x,f.GetInverse(this.m_linearMass),this.m_angularMass=d+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),F.SubVV(F.AddVV(o,m,F.s_t0),F.AddVV(e,u,F.s_t1),this.m_linearError),this.m_angularError=r-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var v=this.m_linearImpulse;s.SelfMulSub(c,v),n-=d*(F.CrossVV(u,v)+this.m_angularImpulse),a.SelfMulAdd(y,v),l+=p*(F.CrossVV(m,v)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,h=t.step.dt,_=t.step.inv_dt,u=n-i+_*this.m_correctionFactor*this.m_angularError,m=-this.m_angularMass*u,c=this.m_angularImpulse,y=h*this.m_maxTorque;this.m_angularImpulse=b2Clamp(this.m_angularImpulse+m,-y,y),i-=a*(m=this.m_angularImpulse-c),n+=l*m;var d=this.m_rA,p=this.m_rB,f=F.AddVV(F.SubVV(F.AddVV(s,F.CrossSV(n,p,F.s_t0),F.s_t0),F.AddVV(e,F.CrossSV(i,d,F.s_t1),F.s_t1),F.s_t2),F.MulSV(_*this.m_correctionFactor,this.m_linearError,F.s_t3),b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2),v=E.MulMV(this.m_linearMass,f,b2MotorJoint.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),b=b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(v);var C=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>C*C&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(C)),F.SubVV(this.m_linearImpulse,b,v),e.SelfMulSub(o,v),i-=a*F.CrossVV(d,v),s.SelfMulAdd(r,v),n+=l*F.CrossVV(p,v),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),b2MotorJoint}();ts.SolveVelocityConstraints_s_Cdot_v2=new F,ts.SolveVelocityConstraints_s_impulse_v2=new F,ts.SolveVelocityConstraints_s_oldImpulse_v2=new F;var es=function(e){function b2MouseJointDef(){var e;return _classCallCheck(this,b2MouseJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2MouseJointDef).call(this,t.b2JointType.e_mouseJoint))).target=new F,e.maxForce=0,e.stiffness=5,e.damping=.7,e}return _inherits(b2MouseJointDef,ai),b2MouseJointDef}(),is=function(t){function b2MouseJoint(t){var e;return _classCallCheck(this,b2MouseJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2MouseJoint).call(this,t))).m_localAnchorB=new F,e.m_targetA=new F,e.m_stiffness=0,e.m_damping=0,e.m_beta=0,e.m_impulse=new F,e.m_maxForce=0,e.m_gamma=0,e.m_indexA=0,e.m_indexB=0,e.m_rB=new F,e.m_localCenterB=new F,e.m_invMassB=0,e.m_invIB=0,e.m_mass=new E,e.m_C=new F,e.m_qB=new z,e.m_lalcB=new F,e.m_K=new E,e.m_targetA.Copy(b2Maybe(t.target,F.ZERO)),X.MulTXV(e.m_bodyB.GetTransform(),e.m_targetA,e.m_localAnchorB),e.m_maxForce=b2Maybe(t.maxForce,0),e.m_impulse.SetZero(),e.m_stiffness=b2Maybe(t.stiffness,0),e.m_damping=b2Maybe(t.damping,0),e.m_beta=0,e.m_gamma=0,e}return _inherits(b2MouseJoint,li),_createClass(b2MouseJoint,[{key:"SetTarget",value:function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}},{key:"GetTarget",value:function(){return this.m_targetA}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetStiffness",value:function(t){this.m_stiffness=t}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"InitVelocityConstraints",value:function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=this.m_qB.SetAngle(i),r=this.m_bodyB.GetMass(),l=2*a*this.m_stiffness,h=2*r*this.m_damping*l,_=r*(l*l),u=t.step.dt;this.m_gamma=u*(h+u*_),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=u*_*this.m_gamma,F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),z.MulRV(o,this.m_lalcB,this.m_rB);var m=this.m_K;m.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,m.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,m.ey.x=m.ex.y,m.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,m.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),s.x+=this.m_invMassB*this.m_impulse.x,s.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*F.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexB].v,i=t.velocities[this.m_indexB].w,s=F.AddVCrossSV(e,i,this.m_rB,b2MouseJoint.SolveVelocityConstraints_s_Cdot),n=E.MulMV(this.m_mass,F.AddVV(s,F.AddVV(this.m_C,F.MulSV(this.m_gamma,this.m_impulse,F.s_t0),F.s_t0),F.s_t0).SelfNeg(),b2MouseJoint.SolveVelocityConstraints_s_impulse),o=b2MouseJoint.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(n);var r=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>r*r&&this.m_impulse.SelfMul(r/this.m_impulse.Length()),F.SubVV(this.m_impulse,o,n),e.SelfMulAdd(this.m_invMassB,n),i+=this.m_invIB*F.CrossVV(this.m_rB,n),t.velocities[this.m_indexB].w=i}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return F.MulSV(t,this.m_impulse,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"Dump",value:function(t){t("Mouse joint dumping is not supported.\n")}},{key:"ShiftOrigin",value:function(t){this.m_targetA.SelfSub(t)}}]),b2MouseJoint}();is.SolveVelocityConstraints_s_Cdot=new F,is.SolveVelocityConstraints_s_impulse=new F,is.SolveVelocityConstraints_s_oldImpulse=new F;var ss=function(e){function b2PrismaticJointDef(){var e;return _classCallCheck(this,b2PrismaticJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2PrismaticJointDef).call(this,t.b2JointType.e_prismaticJoint))).localAnchorA=new F,e.localAnchorB=new F,e.localAxisA=new F(1,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerTranslation=0,e.upperTranslation=0,e.enableMotor=!1,e.maxMotorForce=0,e.motorSpeed=0,e}return _inherits(b2PrismaticJointDef,ai),_createClass(b2PrismaticJointDef,[{key:"Initialize",value:function(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),b2PrismaticJointDef}(),ns=function(t){function b2PrismaticJoint(t){var e;return _classCallCheck(this,b2PrismaticJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2PrismaticJoint).call(this,t))).m_localAnchorA=new F,e.m_localAnchorB=new F,e.m_localXAxisA=new F,e.m_localYAxisA=new F,e.m_referenceAngle=0,e.m_impulse=new F(0,0),e.m_motorImpulse=0,e.m_lowerImpulse=0,e.m_upperImpulse=0,e.m_lowerTranslation=0,e.m_upperTranslation=0,e.m_maxMotorForce=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_enableMotor=!1,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new F,e.m_localCenterB=new F,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_axis=new F(0,0),e.m_perp=new F(0,0),e.m_s1=0,e.m_s2=0,e.m_a1=0,e.m_a2=0,e.m_K=new E,e.m_K3=new q,e.m_K2=new E,e.m_translation=0,e.m_axialMass=0,e.m_qA=new z,e.m_qB=new z,e.m_lalcA=new F,e.m_lalcB=new F,e.m_rA=new F,e.m_rB=new F,e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,F.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,F.ZERO)),e.m_localXAxisA.Copy(b2Maybe(t.localAxisA,new F(1,0))).SelfNormalize(),F.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_referenceAngle=b2Maybe(t.referenceAngle,0),e.m_lowerTranslation=b2Maybe(t.lowerTranslation,0),e.m_upperTranslation=b2Maybe(t.upperTranslation,0),e.m_maxMotorForce=b2Maybe(t.maxMotorForce,0),e.m_motorSpeed=b2Maybe(t.motorSpeed,0),e.m_enableLimit=b2Maybe(t.enableLimit,!1),e.m_enableMotor=b2Maybe(t.enableMotor,!1),e}return _inherits(b2PrismaticJoint,li),_createClass(b2PrismaticJoint,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(r);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=z.MulRV(h,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m=z.MulRV(_,this.m_lalcB,this.m_rB),c=F.AddVV(F.SubVV(o,e,F.s_t0),F.SubVV(m,u,F.s_t1),b2PrismaticJoint.InitVelocityConstraints_s_d),y=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,f=this.m_invIB;if(z.MulRV(h,this.m_localXAxisA,this.m_axis),this.m_a1=F.CrossVV(F.AddVV(c,u,F.s_t0),this.m_axis),this.m_a2=F.CrossVV(m,this.m_axis),this.m_axialMass=y+d+p*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_axialMass>0&&(this.m_axialMass=1/this.m_axialMass),z.MulRV(h,this.m_localYAxisA,this.m_perp),this.m_s1=F.CrossVV(F.AddVV(c,u,F.s_t0),this.m_perp),this.m_s2=F.CrossVV(m,this.m_perp),this.m_K.ex.x=y+d+p*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.ex.y=p*this.m_s1+f*this.m_s2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=p+f,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_enableLimit?this.m_translation=F.DotVV(this.m_axis,c):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;var v=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,b=F.AddVV(F.MulSV(this.m_impulse.x,this.m_perp,F.s_t0),F.MulSV(v,this.m_axis,F.s_t1),b2PrismaticJoint.InitVelocityConstraints_s_P),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+v*this.m_a1,x=this.m_impulse.x*this.m_s2+this.m_impulse.y+v*this.m_a2;s.SelfMulSub(y,b),n-=p*C,a.SelfMulAdd(d,b),l+=f*x}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor){var h=F.DotVV(this.m_axis,F.SubVV(s,e,F.s_t0))+this.m_a2*n-this.m_a1*i,_=this.m_axialMass*(this.m_motorSpeed-h),u=this.m_motorImpulse,m=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=b2Clamp(this.m_motorImpulse+_,-m,m),_=this.m_motorImpulse-u;var c=F.MulSV(_,this.m_axis,b2PrismaticJoint.SolveVelocityConstraints_s_P),y=_*this.m_a1,d=_*this.m_a2;e.SelfMulSub(o,c),i-=a*y,s.SelfMulAdd(r,c),n+=l*d}if(this.m_enableLimit){var p=this.m_translation-this.m_lowerTranslation,f=F.DotVV(this.m_axis,F.SubVV(s,e,F.s_t0))+this.m_a2*n-this.m_a1*i,v=-this.m_axialMass*(f+b2Max(p,0)*t.step.inv_dt),b=this.m_lowerImpulse;this.m_lowerImpulse=b2Max(this.m_lowerImpulse+v,0),v=this.m_lowerImpulse-b;var C=F.MulSV(v,this.m_axis,b2PrismaticJoint.SolveVelocityConstraints_s_P),x=v*this.m_a1,A=v*this.m_a2;e.SelfMulSub(o,C),i-=a*x,s.SelfMulAdd(r,C),n+=l*A;var S=this.m_upperTranslation-this.m_translation,g=F.DotVV(this.m_axis,F.SubVV(e,s,F.s_t0))+this.m_a1*i-this.m_a2*n,w=-this.m_axialMass*(g+b2Max(S,0)*t.step.inv_dt),V=this.m_upperImpulse;this.m_upperImpulse=b2Max(this.m_upperImpulse+w,0),w=this.m_upperImpulse-V;var B=F.MulSV(w,this.m_axis,b2PrismaticJoint.SolveVelocityConstraints_s_P),M=w*this.m_a1,k=w*this.m_a2;e.SelfMulAdd(o,B),i+=a*M,s.SelfMulSub(r,B),n-=l*k}var I=F.DotVV(this.m_perp,F.SubVV(s,e,F.s_t0))+this.m_s2*n-this.m_s1*i,D=n-i,P=this.m_K.Solve(-I,-D,b2PrismaticJoint.SolveVelocityConstraints_s_df);this.m_impulse.SelfAdd(P);var T=F.MulSV(P.x,this.m_perp,b2PrismaticJoint.SolveVelocityConstraints_s_P),G=P.x*this.m_s1+P.y,R=P.x*this.m_s2+P.y;e.SelfMulSub(o,T),i-=a*G,s.SelfMulAdd(r,T),n+=l*R,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,n=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),r=this.m_qB.SetAngle(n),a=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,_=this.m_invIB,u=z.MulRV(o,this.m_lalcA,this.m_rA),y=z.MulRV(r,this.m_lalcB,this.m_rB),d=F.SubVV(F.AddVV(s,y,F.s_t0),F.AddVV(e,u,F.s_t1),b2PrismaticJoint.SolvePositionConstraints_s_d),p=z.MulRV(o,this.m_localXAxisA,this.m_axis),f=F.CrossVV(F.AddVV(d,u,F.s_t0),p),v=F.CrossVV(y,p),b=z.MulRV(o,this.m_localYAxisA,this.m_perp),C=F.CrossVV(F.AddVV(d,u,F.s_t0),b),x=F.CrossVV(y,b),A=b2PrismaticJoint.SolvePositionConstraints_s_impulse,S=F.DotVV(b,d),g=n-i-this.m_referenceAngle,w=k(S),V=k(g),B=!1,M=0;if(this.m_enableLimit){var I=F.DotVV(p,d);k(this.m_upperTranslation-this.m_lowerTranslation)<2*m?(M=I,w=b2Max(w,k(I)),B=!0):I<=this.m_lowerTranslation?(M=b2Min(I-this.m_lowerTranslation,0),w=b2Max(w,this.m_lowerTranslation-I),B=!0):I>=this.m_upperTranslation&&(M=b2Max(I-this.m_upperTranslation,0),w=b2Max(w,I-this.m_upperTranslation),B=!0)}if(B){var D=a+l+h*C*C+_*x*x,P=h*C+_*x,T=h*C*f+_*x*v,G=h+_;0===G&&(G=1);var R=h*f+_*v,J=a+l+h*f*f+_*v*v,L=this.m_K3;L.ex.SetXYZ(D,P,T),L.ey.SetXYZ(P,G,R),L.ez.SetXYZ(T,R,J),A=L.Solve33(-S,-g,-M,A)}else{var O=a+l+h*C*C+_*x*x,j=h*C+_*x,E=h+_;0===E&&(E=1);var q=this.m_K2;q.ex.Set(O,j),q.ey.Set(j,E);var X=q.Solve(-S,-g,b2PrismaticJoint.SolvePositionConstraints_s_impulse1);A.x=X.x,A.y=X.y,A.z=0}var W=F.AddVV(F.MulSV(A.x,b,F.s_t0),F.MulSV(A.z,p,F.s_t1),b2PrismaticJoint.SolvePositionConstraints_s_P),N=A.x*C+A.y+A.z*f,Z=A.x*x+A.y+A.z*v;return e.SelfMulSub(a,W),i-=h*N,s.SelfMulAdd(l,W),n+=_*Z,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=n,w<=m&&V<=c}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_axis.x),e.y=t*(this.m_impulse.y*this.m_perp.y+(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_axis.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.y}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointTranslation",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,b2PrismaticJoint.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,b2PrismaticJoint.GetJointTranslation_s_pB),i=F.SubVV(e,t,b2PrismaticJoint.GetJointTranslation_s_d),s=this.m_bodyA.GetWorldVector(this.m_localXAxisA,b2PrismaticJoint.GetJointTranslation_s_axis);return F.DotVV(i,s)}},{key:"GetJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;F.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=z.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var s=z.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=F.AddVV(t.m_sweep.c,i,F.s_t0),o=F.AddVV(e.m_sweep.c,s,F.s_t1),r=F.SubVV(o,n,F.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,h=e.m_linearVelocity,_=t.m_angularVelocity,u=e.m_angularVelocity;return F.DotVV(r,F.CrossSV(_,a,F.s_t0))+F.DotVV(a,F.SubVV(F.AddVCrossSV(h,u,s,F.s_t0),F.AddVCrossSV(l,_,i,F.s_t1),F.s_t0))}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorForce",value:function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}},{key:"GetMaxMotorForce",value:function(){return this.m_maxMotorForce}},{key:"GetMotorForce",value:function(t){return t*this.m_motorImpulse}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"Draw",value:function(t){var e=this.m_bodyA.GetTransform(),i=this.m_bodyB.GetTransform(),s=X.MulXV(e,this.m_localAnchorA,b2PrismaticJoint.Draw_s_pA),n=X.MulXV(i,this.m_localAnchorB,b2PrismaticJoint.Draw_s_pB),o=z.MulRV(e.q,this.m_localXAxisA,b2PrismaticJoint.Draw_s_axis),r=b2PrismaticJoint.Draw_s_c1,a=b2PrismaticJoint.Draw_s_c2,l=b2PrismaticJoint.Draw_s_c3,h=b2PrismaticJoint.Draw_s_c4,_=b2PrismaticJoint.Draw_s_c5;if(t.DrawSegment(s,n,_),this.m_enableLimit){var u=F.AddVMulSV(s,this.m_lowerTranslation,o,b2PrismaticJoint.Draw_s_lower),m=F.AddVMulSV(s,this.m_upperTranslation,o,b2PrismaticJoint.Draw_s_upper),c=z.MulRV(e.q,this.m_localYAxisA,b2PrismaticJoint.Draw_s_perp);t.DrawSegment(u,m,r),t.DrawSegment(F.AddVMulSV(u,-.5,c,F.s_t0),F.AddVMulSV(u,.5,c,F.s_t1),a),t.DrawSegment(F.AddVMulSV(m,-.5,c,F.s_t0),F.AddVMulSV(m,.5,c,F.s_t1),l)}else t.DrawSegment(F.AddVMulSV(s,-1,o,F.s_t0),F.AddVMulSV(s,1,o,F.s_t1),r);t.DrawPoint(s,5,r),t.DrawPoint(n,5,h)}}]),b2PrismaticJoint}();ns.InitVelocityConstraints_s_d=new F,ns.InitVelocityConstraints_s_P=new F,ns.SolveVelocityConstraints_s_P=new F,ns.SolveVelocityConstraints_s_df=new F,ns.SolvePositionConstraints_s_d=new F,ns.SolvePositionConstraints_s_impulse=new j,ns.SolvePositionConstraints_s_impulse1=new F,ns.SolvePositionConstraints_s_P=new F,ns.GetJointTranslation_s_pA=new F,ns.GetJointTranslation_s_pB=new F,ns.GetJointTranslation_s_d=new F,ns.GetJointTranslation_s_axis=new F,ns.Draw_s_pA=new F,ns.Draw_s_pB=new F,ns.Draw_s_axis=new F,ns.Draw_s_c1=new i(.7,.7,.7),ns.Draw_s_c2=new i(.3,.9,.3),ns.Draw_s_c3=new i(.9,.3,.3),ns.Draw_s_c4=new i(.3,.3,.9),ns.Draw_s_c5=new i(.4,.4,.4),ns.Draw_s_lower=new F,ns.Draw_s_upper=new F,ns.Draw_s_perp=new F;var os=function(e){function b2PulleyJointDef(){var e;return _classCallCheck(this,b2PulleyJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2PulleyJointDef).call(this,t.b2JointType.e_pulleyJoint))).groundAnchorA=new F(-1,1),e.groundAnchorB=new F(1,1),e.localAnchorA=new F(-1,0),e.localAnchorB=new F(1,0),e.lengthA=0,e.lengthB=0,e.ratio=1,e.collideConnected=!0,e}return _inherits(b2PulleyJointDef,ai),_createClass(b2PulleyJointDef,[{key:"Initialize",value:function(t,e,i,s,n,o,r){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(s),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.lengthA=F.DistanceVV(n,i),this.lengthB=F.DistanceVV(o,s),this.ratio=r}}]),b2PulleyJointDef}(),rs=function(t){function b2PulleyJoint(t){var e;return _classCallCheck(this,b2PulleyJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2PulleyJoint).call(this,t))).m_groundAnchorA=new F,e.m_groundAnchorB=new F,e.m_lengthA=0,e.m_lengthB=0,e.m_localAnchorA=new F,e.m_localAnchorB=new F,e.m_constant=0,e.m_ratio=0,e.m_impulse=0,e.m_indexA=0,e.m_indexB=0,e.m_uA=new F,e.m_uB=new F,e.m_rA=new F,e.m_rB=new F,e.m_localCenterA=new F,e.m_localCenterB=new F,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=0,e.m_qA=new z,e.m_qB=new z,e.m_lalcA=new F,e.m_lalcB=new F,e.m_groundAnchorA.Copy(b2Maybe(t.groundAnchorA,new F(-1,1))),e.m_groundAnchorB.Copy(b2Maybe(t.groundAnchorB,new F(1,0))),e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,new F(-1,0))),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,new F(1,0))),e.m_lengthA=b2Maybe(t.lengthA,0),e.m_lengthB=b2Maybe(t.lengthB,0),e.m_ratio=b2Maybe(t.ratio,1),e.m_constant=b2Maybe(t.lengthA,0)+e.m_ratio*b2Maybe(t.lengthB,0),e.m_impulse=0,e}return _inherits(b2PulleyJoint,li),_createClass(b2PulleyJoint,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(r);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),z.MulRV(h,this.m_lalcA,this.m_rA),F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),z.MulRV(_,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(o).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var u=this.m_uA.Length(),c=this.m_uB.Length();u>10*m?this.m_uA.SelfMul(1/u):this.m_uA.SetZero(),c>10*m?this.m_uB.SelfMul(1/c):this.m_uB.SetZero();var y=F.CrossVV(this.m_rA,this.m_uA),d=F.CrossVV(this.m_rB,this.m_uB),p=this.m_invMassA+this.m_invIA*y*y,f=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=p+this.m_ratio*this.m_ratio*f,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var v=F.MulSV(-this.m_impulse,this.m_uA,b2PulleyJoint.InitVelocityConstraints_s_PA),b=F.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,b2PulleyJoint.InitVelocityConstraints_s_PB);s.SelfMulAdd(this.m_invMassA,v),n+=this.m_invIA*F.CrossVV(this.m_rA,v),a.SelfMulAdd(this.m_invMassB,b),l+=this.m_invIB*F.CrossVV(this.m_rB,b)}else this.m_impulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=F.AddVCrossSV(e,i,this.m_rA,b2PulleyJoint.SolveVelocityConstraints_s_vpA),r=F.AddVCrossSV(s,n,this.m_rB,b2PulleyJoint.SolveVelocityConstraints_s_vpB),a=-F.DotVV(this.m_uA,o)-this.m_ratio*F.DotVV(this.m_uB,r),l=-this.m_mass*a;this.m_impulse+=l;var h=F.MulSV(-l,this.m_uA,b2PulleyJoint.SolveVelocityConstraints_s_PA),_=F.MulSV(-this.m_ratio*l,this.m_uB,b2PulleyJoint.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,h),i+=this.m_invIA*F.CrossVV(this.m_rA,h),s.SelfMulAdd(this.m_invMassB,_),n+=this.m_invIB*F.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,n=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),r=this.m_qB.SetAngle(n);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var a=z.MulRV(o,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=z.MulRV(r,this.m_lalcB,this.m_rB),h=this.m_uA.Copy(e).SelfAdd(a).SelfSub(this.m_groundAnchorA),_=this.m_uB.Copy(s).SelfAdd(l).SelfSub(this.m_groundAnchorB),u=h.Length(),c=_.Length();u>10*m?h.SelfMul(1/u):h.SetZero(),c>10*m?_.SelfMul(1/c):_.SetZero();var y=F.CrossVV(a,h),d=F.CrossVV(l,_),p=this.m_invMassA+this.m_invIA*y*y,f=this.m_invMassB+this.m_invIB*d*d,v=p+this.m_ratio*this.m_ratio*f;v>0&&(v=1/v);var b=this.m_constant-u-this.m_ratio*c,C=k(b),x=-v*b,A=F.MulSV(-x,h,b2PulleyJoint.SolvePositionConstraints_s_PA),S=F.MulSV(-this.m_ratio*x,_,b2PulleyJoint.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,A),i+=this.m_invIA*F.CrossVV(a,A),s.SelfMulAdd(this.m_invMassB,S),n+=this.m_invIB*F.CrossVV(l,S),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=n,C<m}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetGroundAnchorA",value:function(){return this.m_groundAnchorA}},{key:"GetGroundAnchorB",value:function(){return this.m_groundAnchorB}},{key:"GetLengthA",value:function(){return this.m_lengthA}},{key:"GetLengthB",value:function(){return this.m_lengthB}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"GetCurrentLengthA",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,b2PulleyJoint.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return F.DistanceVV(t,e)}},{key:"GetCurrentLengthB",value:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,b2PulleyJoint.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return F.DistanceVV(t,e)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"ShiftOrigin",value:function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}]),b2PulleyJoint}();rs.InitVelocityConstraints_s_PA=new F,rs.InitVelocityConstraints_s_PB=new F,rs.SolveVelocityConstraints_s_vpA=new F,rs.SolveVelocityConstraints_s_vpB=new F,rs.SolveVelocityConstraints_s_PA=new F,rs.SolveVelocityConstraints_s_PB=new F,rs.SolvePositionConstraints_s_PA=new F,rs.SolvePositionConstraints_s_PB=new F,rs.GetCurrentLengthA_s_p=new F,rs.GetCurrentLengthB_s_p=new F;var as=function(e){function b2RevoluteJointDef(){var e;return _classCallCheck(this,b2RevoluteJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2RevoluteJointDef).call(this,t.b2JointType.e_revoluteJoint))).localAnchorA=new F(0,0),e.localAnchorB=new F(0,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerAngle=0,e.upperAngle=0,e.enableMotor=!1,e.motorSpeed=0,e.maxMotorTorque=0,e}return _inherits(b2RevoluteJointDef,ai),_createClass(b2RevoluteJointDef,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),b2RevoluteJointDef}(),ls=function(t){function b2RevoluteJoint(t){var e;return _classCallCheck(this,b2RevoluteJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2RevoluteJoint).call(this,t))).m_localAnchorA=new F,e.m_localAnchorB=new F,e.m_impulse=new F,e.m_motorImpulse=0,e.m_lowerImpulse=0,e.m_upperImpulse=0,e.m_enableMotor=!1,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_referenceAngle=0,e.m_lowerAngle=0,e.m_upperAngle=0,e.m_indexA=0,e.m_indexB=0,e.m_rA=new F,e.m_rB=new F,e.m_localCenterA=new F,e.m_localCenterB=new F,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_K=new E,e.m_angle=0,e.m_axialMass=0,e.m_qA=new z,e.m_qB=new z,e.m_lalcA=new F,e.m_lalcB=new F,e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,F.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,F.ZERO)),e.m_referenceAngle=b2Maybe(t.referenceAngle,0),e.m_impulse.SetZero(),e.m_motorImpulse=0,e.m_lowerAngle=b2Maybe(t.lowerAngle,0),e.m_upperAngle=b2Maybe(t.upperAngle,0),e.m_maxMotorTorque=b2Maybe(t.maxMotorTorque,0),e.m_motorSpeed=b2Maybe(t.motorSpeed,0),e.m_enableLimit=b2Maybe(t.enableLimit,!1),e.m_enableMotor=b2Maybe(t.enableMotor,!1),e}return _inherits(b2RevoluteJoint,li),_createClass(b2RevoluteJoint,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),z.MulRV(a,this.m_lalcA,this.m_rA),F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),z.MulRV(l,this.m_lalcB,this.m_rB);var h,_=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,c=this.m_invIB;if(this.m_K.ex.x=_+u+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*c,this.m_K.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*c,this.m_K.ex.y=this.m_K.ey.x,this.m_K.ey.y=_+u+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*c,this.m_axialMass=m+c,this.m_axialMass>0?(this.m_axialMass=1/this.m_axialMass,h=!1):h=!0,this.m_angle=n-e-this.m_referenceAngle,(!1===this.m_enableLimit||h)&&(this.m_lowerImpulse=0,this.m_upperImpulse=0),(!1===this.m_enableMotor||h)&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;var y=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,d=b2RevoluteJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(_,d),s-=m*(F.CrossVV(this.m_rA,d)+y),o.SelfMulAdd(u,d),r+=c*(F.CrossVV(this.m_rB,d)+y)}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,h=a+l===0;if(this.m_enableMotor&&!h){var _=n-i-this.m_motorSpeed,u=-this.m_axialMass*_,m=this.m_motorImpulse,c=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=b2Clamp(this.m_motorImpulse+u,-c,c),i-=a*(u=this.m_motorImpulse-m),n+=l*u}if(this.m_enableLimit&&!h){var y=this.m_angle-this.m_lowerAngle,d=n-i,p=-this.m_axialMass*(d+b2Max(y,0)*t.step.inv_dt),f=this.m_lowerImpulse;this.m_lowerImpulse=b2Max(this.m_lowerImpulse+p,0),i-=a*(p=this.m_lowerImpulse-f),n+=l*p;var v=this.m_upperAngle-this.m_angle,b=i-n,C=-this.m_axialMass*(b+b2Max(v,0)*t.step.inv_dt),x=this.m_upperImpulse;this.m_upperImpulse=b2Max(this.m_upperImpulse+C,0),i+=a*(C=this.m_upperImpulse-x),n-=l*C}var A=F.SubVV(F.AddVCrossSV(s,n,this.m_rB,F.s_t0),F.AddVCrossSV(e,i,this.m_rA,F.s_t1),b2RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2),S=this.m_K.Solve(-A.x,-A.y,b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,e.SelfMulSub(o,S),i-=a*F.CrossVV(this.m_rA,S),s.SelfMulAdd(r,S),n+=l*F.CrossVV(this.m_rB,S),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}},{key:"SolvePositionConstraints",value:function(t){var e,i=t.positions[this.m_indexA].c,s=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,r=this.m_qA.SetAngle(s),a=this.m_qB.SetAngle(o),l=0,h=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&!h){var _=o-s-this.m_referenceAngle,u=0;k(this.m_upperAngle-this.m_lowerAngle)<2*c?u=b2Clamp(_-this.m_lowerAngle,-p,p):_<=this.m_lowerAngle?u=b2Clamp(_-this.m_lowerAngle+c,-p,0):_>=this.m_upperAngle&&(u=b2Clamp(_-this.m_upperAngle-c,0,p));var y=-this.m_axialMass*u;s-=this.m_invIA*y,o+=this.m_invIB*y,l=k(u)}r.SetAngle(s),a.SetAngle(o),F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var d=z.MulRV(r,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var f=z.MulRV(a,this.m_lalcB,this.m_rB),v=F.SubVV(F.AddVV(n,f,F.s_t0),F.AddVV(i,d,F.s_t1),b2RevoluteJoint.SolvePositionConstraints_s_C_v2);e=v.Length();var b=this.m_invMassA,C=this.m_invMassB,x=this.m_invIA,A=this.m_invIB,S=this.m_K;S.ex.x=b+C+x*d.y*d.y+A*f.y*f.y,S.ex.y=-x*d.x*d.y-A*f.x*f.y,S.ey.x=S.ex.y,S.ey.y=b+C+x*d.x*d.x+A*f.x*f.x;var g=S.Solve(v.x,v.y,b2RevoluteJoint.SolvePositionConstraints_s_impulse).SelfNeg();return i.SelfMulSub(b,g),s-=x*F.CrossVV(d,g),n.SelfMulAdd(C,g),o+=A*F.CrossVV(f,g),t.positions[this.m_indexA].a=s,t.positions[this.m_indexB].a=o,e<=m&&l<=c}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*(this.m_lowerImpulse-this.m_upperImpulse)}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}},{key:"GetJointSpeed",value:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerAngle}},{key:"GetUpperLimit",value:function(){return this.m_upperAngle}},{key:"SetLimits",value:function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerAngle=t,this.m_upperAngle=e)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"Draw",value:function(t){var e=this.m_bodyA.GetTransform(),i=this.m_bodyB.GetTransform(),s=X.MulXV(e,this.m_localAnchorA,b2RevoluteJoint.Draw_s_pA),n=X.MulXV(i,this.m_localAnchorB,b2RevoluteJoint.Draw_s_pB),o=b2RevoluteJoint.Draw_s_c1,r=b2RevoluteJoint.Draw_s_c2,a=b2RevoluteJoint.Draw_s_c3,l=b2RevoluteJoint.Draw_s_c4,h=b2RevoluteJoint.Draw_s_c5;t.DrawPoint(s,5,l),t.DrawPoint(n,5,h);var _=this.m_bodyA.GetAngle(),u=this.m_bodyB.GetAngle()-_-this.m_referenceAngle,m=.5,c=b2RevoluteJoint.Draw_s_r.Set(m*Math.cos(u),m*Math.sin(u));if(t.DrawSegment(n,F.AddVV(n,c,F.s_t0),o),t.DrawCircle(n,m,o),this.m_enableLimit){var y=b2RevoluteJoint.Draw_s_rlo.Set(m*Math.cos(this.m_lowerAngle),m*Math.sin(this.m_lowerAngle)),d=b2RevoluteJoint.Draw_s_rhi.Set(m*Math.cos(this.m_upperAngle),m*Math.sin(this.m_upperAngle));t.DrawSegment(n,F.AddVV(n,y,F.s_t0),r),t.DrawSegment(n,F.AddVV(n,d,F.s_t0),a)}var p=b2RevoluteJoint.Draw_s_color_;t.DrawSegment(e.p,s,p),t.DrawSegment(s,n,p),t.DrawSegment(i.p,n,p)}}]),b2RevoluteJoint}();ls.InitVelocityConstraints_s_P=new F,ls.SolveVelocityConstraints_s_Cdot_v2=new F,ls.SolveVelocityConstraints_s_impulse_v2=new F,ls.SolvePositionConstraints_s_C_v2=new F,ls.SolvePositionConstraints_s_impulse=new F,ls.Draw_s_pA=new F,ls.Draw_s_pB=new F,ls.Draw_s_c1=new i(.7,.7,.7),ls.Draw_s_c2=new i(.3,.9,.3),ls.Draw_s_c3=new i(.9,.3,.3),ls.Draw_s_c4=new i(.3,.3,.9),ls.Draw_s_c5=new i(.4,.4,.4),ls.Draw_s_color_=new i(.5,.8,.8),ls.Draw_s_r=new F,ls.Draw_s_rlo=new F,ls.Draw_s_rhi=new F;var hs=function(e){function b2WeldJointDef(){var e;return _classCallCheck(this,b2WeldJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2WeldJointDef).call(this,t.b2JointType.e_weldJoint))).localAnchorA=new F,e.localAnchorB=new F,e.referenceAngle=0,e.stiffness=0,e.damping=0,e}return _inherits(b2WeldJointDef,ai),_createClass(b2WeldJointDef,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),b2WeldJointDef}(),_s=function(t){function b2WeldJoint(t){var e;return _classCallCheck(this,b2WeldJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2WeldJoint).call(this,t))).m_stiffness=0,e.m_damping=0,e.m_bias=0,e.m_localAnchorA=new F,e.m_localAnchorB=new F,e.m_referenceAngle=0,e.m_gamma=0,e.m_impulse=new j(0,0,0),e.m_indexA=0,e.m_indexB=0,e.m_rA=new F,e.m_rB=new F,e.m_localCenterA=new F,e.m_localCenterB=new F,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_mass=new q,e.m_qA=new z,e.m_qB=new z,e.m_lalcA=new F,e.m_lalcB=new F,e.m_K=new q,e.m_stiffness=b2Maybe(t.stiffness,0),e.m_damping=b2Maybe(t.damping,0),e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,F.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,F.ZERO)),e.m_referenceAngle=b2Maybe(t.referenceAngle,0),e.m_impulse.SetZero(),e}return _inherits(b2WeldJoint,li),_createClass(b2WeldJoint,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),z.MulRV(a,this.m_lalcA,this.m_rA),F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),z.MulRV(l,this.m_lalcB,this.m_rB);var h=this.m_invMassA,_=this.m_invMassB,u=this.m_invIA,m=this.m_invIB,c=this.m_K;if(c.ex.x=h+_+this.m_rA.y*this.m_rA.y*u+this.m_rB.y*this.m_rB.y*m,c.ey.x=-this.m_rA.y*this.m_rA.x*u-this.m_rB.y*this.m_rB.x*m,c.ez.x=-this.m_rA.y*u-this.m_rB.y*m,c.ex.y=c.ey.x,c.ey.y=h+_+this.m_rA.x*this.m_rA.x*u+this.m_rB.x*this.m_rB.x*m,c.ez.y=this.m_rA.x*u+this.m_rB.x*m,c.ex.z=c.ez.x,c.ey.z=c.ez.y,c.ez.z=u+m,this.m_stiffness>0){c.GetInverse22(this.m_mass);var y=u+m,d=n-e-this.m_referenceAngle,p=this.m_damping,f=this.m_stiffness,v=t.step.dt;this.m_gamma=v*(p+v*f),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=d*v*f*this.m_gamma,y+=this.m_gamma,this.m_mass.ez.z=0!==y?1/y:0}else c.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var b=b2WeldJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(h,b),s-=u*(F.CrossVV(this.m_rA,b)+this.m_impulse.z),o.SelfMulAdd(_,b),r+=m*(F.CrossVV(this.m_rB,b)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=r}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,l=this.m_invIB;if(this.m_stiffness>0){var h=n-i,_=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=_,i-=a*_,n+=l*_;var u=F.SubVV(F.AddVCrossSV(s,n,this.m_rB,F.s_t0),F.AddVCrossSV(e,i,this.m_rA,F.s_t1),b2WeldJoint.SolveVelocityConstraints_s_Cdot1),m=q.MulM33XY(this.m_mass,u.x,u.y,b2WeldJoint.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=m.x,this.m_impulse.y+=m.y;var c=m;e.SelfMulSub(o,c),i-=a*F.CrossVV(this.m_rA,c),s.SelfMulAdd(r,c),n+=l*F.CrossVV(this.m_rB,c)}else{var y=F.SubVV(F.AddVCrossSV(s,n,this.m_rB,F.s_t0),F.AddVCrossSV(e,i,this.m_rA,F.s_t1),b2WeldJoint.SolveVelocityConstraints_s_Cdot1),d=n-i,p=q.MulM33XYZ(this.m_mass,y.x,y.y,d,b2WeldJoint.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(p);var f=b2WeldJoint.SolveVelocityConstraints_s_P.Set(p.x,p.y);e.SelfMulSub(o,f),i-=a*(F.CrossVV(this.m_rA,f)+p.z),s.SelfMulAdd(r,f),n+=l*(F.CrossVV(this.m_rB,f)+p.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,n=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),r=this.m_qB.SetAngle(n),a=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,_=this.m_invIB;F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=z.MulRV(o,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y,d,p=z.MulRV(r,this.m_lalcB,this.m_rB),f=this.m_K;if(f.ex.x=a+l+u.y*u.y*h+p.y*p.y*_,f.ey.x=-u.y*u.x*h-p.y*p.x*_,f.ez.x=-u.y*h-p.y*_,f.ex.y=f.ey.x,f.ey.y=a+l+u.x*u.x*h+p.x*p.x*_,f.ez.y=u.x*h+p.x*_,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=h+_,this.m_stiffness>0){var v=F.SubVV(F.AddVV(s,p,F.s_t0),F.AddVV(e,u,F.s_t1),b2WeldJoint.SolvePositionConstraints_s_C1);y=v.Length(),d=0;var b=f.Solve22(v.x,v.y,b2WeldJoint.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(a,b),i-=h*F.CrossVV(u,b),s.SelfMulAdd(l,b),n+=_*F.CrossVV(p,b)}else{var C=F.SubVV(F.AddVV(s,p,F.s_t0),F.AddVV(e,u,F.s_t1),b2WeldJoint.SolvePositionConstraints_s_C1),x=n-i-this.m_referenceAngle;y=C.Length(),d=k(x);var A=f.Solve33(C.x,C.y,x,b2WeldJoint.SolvePositionConstraints_s_impulse).SelfNeg(),S=b2WeldJoint.SolvePositionConstraints_s_P.Set(A.x,A.y);e.SelfMulSub(a,S),i-=h*(F.CrossVV(this.m_rA,S)+A.z),s.SelfMulAdd(l,S),n+=_*(F.CrossVV(this.m_rB,S)+A.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=n,y<=m&&d<=c}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"SetStiffness",value:function(t){this.m_stiffness=t}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),b2WeldJoint}();_s.InitVelocityConstraints_s_P=new F,_s.SolveVelocityConstraints_s_Cdot1=new F,_s.SolveVelocityConstraints_s_impulse1=new F,_s.SolveVelocityConstraints_s_impulse=new j,_s.SolveVelocityConstraints_s_P=new F,_s.SolvePositionConstraints_s_C1=new F,_s.SolvePositionConstraints_s_P=new F,_s.SolvePositionConstraints_s_impulse=new j;var us=function(e){function b2WheelJointDef(){var e;return _classCallCheck(this,b2WheelJointDef),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2WheelJointDef).call(this,t.b2JointType.e_wheelJoint))).localAnchorA=new F(0,0),e.localAnchorB=new F(0,0),e.localAxisA=new F(1,0),e.enableLimit=!1,e.lowerTranslation=0,e.upperTranslation=0,e.enableMotor=!1,e.maxMotorTorque=0,e.motorSpeed=0,e.stiffness=0,e.damping=0,e}return _inherits(b2WheelJointDef,ai),_createClass(b2WheelJointDef,[{key:"Initialize",value:function(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA)}}]),b2WheelJointDef}(),ms=function(t){function b2WheelJoint(t){var e;return _classCallCheck(this,b2WheelJoint),(e=_possibleConstructorReturn(this,_getPrototypeOf(b2WheelJoint).call(this,t))).m_localAnchorA=new F,e.m_localAnchorB=new F,e.m_localXAxisA=new F,e.m_localYAxisA=new F,e.m_impulse=0,e.m_motorImpulse=0,e.m_springImpulse=0,e.m_lowerImpulse=0,e.m_upperImpulse=0,e.m_translation=0,e.m_lowerTranslation=0,e.m_upperTranslation=0,e.m_maxMotorTorque=0,e.m_motorSpeed=0,e.m_enableLimit=!1,e.m_enableMotor=!1,e.m_stiffness=0,e.m_damping=0,e.m_indexA=0,e.m_indexB=0,e.m_localCenterA=new F,e.m_localCenterB=new F,e.m_invMassA=0,e.m_invMassB=0,e.m_invIA=0,e.m_invIB=0,e.m_ax=new F,e.m_ay=new F,e.m_sAx=0,e.m_sBx=0,e.m_sAy=0,e.m_sBy=0,e.m_mass=0,e.m_motorMass=0,e.m_axialMass=0,e.m_springMass=0,e.m_bias=0,e.m_gamma=0,e.m_qA=new z,e.m_qB=new z,e.m_lalcA=new F,e.m_lalcB=new F,e.m_rA=new F,e.m_rB=new F,e.m_localAnchorA.Copy(b2Maybe(t.localAnchorA,F.ZERO)),e.m_localAnchorB.Copy(b2Maybe(t.localAnchorB,F.ZERO)),e.m_localXAxisA.Copy(b2Maybe(t.localAxisA,F.UNITX)),F.CrossOneV(e.m_localXAxisA,e.m_localYAxisA),e.m_lowerTranslation=b2Maybe(t.lowerTranslation,0),e.m_upperTranslation=b2Maybe(t.upperTranslation,0),e.m_enableLimit=b2Maybe(t.enableLimit,!1),e.m_maxMotorTorque=b2Maybe(t.maxMotorTorque,0),e.m_motorSpeed=b2Maybe(t.motorSpeed,0),e.m_enableMotor=b2Maybe(t.enableMotor,!1),e.m_ax.SetZero(),e.m_ay.SetZero(),e.m_stiffness=b2Maybe(t.stiffness,0),e.m_damping=b2Maybe(t.damping,0),e}return _inherits(b2WheelJoint,li),_createClass(b2WheelJoint,[{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"SetStiffness",value:function(t){this.m_stiffness=t}},{key:"GetStiffness",value:function(){return this.m_stiffness}},{key:"SetDamping",value:function(t){this.m_damping=t}},{key:"GetDamping",value:function(){return this.m_damping}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,n=this.m_invIB,o=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,a=t.velocities[this.m_indexA].v,l=t.velocities[this.m_indexA].w,h=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,c=this.m_qA.SetAngle(r),y=this.m_qB.SetAngle(_);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var d=z.MulRV(c,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=z.MulRV(y,this.m_lalcB,this.m_rB),f=F.SubVV(F.AddVV(h,p,F.s_t0),F.AddVV(o,d,F.s_t1),b2WheelJoint.InitVelocityConstraints_s_d);z.MulRV(c,this.m_localYAxisA,this.m_ay),this.m_sAy=F.CrossVV(F.AddVV(f,d,F.s_t0),this.m_ay),this.m_sBy=F.CrossVV(p,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+n*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),z.MulRV(c,this.m_localXAxisA,this.m_ax),this.m_sAx=F.CrossVV(F.AddVV(f,d,F.s_t0),this.m_ax),this.m_sBx=F.CrossVV(p,this.m_ax);var v=e+i+s*this.m_sAx*this.m_sAx+n*this.m_sBx*this.m_sBx;if(this.m_axialMass=v>0?1/v:0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_stiffness>0&&v>0){this.m_springMass=1/v;var b=F.DotVV(f,this.m_ax),C=t.step.dt;this.m_gamma=C*(this.m_damping+C*this.m_stiffness),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=b*C*this.m_stiffness*this.m_gamma,this.m_springMass=v+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}else this.m_springImpulse=0;if(this.m_enableLimit?this.m_translation=F.DotVV(this.m_ax,f):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor?(this.m_motorMass=s+n,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var x=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse,A=F.AddVV(F.MulSV(this.m_impulse,this.m_ay,F.s_t0),F.MulSV(x,this.m_ax,F.s_t1),b2WheelJoint.InitVelocityConstraints_s_P),S=this.m_impulse*this.m_sAy+x*this.m_sAx+this.m_motorImpulse,g=this.m_impulse*this.m_sBy+x*this.m_sBx+this.m_motorImpulse;a.SelfMulSub(this.m_invMassA,A),l-=this.m_invIA*S,u.SelfMulAdd(this.m_invMassB,A),m+=this.m_invIB*g}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=l,t.velocities[this.m_indexB].w=m}},{key:"SolveVelocityConstraints",value:function(t){var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,n=this.m_invIB,o=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=F.DotVV(this.m_ax,F.SubVV(a,o,F.s_t0))+this.m_sBx*l-this.m_sAx*r,_=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=_;var u=F.MulSV(_,this.m_ax,b2WheelJoint.SolveVelocityConstraints_s_P),m=_*this.m_sAx,c=_*this.m_sBx;o.SelfMulSub(e,u),r-=s*m,a.SelfMulAdd(i,u);var y=(l+=n*c)-r-this.m_motorSpeed,d=-this.m_motorMass*y,p=this.m_motorImpulse,f=t.step.dt*this.m_maxMotorTorque;if(this.m_motorImpulse=b2Clamp(this.m_motorImpulse+d,-f,f),r-=s*(d=this.m_motorImpulse-p),l+=n*d,this.m_enableLimit){var v=this.m_translation-this.m_lowerTranslation,b=F.DotVV(this.m_ax,F.SubVV(a,o,F.s_t0))+this.m_sBx*l-this.m_sAx*r,C=-this.m_axialMass*(b+b2Max(v,0)*t.step.inv_dt),x=this.m_lowerImpulse;this.m_lowerImpulse=b2Max(this.m_lowerImpulse+C,0),C=this.m_lowerImpulse-x;var A=F.MulSV(C,this.m_ax,b2WheelJoint.SolveVelocityConstraints_s_P),S=C*this.m_sAx,g=C*this.m_sBx;o.SelfMulSub(e,A),r-=s*S,a.SelfMulAdd(i,A),l+=n*g;var w=this.m_upperTranslation-this.m_translation,V=F.DotVV(this.m_ax,F.SubVV(o,a,F.s_t0))+this.m_sAx*r-this.m_sBx*l,B=-this.m_axialMass*(V+b2Max(w,0)*t.step.inv_dt),M=this.m_upperImpulse;this.m_upperImpulse=b2Max(this.m_upperImpulse+B,0),B=this.m_upperImpulse-M;var k=F.MulSV(B,this.m_ax,b2WheelJoint.SolveVelocityConstraints_s_P),I=B*this.m_sAx,D=B*this.m_sBx;o.SelfMulAdd(e,k),r+=s*I,a.SelfMulSub(i,k),l-=n*D}var P=F.DotVV(this.m_ay,F.SubVV(a,o,F.s_t0))+this.m_sBy*l-this.m_sAy*r,T=-this.m_mass*P;this.m_impulse+=T;var G=F.MulSV(T,this.m_ay,b2WheelJoint.SolveVelocityConstraints_s_P),R=T*this.m_sAy,J=T*this.m_sBy;o.SelfMulSub(e,G),r-=s*R,a.SelfMulAdd(i,G),l+=n*J,t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=l}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,n=t.positions[this.m_indexB].a,o=0;if(this.m_enableLimit){var r=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(n);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=z.MulRV(r,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=z.MulRV(a,this.m_lalcB,this.m_rB),_=F.AddVV(F.SubVV(s,e,F.s_t0),F.SubVV(h,l,F.s_t1),b2WheelJoint.SolvePositionConstraints_s_d),u=z.MulRV(r,this.m_localXAxisA,this.m_ax),c=F.CrossVV(F.AddVV(_,l,F.s_t0),this.m_ax),y=F.CrossVV(h,this.m_ax),d=0,p=F.DotVV(u,_);if(k(this.m_upperTranslation-this.m_lowerTranslation)<2*m?d=p:p<=this.m_lowerTranslation?d=b2Min(p-this.m_lowerTranslation,0):p>=this.m_upperTranslation&&(d=b2Max(p-this.m_upperTranslation,0)),0!==d){var f=this.m_invMassA+this.m_invMassB+this.m_invIA*c*c+this.m_invIB*y*y,v=0;0!==f&&(v=-d/f);var b=F.MulSV(v,u,b2WheelJoint.SolvePositionConstraints_s_P),C=v*c,x=v*y;e.SelfMulSub(this.m_invMassA,b),i-=this.m_invIA*C,s.SelfMulAdd(this.m_invMassB,b),n+=this.m_invIB*x,o=k(d)}}var A=this.m_qA.SetAngle(i),S=this.m_qB.SetAngle(n);F.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var g=z.MulRV(A,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var w=z.MulRV(S,this.m_lalcB,this.m_rB),V=F.AddVV(F.SubVV(s,e,F.s_t0),F.SubVV(w,g,F.s_t1),b2WheelJoint.SolvePositionConstraints_s_d),B=z.MulRV(A,this.m_localYAxisA,this.m_ay),M=F.CrossVV(F.AddVV(V,g,F.s_t0),B),I=F.CrossVV(w,B),D=F.DotVV(V,B),P=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,T=0;0!==P&&(T=-D/P);var G=F.MulSV(T,B,b2WheelJoint.SolvePositionConstraints_s_P),R=T*M,J=T*I;return e.SelfMulSub(this.m_invMassA,G),i-=this.m_invIA*R,s.SelfMulAdd(this.m_invMassB,G),n+=this.m_invIB*J,o=b2Max(o,k(D)),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=n,o<=m}},{key:"GetDefinition",value:function(t){return t}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+(this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+(this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_ax.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetJointTranslation",value:function(){return this.GetPrismaticJointTranslation()}},{key:"GetJointLinearSpeed",value:function(){return this.GetPrismaticJointSpeed()}},{key:"GetJointAngle",value:function(){return this.GetRevoluteJointAngle()}},{key:"GetJointAngularSpeed",value:function(){return this.GetRevoluteJointSpeed()}},{key:"GetPrismaticJointTranslation",value:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new F),s=e.GetWorldPoint(this.m_localAnchorB,new F),n=F.SubVV(s,i,new F),o=t.GetWorldVector(this.m_localXAxisA,new F);return F.DotVV(n,o)}},{key:"GetPrismaticJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;F.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=z.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);F.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var s=z.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=F.AddVV(t.m_sweep.c,i,F.s_t0),o=F.AddVV(e.m_sweep.c,s,F.s_t1),r=F.SubVV(o,n,F.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new F),l=t.m_linearVelocity,h=e.m_linearVelocity,_=t.m_angularVelocity,u=e.m_angularVelocity;return F.DotVV(r,F.CrossSV(_,a,F.s_t0))+F.DotVV(a,F.SubVV(F.AddVCrossSV(h,u,s,F.s_t0),F.AddVCrossSV(l,_,i,F.s_t1),F.s_t0))}},{key:"GetRevoluteJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}},{key:"GetRevoluteJointSpeed",value:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.stiffness = %.15f;\n",this.m_stiffness),t("  jd.damping = %.15f;\n",this.m_damping),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"Draw",value:function(t){var e=this.m_bodyA.GetTransform(),i=this.m_bodyB.GetTransform(),s=X.MulXV(e,this.m_localAnchorA,b2WheelJoint.Draw_s_pA),n=X.MulXV(i,this.m_localAnchorB,b2WheelJoint.Draw_s_pB),o=z.MulRV(e.q,this.m_localXAxisA,b2WheelJoint.Draw_s_axis),r=b2WheelJoint.Draw_s_c1,a=b2WheelJoint.Draw_s_c2,l=b2WheelJoint.Draw_s_c3,h=b2WheelJoint.Draw_s_c4,_=b2WheelJoint.Draw_s_c5;if(t.DrawSegment(s,n,_),this.m_enableLimit){var u=F.AddVMulSV(s,this.m_lowerTranslation,o,b2WheelJoint.Draw_s_lower),m=F.AddVMulSV(s,this.m_upperTranslation,o,b2WheelJoint.Draw_s_upper),c=z.MulRV(e.q,this.m_localYAxisA,b2WheelJoint.Draw_s_perp);t.DrawSegment(u,m,r),t.DrawSegment(F.AddVMulSV(u,-.5,c,F.s_t0),F.AddVMulSV(u,.5,c,F.s_t1),a),t.DrawSegment(F.AddVMulSV(m,-.5,c,F.s_t0),F.AddVMulSV(m,.5,c,F.s_t1),l)}else t.DrawSegment(F.AddVMulSV(s,-1,o,F.s_t0),F.AddVMulSV(s,1,o,F.s_t1),r);t.DrawPoint(s,5,r),t.DrawPoint(n,5,h)}}]),b2WheelJoint}();ms.InitVelocityConstraints_s_d=new F,ms.InitVelocityConstraints_s_P=new F,ms.SolveVelocityConstraints_s_P=new F,ms.SolvePositionConstraints_s_d=new F,ms.SolvePositionConstraints_s_P=new F,ms.Draw_s_pA=new F,ms.Draw_s_pB=new F,ms.Draw_s_axis=new F,ms.Draw_s_c1=new i(.7,.7,.7),ms.Draw_s_c2=new i(.3,.9,.3),ms.Draw_s_c3=new i(.9,.3,.3),ms.Draw_s_c4=new i(.3,.3,.9),ms.Draw_s_c5=new i(.4,.4,.4),ms.Draw_s_lower=new F,ms.Draw_s_upper=new F,ms.Draw_s_perp=new F;var cs,ys,ds=function(){function b2World(t){_classCallCheck(this,b2World),this.m_contactManager=new Ji,this.m_bodyList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new F,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_newContacts=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new Li,this.m_island=new Hi,this.s_stack=[],this.m_gravity.Copy(t)}return _createClass(b2World,[{key:"SetDestructionListener",value:function(t){this.m_destructionListener=t}},{key:"SetContactFilter",value:function(t){this.m_contactManager.m_contactFilter=t}},{key:"SetContactListener",value:function(t){this.m_contactManager.m_contactListener=t}},{key:"SetDebugDraw",value:function(t){this.m_debugDraw=t}},{key:"CreateBody",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.IsLocked())throw new Error;var e=new vi(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}},{key:"DestroyBody",value:function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var s=t.m_contactList;s;){var n=s;s=s.next,this.m_contactManager.Destroy(n.contact)}t.m_contactList=null;for(var o=t.m_fixtureList;o;){var r=o;o=o.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(r),r.DestroyProxies(),r.Reset(),t.m_fixtureList=o,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},{key:"CreateJoint",value:function(t){if(this.IsLocked())throw new Error;var e=b2World._Joint_Create(t);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var i=e.m_bodyA,s=e.m_bodyB;if(!e.m_collideConnected)for(var n=s.GetContactList();n;)n.other===i&&n.contact.FlagForFiltering(),n=n.next;return e}},{key:"DestroyJoint",value:function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB,s=t.m_collideConnected;if(e.SetAwake(!0),i.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.Reset(),t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.Reset(),b2World._Joint_Destroy(t),--this.m_jointCount,!s)for(var n=i.GetContactList();n;)n.other===e&&n.contact.FlagForFiltering(),n=n.next}},{key:"Step",value:function(t,e,i){var s=b2World.Step_s_stepTimer.Reset();this.m_newContacts&&(this.m_contactManager.FindNewContacts(),this.m_newContacts=!1),this.m_locked=!0;var n=b2World.Step_s_step;n.dt=t,n.velocityIterations=e,n.positionIterations=i,n.inv_dt=t>0?1/t:0,n.dtRatio=this.m_inv_dt0*t,n.warmStarting=this.m_warmStarting;var o=b2World.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=o.GetMilliseconds(),this.m_stepComplete&&n.dt>0){var r=b2World.Step_s_timer.Reset();this.Solve(n),this.m_profile.solve=r.GetMilliseconds()}if(this.m_continuousPhysics&&n.dt>0){var a=b2World.Step_s_timer.Reset();this.SolveTOI(n),this.m_profile.solveTOI=a.GetMilliseconds()}n.dt>0&&(this.m_inv_dt0=n.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=s.GetMilliseconds()}},{key:"ClearForces",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}},{key:"DebugDraw",value:function(){if(null!==this.m_debugDraw){var e=this.m_debugDraw.GetFlags(),s=b2World.DebugDraw_s_color.SetRGB(0,0,0);if(e&t.b2DrawFlags.e_shapeBit)for(var n=this.m_bodyList;n;n=n.m_next){var o=n.m_xf;this.m_debugDraw.PushTransform(o);for(var r=n.GetFixtureList();r;r=r.m_next)n.GetType()===t.b2BodyType.b2_dynamicBody&&0===n.m_mass?this.DrawShape(r,new i(1,0,0)):n.IsEnabled()?n.GetType()===t.b2BodyType.b2_staticBody?(s.SetRGB(.5,.9,.5),this.DrawShape(r,s)):n.GetType()===t.b2BodyType.b2_kinematicBody?(s.SetRGB(.5,.5,.9),this.DrawShape(r,s)):n.IsAwake()?(s.SetRGB(.9,.7,.7),this.DrawShape(r,s)):(s.SetRGB(.6,.6,.6),this.DrawShape(r,s)):(s.SetRGB(.5,.5,.3),this.DrawShape(r,s));this.m_debugDraw.PopTransform(o)}if(e&t.b2DrawFlags.e_jointBit)for(var a=this.m_jointList;a;a=a.m_next)a.Draw(this.m_debugDraw);if(e&t.b2DrawFlags.e_pairBit){s.SetRGB(.3,.9,.9);for(var l=this.m_contactManager.m_contactList;l;l=l.m_next){var h=l.GetFixtureA(),_=l.GetFixtureB(),u=l.GetChildIndexA(),m=l.GetChildIndexB(),c=h.GetAABB(u).GetCenter(),y=_.GetAABB(m).GetCenter();this.m_debugDraw.DrawSegment(c,y,s)}}if(e&t.b2DrawFlags.e_aabbBit){s.SetRGB(.9,.3,.9);for(var d=b2World.DebugDraw_s_vs,p=this.m_bodyList;p;p=p.m_next)if(p.IsEnabled())for(var f=p.GetFixtureList();f;f=f.m_next)for(var v=0;v<f.m_proxyCount;++v){var b=f.m_proxies[v].treeNode.aabb;d[0].Set(b.lowerBound.x,b.lowerBound.y),d[1].Set(b.upperBound.x,b.lowerBound.y),d[2].Set(b.upperBound.x,b.upperBound.y),d[3].Set(b.lowerBound.x,b.upperBound.y),this.m_debugDraw.DrawPolygon(d,4,s)}}if(e&t.b2DrawFlags.e_centerOfMassBit)for(var C=this.m_bodyList;C;C=C.m_next){var x=b2World.DebugDraw_s_xf;x.q.Copy(C.m_xf.q),x.p.Copy(C.GetWorldCenter()),this.m_debugDraw.DrawTransform(x)}}}},{key:"QueryAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof Gi?this._QueryAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryAABB",value:function(t,e,i){this.m_contactManager.m_broadPhase.Query(e,function(e){var s=e.userData.fixture;return t?t.ReportFixture(s):!i||i(s)})}},{key:"QueryAllAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryAABB(t,function(t){return e.push(t),!0}),e}},{key:"QueryPointAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof Gi?this._QueryPointAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryPointAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryPointAABB",value:function(t,e,i){this.m_contactManager.m_broadPhase.QueryPoint(e,function(e){var s=e.userData.fixture;return t?t.ReportFixture(s):!i||i(s)})}},{key:"QueryAllPointAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryPointAABB(t,function(t){return e.push(t),!0}),e}},{key:"QueryFixtureShape",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof Gi?this._QueryFixtureShape(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3]):this._QueryFixtureShape(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3])}},{key:"_QueryFixtureShape",value:function(t,e,i,s,n){var o=b2World.QueryFixtureShape_s_aabb;e.ComputeAABB(o,s,i),this.m_contactManager.m_broadPhase.Query(o,function(o){var r=o.userData,a=r.fixture;if(b2TestOverlapShape(e,i,a.GetShape(),r.childIndex,s,a.GetBody().GetTransform())){if(t)return t.ReportFixture(a);if(n)return n(a)}return!0})}},{key:"QueryAllFixtureShape",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.QueryFixtureShape(t,e,i,function(t){return s.push(t),!0}),s}},{key:"QueryFixturePoint",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof Gi?this._QueryFixturePoint(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryFixturePoint(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryFixturePoint",value:function(t,e,i){this.m_contactManager.m_broadPhase.QueryPoint(e,function(s){var n=s.userData.fixture;if(n.TestPoint(e)){if(t)return t.ReportFixture(n);if(i)return i(n)}return!0})}},{key:"QueryAllFixturePoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryFixturePoint(t,function(t){return e.push(t),!0}),e}},{key:"RayCast",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof Ri?this._RayCast(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):this._RayCast(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},{key:"_RayCast",value:function(t,e,i,s){var n=b2World.RayCast_s_input;n.maxFraction=1,n.p1.Copy(e),n.p2.Copy(i),this.m_contactManager.m_broadPhase.RayCast(n,function(n,o){var r=o.userData,a=r.fixture,l=r.childIndex,h=b2World.RayCast_s_output;if(a.RayCast(h,n,l)){var _=h.fraction,u=b2World.RayCast_s_point;if(u.Set((1-_)*e.x+_*i.x,(1-_)*e.y+_*i.y),t)return t.ReportFixture(a,u,h.normal,_);if(s)return s(a,u,h.normal,_)}return n.maxFraction})}},{key:"RayCastOne",value:function(t,e){var i=null,s=1;return this.RayCast(t,e,function(t,e,n,o){return o<s&&(s=o,i=t),s}),i}},{key:"RayCastAll",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.RayCast(t,e,function(t,e,s,n){return i.push(t),1}),i}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactManager.m_contactList}},{key:"SetAllowSleeping",value:function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}},{key:"GetAllowSleeping",value:function(){return this.m_allowSleep}},{key:"SetWarmStarting",value:function(t){this.m_warmStarting=t}},{key:"GetWarmStarting",value:function(){return this.m_warmStarting}},{key:"SetContinuousPhysics",value:function(t){this.m_continuousPhysics=t}},{key:"GetContinuousPhysics",value:function(){return this.m_continuousPhysics}},{key:"SetSubStepping",value:function(t){this.m_subStepping=t}},{key:"GetSubStepping",value:function(){return this.m_subStepping}},{key:"GetProxyCount",value:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}},{key:"GetBodyCount",value:function(){return this.m_bodyCount}},{key:"GetJointCount",value:function(){return this.m_jointCount}},{key:"GetContactCount",value:function(){return this.m_contactManager.m_contactCount}},{key:"GetTreeHeight",value:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}},{key:"GetTreeBalance",value:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}},{key:"GetTreeQuality",value:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}},{key:"SetGravity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!F.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)}},{key:"GetGravity",value:function(){return this.m_gravity}},{key:"IsLocked",value:function(){return this.m_locked}},{key:"SetAutoClearForces",value:function(t){this.m_clearForces=t}},{key:"GetAutoClearForces",value:function(){return this.m_clearForces}},{key:"ShiftOrigin",value:function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},{key:"GetContactManager",value:function(){return this.m_contactManager}},{key:"GetProfile",value:function(){return this.m_profile}},{key:"Dump",value:function(e){if(!this.m_locked){e("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),e("this.m_world.SetGravity(g);\n"),e("const bodies: b2Body[] = [];\n"),e("const joints: b2Joint[] = [];\n");for(var i=0,s=this.m_bodyList;s;s=s.m_next)s.m_islandIndex=i,s.Dump(e),++i;i=0;for(var n=this.m_jointList;n;n=n.m_next)n.m_index=i,++i;for(var o=this.m_jointList;o;o=o.m_next)o.m_type!==t.b2JointType.e_gearJoint&&(e("{\n"),o.Dump(e),e("}\n"));for(var r=this.m_jointList;r;r=r.m_next)r.m_type===t.b2JointType.e_gearJoint&&(e("{\n"),r.Dump(e),e("}\n"))}}},{key:"DrawShape",value:function(e,i){if(null!==this.m_debugDraw){var s=e.GetShape();switch(s.m_type){case t.b2ShapeType.e_circleShape:var n=s,o=n.m_p,r=n.m_radius,a=F.UNITX;this.m_debugDraw.DrawSolidCircle(o,r,a,i);break;case t.b2ShapeType.e_edgeShape:var l=s,h=l.m_vertex1,_=l.m_vertex2;this.m_debugDraw.DrawSegment(h,_,i),!1===l.m_oneSided&&(this.m_debugDraw.DrawPoint(h,4,i),this.m_debugDraw.DrawPoint(_,4,i));break;case t.b2ShapeType.e_chainShape:for(var u=s,m=u.m_count,c=u.m_vertices,y=c[0],d=1;d<m;++d){var p=c[d];this.m_debugDraw.DrawSegment(y,p,i),y=p}break;case t.b2ShapeType.e_polygonShape:var f=s,v=f.m_count,b=f.m_vertices;this.m_debugDraw.DrawSolidPolygon(b,v,i)}}}},{key:"Solve",value:function(e){this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var i=this.m_island;i.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_islandFlag=!1;for(var o=this.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;for(var r=this.s_stack,a=this.m_bodyList;a;a=a.m_next)if(!a.m_islandFlag&&a.IsAwake()&&a.IsEnabled()&&a.GetType()!==t.b2BodyType.b2_staticBody){i.Clear();var l=0;for(r[l++]=a,a.m_islandFlag=!0;l>0;){var h=r[--l];if(!h)throw new Error;if(i.AddBody(h),h.GetType()!==t.b2BodyType.b2_staticBody){h.m_awakeFlag=!0;for(var _=h.m_contactList;_;_=_.next){var u=_.contact;if(!u.m_islandFlag&&(u.IsEnabled()&&u.IsTouching())){var m=u.m_fixtureA.m_isSensor,c=u.m_fixtureB.m_isSensor;if(!m&&!c){i.AddContact(u),u.m_islandFlag=!0;var y=_.other;y.m_islandFlag||(r[l++]=y,y.m_islandFlag=!0)}}}for(var d=h.m_jointList;d;d=d.next)if(!d.joint.m_islandFlag){var p=d.other;p.IsEnabled()&&(i.AddJoint(d.joint),d.joint.m_islandFlag=!0,p.m_islandFlag||(r[l++]=p,p.m_islandFlag=!0))}}}var f=new Li;i.Solve(f,e,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=f.solveInit,this.m_profile.solveVelocity+=f.solveVelocity,this.m_profile.solvePosition+=f.solvePosition;for(var v=0;v<i.m_bodyCount;++v){var b=i.m_bodies[v];b.GetType()===t.b2BodyType.b2_staticBody&&(b.m_islandFlag=!1)}}for(var C=0;C<r.length&&r[C];++C)r[C]=null;for(var x=new Z,A=this.m_bodyList;A;A=A.m_next)A.m_islandFlag&&A.GetType()!==t.b2BodyType.b2_staticBody&&A.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=x.GetMilliseconds()}},{key:"SolveTOI",value:function(e){var i=this.m_island;if(i.Initialize(64,32,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1,s.m_sweep.alpha0=0;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_toiFlag=!1,n.m_islandFlag=!1,n.m_toiCount=0,n.m_toi=1}for(;;){for(var r=null,a=1,l=this.m_contactManager.m_contactList;l;l=l.m_next)if(l.IsEnabled()&&!(l.m_toiCount>8)){var h=1;if(l.m_toiFlag)h=l.m_toi;else{var _=l.GetFixtureA(),u=l.GetFixtureB();if(_.IsSensor()||u.IsSensor())continue;var m=_.GetBody(),c=u.GetBody(),y=m.m_type,d=c.m_type,p=m.IsAwake()&&y!==t.b2BodyType.b2_staticBody,f=c.IsAwake()&&d!==t.b2BodyType.b2_staticBody;if(!p&&!f)continue;var v=m.IsBullet()||y!==t.b2BodyType.b2_dynamicBody,b=c.IsBullet()||d!==t.b2BodyType.b2_dynamicBody;if(!v&&!b)continue;var C=m.m_sweep.alpha0;m.m_sweep.alpha0<c.m_sweep.alpha0?(C=c.m_sweep.alpha0,m.m_sweep.Advance(C)):c.m_sweep.alpha0<m.m_sweep.alpha0&&(C=m.m_sweep.alpha0,c.m_sweep.Advance(C));var x=l.GetChildIndexA(),A=l.GetChildIndexB(),S=b2World.SolveTOI_s_toi_input;S.proxyA.SetShape(_.GetShape(),x),S.proxyB.SetShape(u.GetShape(),A),S.sweepA.Copy(m.m_sweep),S.sweepB.Copy(c.m_sweep),S.tMax=1;var g=b2World.SolveTOI_s_toi_output;b2TimeOfImpact(g,S);var w=g.t;h=g.state===t.b2TOIOutputState.e_touching?b2Min(C+(1-C)*w,1):1,l.m_toi=h,l.m_toiFlag=!0}h<a&&(r=l,a=h)}if(null===r||1-10*o<a){this.m_stepComplete=!0;break}var V=r.GetFixtureA(),B=r.GetFixtureB(),M=V.GetBody(),k=B.GetBody(),I=b2World.SolveTOI_s_backup1.Copy(M.m_sweep),D=b2World.SolveTOI_s_backup2.Copy(k.m_sweep);if(M.Advance(a),k.Advance(a),r.Update(this.m_contactManager.m_contactListener),r.m_toiFlag=!1,++r.m_toiCount,r.IsEnabled()&&r.IsTouching()){M.SetAwake(!0),k.SetAwake(!0),i.Clear(),i.AddBody(M),i.AddBody(k),i.AddContact(r),M.m_islandFlag=!0,k.m_islandFlag=!0,r.m_islandFlag=!0;for(var P=0;P<2;++P){var T=0===P?M:k;if(T.m_type===t.b2BodyType.b2_dynamicBody)for(var G=T.m_contactList;G&&i.m_bodyCount!==i.m_bodyCapacity&&i.m_contactCount!==i.m_contactCapacity;G=G.next){var R=G.contact;if(!R.m_islandFlag){var J=G.other;if(J.m_type!==t.b2BodyType.b2_dynamicBody||T.IsBullet()||J.IsBullet()){var L=R.m_fixtureA.m_isSensor,F=R.m_fixtureB.m_isSensor;if(!L&&!F){var O=b2World.SolveTOI_s_backup.Copy(J.m_sweep);J.m_islandFlag||J.Advance(a),R.Update(this.m_contactManager.m_contactListener),R.IsEnabled()&&R.IsTouching()?(R.m_islandFlag=!0,i.AddContact(R),J.m_islandFlag||(J.m_islandFlag=!0,J.m_type!==t.b2BodyType.b2_staticBody&&J.SetAwake(!0),i.AddBody(J))):(J.m_sweep.Copy(O),J.SynchronizeTransform())}}}}}var j=b2World.SolveTOI_s_subStep;j.dt=(1-a)*e.dt,j.inv_dt=1/j.dt,j.dtRatio=1,j.positionIterations=20,j.velocityIterations=e.velocityIterations,j.warmStarting=!1,i.SolveTOI(j,M.m_islandIndex,k.m_islandIndex);for(var E=0;E<i.m_bodyCount;++E){var q=i.m_bodies[E];if(q.m_islandFlag=!1,q.m_type===t.b2BodyType.b2_dynamicBody){q.SynchronizeFixtures();for(var z=q.m_contactList;z;z=z.next)z.contact.m_toiFlag=!1,z.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else r.SetEnabled(!1),M.m_sweep.Copy(I),k.m_sweep.Copy(D),M.SynchronizeTransform(),k.SynchronizeTransform()}}}],[{key:"_Joint_Create",value:function(e){switch(e.type){case t.b2JointType.e_distanceJoint:return new _i(e);case t.b2JointType.e_mouseJoint:return new is(e);case t.b2JointType.e_prismaticJoint:return new ns(e);case t.b2JointType.e_revoluteJoint:return new ls(e);case t.b2JointType.e_pulleyJoint:return new rs(e);case t.b2JointType.e_gearJoint:return new Ki(e);case t.b2JointType.e_wheelJoint:return new ms(e);case t.b2JointType.e_weldJoint:return new _s(e);case t.b2JointType.e_frictionJoint:return new Yi(e);case t.b2JointType.e_motorJoint:return new ts(e);case t.b2JointType.e_areaJoint:return new mi(e)}throw new Error}},{key:"_Joint_Destroy",value:function(t){}}]),b2World}();ds.Step_s_step=new Fi,ds.Step_s_stepTimer=new Z,ds.Step_s_timer=new Z,ds.DebugDraw_s_color=new i(0,0,0),ds.DebugDraw_s_vs=F.MakeArray(4),ds.DebugDraw_s_xf=new X,ds.QueryFixtureShape_s_aabb=new It,ds.RayCast_s_input=new Mt,ds.RayCast_s_output=new kt,ds.RayCast_s_point=new F,ds.SolveTOI_s_subStep=new Fi,ds.SolveTOI_s_backup=new N,ds.SolveTOI_s_backup1=new N,ds.SolveTOI_s_backup2=new N,ds.SolveTOI_s_toi_input=new We,ds.SolveTOI_s_toi_output=new Ze,t.b2StretchingModel=void 0,(cs=t.b2StretchingModel||(t.b2StretchingModel={}))[cs.b2_pbdStretchingModel=0]="b2_pbdStretchingModel",cs[cs.b2_xpbdStretchingModel=1]="b2_xpbdStretchingModel",t.b2BendingModel=void 0,(ys=t.b2BendingModel||(t.b2BendingModel={}))[ys.b2_springAngleBendingModel=0]="b2_springAngleBendingModel",ys[ys.b2_pbdAngleBendingModel=1]="b2_pbdAngleBendingModel",ys[ys.b2_xpbdAngleBendingModel=2]="b2_xpbdAngleBendingModel",ys[ys.b2_pbdDistanceBendingModel=3]="b2_pbdDistanceBendingModel",ys[ys.b2_pbdHeightBendingModel=4]="b2_pbdHeightBendingModel",ys[ys.b2_pbdTriangleBendingModel=5]="b2_pbdTriangleBendingModel";var ps=function(){function b2RopeTuning(){_classCallCheck(this,b2RopeTuning),this.stretchingModel=t.b2StretchingModel.b2_pbdStretchingModel,this.bendingModel=t.b2BendingModel.b2_pbdAngleBendingModel,this.damping=0,this.stretchStiffness=1,this.stretchHertz=0,this.stretchDamping=0,this.bendStiffness=.5,this.bendHertz=1,this.bendDamping=0,this.isometric=!1,this.fixedEffectiveMass=!1,this.warmStart=!1}return _createClass(b2RopeTuning,[{key:"Copy",value:function(t){return this.stretchingModel=t.stretchingModel,this.bendingModel=t.bendingModel,this.damping=t.damping,this.stretchStiffness=t.stretchStiffness,this.stretchHertz=t.stretchHertz,this.stretchDamping=t.stretchDamping,this.bendStiffness=t.bendStiffness,this.bendHertz=t.bendHertz,this.bendDamping=t.bendDamping,this.isometric=t.isometric,this.fixedEffectiveMass=t.fixedEffectiveMass,this.warmStart=t.warmStart,this}}]),b2RopeTuning}(),fs=function b2RopeStretch(){_classCallCheck(this,b2RopeStretch),this.i1=0,this.i2=0,this.invMass1=0,this.invMass2=0,this.L=0,this.lambda=0,this.spring=0,this.damper=0},vs=function b2RopeBend(){_classCallCheck(this,b2RopeBend),this.i1=0,this.i2=0,this.i3=0,this.invMass1=0,this.invMass2=0,this.invMass3=0,this.invEffectiveMass=0,this.lambda=0,this.L1=0,this.L2=0,this.alpha1=0,this.alpha2=0,this.spring=0,this.damper=0},bs=function(){function b2Rope(){_classCallCheck(this,b2Rope),this.m_position=new F,this.m_count=0,this.m_stretchCount=0,this.m_bendCount=0,this.m_stretchConstraints=[],this.m_bendConstraints=[],this.m_bindPositions=[],this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_invMasses=[],this.m_gravity=new F,this.m_tuning=new ps}return _createClass(b2Rope,[{key:"Create",value:function(t){function make_array(t,e,i){for(var s=0;s<e;++s)t[s]=i(s)}this.m_position.Copy(t.position),this.m_count=t.count,make_array(this.m_bindPositions,this.m_count,function(){return new F}),make_array(this.m_ps,this.m_count,function(){return new F}),make_array(this.m_p0s,this.m_count,function(){return new F}),make_array(this.m_vs,this.m_count,function(){return new F}),make_array(this.m_invMasses,this.m_count,function(){return 0});for(var e=0;e<this.m_count;++e){this.m_bindPositions[e].Copy(t.vertices[e]),this.m_ps[e].Copy(t.vertices[e]).SelfAdd(this.m_position),this.m_p0s[e].Copy(t.vertices[e]).SelfAdd(this.m_position),this.m_vs[e].SetZero();var i=t.masses[e];this.m_invMasses[e]=i>0?1/i:0}this.m_stretchCount=this.m_count-1,this.m_bendCount=this.m_count-2,make_array(this.m_stretchConstraints,this.m_stretchCount,function(){return new fs}),make_array(this.m_bendConstraints,this.m_bendCount,function(){return new vs});for(var s=0;s<this.m_stretchCount;++s){var n=this.m_stretchConstraints[s],o=this.m_ps[s],r=this.m_ps[s+1];n.i1=s,n.i2=s+1,n.L=F.DistanceVV(o,r),n.invMass1=this.m_invMasses[s],n.invMass2=this.m_invMasses[s+1],n.lambda=0,n.damper=0,n.spring=0}for(var a=0;a<this.m_bendCount;++a){var l=this.m_bendConstraints[a],h=this.m_ps[a],_=this.m_ps[a+1],u=this.m_ps[a+2];l.i1=a,l.i2=a+1,l.i3=a+2,l.invMass1=this.m_invMasses[a],l.invMass2=this.m_invMasses[a+1],l.invMass3=this.m_invMasses[a+2],l.invEffectiveMass=0,l.L1=F.DistanceVV(h,_),l.L2=F.DistanceVV(_,u),l.lambda=0;var m=F.SubVV(_,h,new F),c=F.SubVV(u,_,new F),y=m.LengthSquared(),d=c.LengthSquared();if(y*d!=0){var p=(new F).Copy(m).SelfSkew().SelfMul(-1/y),f=(new F).Copy(c).SelfSkew().SelfMul(1/d),v=p.Clone().SelfNeg(),b=p.Clone().SelfSub(f),C=f.Clone();l.invEffectiveMass=l.invMass1*F.DotVV(v,v)+l.invMass2*F.DotVV(b,b)+l.invMass3*F.DotVV(C,C);var x=F.SubVV(u,h,new F),A=x.LengthSquared();0!==A&&(l.alpha1=F.DotVV(c,x)/A,l.alpha2=F.DotVV(m,x)/A)}}this.m_gravity.Copy(t.gravity),this.SetTuning(t.tuning)}},{key:"SetTuning",value:function(t){this.m_tuning.Copy(t);for(var e=2*a*this.m_tuning.bendHertz,i=0;i<this.m_bendCount;++i){var s=this.m_bendConstraints[i],n=s.L1*s.L1,o=s.L2*s.L2;if(n*o!=0){var r=1/s.L1+1/s.L2,l=s.invMass1/n+s.invMass2*r*r+s.invMass3/o;if(0!==l){var h=1/l;s.spring=h*e*e,s.damper=2*h*this.m_tuning.bendDamping*e}else s.spring=0,s.damper=0}else s.spring=0,s.damper=0}for(var _=2*a*this.m_tuning.stretchHertz,u=0;u<this.m_stretchCount;++u){var m=this.m_stretchConstraints[u],c=m.invMass1+m.invMass2;if(0!==c){var y=1/c;m.spring=y*_*_,m.damper=2*y*this.m_tuning.stretchDamping*_}}}},{key:"Step",value:function(e,i,s){if(0!==e){for(var n=1/e,o=Math.exp(-e*this.m_tuning.damping),r=0;r<this.m_count;++r)this.m_invMasses[r]>0?(this.m_vs[r].x*=o,this.m_vs[r].y*=o,this.m_vs[r].x+=e*this.m_gravity.x,this.m_vs[r].y+=e*this.m_gravity.y):(this.m_vs[r].x=n*(this.m_bindPositions[r].x+s.x-this.m_p0s[r].x),this.m_vs[r].y=n*(this.m_bindPositions[r].y+s.y-this.m_p0s[r].y));this.m_tuning.bendingModel===t.b2BendingModel.b2_springAngleBendingModel&&this.ApplyBendForces(e);for(var a=0;a<this.m_bendCount;++a)this.m_bendConstraints[a].lambda=0;for(var l=0;l<this.m_stretchCount;++l)this.m_stretchConstraints[l].lambda=0;for(var h=0;h<this.m_count;++h)this.m_ps[h].x+=e*this.m_vs[h].x,this.m_ps[h].y+=e*this.m_vs[h].y;for(var _=0;_<i;++_)this.m_tuning.bendingModel===t.b2BendingModel.b2_pbdAngleBendingModel?this.SolveBend_PBD_Angle():this.m_tuning.bendingModel===t.b2BendingModel.b2_xpbdAngleBendingModel?this.SolveBend_XPBD_Angle(e):this.m_tuning.bendingModel===t.b2BendingModel.b2_pbdDistanceBendingModel?this.SolveBend_PBD_Distance():this.m_tuning.bendingModel===t.b2BendingModel.b2_pbdHeightBendingModel?this.SolveBend_PBD_Height():this.m_tuning.bendingModel===t.b2BendingModel.b2_pbdTriangleBendingModel&&this.SolveBend_PBD_Triangle(),this.m_tuning.stretchingModel===t.b2StretchingModel.b2_pbdStretchingModel?this.SolveStretch_PBD():this.m_tuning.stretchingModel===t.b2StretchingModel.b2_xpbdStretchingModel&&this.SolveStretch_XPBD(e);for(var u=0;u<this.m_count;++u)this.m_vs[u].x=n*(this.m_ps[u].x-this.m_p0s[u].x),this.m_vs[u].y=n*(this.m_ps[u].y-this.m_p0s[u].y),this.m_p0s[u].Copy(this.m_ps[u])}}},{key:"Reset",value:function(t){this.m_position.Copy(t);for(var e=0;e<this.m_count;++e)this.m_ps[e].x=this.m_bindPositions[e].x+this.m_position.x,this.m_ps[e].y=this.m_bindPositions[e].y+this.m_position.y,this.m_p0s[e].x=this.m_bindPositions[e].x+this.m_position.x,this.m_p0s[e].y=this.m_bindPositions[e].y+this.m_position.y,this.m_vs[e].SetZero();for(var i=0;i<this.m_bendCount;++i)this.m_bendConstraints[i].lambda=0;for(var s=0;s<this.m_stretchCount;++s)this.m_stretchConstraints[s].lambda=0}},{key:"Draw",value:function(t){for(var e=new i(.4,.5,.7),s=new i(.1,.8,.1),n=new i(.7,.2,.4),o=0;o<this.m_count-1;++o){t.DrawSegment(this.m_ps[o],this.m_ps[o+1],e);var r=this.m_invMasses[o]>0?n:s;t.DrawPoint(this.m_ps[o],5,r)}var a=this.m_invMasses[this.m_count-1]>0?n:s;t.DrawPoint(this.m_ps[this.m_count-1],5,a)}},{key:"SolveStretch_PBD",value:function(){for(var t=this.m_tuning.stretchStiffness,e=0;e<this.m_stretchCount;++e){var i=this.m_stretchConstraints[e],s=this.m_ps[i.i1].Clone(),n=this.m_ps[i.i2].Clone(),o=n.Clone().SelfSub(s),r=o.Normalize(),a=i.invMass1+i.invMass2;if(0!==a){var l=i.invMass1/a,h=i.invMass2/a;s.x-=t*l*(i.L-r)*o.x,s.y-=t*l*(i.L-r)*o.y,n.x+=t*h*(i.L-r)*o.x,n.y+=t*h*(i.L-r)*o.y,this.m_ps[i.i1].Copy(s),this.m_ps[i.i2].Copy(n)}}}},{key:"SolveStretch_XPBD",value:function(t){for(var e=0;e<this.m_stretchCount;++e){var i=this.m_stretchConstraints[e],s=this.m_ps[i.i1].Clone(),n=this.m_ps[i.i2].Clone(),o=s.Clone().SelfSub(this.m_p0s[i.i1]),r=n.Clone().SelfSub(this.m_p0s[i.i2]),a=n.Clone().SelfSub(s),l=a.Normalize(),h=a.Clone().SelfNeg(),_=a,u=i.invMass1+i.invMass2;if(0!==u){var m=1/(i.spring*t*t),c=m*(t*t*i.damper)/t,y=l-i.L,d=F.DotVV(h,o)+F.DotVV(_,r),p=-(y+m*i.lambda+c*d)/((1+c)*u+m);s.x+=i.invMass1*p*h.x,s.y+=i.invMass1*p*h.y,n.x+=i.invMass2*p*_.x,n.y+=i.invMass2*p*_.y,this.m_ps[i.i1].Copy(s),this.m_ps[i.i2].Copy(n),i.lambda+=p}}}},{key:"SolveBend_PBD_Angle",value:function(){for(var t=this.m_tuning.bendStiffness,e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],s=this.m_ps[i.i1],n=this.m_ps[i.i2],o=this.m_ps[i.i3],r=n.Clone().SelfSub(s),a=o.Clone().SelfSub(n),l=F.CrossVV(r,a),h=F.DotVV(r,a),_=L(l,h),u=0,m=0;if(this.m_tuning.isometric?(u=i.L1*i.L1,m=i.L2*i.L2):(u=r.LengthSquared(),m=a.LengthSquared()),u*m!=0){var c=(new F).Copy(r).SelfSkew().SelfMul(-1/u),y=(new F).Copy(a).SelfSkew().SelfMul(1/m),d=c.Clone().SelfNeg(),p=c.Clone().SelfSub(y),f=y,v=0;0===(v=this.m_tuning.fixedEffectiveMass?i.invEffectiveMass:i.invMass1*F.DotVV(d,d)+i.invMass2*F.DotVV(p,p)+i.invMass3*F.DotVV(f,f))&&(v=i.invEffectiveMass);var b=-t*_/v;s.x+=i.invMass1*b*d.x,s.y+=i.invMass1*b*d.y,n.x+=i.invMass2*b*p.x,n.y+=i.invMass2*b*p.y,o.x+=i.invMass3*b*f.x,o.y+=i.invMass3*b*f.y,this.m_ps[i.i1].Copy(s),this.m_ps[i.i2].Copy(n),this.m_ps[i.i3].Copy(o)}}}},{key:"SolveBend_XPBD_Angle",value:function(t){for(var e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],s=this.m_ps[i.i1],n=this.m_ps[i.i2],o=this.m_ps[i.i3],r=s.Clone().SelfSub(this.m_p0s[i.i1]),a=n.Clone().SelfSub(this.m_p0s[i.i2]),l=o.Clone().SelfSub(this.m_p0s[i.i3]),h=n.Clone().SelfSub(s),_=o.Clone().SelfSub(n),u=void 0,m=void 0;if(this.m_tuning.isometric?(u=i.L1*i.L1,m=i.L2*i.L2):(u=h.LengthSquared(),m=_.LengthSquared()),u*m!=0){var c=F.CrossVV(h,_),y=F.DotVV(h,_),d=L(c,y),p=(new F).Copy(h).SelfSkew().SelfMul(-1/u),f=(new F).Copy(_).SelfSkew().SelfMul(1/m),v=p.Clone().SelfNeg(),b=p.Clone().SelfSub(f),C=f,x=void 0;if(0!==(x=this.m_tuning.fixedEffectiveMass?i.invEffectiveMass:i.invMass1*F.DotVV(v,v)+i.invMass2*F.DotVV(b,b)+i.invMass3*F.DotVV(C,C))){var A=1/(i.spring*t*t),S=A*(t*t*i.damper)/t,g=d,w=F.DotVV(v,r)+F.DotVV(b,a)+F.DotVV(C,l),V=-(g+A*i.lambda+S*w)/((1+S)*x+A);s.x+=i.invMass1*V*v.x,s.y+=i.invMass1*V*v.y,n.x+=i.invMass2*V*b.x,n.y+=i.invMass2*V*b.y,o.x+=i.invMass3*V*C.x,o.y+=i.invMass3*V*C.y,this.m_ps[i.i1].Copy(s),this.m_ps[i.i2].Copy(n),this.m_ps[i.i3].Copy(o),i.lambda+=V}}}}},{key:"SolveBend_PBD_Distance",value:function(){for(var t=this.m_tuning.bendStiffness,e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],s=i.i1,n=i.i3,o=this.m_ps[s].Clone(),r=this.m_ps[n].Clone(),a=r.Clone().SelfSub(o),l=a.Normalize(),h=i.invMass1+i.invMass3;if(0!==h){var _=i.invMass1/h,u=i.invMass3/h;o.x-=t*_*(i.L1+i.L2-l)*a.x,o.y-=t*_*(i.L1+i.L2-l)*a.y,r.x+=t*u*(i.L1+i.L2-l)*a.x,r.y+=t*u*(i.L1+i.L2-l)*a.y,this.m_ps[s].Copy(o),this.m_ps[n].Copy(r)}}}},{key:"SolveBend_PBD_Height",value:function(){for(var t=this.m_tuning.bendStiffness,e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],s=this.m_ps[i.i1].Clone(),n=this.m_ps[i.i2].Clone(),o=this.m_ps[i.i3].Clone(),r=new F;r.x=i.alpha1*s.x+i.alpha2*o.x-n.x,r.y=i.alpha1*s.y+i.alpha2*o.y-n.y;var a=r.Length();if(0!==a){var l=r.Clone().SelfMul(1/a),h=l.Clone().SelfMul(i.alpha1),_=l.Clone().SelfNeg(),u=l.Clone().SelfMul(i.alpha2),m=i.invMass1*i.alpha1*i.alpha1+i.invMass2+i.invMass3*i.alpha2*i.alpha2;if(0!==m){var c=-t*(1/m)*a;s.x+=i.invMass1*c*h.x,s.y+=i.invMass1*c*h.y,n.x+=i.invMass2*c*_.x,n.y+=i.invMass2*c*_.y,o.x+=i.invMass3*c*u.x,o.y+=i.invMass3*c*u.y,this.m_ps[i.i1].Copy(s),this.m_ps[i.i2].Copy(n),this.m_ps[i.i3].Copy(o)}}}}},{key:"SolveBend_PBD_Triangle",value:function(){for(var t=this.m_tuning.bendStiffness,e=0;e<this.m_bendCount;++e){var i=this.m_bendConstraints[e],s=this.m_ps[i.i1].Clone(),n=this.m_ps[i.i2].Clone(),o=this.m_ps[i.i3].Clone(),r=i.invMass1,a=i.invMass2,l=i.invMass3,h=t/(r+l+2*a),_=new F;_.x=n.x-1/3*(s.x+n.x+o.x),_.y=n.y-1/3*(s.y+n.y+o.y);var u=new F;u.x=2*r*h*_.x,u.y=2*r*h*_.y;var m=new F;m.x=-4*a*h*_.x,m.y=-4*a*h*_.y;var c=new F;c.x=2*l*h*_.x,c.y=2*l*h*_.y,s.SelfAdd(u),n.SelfAdd(m),o.SelfAdd(c),this.m_ps[i.i1].Copy(s),this.m_ps[i.i2].Copy(n),this.m_ps[i.i3].Copy(o)}}},{key:"ApplyBendForces",value:function(t){for(var e=2*a*this.m_tuning.bendHertz,i=0;i<this.m_bendCount;++i){var s=this.m_bendConstraints[i],n=this.m_ps[s.i1].Clone(),o=this.m_ps[s.i2].Clone(),r=this.m_ps[s.i3].Clone(),l=this.m_vs[s.i1],h=this.m_vs[s.i2],_=this.m_vs[s.i3],u=n.Clone().SelfSub(n),m=r.Clone().SelfSub(o),c=void 0,y=void 0;if(this.m_tuning.isometric?(c=s.L1*s.L1,y=s.L2*s.L2):(c=u.LengthSquared(),y=m.LengthSquared()),c*y!=0){var d=F.CrossVV(u,m),p=F.DotVV(u,m),f=L(d,p),v=(new F).Copy(u).SelfSkew().SelfMul(-1/c),b=(new F).Copy(m).SelfSkew().SelfMul(1/y),C=v.Clone().SelfNeg(),x=v.Clone().SelfSub(b),A=b,S=0;if(0!==(S=this.m_tuning.fixedEffectiveMass?s.invEffectiveMass:s.invMass1*F.DotVV(C,C)+s.invMass2*F.DotVV(x,x)+s.invMass3*F.DotVV(A,A))){var g=1/S,w=-t*(g*e*e*f+2*g*this.m_tuning.bendDamping*e*(F.DotVV(C,l)+F.DotVV(x,h)+F.DotVV(A,_)));this.m_vs[s.i1].x+=s.invMass1*w*C.x,this.m_vs[s.i1].y+=s.invMass1*w*C.y,this.m_vs[s.i2].x+=s.invMass2*w*x.x,this.m_vs[s.i2].y+=s.invMass2*w*x.y,this.m_vs[s.i3].x+=s.invMass3*w*A.x,this.m_vs[s.i3].y+=s.invMass3*w*A.y}}}}}]),b2Rope}(),Cs=t.b2BodyType.b2_staticBody,xs=t.b2BodyType.b2_kinematicBody,As=t.b2BodyType.b2_dynamicBody,Ss=t.b2BendingModel.b2_springAngleBendingModel,gs=t.b2BendingModel.b2_pbdAngleBendingModel,ws=t.b2BendingModel.b2_xpbdAngleBendingModel,Vs=t.b2BendingModel.b2_pbdDistanceBendingModel,Bs=t.b2BendingModel.b2_pbdHeightBendingModel,Ms=t.b2BendingModel.b2_pbdTriangleBendingModel,ks=t.b2StretchingModel.b2_pbdStretchingModel,Is=t.b2StretchingModel.b2_xpbdStretchingModel;return t.b2AABB=It,t.b2Abs=k,t.b2Acos=R,t.b2Alloc=function(t){return null},t.b2AngularStiffness=function(t,e,i,s,n){var o,r=s.GetInertia(),l=n.GetInertia();o=r>0&&l>0?r*l/(r+l):r>0?r:l;var h=2*a*e;t.stiffness=o*h*h,t.damping=2*o*i*h},t.b2AreaJoint=mi,t.b2AreaJointDef=ui,t.b2Asin=J,t.b2Assert=function(t){if(!t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];throw _construct(Error,i)}},t.b2Atan2=L,t.b2BlockAllocator=function b2BlockAllocator(){_classCallCheck(this,b2BlockAllocator)},t.b2Body=vi,t.b2BodyDef=function b2BodyDef(){_classCallCheck(this,b2BodyDef),this.type=t.b2BodyType.b2_staticBody,this.position=new F(0,0),this.angle=0,this.linearVelocity=new F(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.enabled=!0,this.userData=null,this.gravityScale=1},t.b2BroadPhase=Lt,t.b2ChainAndCircleContact=xi,t.b2ChainAndPolygonContact=Ai,t.b2ChainShape=Ot,t.b2CircleContact=Si,t.b2CircleShape=jt,t.b2Clamp=b2Clamp,t.b2ClipSegmentToLine=b2ClipSegmentToLine,t.b2ClipVertex=Bt,t.b2CollideCircles=b2CollideCircles,t.b2CollideEdgeAndCircle=b2CollideEdgeAndCircle,t.b2CollideEdgeAndPolygon=b2CollideEdgeAndPolygon,t.b2CollidePolygonAndCircle=b2CollidePolygonAndCircle,t.b2CollidePolygons=b2CollidePolygons,t.b2Color=i,t.b2Contact=Ci,t.b2ContactEdge=bi,t.b2ContactFactory=ki,t.b2ContactFeature=xt,t.b2ContactFilter=Di,t.b2ContactID=At,t.b2ContactImpulse=Pi,t.b2ContactListener=Ti,t.b2ContactManager=Ji,t.b2ContactPositionConstraint=Xi,t.b2ContactRegister=Mi,t.b2ContactSolver=Zi,t.b2ContactSolverDef=Wi,t.b2ContactVelocityConstraint=zi,t.b2Cos=T,t.b2Counter=U,t.b2DegToRad=function(t){return t*V},t.b2DestructionListener=Ii,t.b2Distance=b2Distance,t.b2DistanceInput=$,t.b2DistanceJoint=_i,t.b2DistanceJointDef=hi,t.b2DistanceOutput=tt,t.b2DistanceProxy=K,t.b2Draw=s,t.b2DynamicTree=Rt,t.b2EdgeAndCircleContact=Vi,t.b2EdgeAndPolygonContact=Bi,t.b2EdgeShape=Ft,t.b2Filter=ci,t.b2Fixture=fi,t.b2FixtureDef=yi,t.b2FixtureProxy=di,t.b2Free=function(t){},t.b2FrictionJoint=Yi,t.b2FrictionJointDef=Ui,t.b2GearJoint=Ki,t.b2GearJointDef=Qi,t.b2GetPointStates=function(e,i,s,n){var o;for(o=0;o<s.pointCount;++o){var r=s.points[o].id.key;e[o]=t.b2PointState.b2_removeState;for(var a=0,l=n.pointCount;a<l;++a)if(n.points[a].id.key===r){e[o]=t.b2PointState.b2_persistState;break}}for(;o<_;++o)e[o]=t.b2PointState.b2_nullState;for(o=0;o<n.pointCount;++o){var h=n.points[o].id.key;i[o]=t.b2PointState.b2_addState;for(var u=0,m=s.pointCount;u<m;++u)if(s.points[u].id.key===h){i[o]=t.b2PointState.b2_persistState;break}}for(;o<_;++o)i[o]=t.b2PointState.b2_nullState},t.b2GrowableStack=w,t.b2InvSqrt=function(t){return 1/Math.sqrt(t)},t.b2IsPowerOfTwo=function(t){return t>0&&0==(t&t-1)},t.b2IsValid=I,t.b2Island=Hi,t.b2Jacobian=oi,t.b2Joint=li,t.b2JointDef=ai,t.b2JointEdge=ri,t.b2LinearStiffness=function(t,e,i,s,n){var o,r=s.GetMass(),l=n.GetMass();o=r>0&&l>0?r*l/(r+l):r>0?r:l;var h=2*a*e;t.stiffness=o*h*h,t.damping=2*o*i*h},t.b2Log=function(t){},t.b2MakeArray=b2MakeArray,t.b2MakeNullArray=function(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=null;return e},t.b2MakeNumberArray=b2MakeNumberArray,t.b2Manifold=wt,t.b2ManifoldPoint=St,t.b2MassData=Y,t.b2Mat22=E,t.b2Mat33=q,t.b2Max=b2Max,t.b2Maybe=b2Maybe,t.b2Min=b2Min,t.b2MixFriction=b2MixFriction,t.b2MixRestitution=b2MixRestitution,t.b2MixRestitutionThreshold=b2MixRestitutionThreshold,t.b2MotorJoint=ts,t.b2MotorJointDef=$i,t.b2MouseJoint=is,t.b2MouseJointDef=es,t.b2NextPowerOfTwo=function(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,1+(t|=t>>16&65535)},t.b2Pair=Jt,t.b2ParseInt=function(t){return parseInt(t,10)},t.b2ParseUInt=function(t){return Math.abs(parseInt(t,10))},t.b2PolygonAndCircleContact=wi,t.b2PolygonContact=gi,t.b2PolygonShape=Je,t.b2Position=Oi,t.b2PositionSolverManifold=Ni,t.b2Pow=P,t.b2PrismaticJoint=ns,t.b2PrismaticJointDef=ss,t.b2Profile=Li,t.b2PulleyJoint=rs,t.b2PulleyJointDef=os,t.b2QueryCallback=Gi,t.b2RadToDeg=function(t){return t*B},t.b2Random=function(){return 2*Math.random()-1},t.b2RandomRange=function(t,e){return(e-t)*Math.random()+t},t.b2RayCastCallback=Ri,t.b2RayCastInput=Mt,t.b2RayCastOutput=kt,t.b2RevoluteJoint=ls,t.b2RevoluteJointDef=as,t.b2Rope=bs,t.b2RopeDef=function b2RopeDef(){_classCallCheck(this,b2RopeDef),this.position=new F,this.vertices=[],this.count=0,this.masses=[],this.gravity=new F,this.tuning=new ps},t.b2RopeTuning=ps,t.b2Rot=z,t.b2SeparationFunction=Ye,t.b2Shape=Q,t.b2ShapeCast=function(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,s=e.proxyB,n=b2Max(i.m_radius,y)+b2Max(s.m_radius,y),o=e.transformA,r=e.transformB,a=e.translationB,l=mt.Set(0,0),h=0,_=ct;_.m_count=0;for(var u=_.m_vertices,c=i.GetSupport(z.MulTRV(o.q,F.NegV(a,F.s_t1),F.s_t0)),d=X.MulXV(o,i.GetVertex(c),yt),p=s.GetSupport(z.MulTRV(r.q,a,F.s_t0)),f=X.MulXV(r,s.GetVertex(p),dt),v=F.SubVV(d,f,pt),b=b2Max(y,n-y),C=.5*m,x=0;x<20&&v.Length()-b>C;){t.iterations+=1,c=i.GetSupport(z.MulTRV(o.q,F.NegV(v,F.s_t1),F.s_t0)),d=X.MulXV(o,i.GetVertex(c),yt),p=s.GetSupport(z.MulTRV(r.q,v,F.s_t0)),f=X.MulXV(r,s.GetVertex(p),dt);var A=F.SubVV(d,f,ft);v.Normalize();var S=F.DotVV(v,A),g=F.DotVV(v,a);if(S-b>h*g){if(g<=0)return!1;if((h=(S-b)/g)>1)return!1;l.Copy(v).SelfNeg(),_.m_count=0}var w=u[_.m_count];switch(w.indexA=p,w.wA.Copy(f).SelfMulAdd(h,a),w.indexB=c,w.wB.Copy(d),w.w.Copy(w.wB).SelfSub(w.wA),w.a=1,_.m_count+=1,_.m_count){case 1:break;case 2:_.Solve2();break;case 3:_.Solve3()}if(3===_.m_count)return!1;_.GetClosestPoint(v),++x}if(0===x)return!1;var V=vt,B=bt;return _.GetWitnessPoints(V,B),v.LengthSquared()>0&&(l.Copy(v).SelfNeg(),l.Normalize()),t.normal.Copy(l),t.lambda=h,t.iterations=x,!0},t.b2ShapeCastInput=function b2ShapeCastInput(){_classCallCheck(this,b2ShapeCastInput),this.proxyA=new K,this.proxyB=new K,this.transformA=new X,this.transformB=new X,this.translationB=new F},t.b2ShapeCastOutput=function b2ShapeCastOutput(){_classCallCheck(this,b2ShapeCastOutput),this.point=new F,this.normal=new F,this.lambda=0,this.iterations=0},t.b2Simplex=it,t.b2SimplexCache=H,t.b2SimplexVertex=et,t.b2Sin=G,t.b2SolverData=Ei,t.b2Sq=b2Sq,t.b2Sqrt=D,t.b2StackAllocator=function b2StackAllocator(){_classCallCheck(this,b2StackAllocator)},t.b2Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},t.b2Sweep=N,t.b2TOIInput=We,t.b2TOIOutput=Ze,t.b2TestOverlapAABB=b2TestOverlapAABB,t.b2TestOverlapShape=b2TestOverlapShape,t.b2TimeOfImpact=b2TimeOfImpact,t.b2TimeStep=Fi,t.b2Timer=Z,t.b2Transform=X,t.b2TreeNode=Gt,t.b2Vec2=F,t.b2Vec2_zero=O,t.b2Vec3=j,t.b2Velocity=ji,t.b2VelocityConstraintPoint=qi,t.b2Version=S,t.b2WeldJoint=_s,t.b2WeldJointDef=hs,t.b2WheelJoint=ms,t.b2WheelJointDef=us,t.b2World=ds,t.b2WorldManifold=Vt,t.b2_180_over_pi=B,t.b2_aabbExtension=u,t.b2_aabbMultiplier=4,t.b2_angularSleepTolerance=A,t.b2_angularSlop=c,t.b2_baumgarte=.2,t.b2_branch="master",t.b2_commit="9ebbbcd960ad424e03e5de6e66a40764c16f51bc",t.b2_epsilon=o,t.b2_epsilon_sq=r,t.b2_gjk_reset=function(){t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0},t.b2_lengthUnitsPerMeter=l,t.b2_linearSleepTolerance=x,t.b2_linearSlop=m,t.b2_maxAngularCorrection=p,t.b2_maxFloat=n,t.b2_maxLinearCorrection=d,t.b2_maxManifoldPoints=_,t.b2_maxPolygonVertices=h,t.b2_maxRotation=b,t.b2_maxRotationSquared=C,t.b2_maxSubSteps=8,t.b2_maxTOIContacts=32,t.b2_maxTranslation=f,t.b2_maxTranslationSquared=v,t.b2_minPulleyLength=2,t.b2_pi=a,t.b2_pi_over_180=V,t.b2_polygonRadius=y,t.b2_timeToSleep=.5,t.b2_toiBaumgarte=.75,t.b2_toi_reset=function(){t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0},t.b2_two_pi=M,t.b2_version=g,t.dynamicBody=As,t.get_g_blockSolve=function(){return t.g_blockSolve},t.kinematicBody=xs,t.pbdAngleBendingModel=gs,t.pbdDistanceBendingModel=Vs,t.pbdHeightBendingModel=Bs,t.pbdStretchingModel=ks,t.pbdTriangleBendingModel=Ms,t.set_g_blockSolve=function(e){t.g_blockSolve=e},t.springAngleBendingModel=Ss,t.staticBody=Cs,t.xpbdAngleBendingModel=ws,t.xpbdStretchingModel=Is,Object.defineProperty(t,"__esModule",{value:!0}),t}({});!function(t,e){var i=function IPhysics(){_classCallCheck(this,IPhysics)};i.RigidBody=null,i.Physics=null;var s=function(t){function ColliderBase(){var t;return _classCallCheck(this,ColliderBase),(t=_possibleConstructorReturn(this,_getPrototypeOf(ColliderBase).apply(this,arguments)))._isSensor=!1,t._density=10,t._friction=.2,t._restitution=0,t}return _inherits(ColliderBase,e.Component),_createClass(ColliderBase,[{key:"getDef",value:function(){if(!this._def){var t=new window.box2d.b2FixtureDef;t.density=this.density,t.friction=this.friction,t.isSensor=this.isSensor,t.restitution=this.restitution,t.shape=this._shape,this._def=t}return this._def}},{key:"_onEnable",value:function(){this.rigidBody?this.refresh():e.Laya.systemTimer.callLater(this,this._checkRigidBody)}},{key:"_checkRigidBody",value:function(){if(!this.rigidBody){var t=this.owner.getComponent(i.RigidBody);t&&(this.rigidBody=t,this.refresh())}}},{key:"_onDestroy",value:function(){this.rigidBody&&(this.fixture&&(this.fixture.GetBody()==this.rigidBody._getOriBody()&&this.rigidBody.body.DestroyFixture(this.fixture),this.fixture=null),this.rigidBody=null,this._shape=null,this._def=null)}},{key:"refresh",value:function(){if(this.enabled&&this.rigidBody){var t=this.rigidBody.body;this.fixture&&(this.fixture.GetBody()==this.rigidBody.body&&this.rigidBody.body.DestroyFixture(this.fixture),this.fixture.Destroy(),this.fixture=null);var e=this.getDef();e.filter.groupIndex=this.rigidBody.group,e.filter.categoryBits=this.rigidBody.category,e.filter.maskBits=this.rigidBody.mask,this.fixture=t.CreateFixture(e),this.fixture.collider=this}}},{key:"resetShape",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}},{key:"isSensor",get:function(){return this._isSensor},set:function(t){this._isSensor=t,this._def&&(this._def.isSensor=t,this.refresh())}},{key:"density",get:function(){return this._density},set:function(t){this._density=t,this._def&&(this._def.density=t,this.refresh())}},{key:"friction",get:function(){return this._friction},set:function(t){this._friction=t,this._def&&(this._def.friction=t,this.refresh())}},{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t,this._def&&(this._def.restitution=t,this.refresh())}},{key:"isSingleton",get:function(){return!1}}]),ColliderBase}();e.ClassUtils.regClass("laya.physics.ColliderBase",s),e.ClassUtils.regClass("Laya.ColliderBase",s);var n=function(t){function RigidBody(){var t;return _classCallCheck(this,RigidBody),(t=_possibleConstructorReturn(this,_getPrototypeOf(RigidBody).apply(this,arguments)))._type="dynamic",t._allowSleep=!0,t._angularVelocity=0,t._angularDamping=0,t._linearVelocity={x:0,y:0},t._linearDamping=0,t._bullet=!1,t._allowRotation=!0,t._gravityScale=1,t.group=0,t.category=1,t.mask=-1,t.label="RigidBody",t}return _inherits(RigidBody,e.Component),_createClass(RigidBody,[{key:"_createBody",value:function(){if(!this._body&&this.owner){var t=this.owner,s=window.box2d,n=new s.b2BodyDef,o=t.localToGlobal(e.Point.TEMP.setTo(0,0),!1,i.Physics.I.worldRoot);n.position.Set(o.x/i.Physics.PIXEL_RATIO,o.y/i.Physics.PIXEL_RATIO),n.angle=e.Utils.toRadian(t.rotation),n.allowSleep=this._allowSleep,n.angularDamping=this._angularDamping,n.angularVelocity=this._angularVelocity,n.bullet=this._bullet,n.fixedRotation=!this._allowRotation,n.gravityScale=this._gravityScale,n.linearDamping=this._linearDamping;var r=this._linearVelocity;(r&&0!=r.x||0!=r.y)&&(n.linearVelocity=new s.b2Vec2(r.x,r.y)),n.type=s.b2BodyType["b2_"+this._type+"Body"],this._body=i.Physics.I._createBody(n),this.resetCollider(!1)}}},{key:"_onAwake",value:function(){this._createBody()}},{key:"_onEnable",value:function(){var t=this;this._createBody(),e.Laya.physicsTimer.frameLoop(1,this,this._sysPhysicToNode);var i=this.owner;if(this.accessGetSetFunc(i,"x","set")&&!i._changeByRigidBody){i._changeByRigidBody=!0,this._overSet(i,"x",function(e){t.accessGetSetFunc(i,"x","set")(e),t._sysPosToPhysic()}),this._overSet(i,"y",function(e){t.accessGetSetFunc(i,"y","set")(e),t._sysPosToPhysic()}),this._overSet(i,"rotation",function(e){t.accessGetSetFunc(i,"rotation","set")(e),t._sysNodeToPhysic()}),this._overSet(i,"scaleX",function(e){t.accessGetSetFunc(i,"scaleX","set")(e),t.resetCollider(!0)}),this._overSet(i,"scaleY",function(e){t.accessGetSetFunc(i,"scaleY","set")(e),t.resetCollider(!0)})}}},{key:"accessGetSetFunc",value:function(t,e,i){if(-1!==["get","set"].indexOf(i)){var s="_$".concat(i,"_").concat(e);if(t[s])return t[s];for(var n,o=t.constructor;o;){if((n=Object.getOwnPropertyDescriptor(o.prototype,e))&&n[i]){t[s]=n[i].bind(t);break}o=Object.getPrototypeOf(o)}return t[s]}}},{key:"resetCollider",value:function(t){var e=this.owner.getComponents(s);if(e)for(var i=0,n=e.length;i<n;i++){var o=e[i];o.rigidBody=this,t?o.resetShape():o.refresh()}}},{key:"_sysPhysicToNode",value:function(){if("static"!=this.type&&this._body.IsAwake()){var t=this._body.GetPosition(),s=this._body.GetAngle(),n=this.owner;this.accessGetSetFunc(n,"rotation","set")(e.Utils.toAngle(s)-n.parent.globalRotation);var o=n.globalToLocal(e.Point.TEMP.setTo(t.x*i.Physics.PIXEL_RATIO,t.y*i.Physics.PIXEL_RATIO),!1,i.Physics.I.worldRoot);o.x+=n.pivotX,o.y+=n.pivotY,o=n.toParentPoint(o),this.accessGetSetFunc(n,"x","set")(o.x),this.accessGetSetFunc(n,"y","set")(o.y)}}},{key:"_sysNodeToPhysic",value:function(){var t=this.owner;this._body.SetAngle(e.Utils.toRadian(t.rotation));var s=t.localToGlobal(e.Point.TEMP.setTo(0,0),!1,i.Physics.I.worldRoot);this._body.SetPositionXY(s.x/i.Physics.PIXEL_RATIO,s.y/i.Physics.PIXEL_RATIO)}},{key:"_sysPosToPhysic",value:function(){var t=this.owner.localToGlobal(e.Point.TEMP.setTo(0,0),!1,i.Physics.I.worldRoot);this._body.SetPositionXY(t.x/i.Physics.PIXEL_RATIO,t.y/i.Physics.PIXEL_RATIO)}},{key:"_overSet",value:function(t,e,i){Object.defineProperty(t,e,{get:this.accessGetSetFunc(t,e,"get"),set:i,enumerable:!1,configurable:!0})}},{key:"_onDisable",value:function(){e.Laya.physicsTimer.clear(this,this._sysPhysicToNode),this._body&&i.Physics.I._removeBody(this._body),this._body=null;var t=this.owner;t._changeByRigidBody&&(this._overSet(t,"x",this.accessGetSetFunc(t,"x","set")),this._overSet(t,"y",this.accessGetSetFunc(t,"y","set")),this._overSet(t,"rotation",this.accessGetSetFunc(t,"rotation","set")),this._overSet(t,"scaleX",this.accessGetSetFunc(t,"scaleX","set")),this._overSet(t,"scaleY",this.accessGetSetFunc(t,"scaleY","set")),t._changeByRigidBody=!1)}},{key:"getBody",value:function(){return this._body||this._onAwake(),this._body}},{key:"_getOriBody",value:function(){return this._body}},{key:"applyForce",value:function(t,e){this._body||this._onAwake(),this._body.ApplyForce(e,t)}},{key:"applyForceToCenter",value:function(t){this._body||this._onAwake(),this._body.ApplyForceToCenter(t)}},{key:"applyLinearImpulse",value:function(t,e){this._body||this._onAwake(),this._body.ApplyLinearImpulse(e,t)}},{key:"applyLinearImpulseToCenter",value:function(t){this._body||this._onAwake(),this._body.ApplyLinearImpulseToCenter(t)}},{key:"applyTorque",value:function(t){this._body||this._onAwake(),this._body.ApplyTorque(t)}},{key:"setVelocity",value:function(t){this._body||this._onAwake(),this._body.SetLinearVelocity(t)}},{key:"setAngle",value:function(t){this._body||this._onAwake(),this._body.SetAngle(t),this._body.SetAwake(!0)}},{key:"getMass",value:function(){return this._body?this._body.GetMass():0}},{key:"getCenter",value:function(){this._body||this._onAwake();var t=this._body.GetLocalCenter();return t.x=t.x*i.Physics.PIXEL_RATIO,t.y=t.y*i.Physics.PIXEL_RATIO,t}},{key:"getWorldCenter",value:function(){this._body||this._onAwake();var t=this._body.GetWorldCenter();return t.x=t.x*i.Physics.PIXEL_RATIO,t.y=t.y*i.Physics.PIXEL_RATIO,t}},{key:"body",get:function(){return this._body||this._onAwake(),this._body}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._body&&this._body.SetType(window.box2d.b2BodyType["b2_"+this._type+"Body"])}},{key:"gravityScale",get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._body&&this._body.SetGravityScale(t)}},{key:"allowRotation",get:function(){return this._allowRotation},set:function(t){this._allowRotation=t,this._body&&this._body.SetFixedRotation(!t)}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this._body&&this._body.SetSleepingAllowed(t)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&this._body.SetAngularDamping(t)}},{key:"angularVelocity",get:function(){return this._body?this._body.GetAngularVelocity():this._angularVelocity},set:function(t){this._angularVelocity=t,this._body&&this._body.SetAngularVelocity(t)}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&this._body.SetLinearDamping(t)}},{key:"linearVelocity",get:function(){if(this._body){var t=this._body.GetLinearVelocity();return{x:t.x,y:t.y}}return this._linearVelocity},set:function(t){t&&(t instanceof Array&&(t={x:t[0],y:t[1]}),this._linearVelocity=t,this._body&&this._body.SetLinearVelocity(new window.box2d.b2Vec2(t.x,t.y)))}},{key:"bullet",get:function(){return this._bullet},set:function(t){this._bullet=t,this._body&&this._body.SetBullet(t)}}]),RigidBody}();e.ClassUtils.regClass("laya.physics.RigidBody",n),e.ClassUtils.regClass("Laya.RigidBody",n);var o=function(){function DestructionListener(){_classCallCheck(this,DestructionListener)}return _createClass(DestructionListener,[{key:"SayGoodbyeJoint",value:function(t){t.m_userData&&(t.m_userData.isDestroy=!0)}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t){}}]),DestructionListener}(),r=function(t){function Physics(){var t;return _classCallCheck(this,Physics),(t=_possibleConstructorReturn(this,_getPrototypeOf(Physics).call(this))).box2d=window.box2d,t.velocityIterations=8,t.positionIterations=3,t._eventList=[],t}return _inherits(Physics,e.EventDispatcher),_createClass(Physics,[{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._enabled){this._enabled=!0,t||(t={});var i=window.box2d;if(null==i)return void console.error("Can not find box2d libs, you should request box2d.js first.");var s=new i.b2Vec2(0,t.gravity||500/Physics.PIXEL_RATIO);this.world=new i.b2World(s),this.world.SetDestructionListener(new o),this.world.SetContactListener(new a),this.allowSleeping=null==t.allowSleeping||t.allowSleeping,t.customUpdate||e.Laya.physicsTimer.frameLoop(1,this,this._update),this._emptyBody=this._createBody(new window.box2d.b2BodyDef)}}},{key:"_update",value:function(){var t=e.Laya.timer.delta/1e3;t>.033&&(t=.033),this.world.Step(t,this.velocityIterations,this.positionIterations,3);var i=this._eventList.length;if(i>0){for(var s=0;s<i;s+=2)this._sendEvent(this._eventList[s],this._eventList[s+1]);this._eventList.length=0}}},{key:"_sendEvent",value:function(t,i){var s=i.GetFixtureA().collider,n=i.GetFixtureB().collider,o=s.owner,r=n.owner;if(i.getHitInfo=function(){var t=new this.box2d.b2WorldManifold;this.GetWorldManifold(t);var e=t.points[0];return e.x*=Physics.PIXEL_RATIO,e.y*=Physics.PIXEL_RATIO,t},o){var a=[n,s,i];0===t?(o.event(e.Event.TRIGGER_ENTER,a),o._triggered?o.event(e.Event.TRIGGER_STAY,a):o._triggered=!0):(o._triggered=!1,o.event(e.Event.TRIGGER_EXIT,a))}r&&(a=[s,n,i],0===t?(r.event(e.Event.TRIGGER_ENTER,a),r._triggered?r.event(e.Event.TRIGGER_STAY,a):r._triggered=!0):(r._triggered=!1,r.event(e.Event.TRIGGER_EXIT,a)))}},{key:"_createBody",value:function(t){return this.world?this.world.CreateBody(t):(console.error('The physical engine should be initialized first.use "Physics.enable()"'),null)}},{key:"_removeBody",value:function(t){this.world?this.world.DestroyBody(t):console.error('The physical engine should be initialized first.use "Physics.enable()"')}},{key:"_createJoint",value:function(t){if(this.world){var e=this.world.CreateJoint(t);return e.m_userData={},e.m_userData.isDestroy=!1,e}return console.error('The physical engine should be initialized first.use "Physics.enable()"'),null}},{key:"_removeJoint",value:function(t){this.world?this.world.DestroyJoint(t):console.error('The physical engine should be initialized first.use "Physics.enable()"')}},{key:"stop",value:function(){e.Laya.physicsTimer.clear(this,this._update)}},{key:"getBodyCount",value:function(){return this.world.GetBodyCount()}},{key:"getContactCount",value:function(){return this.world.GetContactCount()}},{key:"getJointCount",value:function(){return this.world.GetJointCount()}},{key:"updatePhysicsByWorldRoot",value:function(){if(this.worldRoot){var t=this.worldRoot.localToGlobal(e.Point.TEMP.setTo(0,0));this.world.ShiftOrigin({x:-t.x/Physics.PIXEL_RATIO,y:-t.y/Physics.PIXEL_RATIO})}}},{key:"allowSleeping",get:function(){return this.world.GetAllowSleeping()},set:function(t){this.world.SetAllowSleeping(t)}},{key:"gravity",get:function(){return this.world.GetGravity()},set:function(t){this.world.SetGravity(t)}},{key:"worldRoot",get:function(){return this._worldRoot||e.Laya.stage},set:function(t){if(this._worldRoot=t,t){var i=t.localToGlobal(e.Point.TEMP.setTo(0,0));this.world.ShiftOrigin({x:-i.x/Physics.PIXEL_RATIO,y:-i.y/Physics.PIXEL_RATIO})}}}],[{key:"enable",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Physics.I.start(t),i.RigidBody=n,i.Physics=this}},{key:"I",get:function(){return Physics._I||(Physics._I=new Physics)}}]),Physics}();r.PIXEL_RATIO=50,e.ClassUtils.regClass("laya.physics.Physics",r),e.ClassUtils.regClass("Laya.Physics",r);var a=function(){function ContactListener(){_classCallCheck(this,ContactListener)}return _createClass(ContactListener,[{key:"BeginContact",value:function(t){r.I._eventList.push(0,t)}},{key:"EndContact",value:function(t){r.I._eventList.push(1,t)}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),ContactListener}(),l=function(t){function BoxCollider(){var t;return _classCallCheck(this,BoxCollider),(t=_possibleConstructorReturn(this,_getPrototypeOf(BoxCollider).apply(this,arguments)))._x=0,t._y=0,t._width=100,t._height=100,t}return _inherits(BoxCollider,s),_createClass(BoxCollider,[{key:"getDef",value:function(){return this._shape||(this._shape=new window.box2d.b2PolygonShape,this._setShape(!1)),this.label=this.label||"BoxCollider",_get(_getPrototypeOf(BoxCollider.prototype),"getDef",this).call(this)}},{key:"_setShape",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.owner.scaleX||1,i=this.owner.scaleY||1;this._shape.SetAsBox(this._width/2/r.PIXEL_RATIO*e,this._height/2/r.PIXEL_RATIO*i,new window.box2d.b2Vec2((this._width/2+this._x)/r.PIXEL_RATIO*e,(this._height/2+this._y)/r.PIXEL_RATIO*i)),t&&this.refresh()}},{key:"resetShape",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._setShape()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._shape&&this._setShape()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._shape&&this._setShape()}},{key:"width",get:function(){return this._width},set:function(t){if(t<=0)throw"BoxCollider size cannot be less than 0";this._width=t,this._shape&&this._setShape()}},{key:"height",get:function(){return this._height},set:function(t){if(t<=0)throw"BoxCollider size cannot be less than 0";this._height=t,this._shape&&this._setShape()}}]),BoxCollider}();e.ClassUtils.regClass("laya.physics.BoxCollider",l),e.ClassUtils.regClass("Laya.BoxCollider",l);var h=function(t){function ChainCollider(){var t;return _classCallCheck(this,ChainCollider),(t=_possibleConstructorReturn(this,_getPrototypeOf(ChainCollider).apply(this,arguments)))._x=0,t._y=0,t._points="0,0,100,0",t._loop=!1,t}return _inherits(ChainCollider,s),_createClass(ChainCollider,[{key:"getDef",value:function(){return this._shape||(this._shape=new window.box2d.b2ChainShape,this._setShape(!1)),this.label=this.label||"ChainCollider",_get(_getPrototypeOf(ChainCollider.prototype),"getDef",this).call(this)}},{key:"_setShape",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this._points.split(","),i=e.length;if(i%2==1)throw"ChainCollider points lenth must a multiplier of 2";for(var s=[],n=0,o=i;n<o;n+=2)s.push(new window.box2d.b2Vec2((this._x+parseInt(e[n]))/r.PIXEL_RATIO,(this._y+parseInt(e[n+1]))/r.PIXEL_RATIO));this._loop?this._shape.CreateLoop(s,i/2):this._shape.CreateChain(s,i/2,new window.box2d.b2Vec2(0,0),new window.box2d.b2Vec2(0,0)),t&&this.refresh()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._shape&&this._setShape()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._shape&&this._setShape()}},{key:"points",get:function(){return this._points},set:function(t){if(!t)throw"ChainCollider points cannot be empty";this._points=t,this._shape&&this._setShape()}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._shape&&this._setShape()}}]),ChainCollider}();e.ClassUtils.regClass("laya.physics.ChainCollider",h),e.ClassUtils.regClass("Laya.ChainCollider",h);var _=function(t){function CircleCollider(){var t;return _classCallCheck(this,CircleCollider),(t=_possibleConstructorReturn(this,_getPrototypeOf(CircleCollider).apply(this,arguments)))._x=0,t._y=0,t._radius=50,t}return _inherits(CircleCollider,s),_createClass(CircleCollider,[{key:"getDef",value:function(){return this._shape||(this._shape=new window.box2d.b2CircleShape,this._setShape(!1)),this.label=this.label||"CircleCollider",_get(_getPrototypeOf(CircleCollider.prototype),"getDef",this).call(this)}},{key:"_setShape",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.owner.scaleX||1;this._shape.m_radius=this._radius/r.PIXEL_RATIO*e,this._shape.m_p.Set((this._radius+this._x)/r.PIXEL_RATIO*e,(this._radius+this._y)/r.PIXEL_RATIO*e),t&&this.refresh()}},{key:"resetShape",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._setShape()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._shape&&this._setShape()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._shape&&this._setShape()}},{key:"radius",get:function(){return this._radius},set:function(t){if(t<=0)throw"CircleCollider radius cannot be less than 0";this._radius=t,this._shape&&this._setShape()}}]),CircleCollider}();e.ClassUtils.regClass("laya.physics.CircleCollider",_),e.ClassUtils.regClass("Laya.CircleCollider",_);var u=function(t){function EdgeCollider(){var t;return _classCallCheck(this,EdgeCollider),(t=_possibleConstructorReturn(this,_getPrototypeOf(EdgeCollider).apply(this,arguments)))._x=0,t._y=0,t._points="0,0,100,0",t}return _inherits(EdgeCollider,s),_createClass(EdgeCollider,[{key:"getDef",value:function(){return this._shape||(this._shape=new window.box2d.b2EdgeShape,this._setShape(!1)),this.label=this.label||"EdgeCollider",_get(_getPrototypeOf(EdgeCollider.prototype),"getDef",this).call(this)}},{key:"_setShape",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this._points.split(","),i=e.length;if(i%2==1)throw"EdgeCollider points lenth must a multiplier of 2";for(var s=[],n=0,o=i;n<o;n+=2)s.push(new window.box2d.b2Vec2((this._x+parseInt(e[n]))/r.PIXEL_RATIO,(this._y+parseInt(e[n+1]))/r.PIXEL_RATIO));this._shape.SetTwoSided(s[0],s[1]),t&&this.refresh()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._shape&&this._setShape()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._shape&&this._setShape()}},{key:"points",get:function(){return this._points},set:function(t){if(!t)throw"EdgeCollider points cannot be empty";this._points=t,this._shape&&this._setShape()}}]),EdgeCollider}();e.ClassUtils.regClass("laya.physics.EdgeCollider",u),e.ClassUtils.regClass("Laya.EdgeCollider",u);var m=function(t){function PhysicsDebugDraw(){var t;return _classCallCheck(this,PhysicsDebugDraw),(t=_possibleConstructorReturn(this,_getPrototypeOf(PhysicsDebugDraw).call(this))).m_drawFlags=99,PhysicsDebugDraw._inited||(PhysicsDebugDraw._inited=!0,PhysicsDebugDraw.init()),t._camera={},t._camera.m_center=new PhysicsDebugDraw.box2d.b2Vec2(0,0),t._camera.m_extent=25,t._camera.m_zoom=1,t._camera.m_width=1280,t._camera.m_height=800,t._mG=new e.Graphics,t.graphics=t._mG,t._textSp=new e.Sprite,t._textG=t._textSp.graphics,t.addChild(t._textSp),t}return _inherits(PhysicsDebugDraw,e.Sprite),_createClass(PhysicsDebugDraw,[{key:"render",value:function(t,e,i){this._renderToGraphic(),_get(_getPrototypeOf(PhysicsDebugDraw.prototype),"render",this).call(this,t,e,i)}},{key:"_renderToGraphic",value:function(){this.world&&(this._textG.clear(),this._mG.clear(),this._mG.save(),this._mG.scale(r.PIXEL_RATIO,r.PIXEL_RATIO),this.lineWidth=1/r.PIXEL_RATIO,this.world.DebugDraw?this.world.DebugDraw():this.world.DrawDebugData(),this._mG.restore())}},{key:"SetFlags",value:function(t){this.m_drawFlags=t}},{key:"GetFlags",value:function(){return this.m_drawFlags}},{key:"AppendFlags",value:function(t){this.m_drawFlags|=t}},{key:"ClearFlags",value:function(t){this.m_drawFlags&=~t}},{key:"PushTransform",value:function(t){this._mG.save(),this._mG.translate(t.p.x,t.p.y),this._mG.rotate(t.q.GetAngle())}},{key:"PopTransform",value:function(t){this._mG.restore()}},{key:"DrawPolygon",value:function(t,e,i){var s,n;for(t.length,n=[],s=0;s<e;s++)n.push(t[s].x,t[s].y);this._mG.drawPoly(0,0,n,null,i.MakeStyleString(1),this.lineWidth)}},{key:"DrawSolidPolygon",value:function(t,e,i){var s,n;for(t.length,n=[],s=0;s<e;s++)n.push(t[s].x,t[s].y);this._mG.drawPoly(0,0,n,i.MakeStyleString(.5),i.MakeStyleString(1),this.lineWidth)}},{key:"DrawCircle",value:function(t,e,i){this._mG.drawCircle(t.x,t.y,e,null,i.MakeStyleString(1),this.lineWidth)}},{key:"DrawSolidCircle",value:function(t,e,i,s){var n=t.x,o=t.y;this._mG.drawCircle(n,o,e,s.MakeStyleString(.5),s.MakeStyleString(1),this.lineWidth),this._mG.drawLine(n,o,n+i.x*e,o+i.y*e,s.MakeStyleString(1),this.lineWidth)}},{key:"DrawParticles",value:function(t,e,i,s){if(null!==i)for(var n=0;n<s;++n){var o=t[n],r=i[n];this._mG.drawCircle(o.x,o.y,e,r.MakeStyleString(),null,this.lineWidth)}else for(n=0;n<s;++n)o=t[n],this._mG.drawCircle(o.x,o.y,e,"#ffff00",null,this.lineWidth)}},{key:"DrawSegment",value:function(t,e,i){this._mG.drawLine(t.x,t.y,e.x,e.y,i.MakeStyleString(1),this.lineWidth)}},{key:"DrawTransform",value:function(t){this.PushTransform(t),this._mG.drawLine(0,0,1,0,PhysicsDebugDraw.box2d.b2Color.RED.MakeStyleString(1),this.lineWidth),this._mG.drawLine(0,0,0,1,PhysicsDebugDraw.box2d.b2Color.GREEN.MakeStyleString(1),this.lineWidth),this.PopTransform(t)}},{key:"DrawPoint",value:function(t,e,i){e*=this._camera.m_zoom;var s=(e/=this._camera.m_extent)/2;this._mG.drawRect(t.x-s,t.y-s,e,e,i.MakeStyleString(),null)}},{key:"DrawString",value:function(t,e,i){this._textG.fillText(i,t,e,"15px DroidSans",PhysicsDebugDraw.DrawString_s_color.MakeStyleString(),"left")}},{key:"DrawStringWorld",value:function(t,e,i){this.DrawString(t,e,i)}},{key:"DrawAABB",value:function(t,e){var i=t.lowerBound.x,s=t.lowerBound.y,n=t.upperBound.x-t.lowerBound.x,o=t.upperBound.y-t.lowerBound.y;this._mG.drawRect(i,s,n,o,null,e.MakeStyleString(),this.lineWidth)}}],[{key:"init",value:function(){PhysicsDebugDraw.box2d=e.Browser.window.box2d,PhysicsDebugDraw.DrawString_s_color=new PhysicsDebugDraw.box2d.b2Color(.9,.6,.6),PhysicsDebugDraw.DrawStringWorld_s_p=new PhysicsDebugDraw.box2d.b2Vec2,PhysicsDebugDraw.DrawStringWorld_s_cc=new PhysicsDebugDraw.box2d.b2Vec2,PhysicsDebugDraw.DrawStringWorld_s_color=new PhysicsDebugDraw.box2d.b2Color(.5,.9,.5)}},{key:"enable",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:99;if(!PhysicsDebugDraw.I){var i=new PhysicsDebugDraw;i.world=r.I.world,i.world.SetDebugDraw(i),i.zOrder=1e3,i.m_drawFlags=t,e.Laya.stage.addChild(i),PhysicsDebugDraw.I=i}return i}}]),PhysicsDebugDraw}();m._inited=!1,e.ClassUtils.regClass("laya.physics.PhysicsDebugDraw",m),e.ClassUtils.regClass("Laya.PhysicsDebugDraw",m);var c=function(t){function PolygonCollider(){var t;return _classCallCheck(this,PolygonCollider),(t=_possibleConstructorReturn(this,_getPrototypeOf(PolygonCollider).apply(this,arguments)))._x=0,t._y=0,t._points="50,0,100,100,0,100",t}return _inherits(PolygonCollider,s),_createClass(PolygonCollider,[{key:"getDef",value:function(){return this._shape||(this._shape=new window.box2d.b2PolygonShape,this._setShape(!1)),this.label=this.label||"PolygonCollider",_get(_getPrototypeOf(PolygonCollider.prototype),"getDef",this).call(this)}},{key:"_setShape",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this._points.split(","),i=e.length;if(i<6)throw"PolygonCollider points must be greater than 3";if(i%2==1)throw"PolygonCollider points lenth must a multiplier of 2";for(var s=[],n=0,o=i;n<o;n+=2)s.push(new window.box2d.b2Vec2((this._x+parseInt(e[n]))/r.PIXEL_RATIO,(this._y+parseInt(e[n+1]))/r.PIXEL_RATIO));this._shape.Set(s,i/2),t&&this.refresh()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._shape&&this._setShape()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._shape&&this._setShape()}},{key:"points",get:function(){return this._points},set:function(t){if(!t)throw"PolygonCollider points cannot be empty";this._points=t,this._shape&&this._setShape()}}]),PolygonCollider}();e.ClassUtils.regClass("laya.physics.PolygonCollider",c),e.ClassUtils.regClass("Laya.PolygonCollider",c);var y=function(t){function JointBase(){return _classCallCheck(this,JointBase),_possibleConstructorReturn(this,_getPrototypeOf(JointBase).apply(this,arguments))}return _inherits(JointBase,e.Component),_createClass(JointBase,[{key:"_onEnable",value:function(){this._createJoint()}},{key:"_onAwake",value:function(){this._createJoint()}},{key:"_createJoint",value:function(){}},{key:"_onDisable",value:function(){this._joint&&this._joint.m_userData&&!this._joint.m_userData.isDestroy&&r.I._removeJoint(this._joint),this._joint=null}},{key:"joint",get:function(){return this._joint||this._createJoint(),this._joint}},{key:"isSingleton",get:function(){return!1}}]),JointBase}();e.ClassUtils.regClass("laya.physics.joint.JointBase",y),e.ClassUtils.regClass("Laya.JointBase",y);var d=function(t){function DistanceJoint(){var t;return _classCallCheck(this,DistanceJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(DistanceJoint).apply(this,arguments))).selfAnchor=[0,0],t.otherAnchor=[0,0],t.collideConnected=!1,t._length=0,t._maxLength=-1,t._minLength=-1,t._frequency=1,t._dampingRatio=0,t}return _inherits(DistanceJoint,y),_createClass(DistanceJoint,[{key:"_createJoint",value:function(){if(!this._joint){if(this.selfBody=this.selfBody||this.owner.getComponent(n),!this.selfBody)throw"selfBody can not be empty";var t=window.box2d,e=DistanceJoint._temp||(DistanceJoint._temp=new t.b2DistanceJointDef);e.bodyA=this.otherBody?this.otherBody.getBody():r.I._emptyBody,e.bodyB=this.selfBody.getBody(),e.localAnchorA.Set(this.otherAnchor[0]/r.PIXEL_RATIO,this.otherAnchor[1]/r.PIXEL_RATIO),e.localAnchorB.Set(this.selfAnchor[0]/r.PIXEL_RATIO,this.selfAnchor[1]/r.PIXEL_RATIO),t.b2LinearStiffness(e,this._frequency,this._dampingRatio,e.bodyA,e.bodyB),e.collideConnected=this.collideConnected;var i=e.bodyA.GetWorldPoint(e.localAnchorA,new t.b2Vec2),s=e.bodyB.GetWorldPoint(e.localAnchorB,new t.b2Vec2);e.length=this._length/r.PIXEL_RATIO||t.b2Vec2.SubVV(s,i,new t.b2Vec2).Length(),e.maxLength=t.b2_maxFloat,e.minLength=0,this._maxLength>=0&&(e.maxLength=this._maxLength/r.PIXEL_RATIO),this._minLength>=0&&(e.minLength=this._minLength/r.PIXEL_RATIO),this._joint=r.I._createJoint(e)}}},{key:"length",get:function(){return this._length},set:function(t){this._length=t,this._joint&&this._joint.SetLength(t/r.PIXEL_RATIO)}},{key:"minLength",get:function(){return this._minLength},set:function(t){this._minLength=t,this._joint&&this._joint.SetMinLength(t/r.PIXEL_RATIO)}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.SetMaxLength(t/r.PIXEL_RATIO)}},{key:"frequency",get:function(){return this._frequency},set:function(t){if(this._frequency=t,this._joint){var e={},i=window.box2d,s=this.otherBody?this.otherBody.getBody():r.I._emptyBody,n=this.selfBody.getBody();i.b2LinearStiffness(e,this._frequency,this._dampingRatio,s,n),this._joint.SetStiffness(e.stiffness),this._joint.SetDamping(e.damping)}}},{key:"damping",get:function(){return this._dampingRatio},set:function(t){if(this._dampingRatio=t,this._joint){var e={},i=window.box2d,s=this.otherBody?this.otherBody.getBody():r.I._emptyBody,n=this.selfBody.getBody();i.b2LinearStiffness(e,this._frequency,this._dampingRatio,s,n),this._joint.SetDamping(e.damping)}}}]),DistanceJoint}();e.ClassUtils.regClass("laya.physics.joint.DistanceJoint",d),e.ClassUtils.regClass("Laya.DistanceJoint",d);var p=function(t){function GearJoint(){var t;return _classCallCheck(this,GearJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(GearJoint).apply(this,arguments))).collideConnected=!1,t._ratio=1,t}return _inherits(GearJoint,y),_createClass(GearJoint,[{key:"_createJoint",value:function(){if(!this._joint){if(!this.joint1)throw"Joint1 can not be empty";if(!this.joint2)throw"Joint2 can not be empty";var t=window.box2d,e=GearJoint._temp||(GearJoint._temp=new t.b2GearJointDef);e.bodyA=this.joint1.owner.getComponent(n).getBody(),e.bodyB=this.joint2.owner.getComponent(n).getBody(),e.joint1=this.joint1.joint,e.joint2=this.joint2.joint,e.ratio=this._ratio,e.collideConnected=this.collideConnected,this._joint=r.I._createJoint(e)}}},{key:"ratio",get:function(){return this._ratio},set:function(t){this._ratio=t,this._joint&&this._joint.SetRatio(t)}}]),GearJoint}();e.ClassUtils.regClass("laya.physics.joint.GearJoint",p),e.ClassUtils.regClass("Laya.GearJoint",p);var f=function(t){function MotorJoint(){var t;return _classCallCheck(this,MotorJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(MotorJoint).apply(this,arguments))).collideConnected=!1,t._linearOffset=[0,0],t._angularOffset=0,t._maxForce=1e3,t._maxTorque=1e3,t._correctionFactor=.3,t}return _inherits(MotorJoint,y),_createClass(MotorJoint,[{key:"_createJoint",value:function(){if(!this._joint){if(!this.otherBody)throw"otherBody can not be empty";if(this.selfBody=this.selfBody||this.owner.getComponent(n),!this.selfBody)throw"selfBody can not be empty";var t=window.box2d,e=MotorJoint._temp||(MotorJoint._temp=new t.b2MotorJointDef);e.Initialize(this.otherBody.getBody(),this.selfBody.getBody()),e.linearOffset=new t.b2Vec2(this._linearOffset[0]/r.PIXEL_RATIO,this._linearOffset[1]/r.PIXEL_RATIO),e.angularOffset=this._angularOffset,e.maxForce=this._maxForce,e.maxTorque=this._maxTorque,e.correctionFactor=this._correctionFactor,e.collideConnected=this.collideConnected,this._joint=r.I._createJoint(e)}}},{key:"linearOffset",get:function(){return this._linearOffset},set:function(t){this._linearOffset=t,this._joint&&this._joint.SetLinearOffset(new window.box2d.b2Vec2(t[0]/r.PIXEL_RATIO,t[1]/r.PIXEL_RATIO))}},{key:"angularOffset",get:function(){return this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.SetAngularOffset(t)}},{key:"maxForce",get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}},{key:"maxTorque",get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.SetMaxTorque(t)}},{key:"correctionFactor",get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.SetCorrectionFactor(t)}}]),MotorJoint}();e.ClassUtils.regClass("laya.physics.joint.MotorJoint",f),e.ClassUtils.regClass("Laya.MotorJoint",f);var v=function(t){function MouseJoint(){var t;return _classCallCheck(this,MouseJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(MouseJoint).apply(this,arguments)))._maxForce=1e4,t._frequency=5,t._dampingRatio=.7,t}return _inherits(MouseJoint,y),_createClass(MouseJoint,[{key:"_onEnable",value:function(){this.owner.on(e.Event.MOUSE_DOWN,this,this.onMouseDown)}},{key:"_onAwake",value:function(){}},{key:"onMouseDown",value:function(){this._createJoint(),e.Laya.stage.on(e.Event.MOUSE_MOVE,this,this.onMouseMove),e.Laya.stage.once(e.Event.MOUSE_UP,this,this.onStageMouseUp),e.Laya.stage.once(e.Event.MOUSE_OUT,this,this.onStageMouseUp)}},{key:"_createJoint",value:function(){if(!this._joint){if(this.selfBody=this.selfBody||this.owner.getComponent(n),!this.selfBody)throw"selfBody can not be empty";var t=window.box2d,i=MouseJoint._temp||(MouseJoint._temp=new t.b2MouseJointDef);if(this.anchor)var s=this.selfBody.owner.localToGlobal(e.Point.TEMP.setTo(this.anchor[0],this.anchor[1]),!1,r.I.worldRoot);else s=r.I.worldRoot.globalToLocal(e.Point.TEMP.setTo(e.Laya.stage.mouseX,e.Laya.stage.mouseY));var o=new t.b2Vec2(s.x/r.PIXEL_RATIO,s.y/r.PIXEL_RATIO);i.bodyA=r.I._emptyBody,i.bodyB=this.selfBody.getBody(),i.target=o,t.b2LinearStiffness(i,this._frequency,this._dampingRatio,i.bodyA,i.bodyB),i.maxForce=this._maxForce,this._joint=r.I._createJoint(i)}}},{key:"onStageMouseUp",value:function(){e.Laya.stage.off(e.Event.MOUSE_MOVE,this,this.onMouseMove),e.Laya.stage.off(e.Event.MOUSE_UP,this,this.onStageMouseUp),e.Laya.stage.off(e.Event.MOUSE_OUT,this,this.onStageMouseUp),_get(_getPrototypeOf(MouseJoint.prototype),"_onDisable",this).call(this)}},{key:"onMouseMove",value:function(){this._joint.SetTarget(new window.box2d.b2Vec2(r.I.worldRoot.mouseX/r.PIXEL_RATIO,r.I.worldRoot.mouseY/r.PIXEL_RATIO))}},{key:"_onDisable",value:function(){this.owner.off(e.Event.MOUSE_DOWN,this,this.onMouseDown),_get(_getPrototypeOf(MouseJoint.prototype),"_onDisable",this).call(this)}},{key:"maxForce",get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}},{key:"frequency",get:function(){return this._frequency},set:function(t){if(this._frequency=t,this._joint){var e={},i=window.box2d,s=r.I._emptyBody,n=this.selfBody.getBody();i.b2LinearStiffness(e,this._frequency,this._dampingRatio,s,n),this._joint.SetStiffness(e.stiffness),this._joint.SetDamping(e.damping)}}},{key:"damping",get:function(){return this._dampingRatio},set:function(t){if(this._dampingRatio=t,this._joint){var e={},i=window.box2d,s=r.I._emptyBody,n=this.selfBody.getBody();i.b2LinearStiffness(e,this._frequency,this._dampingRatio,s,n),this._joint.SetDamping(e.damping)}}}]),MouseJoint}();e.ClassUtils.regClass("laya.physics.joint.MouseJoint",v),e.ClassUtils.regClass("Laya.MouseJoint",v);var b=function(t){function PrismaticJoint(){var t;return _classCallCheck(this,PrismaticJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(PrismaticJoint).apply(this,arguments))).anchor=[0,0],t.axis=[1,0],t.collideConnected=!1,t._enableMotor=!1,t._motorSpeed=0,t._maxMotorForce=1e4,t._enableLimit=!1,t._lowerTranslation=0,t._upperTranslation=0,t}return _inherits(PrismaticJoint,y),_createClass(PrismaticJoint,[{key:"_createJoint",value:function(){if(!this._joint){if(this.selfBody=this.selfBody||this.owner.getComponent(n),!this.selfBody)throw"selfBody can not be empty";var t=window.box2d,i=PrismaticJoint._temp||(PrismaticJoint._temp=new t.b2PrismaticJointDef),s=this.selfBody.owner.localToGlobal(e.Point.TEMP.setTo(this.anchor[0],this.anchor[1]),!1,r.I.worldRoot),o=new t.b2Vec2(s.x/r.PIXEL_RATIO,s.y/r.PIXEL_RATIO);i.Initialize(this.otherBody?this.otherBody.getBody():r.I._emptyBody,this.selfBody.getBody(),o,new t.b2Vec2(this.axis[0],this.axis[1])),i.enableMotor=this._enableMotor,i.motorSpeed=this._motorSpeed,i.maxMotorForce=this._maxMotorForce,i.enableLimit=this._enableLimit,i.lowerTranslation=this._lowerTranslation/r.PIXEL_RATIO,i.upperTranslation=this._upperTranslation/r.PIXEL_RATIO,i.collideConnected=this.collideConnected,this._joint=r.I._createJoint(i)}}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t)}},{key:"maxMotorForce",get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.SetMaxMotorForce(t)}},{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t)}},{key:"lowerTranslation",get:function(){return this._lowerTranslation},set:function(t){this._lowerTranslation=t,this._joint&&this._joint.SetLimits(t,this._upperTranslation)}},{key:"upperTranslation",get:function(){return this._upperTranslation},set:function(t){this._upperTranslation=t,this._joint&&this._joint.SetLimits(this._lowerTranslation,t)}}]),PrismaticJoint}();e.ClassUtils.regClass("laya.physics.joint.PrismaticJoint",b),e.ClassUtils.regClass("Laya.PrismaticJoint",b);var C=function(t){function PulleyJoint(){var t;return _classCallCheck(this,PulleyJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(PulleyJoint).apply(this,arguments))).selfAnchor=[0,0],t.otherAnchor=[0,0],t.selfGroundPoint=[0,0],t.otherGroundPoint=[0,0],t.ratio=1.5,t.collideConnected=!1,t}return _inherits(PulleyJoint,y),_createClass(PulleyJoint,[{key:"_createJoint",value:function(){if(!this._joint){if(!this.otherBody)throw"otherBody can not be empty";if(this.selfBody=this.selfBody||this.owner.getComponent(n),!this.selfBody)throw"selfBody can not be empty";var t=window.box2d,i=PulleyJoint._temp||(PulleyJoint._temp=new t.b2PulleyJointDef),s=this.otherBody.owner.localToGlobal(e.Point.TEMP.setTo(this.otherAnchor[0],this.otherAnchor[1]),!1,r.I.worldRoot),o=new t.b2Vec2(s.x/r.PIXEL_RATIO,s.y/r.PIXEL_RATIO),a=this.selfBody.owner.localToGlobal(e.Point.TEMP.setTo(this.selfAnchor[0],this.selfAnchor[1]),!1,r.I.worldRoot),l=new t.b2Vec2(a.x/r.PIXEL_RATIO,a.y/r.PIXEL_RATIO),h=this.otherBody.owner.localToGlobal(e.Point.TEMP.setTo(this.otherGroundPoint[0],this.otherGroundPoint[1]),!1,r.I.worldRoot),_=new t.b2Vec2(h.x/r.PIXEL_RATIO,h.y/r.PIXEL_RATIO),u=this.selfBody.owner.localToGlobal(e.Point.TEMP.setTo(this.selfGroundPoint[0],this.selfGroundPoint[1]),!1,r.I.worldRoot),m=new t.b2Vec2(u.x/r.PIXEL_RATIO,u.y/r.PIXEL_RATIO);i.Initialize(this.otherBody.getBody(),this.selfBody.getBody(),_,m,o,l,this.ratio),i.collideConnected=this.collideConnected,this._joint=r.I._createJoint(i)}}}]),PulleyJoint}();e.ClassUtils.regClass("laya.physics.joint.PulleyJoint",C),e.ClassUtils.regClass("Laya.PulleyJoint",C);var x=function(t){function RevoluteJoint(){var t;return _classCallCheck(this,RevoluteJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(RevoluteJoint).apply(this,arguments))).anchor=[0,0],t.collideConnected=!1,t._enableMotor=!1,t._motorSpeed=0,t._maxMotorTorque=1e4,t._enableLimit=!1,t._lowerAngle=0,t._upperAngle=0,t}return _inherits(RevoluteJoint,y),_createClass(RevoluteJoint,[{key:"_createJoint",value:function(){if(!this._joint){if(this.selfBody=this.selfBody||this.owner.getComponent(n),!this.selfBody)throw"selfBody can not be empty";var t=window.box2d,i=RevoluteJoint._temp||(RevoluteJoint._temp=new t.b2RevoluteJointDef),s=this.selfBody.owner.localToGlobal(e.Point.TEMP.setTo(this.anchor[0],this.anchor[1]),!1,r.I.worldRoot),o=new t.b2Vec2(s.x/r.PIXEL_RATIO,s.y/r.PIXEL_RATIO);i.Initialize(this.otherBody?this.otherBody.getBody():r.I._emptyBody,this.selfBody.getBody(),o),i.enableMotor=this._enableMotor,i.motorSpeed=this._motorSpeed,i.maxMotorTorque=this._maxMotorTorque,i.enableLimit=this._enableLimit,i.lowerAngle=this._lowerAngle,i.upperAngle=this._upperAngle,i.collideConnected=this.collideConnected,this._joint=r.I._createJoint(i)}}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t)}},{key:"lowerAngle",get:function(){return this._lowerAngle},set:function(t){this._lowerAngle=t,this._joint&&this._joint.SetLimits(t,this._upperAngle)}},{key:"upperAngle",get:function(){return this._upperAngle},set:function(t){this._upperAngle=t,this._joint&&this._joint.SetLimits(this._lowerAngle,t)}}]),RevoluteJoint}();e.ClassUtils.regClass("laya.physics.joint.RevoluteJoint",x),e.ClassUtils.regClass("Laya.RevoluteJoint",x);var A=function(t){function WeldJoint(){var t;return _classCallCheck(this,WeldJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(WeldJoint).apply(this,arguments))).anchor=[0,0],t.collideConnected=!1,t._frequency=5,t._dampingRatio=.7,t}return _inherits(WeldJoint,y),_createClass(WeldJoint,[{key:"_createJoint",value:function(){if(!this._joint){if(!this.otherBody)throw"otherBody can not be empty";if(this.selfBody=this.selfBody||this.owner.getComponent(n),!this.selfBody)throw"selfBody can not be empty";var t=window.box2d,i=WeldJoint._temp||(WeldJoint._temp=new t.b2WeldJointDef),s=this.selfBody.owner.localToGlobal(e.Point.TEMP.setTo(this.anchor[0],this.anchor[1]),!1,r.I.worldRoot),o=new t.b2Vec2(s.x/r.PIXEL_RATIO,s.y/r.PIXEL_RATIO);i.Initialize(this.otherBody.getBody(),this.selfBody.getBody(),o),t.b2AngularStiffness(i,this._frequency,this._dampingRatio,i.bodyA,i.bodyB),i.collideConnected=this.collideConnected,this._joint=r.I._createJoint(i)}}},{key:"frequency",get:function(){return this._frequency},set:function(t){if(this._frequency=t,this._joint){var e={},i=window.box2d,s=this.otherBody?this.otherBody.getBody():r.I._emptyBody,n=this.selfBody.getBody();i.b2AngularStiffness(e,this._frequency,this._dampingRatio,s,n),this._joint.SetStiffness(e.stiffness),this._joint.SetDamping(e.damping)}}},{key:"damping",get:function(){return this._dampingRatio},set:function(t){if(this._dampingRatio=t,this._joint){var e={},i=window.box2d,s=this.otherBody?this.otherBody.getBody():r.I._emptyBody,n=this.selfBody.getBody();i.b2AngularStiffness(e,this._frequency,this._dampingRatio,s,n),this._joint.SetDamping(e.damping)}}}]),WeldJoint}();e.ClassUtils.regClass("laya.physics.joint.WeldJoint",A),e.ClassUtils.regClass("Laya.WeldJoint",A);var S=function(t){function WheelJoint(){var t;return _classCallCheck(this,WheelJoint),(t=_possibleConstructorReturn(this,_getPrototypeOf(WheelJoint).apply(this,arguments))).anchor=[0,0],t.collideConnected=!1,t.axis=[1,0],t._frequency=5,t._dampingRatio=.7,t._enableMotor=!1,t._motorSpeed=0,t._maxMotorTorque=1e4,t._enableLimit=!0,t._lowerTranslation=0,t._upperTranslation=0,t}return _inherits(WheelJoint,y),_createClass(WheelJoint,[{key:"_createJoint",value:function(){if(!this._joint){if(!this.otherBody)throw"otherBody can not be empty";if(this.selfBody=this.selfBody||this.owner.getComponent(n),!this.selfBody)throw"selfBody can not be empty";var t=window.box2d,i=WheelJoint._temp||(WheelJoint._temp=new t.b2WheelJointDef),s=this.selfBody.owner.localToGlobal(e.Point.TEMP.setTo(this.anchor[0],this.anchor[1]),!1,r.I.worldRoot),o=new t.b2Vec2(s.x/r.PIXEL_RATIO,s.y/r.PIXEL_RATIO);i.Initialize(this.otherBody.getBody(),this.selfBody.getBody(),o,new t.b2Vec2(this.axis[0],this.axis[1])),i.enableMotor=this._enableMotor,i.motorSpeed=this._motorSpeed,i.maxMotorTorque=this._maxMotorTorque,t.b2LinearStiffness(i,this._frequency,this._dampingRatio,i.bodyA,i.bodyB),i.collideConnected=this.collideConnected,i.enableLimit=this._enableLimit,i.lowerTranslation=this._lowerTranslation/r.PIXEL_RATIO,i.upperTranslation=this._upperTranslation/r.PIXEL_RATIO,this._joint=r.I._createJoint(i)}}},{key:"frequency",get:function(){return this._frequency},set:function(t){if(this._frequency=t,this._joint){var e={},i=window.box2d,s=this.otherBody?this.otherBody.getBody():r.I._emptyBody,n=this.selfBody.getBody();i.b2LinearStiffness(e,this._frequency,this._dampingRatio,s,n),this._joint.SetStiffness(e.stiffness),this._joint.SetDamping(e.damping)}}},{key:"damping",get:function(){return this._dampingRatio},set:function(t){if(this._dampingRatio=t,this._joint){var e={},i=window.box2d,s=this.otherBody?this.otherBody.getBody():r.I._emptyBody,n=this.selfBody.getBody();i.b2LinearStiffness(e,this._frequency,this._dampingRatio,s,n),this._joint.SetDamping(e.damping)}}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t)}},{key:"lowerTranslation",get:function(){return this._lowerTranslation},set:function(t){this._lowerTranslation=t,this._joint&&this._joint.SetLimits(t,this._upperTranslation)}},{key:"upperTranslation",get:function(){return this._upperTranslation},set:function(t){this._upperTranslation=t,this._joint&&this._joint.SetLimits(this._lowerTranslation,t)}}]),WheelJoint}();e.ClassUtils.regClass("laya.physics.joint.WheelJoint",S),e.ClassUtils.regClass("Laya.WheelJoint",S),t.BoxCollider=l,t.ChainCollider=h,t.CircleCollider=_,t.ColliderBase=s,t.DestructionListener=o,t.DistanceJoint=d,t.EdgeCollider=u,t.GearJoint=p,t.IPhysics=i,t.JointBase=y,t.MotorJoint=f,t.MouseJoint=v,t.Physics=r,t.PhysicsDebugDraw=m,t.PolygonCollider=c,t.PrismaticJoint=b,t.PulleyJoint=C,t.RevoluteJoint=x,t.RigidBody=n,t.WeldJoint=A,t.WheelJoint=S}(window.Laya=window.Laya||{},Laya);