"use strict";function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach(function(t){_defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPrimitive(e,t){if("object"!==_typeof2(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==_typeof2(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof2(t)?t:String(t)}var Config={LIB_VERSION:"3.2.7",LIB_NAME:"MG",BASE_URL:"https://turbo.api.plutus-cat.com/event_center/api/v1"},_={},ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,nativeToString=ObjProto.toString,nativeHasOwnProperty=Object.prototype.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIsArray=Array.isArray,breaker={};_.isNumber=function(e){return"number"==typeof e?0==e-e:"string"==typeof e&&""!==e.trim()&&(Number.isFinite?Number.isFinite(+e):isFinite(+e))},_.each=function(e,t,i){if(null==e)return!1;if(nativeForEach&&e.forEach===nativeForEach)e.forEach(t,i);else if(e.length===+e.length){for(var n=0,r=e.length;n<r;n++)if(n in e&&t.call(i,e[n],n,e)===breaker)return!1}else for(var a in e)if(nativeHasOwnProperty.call(e,a)&&t.call(i,e[a],a,e)===breaker)return!1},_.extend=function(e){return _.each(slice.call(arguments,1),function(t){for(var i in t)void 0!==t[i]&&(e[i]=t[i])}),e},_.extend2Layers=function(e){return _.each(slice.call(arguments,1),function(t){for(var i in t)void 0!==t[i]&&(_.isObject(t[i])&&_.isObject(e[i])?_.extend(e[i],t[i]):e[i]=t[i])}),e},_.isArray=nativeIsArray||function(e){return"[object Array]"===nativeToString.call(e)},_.isFunction=function(e){try{return"function"==typeof e}catch(e){return!1}},_.isPromise=function(e){return"[object Promise]"===nativeToString.call(e)&&null!=e},_.isObject=function(e){return"[object Object]"===nativeToString.call(e)&&null!=e},_.isEmptyObject=function(e){if(_.isObject(e)){for(var t in e)if(nativeHasOwnProperty.call(e,t))return!1;return!0}return!1},_.isUndefined=function(e){return void 0===e},_.isString=function(e){return"[object String]"===nativeToString.call(e)},_.isDate=function(e){return"[object Date]"===nativeToString.call(e)},_.isBoolean=function(e){return"[object Boolean]"===nativeToString.call(e)},_.isNumber=function(e){return"[object Number]"===nativeToString.call(e)&&/[\d\.]+/.test(String(e))},_.isJSONString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},_.decodeURIComponent=function(e){var t="";try{t=decodeURIComponent(e)}catch(i){t=e}return t},_.encodeURIComponent=function(e){var t="";try{t=encodeURIComponent(e)}catch(i){t=e}return t},_.utf8Encode=function(e){var t,i,n,r,a="";for(t=i=0,n=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,r=0;r<n;r++){var s=e.charCodeAt(r),o=null;s<128?i++:o=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(i>t&&(a+=e.substring(t,i)),a+=o,t=i=r+1)}return i>t&&(a+=e.substring(t,e.length)),a},_.base64Encode=function(e){var t,i,n,r,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,c=0,u="",l=[];if(!e)return e;e=_.utf8Encode(e);do{t=(a=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++))>>18&63,i=a>>12&63,n=a>>6&63,r=63&a,l[c++]=s.charAt(t)+s.charAt(i)+s.charAt(n)+s.charAt(r)}while(o<e.length);switch(u=l.join(""),e.length%3){case 1:u=u.slice(0,-2)+"==";break;case 2:u=u.slice(0,-1)+"="}return u},_.encodeDates=function(e){return _.each(e,function(t,i){if(_.isDate(t))e[i]=_.formatDate(t);else if(_.isObject(t))e[i]=_.encodeDates(t);else if(_.isArray(t))for(var n=0;n<t.length;n++)_.isDate(t[n])&&(e[i][n]=_.formatDate(t[n]))}),e},_.formatDate=function(e){function pad(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+pad(e.getMonth()+1)+"-"+pad(e.getDate())+" "+pad(e.getHours())+":"+pad(e.getMinutes())+":"+pad(e.getSeconds())+"."+((t=e.getMilliseconds())<100&&t>9?"0"+t:t<10?"00"+t:t);var t},_.searchObjDate=function(e){try{(_.isObject(e)||_.isArray(e))&&_.each(e,function(t,i){_.isObject(t)||_.isArray(t)?_.searchObjDate(e[i]):_.isDate(t)&&(e[i]=_.formatDate(t))})}catch(e){logger.warn(e)}},_.UUID=function(){var e=(new Date).getTime();return String(Math.random()).replace(".","").slice(1,11)+"-"+e},_.UUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},_.setMpPlatform=function(e){_.mpPlatform=e},_.getMpPlatform=function(){return _.mpPlatform},_.createExtraHeaders=function(){return{"TA-Integration-Type":Config.LIB_NAME,"TA-Integration-Version":Config.LIB_VERSION,"TA-Integration-Count":"1","TA-Integration-Extra":_.getMpPlatform()}},_.checkAppId=function(e){return e=e.replace(/\s*/g,"")},_.checkUrl=function(e){return e=e.replace(/\s*/g,""),e=_.url("basic",e)},_.url=function(){function _t(){return new RegExp(/(.*?)\.?([^.]*?)\.(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|net\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function _i(e,t){var i=e.charAt(0),n=t.split(i);return i===e?n:n[(e=parseInt(e.substring(1),10))<0?n.length+e:e-1]}function _f(e,t){for(var i,n=e.charAt(0),r=t.split("&"),a=[],s={},o=[],c=e.substring(1),u=0,l=r.length;u<l;u++)if((a=r[u].match(/(.*?)=(.*)/))||(a=[r[u],r[u],""]),""!==a[1].replace(/\s/g,"")){if(a[2]=(i=a[2]||"",_.decodeURIComponent(i.replace(/\+/g," "))),c===a[1])return a[2];(o=a[1].match(/(.*)\[([0-9]+)\]/))?(s[o[1]]=s[o[1]]||[],s[o[1]][o[2]]=a[2]):s[a[1]]=a[2]}return n===e?s:s[c]}return function(e,t){var i,n={};if("tld?"===e)return _t();if(t=t||window.location.toString(),!e)return t;if(e=e.toString(),t.match(/^mailto:([^\/].+)/))i=t.match(/^mailto:([^\/].+)/),n.protocol="mailto",n.email=i[1];else{if(t.match(/(.*?)\/#!(.*)/)&&(i=t.match(/(.*?)\/#!(.*)/),t=i[1]+i[2]),t.match(/(.*?)#(.*)/)&&(i=t.match(/(.*?)#(.*)/),n.hash=i[2],t=i[1]),n.hash&&e.match(/^#/))return _f(e,n.hash);if(t.match(/(.*?)\?(.*)/)&&(i=t.match(/(.*?)\?(.*)/),n.query=i[2],t=i[1]),n.query&&e.match(/^\?/))return _f(e,n.query);if(t.match(/(.*?):?\/\/(.*)/)&&(i=t.match(/(.*?):?\/\/(.*)/),n.protocol=i[1].toLowerCase(),t=i[2]),t.match(/(.*?)(\/.*)/)&&(i=t.match(/(.*?)(\/.*)/),n.path=i[2],t=i[1]),n.path=(n.path||"").replace(/^([^\/])/,"/$1").replace(/\/$/,""),e.match(/^[-0-9]+$/)&&(e=e.replace(/^([^\/])/,"/$1")),e.match(/^\//))return _i(e,n.path.substring(1));if((i=_i("/-1",n.path.substring(1)))&&(i=i.match(/(.*?)\.(.*)/))&&(n.file=i[0],n.filename=i[1],n.fileext=i[2]),t.match(/(.*):([0-9]+)$/)&&(i=t.match(/(.*):([0-9]+)$/),n.port=i[2],t=i[1]),t.match(/(.*?)@(.*)/)&&(i=t.match(/(.*?)@(.*)/),n.auth=i[1],t=i[2]),n.auth&&(i=n.auth.match(/(.*):(.*)/),n.user=i?i[1]:n.auth,n.pass=i?i[2]:void 0),n.hostname=t.toLowerCase(),"."===e.charAt(0))return _i(e,n.hostname);_t()&&(i=n.hostname.match(_t()))&&(n.tld=i[3],n.domain=i[2]?i[2]+"."+i[3]:void 0,n.sub=i[1]||void 0);var r=n.port?":"+n.port:"";n.protocol=n.protocol||window.location.protocol.replace(":",""),n.port=n.port||("https"===n.protocol?"443":"80"),n.protocol=n.protocol||("443"===n.port?"https":"http"),n.basic=n.protocol+"://"+n.hostname+r}return e in n?n[e]:"{}"===e?n:""}}(),_.createString=function(e){for(var t=e,i=Math.random().toString(36).substr(2);i.length<t;)i+=Math.random().toString(36).substr(2);return i=i.substr(0,e)},_.createAesKey=function(){return _.createString(16)},_.setQuery=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")},_.generateEncryptyData=function(e,t){if(void 0===t)return e;var i=t.publicKey,n=t.version;if(void 0===i||void 0===n)return e;if("undefined"==typeof CryptoJS||"undefined"==typeof JSEncrypt)return e;var r=_.createAesKey();try{var a=CryptoJS.enc.Utf8.parse(r),s=CryptoJS.enc.Utf8.parse(JSON.stringify(e)),o=_.isUndefined(CryptoJS.pad.Pkcs7)?CryptoJS.pad.PKCS7:CryptoJS.pad.Pkcs7,c=CryptoJS.AES.encrypt(s,a,{mode:CryptoJS.mode.ECB,padding:o}).toString(),u=new JSEncrypt;u.setPublicKey(i);var l=u.encrypt(r);return!1===l?(logger.warn("私钥加密失败，返回原数据"),e):{pkv:n,ekey:l,payload:c}}catch(e){logger.warn("数据加密失败，返回原数据: "+e)}return e};var logger="object"===_typeof(logger)?logger:{};logger.info=function(){if("object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&logger.enabled)try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}},logger.warn=function(){if("object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&logger.enabled)try{return console.warn.apply(console,arguments)}catch(e){console.warn(arguments[0])}};var PlatformProxy=function(){function PlatformProxy(){_classCallCheck(this,PlatformProxy),this.config={persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_mg"}}return _createClass(PlatformProxy,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,i){var n=localStorage.getItem(e);if(!t)return _.isJSONString(n)?JSON.parse(n):{};_.isJSONString(n)?i(JSON.parse(n)):i({})}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"_setSystemProxy",value:function(e){this._sysCallback=e}},{key:"getSystemInfo",value:function(e){var t={mp_platform:"web",system:this._getOs(),screenWidth:window.screen.width,screenHeight:window.screen.height,systemLanguage:navigator.language};this._sysCallback&&(t=_.extend(t,this._sysCallback(e))),e.success(t),e.complete()}},{key:"_getOs",value:function(){var e=navigator.userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"MacOS":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"ChromeOS":""}},{key:"getNetworkType",value:function(e){e.complete()}},{key:"onNetworkStatusChange",value:function(){}},{key:"request",value:function(e){var t={},i=new XMLHttpRequest;if(i.open(e.method,e.url),e.header)for(var n in e.header)i.setRequestHeader(n,e.header[n]);return i.onreadystatechange=function(){4===i.readyState&&200===i.status?(t.statusCode=200,_.isJSONString(i.responseText)&&(t.data=JSON.parse(i.responseText)),e.success(t)):200!==i.status&&(t.errMsg="network error",e.fail(t))},i.ontimeout=function(){t.errMsg="timeout",e.fail(t)},i.send(e.data),i}},{key:"initAutoTrackInstance",value:function(e,t){this.instance=e,this.autoTrack=t.autoTrack;var i=this;"onpagehide"in window?window.onpagehide=function(){i.onPageHide(!0)}:window.onbeforeunload=function(){i.onPageHide(!0)},i.onPageShow(),i.autoTrack.appHide&&i.instance.timeEvent("ta_page_hide"),"onvisibilitychange"in document&&(document.onvisibilitychange=function(){document.hidden?i.onPageHide(!1):(i.onPageShow(),i.autoTrack.appHide&&i.instance.timeEvent("ta_page_hide"))})}},{key:"setGlobal",value:function(e,t){window[t]=e}},{key:"getAppOptions",value:function(){}},{key:"showToast",value:function(){}},{key:"onPageShow",value:function(){if(this.autoTrack.appShow){var e={};_.extend(e,this.autoTrack.properties),_.isFunction(this.autoTrack.callback)&&_.extend(e,this.autoTrack.callback("appShow")),this.instance._internalTrack("ta_page_show",e)}}},{key:"onPageHide",value:function(e){if(this.autoTrack.appHide){var t={};_.extend(t,this.autoTrack.properties),_.isFunction(this.autoTrack.callback)&&_.extend(t,this.autoTrack.callback("appHide")),this.instance._internalTrack("ta_page_hide",t,new Date,null,e)}}}],[{key:"createInstance",value:function(){return new PlatformProxy}}]),PlatformProxy}(),AutoTrackBridge=function(){function AutoTrackBridge(e,t){if(_classCallCheck(this,AutoTrackBridge),this.taInstance=e,this.config=t||{},this.referrer="Directly open",this.config.isPlugin)e.App=function(){App.apply(this,arguments)},inension(e.Page);else{var i=App;App=this._initAppExtention(i);var n=Page;Page=this._initPageExtension(n)}}return _createClass(AutoTrackBridge,[{key:"_initPageExtension",value:function(e){var t=this;return function(i){var n=i.onLoad,r=i.onShow,a=i.onShareAppMessage,s={};return i.onLoad=function(e){s=e||{},"function"==typeof n&&n.call(this,e)},i.onShow=function(e){t.onPageShow(s),"function"==typeof r&&r.call(this,e)},"function"==typeof a&&(i.onShareAppMessage=function(e){var i=a.call(this,e);return t.onPageShare(i)}),e(i)}}},{key:"_initAppExtention",value:function(e){var t=this;return function(i){var n=i.onLaunch,r=i.onShow,a=i.onHide;return i.onLaunch=function(e){t.onAppLaunch(e,this),"function"==typeof n&&n.call(this,e)},i.onShow=function(e){t.onAppShow(e),"function"==typeof r&&r.call(this,e)},i.onHide=function(){t.onAppHide(),"function"==typeof a&&a.call(this)},e(i)}}},{key:"onAppLaunch",value:function(e,t){if(this._setAutoTrackProperties(e),_.isUndefined(t)||(t[this.taInstance.name]=this.taInstance),this.config.appLaunch){var i={};e&&e.path&&(i.$url_query=_.setQuery(e.query),i.$scene=e.scene),this.taInstance._internalTrack("$MPLaunch",i)}}},{key:"onAppShow",value:function(e){if(this.config.appHide&&this.taInstance.timeEvent("$MPHide"),this._setAutoTrackProperties(e),this.config.appShow){var t={};e&&e.path&&(t.$url_query=_.setQuery(e.query),t.$scene=e.scene),_.extend(t,this.config.properties),_.isFunction(this.config.callback)&&_.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("$MPShow",t)}}},{key:"onAppHide",value:function(){if(this.config.appHide){var e={};_.extend(e,this.config.properties),_.isFunction(this.config.callback)&&_.extend(e,this.config.callback("appHide")),this.taInstance._internalTrack("$MPHide",e)}}},{key:"_getCurrentPath",value:function(){var e="Not to get";try{var t=getCurrentPages();e=t[t.length-1].route}catch(e){logger.info(e)}return e}},{key:"_setAutoTrackProperties",value:function(e){this.taInstance._setAutoTrackProperties({})}},{key:"_getPath",value:function(e){return"string"==typeof e?e.replace(/^\//,""):"Abnormal values"}},{key:"onPageShare",value:function(e){if(this.config.pageShare){var t=1;try{t=getCurrentPages().length}catch(e){t=1}this.taInstance._internalTrack("$MPShare",{$share_method:"转发消息卡片",$share_depth:t})}return _.isObject(e)?e:{}}},{key:"onPageShow",value:function(e){if(this.config.pageShow){var t=this._getCurrentPath(),i={$url_query:_.setQuery(e)};this.referrer=t,this.taInstance._internalTrack("$MPViewScreen",i)}}}]),AutoTrackBridge}(),AutoTrackBridge$1=function(){function AutoTrackBridge(e,t,i){var n=this;_classCallCheck(this,AutoTrackBridge),this.taInstance=e,this.config=t||{};var r=i.getLaunchOptionsSync();this._onShow(r),this.startTracked=!0,i.onShow(function(e){n._onShow(e)}),i.onHide(function(){if(n.startTracked=!1,n.config.appHide){var e={};_.extend(e,n.config.properties),_.isFunction(n.config.callback)&&_.extend(e,n.config.callback("appHide")),n.taInstance._internalTrack("$MPHide",e)}})}return _createClass(AutoTrackBridge,[{key:"_onShow",value:function(e){if(!this.startTracked&&(this.config.appHide&&this.taInstance.timeEvent("$MPHide"),this.config.appShow)){var t={};_.extend(t,this.config.properties),_.isFunction(this.config.callback)&&_.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("$MPShow",_objectSpread2(_objectSpread2({},t),{},{$scene:e.scene,$url_query:_.setQuery(PlatformAPI.getAppOptions().query)}))}}}]),AutoTrackBridge}(),PlatformProxy$1=function(){function PlatformProxy$1(e,t,i){_classCallCheck(this,PlatformProxy$1),this.api=e,this.config=t,this._config=i}return _createClass(PlatformProxy$1,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,i){if(!t){if("dd_mp"===this._config.platform){var n=this.api.getStorageSync({key:e});return _.isJSONString(n.data)?JSON.parse(n.data):{}}var r=this.api.getStorageSync(e);return _.isJSONString(r)?JSON.parse(r):{}}this.api.getStorage({key:e,success:function(e){var t=_.isJSONString(e.data)?JSON.parse(e.data):{};i(t)},fail:function(){logger.warn("getStorage faild"),i({})}})}},{key:"setStorage",value:function(e,t){this.api.setStorage({key:e,data:t})}},{key:"_getPlatform",value:function(){return""}},{key:"getSystemInfo",value:function(e){var t=this._config.mpPlatform;this.api.getSystemInfo({success:function(i){_.isFunction(t)?i.mp_platform=t(i):i.mp_platform=t,e.success(i),"wechat"===t&&e.complete()},complete:function(){e.complete()}})}},{key:"getNetworkType",value:function(e){_.isFunction(this.api.getNetworkType)?this.api.getNetworkType({success:function(t){e.success(t)},complete:function(){e.complete()}}):(e.success({}),e.complete())}},{key:"onNetworkStatusChange",value:function(e){_.isFunction(this.api.onNetworkStatusChange)?this.api.onNetworkStatusChange(e):e({})}},{key:"request",value:function(e){if("ali_mp"===this._config.platform||"dd_mp"===this._config.platform){var t=_.extend({},e);return t.headers=e.header,t.success=function(t){t.statusCode=t.status,e.success(t)},t.fail=function(t){t.errMsg=t.errorMessage,e.fail(t)},"dd_mp"===this._config.platform?this.api.httpRequest(t):this.api.request(t)}return this.api.request(e)}},{key:"initAutoTrackInstance",value:function(e,t){return _.isObject(t.autoTrack)&&(t.autoTrack.isPlugin=t.is_plugin),this._config.mp?new AutoTrackBridge(e,t.autoTrack,this.api):new AutoTrackBridge$1(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){this._config.mp?logger.warn("ThinkingAnalytics: we do not set global name for TA instance when you do not enable auto track."):GameGlobal[t]=e}},{key:"getAppOptions",value:function(e){var t={};try{t=this.api.getLaunchOptionsSync()}catch(e){logger.warn("Cannot get launch options.")}if(_.isFunction(e))try{this._config.mp?this.api.onAppShow(e):this.api.onShow(e)}catch(e){logger.warn("Cannot register onShow callback.")}return t}},{key:"showToast",value:function(e){if(_.isFunction(this.api.showToast)){var t={title:e};"dd_mp"!==this._config.platform&&"ali_mp"!==this._config.platform||(t.content=e),this.api.showToast(t)}}}],[{key:"createInstance",value:function(){return this._createInstance("R_CURRENT_PLATFORM")}},{key:"_createInstance",value:function(e){switch(e){case"wechat_mp":return new PlatformProxy$1(wx,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_wechat"},{mpPlatform:"wechat",mp:!0,platform:e});case"wechat_mg":return new PlatformProxy$1(wx,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_wechat_game"},{mpPlatform:"wechat",platform:e});case"qq_mp":return new PlatformProxy$1(qq,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qq"},{mpPlatform:"qq",mp:!0,platform:e});case"qq_mg":return new PlatformProxy$1(qq,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qq_game"},{mpPlatform:"qq",platform:e});case"baidu_mp":return new PlatformProxy$1(swan,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_swan"},{mpPlatform:function(e){return e.host},mp:!0,platform:e});case"baidu_mg":return new PlatformProxy$1(swan,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_swan_game"},{mpPlatform:function(e){return e.host},platform:e});case"tt_mg":return new PlatformProxy$1(tt,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tt_game"},{mpPlatform:function(e){return e.appName},platform:e});case"tt_mp":return new PlatformProxy$1(tt,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tt"},{mpPlatform:function(e){return e.appName},mp:!0,platform:e});case"ali_mp":return new PlatformProxy$1(my,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_ali"},{mpPlatform:function(e){return e.app},mp:!0,platform:e});case"dd_mp":return new PlatformProxy$1(dd,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_dd"},{mpPlatform:"dingding",mp:!0,platform:e});case"bl_mg":return new PlatformProxy$1(bl,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_mg"},{mpPlatform:"bilibili",platform:e});case"kuaishou_mp":return new PlatformProxy$1(ks,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_kuaishou"},{mpPlatform:"kuaishou",mp:!0,platform:e});case"qh360_mg":return new PlatformProxy$1(qh,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qh360"},{mpPlatform:"qh360",platform:e});case"tb_mp":return new PlatformProxy$1(my,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tb"},{mpPlatform:"tb",mp:!0,platform:e});case"jd_mp":return new PlatformProxy$1(jd,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_jd"},{mpPlatform:"jd",mp:!0,platform:e});case"qh360_mp":return new PlatformProxy$1(qh,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qh360"},{mpPlatform:"qh360",mp:!0,platform:e});case"WEB":return new PlatformProxy.createInstance}}}]),PlatformProxy$1}(),AutoTrackBridge$2=_createClass(function AutoTrackBridge(e,t){var i=this;_classCallCheck(this,AutoTrackBridge),this.taInstance=e,this.config=t||{},this.config.appShow&&this.taInstance._internalTrack("ta_mg_show"),this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),qg.onShow(function(){if(i.config.appHide&&i.taInstance.timeEvent("ta_mg_hide"),i.config.appShow){var e={};_.extend(e,i.config.properties),_.isFunction(i.config.callback)&&_.extend(e,i.config.callback("appShow")),i.taInstance._internalTrack("ta_mg_show")}}),qg.onHide(function(){if(i.config.appHide){var e={};_.extend(e,i.config.properties),_.isFunction(i.config.callback)&&_.extend(e,i.config.callback("appHide")),i.taInstance._internalTrack("ta_mg_hide")}})}),PlatformProxy$2=function(){function PlatformProxy(){_classCallCheck(this,PlatformProxy),this.config={persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_vivo_game",asyncPersistence:!0}}return _createClass(PlatformProxy,[{key:"getConfig",value:function(){return this.config||{}}},{key:"getStorage",value:function(e,t,i){if(!t){var n=qg.getStorageSync({key:e});return _.isJSONString(n)?JSON.parse(n):{}}qg.getStorage({key:e,success:function(e){var t=_.isJSONString(e)?JSON.parse(e):{};i(t)},fail:function(){i({})}})}},{key:"setStorage",value:function(e,t){qg.setStorage({key:e,value:t})}},{key:"getSystemInfo",value:function(e){qg.getSystemInfo({success:function(t){var i=t,n=[t.osType,t.osVersionName].join(" ");i.brand=t.manufacturer,i.system=n,i.mp_platform="vivo_qg",e.success(i)},complete:function(){e.complete()}})}},{key:"getNetworkType",value:function(e){qg.getNetworkType({success:function(t){var i=t;i.networkType=t.type,e.success(i)},complete:function(){e.complete()}})}},{key:"onNetworkStatusChange",value:function(e){qg.subscribeNetworkStatus({callback:function(t){var i=t;i.networkType=t.type,e(i)}})}},{key:"request",value:function(e){return qg.request({url:e.url,data:e.data,method:e.method,header:e.header,success:function(t){e.success(t)},fail:function(t){e.fail(t)}})}},{key:"initAutoTrackInstance",value:function(e,t){return new AutoTrackBridge$2(e,t.autoTrack)}},{key:"setGlobal",value:function(e,t){globalThis[t]=e}},{key:"getAppOptions",value:function(){return{}}},{key:"showToast",value:function(e){qg.showToast({message:e,duration:0})}}],[{key:"createInstance",value:function(){return new PlatformProxy}}]),PlatformProxy}(),AutoTrackBridge$3=_createClass(function AutoTrackBridge(e,t,i){var n=this;if(_classCallCheck(this,AutoTrackBridge),this.taInstance=e,this.config=t||{},this.config.appShow){var r={};_.extend(r,this.config.properties),_.isFunction(this.config.callback)&&_.extend(r,this.config.callback("appShow")),this.taInstance._internalTrack("ta_mg_show",r)}this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),i.onShow(function(){if(n.config.appHide&&n.taInstance.timeEvent("ta_mg_hide"),n.config.appShow){var e={};_.extend(e,n.config.properties),_.isFunction(n.config.callback)&&_.extend(e,n.config.callback("appShow")),n.taInstance._internalTrack("ta_mg_show",e)}}),i.onHide(function(){if(n.config.appHide){var e={};_.extend(e,n.config.properties),_.isFunction(n.config.callback)&&_.extend(e,n.config.callback("appHide")),n.taInstance._internalTrack("ta_mg_hide",e)}})}),PlatformProxy$3=function(){function PlatformProxy(e,t,i){_classCallCheck(this,PlatformProxy),this.api=e,this.config=t,this._config=i}return _createClass(PlatformProxy,[{key:"getConfig",value:function(){return this.config||{}}},{key:"getStorage",value:function(e,t,i){var n=localStorage.getItem(e);if(!t)return _.isJSONString(n)?JSON.parse(n):{};_.isJSONString(n)?i(JSON.parse(n)):i({})}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"getSystemInfo",value:function(e){var t=this._config.mpPlatform;this.api.getSystemInfo({success:function(i){i.mp_platform=t,e.success(i)},complete:function(){e.complete()}})}},{key:"getNetworkType",value:function(e){this.api.getNetworkType({success:function(t){e.success(t)},complete:function(){e.complete()}})}},{key:"onNetworkStatusChange",value:function(e){this.api.onNetworkStatusChange({callback:function(t){e(t)}})}},{key:"request",value:function(e){var t={},i=new XMLHttpRequest;if(i.open(e.method,e.url),e.header)for(var n in e.header)i.setRequestHeader(n,e.header[n]);return i.onreadystatechange=function(){4===i.readyState&&200===i.status?(t.statusCode=200,_.isJSONString(i.responseText)&&(t.data=JSON.parse(i.responseText)),e.success(t)):200!==i.status&&(t.errMsg="network error",e.fail(t))},i.ontimeout=function(){t.errMsg="timeout",e.fail(t)},i.send(e.data),i}},{key:"initAutoTrackInstance",value:function(e,t){return new AutoTrackBridge$3(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){globalThis[t]=e}},{key:"getAppOptions",value:function(){return this.api.getLaunchOptionsSync()}},{key:"showToast",value:function(e){this.api.showToast({title:e,icon:"none",duration:2e3})}}],[{key:"createInstance",value:function(){return this._createInstance("R_CURRENT_PLATFORM")}},{key:"_createInstance",value:function(e){switch(e){case"oppo":return new PlatformProxy(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_oppo_game"},{mpPlatform:"oppo_qg"});case"huawei":return new PlatformProxy(hbs,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_huawei_game"},{mpPlatform:"huawei_qg"});case"mz":return new PlatformProxy(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_mz_game"},{mpPlatform:"mz"});case"xiaomi":return new PlatformProxy(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg"},{mpPlatform:"xiaomi"})}}}]),PlatformProxy}(),PlatformProxyLaya=function(){function PlatformProxyLaya(){_classCallCheck(this,PlatformProxyLaya)}return _createClass(PlatformProxyLaya,null,[{key:"createInstance",value:function(){return Laya.Browser.onMiniGame?PlatformProxy$1._createInstance("wechat_mg"):Laya.Browser.onBDMiniGame?PlatformProxy$1._createInstance("baidu_mg"):Laya.Browser.onVVMiniGame?PlatformProxy$2.createInstance():Laya.Browser.onQQMiniGame?PlatformProxy$1._createInstance("qq_mg"):Laya.Browser.onQGMiniGame?PlatformProxy$3._createInstance("oppo"):Laya.Browser.onHWMiniGame?PlatformProxy$3._createInstance("huawei"):Laya.Browser.onKGMiniGame?PlatformProxy$3._createInstance("xiaomi"):Laya.Browser.onTTMiniGame?PlatformProxy$1._createInstance("tt_mg"):Laya.Browser.onBLMiniGame?PlatformProxy$1._createInstance("bl_mg"):Laya.Browser.onAlipayMiniGame?PlatformProxy$1._createInstance("ali_mp"):Laya.Browser.onTBMiniGame?PlatformProxy$1._createInstance("tb_mp"):PlatformProxy.createInstance()}}]),PlatformProxyLaya}(),PlatformAPI=function(){function PlatformAPI(){_classCallCheck(this,PlatformAPI)}return _createClass(PlatformAPI,null,[{key:"_getCurrentPlatform",value:function(){return this.currentPlatform||(this.currentPlatform=PlatformProxyLaya.createInstance())}},{key:"getConfig",value:function(){return this._getCurrentPlatform().getConfig()}},{key:"getStorage",value:function(e,t,i){return this._getCurrentPlatform().getStorage(e,t,i)}},{key:"setStorage",value:function(e,t){return this._getCurrentPlatform().setStorage(e,t)}},{key:"getSystemInfo",value:function(e){return this._getCurrentPlatform().getSystemInfo(e)}},{key:"getNetworkType",value:function(e){return this._getCurrentPlatform().getNetworkType(e)}},{key:"onNetworkStatusChange",value:function(e){this._getCurrentPlatform().onNetworkStatusChange(e)}},{key:"request",value:function(e){return this._getCurrentPlatform().request(e)}},{key:"initAutoTrackInstance",value:function(e,t){return this._getCurrentPlatform().initAutoTrackInstance(e,t)}},{key:"setGlobal",value:function(e,t){e&&t&&this._getCurrentPlatform().setGlobal(e,t)}},{key:"getAppOptions",value:function(e){return this._getCurrentPlatform().getAppOptions(e)}},{key:"showDebugToast",value:function(e){this._getCurrentPlatform().showToast(e)}}]),PlatformAPI}(),KEY_NAME_MATCH_REGEX=/^[a-zA-Z][a-zA-Z0-9_]{0,49}$/,PropertyChecker=function(){function PropertyChecker(){_classCallCheck(this,PropertyChecker)}return _createClass(PropertyChecker,null,[{key:"stripProperties",value:function(e){return _.isObject(e)?(_.each(e,function(e,t){_.isString(e)||_.isNumber(e)||_.isDate(e)||_.isBoolean(e)||_.isArray(e)||_.isObject(e)||logger.warn("Your data -",t,e,"- format does not meet requirements and may not be stored correctly. Attribute values only support String, Number, Date, Boolean, Array, Object")}),e):e}},{key:"_checkPropertiesKey",value:function(e){var t=!0;return _.each(e,function(e,i){KEY_NAME_MATCH_REGEX.test(i)||(logger.warn("Invalid KEY: "+i),t=!1)}),t}},{key:"event",value:function(e){return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger.warn("Check the parameter format. The eventName must start with an English letter and contain no more than 50 characters including letters, digits, and underscores: "+e),!1)}},{key:"propertyName",value:function(e){return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger.warn("Check the parameter format. PropertyName must start with a letter and contain letters, digits, and underscores (_). The value is a string of no more than 50 characters: "+e),!1)}},{key:"properties",value:function(e){return this.stripProperties(e),!e||(_.isObject(e)?!!this._checkPropertiesKey(e)||(logger.warn("Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters"),!1):(logger.warn("properties can be none, but it must be an object"),!1))}},{key:"propertiesMust",value:function(e){return this.stripProperties(e),void 0===e||!_.isObject(e)||_.isEmptyObject(e)?(logger.warn("properties must be an object with a value"),!1):!!this._checkPropertiesKey(e)||(logger.warn("Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters"),!1)}},{key:"userId",value:function(e){return!(!_.isString(e)||!/^.{1,64}$/.test(e))||(logger.warn("The user ID must be a string of less than 64 characters and cannot be null"),!1)}},{key:"userAddProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isNumber(e[t]))return logger.warn("The attributes of userAdd need to be Number"),!1;return!0}},{key:"userAppendProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isArray(e[t]))return logger.warn("The attribute of userAppend must be Array"),!1;return!0}}]),PropertyChecker}(),HttpTask=function(){function HttpTask(e,t,i,n,r){_classCallCheck(this,HttpTask),this.data=e,this.serverUrl=t,this.callback=r,this.tryCount=_.isNumber(i)?i:1,this.timeout=_.isNumber(n)?n:3e3,this.taClassName="HttpTask"}return _createClass(HttpTask,[{key:"run",value:function(){var e=this,t=_.createExtraHeaders();t["content-type"]="application/json";var i=PlatformAPI.request({url:this.serverUrl,method:"POST",data:this.data,header:t,success:function(t){e.onSuccess(t)},fail:function(t){e.onFailed(t)}});setTimeout(function(){(_.isObject(i)||_.isPromise(i))&&_.isFunction(i.abort)&&i.abort()},this.timeout)}},{key:"onSuccess",value:function(e){if(200===e.statusCode){var t;switch(e.data.code){case 0:t="success";break;case-1:t="invalid data";break;case-2:t="invalid APP ID";break;default:t="Unknown return code"}this.callback({code:e.data.code,msg:t})}else this.callback({code:-3,msg:e.statusCode})}},{key:"onFailed",value:function(e){--this.tryCount>0?this.run():this.callback({code:-3,msg:e.errMsg})}}]),HttpTask}(),HttpTaskDebug=function(){function HttpTaskDebug(e,t,i,n,r,a,s){_classCallCheck(this,HttpTaskDebug),this.data=e,this.serverDebugUrl=t,this.callback=s,this.tryCount=_.isNumber(i)?i:1,this.timeout=_.isNumber(n)?n:3e3,this.dryrun=r,this.deviceId=a,this.taClassName="HttpTaskDebug"}return _createClass(HttpTaskDebug,[{key:"run",value:function(){var e=this,t="client_id="+this.data.client_id+"&source=client&dryRun="+this.dryrun+"&deviceId="+this.deviceId+"&data="+encodeURIComponent(JSON.stringify(this.data.data[0])),i=_.createExtraHeaders();i["content-type"]="application/x-www-form-urlencoded";var n=PlatformAPI.request({url:this.serverDebugUrl,method:"POST",data:t,header:i,success:function(t){e.onSuccess(t)},fail:function(t){e.onFailed(t)}});setTimeout(function(){(_.isObject(n)||_.isPromise(n))&&_.isFunction(n.abort)&&n.abort()},this.timeout)}},{key:"onSuccess",value:function(e){if(200===e.statusCode){var t;if(0===e.data.errorLevel)t="Verify data success.";else if(1===e.data.errorLevel){for(var i=e.data.errorProperties,n="",r=0;r<i.length;r++){var a=i[r].errorReason;n=n+" propertyName:"+i[r].propertyName+" errorReasons:"+a+"\n"}t="Debug data error. errorLevel:"+e.data.errorLevel+" reason:"+n}else 2!==e.data.errorLevel&&-1!==e.data.errorLevel||(t="Debug data error. errorLevel:"+e.data.errorLevel+" reason:"+e.data.errorReasons);logger.info(t),this.callback({code:e.data.errorLevel,msg:t})}else this.callback({code:-3,msg:e.statusCode})}},{key:"onFailed",value:function(e){--this.tryCount>0?this.run():this.callback({code:-3,msg:e.errMsg})}}]),HttpTaskDebug}(),SenderQueue=function(){function SenderQueue(){_classCallCheck(this,SenderQueue),this.items=[],this.isRunning=!1,this.showDebug=!1}return _createClass(SenderQueue,[{key:"enqueue",value:function(e,t,i){var n,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=this;n="debug"===i.debugMode?new HttpTaskDebug(e,t,i.maxRetries,i.sendTimeout,0,i.deviceId,function(e){a.isRunning=!1,_.isFunction(i.callback)&&i.callback(e),a._runNext(),!1===a.showDebug&&(0!==e.code&&1!==e.code&&2!==e.code||(a.showDebug=!0,_.isFunction(PlatformAPI.showDebugToast)&&PlatformAPI.showDebugToast("The current mode is Debug")))}):"debugOnly"===i.debugMode?new HttpTaskDebug(e,t,i.maxRetries,i.sendTimeout,1,i.deviceId,function(e){a.isRunning=!1,_.isFunction(i.callback)&&i.callback(e),a._runNext(),!1===a.showDebug&&(0!==e.code&&1!==e.code&&2!==e.code||(a.showDebug=!0,_.isFunction(PlatformAPI.showDebugToast)&&PlatformAPI.showDebugToast("The current mode is debugOnly")))}):new HttpTask(JSON.stringify(e),t,i.maxRetries,i.sendTimeout,function(e){a.isRunning=!1,_.isFunction(i.callback)&&i.callback(e),a._runNext()}),!0===r?(this.items.push(n),this._runNext()):n.run()}},{key:"_dequeue",value:function(){return this.items.shift()}},{key:"_runNext",value:function(){if(this.items.length>0&&!this.isRunning)if(this.isRunning=!0,"HttpTask"!==this.items[0].taClassName)this._dequeue().run();else{for(var e=this.items.splice(0,this.items.length),t=e[0],i=JSON.parse(t.data),n=i.client_id,r=1;r<e.length;r++){var a=e[r],s=JSON.parse(a.data);s.client_id===n&&t.serverUrl===a.serverUrl?i.event_list=i.event_list.concat(s.event_list):this.items.push(a)}new HttpTask(JSON.stringify(i),t.serverUrl,t.tryCount,t.timeout,t.callback).run()}}}]),SenderQueue}(),senderQueue=new SenderQueue,DEFAULT_CONFIG={name:"thinkingdata",is_plugin:!1,maxRetries:3,sendTimeout:3e3,enablePersistence:!0,asyncPersistence:!1,enableLog:!0,strict:!1,debugMode:"none"},systemInformation={properties:{$lib_version:Config.LIB_VERSION},getSystemInfo:function(e){var t=this;PlatformAPI.onNetworkStatusChange(function(e){t.properties.$network_type=e.networkType}),PlatformAPI.getNetworkType({success:function(e){t.properties.$network_type=e.networkType},complete:function(){PlatformAPI.getSystemInfo({success:function(e){logger.info(JSON.stringify(e,null,4));var i={$manufacturer:e.brand,$model:e.model,$screen_width:Number(e.screenWidth),$screen_height:Number(e.screenHeight),$os:e.platform,$os_version:e.system};_.extend(t.properties,i),_.setMpPlatform(e.mp_platform)},complete:function(){e()}})}})}},ThinkingDataPersistence=function(){function ThinkingDataPersistence(e,t){var i=this;_classCallCheck(this,ThinkingDataPersistence),this.enabled=e.enablePersistence,this.enabled?(e.isChildInstance?(this.name=e.persistenceName+"_"+e.name,this.nameOld=e.persistenceNameOld+"_"+e.name):(this.name=e.persistenceName,this.nameOld=e.persistenceNameOld),e.asyncPersistence?(this._state={},PlatformAPI.getStorage(this.name,!0,function(n){_.isEmptyObject(n)?PlatformAPI.getStorage(i.nameOld,!0,function(n){i._state=_.extend2Layers({},n,i._state),i._init(e,t),i._save()}):(i._state=_.extend2Layers({},n,i._state),i._init(e,t),i._save())})):(this._state=PlatformAPI.getStorage(this.name)||{},_.isEmptyObject(this._state)&&(this._state=PlatformAPI.getStorage(this.nameOld)||{}),this._init(e,t))):(this._state={},this._init(e,t))}return _createClass(ThinkingDataPersistence,[{key:"_init",value:function(e,t){this.getDistinctId()||this.setDistinctId(_.UUID()),e.isChildInstance||this.getDeviceId()||this._setDeviceId(_.UUID()),this.initComplete=!0,"function"==typeof t&&t(),this._save()}},{key:"_save",value:function(){this.enabled&&this.initComplete&&PlatformAPI.setStorage(this.name,JSON.stringify(this._state))}},{key:"_set",value:function(e,t){var i,n=this;"string"==typeof e?(i={})[e]=t:"object"===_typeof(e)&&(i=e),_.each(i,function(e,t){n._state[t]=e}),this._save()}},{key:"_get",value:function(e){return this._state[e]}},{key:"setEventTimer",value:function(e,t){var i=this._state.event_timers||{};i[e]=t,this._set("event_timers",i)}},{key:"removeEventTimer",value:function(e){var t=(this._state.event_timers||{})[e];return _.isUndefined(t)||(delete this._state.event_timers[e],this._save()),t}},{key:"getDeviceId",value:function(){return this._state.device_id}},{key:"_setDeviceId",value:function(e){this.getDeviceId()?logger.warn("cannot modify the device id."):this._set("device_id",e)}},{key:"getDistinctId",value:function(){return this._state.distinct_id}},{key:"setDistinctId",value:function(e){this._set("distinct_id",e)}},{key:"getAccountId",value:function(){return this._state.account_id}},{key:"setAccountId",value:function(e){this._set("account_id",e)}},{key:"getSuperProperties",value:function(){return this._state.props||{}}},{key:"setSuperProperties",value:function(e,t){var i=t?e:_.extend(this.getSuperProperties(),e);this._set("props",i)}}]),ThinkingDataPersistence}();function getPlatFormName(){return PlatformAPI.getConfig().persistenceNameOld}var ThinkingDataAPI=function(){function ThinkingDataAPI(e){_classCallCheck(this,ThinkingDataAPI),e.appId=e.clientId?_.checkAppId(e.clientId):_.checkAppId(e.appid),e.accessToken=e.accessToken,e.serverUrl="https://turbo.api.plutus-cat.com/event_center/api/v1/eventv2/collect/?access_token=".concat(e.accessToken);var t=_.extend({},DEFAULT_CONFIG,PlatformAPI.getConfig());_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)}return _createClass(ThinkingDataAPI,[{key:"_init",value:function(e){var t=this;this.name=e.name,this.appId=e.clientId||e.appid,this.accessToken=e.accessToken;var i=e.serverUrl||e.server_url;this.serverUrl=i,this.serverDebugUrl=i+"/data_debug",this.configUrl=i+"/config",this.autoTrackProperties={},this._queue=[],this.config.syncBatchSize=100,this.config.syncInterval=60,e.isChildInstance?this._state={}:(logger.enabled=e.enableLog,this.instances=[],this._state={getSystemInfo:!1,initComplete:!1},systemInformation.getSystemInfo(function(){t._updateState({getSystemInfo:!0})}),PlatformAPI.setGlobal(this,this.name)),this.store=new ThinkingDataPersistence(e,function(){t.config.asyncPersistence&&_.isFunction(t.config.persistenceComplete)&&t.config.persistenceComplete(t),t._updateState()}),this.enabled=!_.isBoolean(this.store._get("ta_enabled"))||this.store._get("ta_enabled"),this.isOptOut=!!_.isBoolean(this.store._get("ta_isOptOut"))&&this.store._get("ta_isOptOut"),"GravityEngine_wechat_game"===getPlatFormName()&&e.autoTrack.appLaunch&&this.track("$MPLaunch",{$url_query:this.setQuery(this.getQuery()),$scene:PlatformAPI.getAppOptions().scene}),!e.isChildInstance&&e.autoTrack&&(this.autoTrack=PlatformAPI.initAutoTrackInstance(this,e))}},{key:"updateConfig",value:function(e,t){}},{key:"initInstance",value:function(e,t){if(this.config.isChildInstance)logger.warn("initInstance() cannot be called on child instance");else{if(_.isString(e)&&e!==this.name&&_.isUndefined(this[e])){var i=new ThinkingDataAPI(_.extend({},this.config,{enablePersistence:!1,isChildInstance:!0,name:e},t));return this[e]=i,this.instances.push(e),this[e]._state=this._state,i}logger.warn("initInstance() failed due to the name is invalid: "+e)}}},{key:"lightInstance",value:function(e){return this[e]}},{key:"_setAutoTrackProperties",value:function(e){_.extend(this.autoTrackProperties,e)}},{key:"init",value:function(){if(this._state.initComplete)return!1;this._updateState({initComplete:!0})}},{key:"_isReady",value:function(){return this._state.getSystemInfo&&this._state.initComplete&&this.store.initComplete}},{key:"_updateState",value:function(e){var t=this;_.isObject(e)&&_.extend(this._state,e),this._onStateChange(),_.each(this.instances,function(e){t[e]._onStateChange()})}},{key:"_onStateChange",value:function(){var e=this;this._isReady()&&this._queue&&this._queue.length>0&&(_.each(this._queue,function(t){e[t[0]].apply(e,slice.call(t[1]))}),this._queue=[])}},{key:"_hasDisabled",value:function(){var e=!this.enabled||this.isOptOut;return e&&logger.info("ThinkingData is Pause or Stop!"),e}},{key:"_sendRequest",value:function(e,t,i){if(!this._hasDisabled())if(_.isUndefined(this.config.disableEventList)||!this.config.disableEventList.includes(e.eventName)){t=_.isDate(t)?t:new Date;var n={event_list:[{type:e.type,time:Date.now()}]};if(n.event_list[0].event=e.eventName,"track"===e.type){n.event_list[0].properties=_.extend({},systemInformation.properties,this.autoTrackProperties,this.store.getSuperProperties(),this.dynamicProperties?this.dynamicProperties():{});var r=this.store.removeEventTimer(e.eventName);if(!_.isUndefined(r)){var a=(new Date).getTime()-r,s=parseFloat((a/1e3).toFixed(3));s>86400?s=86400:s<0&&(s=0),n.event_list[0].properties.$event_duration=s}}else n.event_list[0].properties={};_.isObject(e.properties)&&!_.isEmptyObject(e.properties)&&_.extend(n.event_list[0].properties,e.properties),_.searchObjDate(n.event_list[0]),n.client_id=this.appId,logger.info(JSON.stringify(n,null,4));var o="debug"===this.config.debugMode||"debugOnly"===this.config.debugMode?this.serverDebugUrl:this.serverUrl;if(_.isBoolean(this.config.enableEncrypt)&&1==this.config.enableEncrypt&&(n.event_list[0]=_.generateEncryptyData(n.event_list[0],void 0)),i){var c=new FormData;if("debug"===this.config.debugMode||"debugOnly"===this.config.debugMode)c.append("source","client"),c.append("appid",this.appId),c.append("dryRun","debugOnly"===this.config.debugMode?1:0),c.append("deviceId",this.getDeviceId()),c.append("data",JSON.stringify(n.event_list[0]));else{var u=_.base64Encode(JSON.stringify(n));c.append("data",u)}navigator.sendBeacon(o,c),_.isFunction(e.onComplete)&&e.onComplete({statusCode:200})}else senderQueue.enqueue(n,o,{maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:e.onComplete,debugMode:this.config.debugMode,deviceId:this.getDeviceId()})}else logger.info("disabled Event : "+e.eventName)}},{key:"_isObjectParams",value:function(e){return _.isObject(e)&&_.isFunction(e.onComplete)}},{key:"track",value:function(e,t,i,n){if(!this._hasDisabled()){if(this._isObjectParams(e)){var r=e;e=r.eventName,t=r.properties,i=r.time,n=r.onComplete}PropertyChecker.event(e)&&PropertyChecker.properties(t)||!this.config.strict?this._internalTrack(e,t,i,n):_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})}}},{key:"trackUpdate",value:function(e){if(!this._hasDisabled())if(e&&e.eventId&&(PropertyChecker.event(e.eventName)&&PropertyChecker.properties(e.properties)||!this.config.strict)){var t=_.isDate(e.time)?e.time:new Date;this._isReady()?this._sendRequest({type:"track_update",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,extraId:e.eventId},t):(e.time=t,this._queue.push(["trackUpdate",[e]]))}else logger.warn("Invalide parameter for trackUpdate: you should pass an object contains eventId to trackUpdate()"),_.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})}},{key:"trackOverwrite",value:function(e){if(!this._hasDisabled())if(e&&e.eventId&&(PropertyChecker.event(e.eventName)&&PropertyChecker.properties(e.properties)||!this.config.strict)){var t=_.isDate(e.time)?e.time:new Date;this._isReady()?this._sendRequest({type:"track_overwrite",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,extraId:e.eventId},t):(e.time=t,this._queue.push(["trackOverwrite",[e]]))}else logger.warn("Invalide parameter for trackOverwrite: you should pass an object contains eventId to trackOverwrite()"),_.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})}},{key:"trackFirstEvent",value:function(e){if(!this._hasDisabled())if(e&&e.eventName&&(PropertyChecker.event(e.eventName)&&PropertyChecker.properties(e.properties)||!this.config.strict)){var t=_.isDate(e.time)?e.time:new Date;this._isReady()?this._sendRequest({type:"track",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,firstCheckId:e.firstCheckId?e.firstCheckId:this.getDeviceId()},t):(e.time=t,this._queue.push(["trackFirstEvent",[e]]))}else logger.warn("Invalide parameter for trackFirstEvent: you should pass an object contains eventName to trackFirstEvent()"),_.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})}},{key:"_internalTrack",value:function(e,t,i,n,r){this._hasDisabled()||(i=_.isDate(i)?i:new Date,this._isReady()?this._sendRequest({type:"track",eventName:e,properties:t,onComplete:n},i,r):this._queue.push(["_internalTrack",[e,t,i,n]]))}},{key:"userSet",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_set",properties:e,onComplete:i},t):this._queue.push(["userSet",[e,t,i]])):(logger.warn("calling userSet failed due to invalid arguments"),_.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"userSetOnce",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_set_once",properties:e,onComplete:i},t):this._queue.push(["userSetOnce",[e,t,i]])):(logger.warn("calling userSetOnce failed due to invalid arguments"),_.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"userAdd",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_increment",properties:e,onComplete:i},t):this._queue.push(["userAdd",[e,t,i]])):(logger.warn("calling userAdd failed due to invalid arguments"),_.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"userDel",value:function(e,t){var i={};if(!this._hasDisabled()){if(this._isObjectParams(i)){var n=i;i=n.properties,e=n.time,t=n.onComplete}PropertyChecker.propertiesMust(i)||!this.config.strict?(e=_.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_delete",properties:i,onComplete:t},e):this._queue.push(["userDel",[i,e,t]])):(logger.warn("calling userDel failed due to invalid arguments"),_.isFunction(t)&&t({code:-1,msg:"invalid parameters"}))}}},{key:"userAppend",value:function(e,t,i){if(!this._hasDisabled()){if(this._isObjectParams(e)){var n=e;e=n.properties,t=n.time,i=n.onComplete}PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_append",properties:e,onComplete:i},t):this._queue.push(["userAppend",[e,t,i]])):(logger.warn("calling userAppend failed due to invalid arguments"),_.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"userUnset",value:function(e,t,i){var n=_defineProperty({},e,null);if(!this._hasDisabled()){if(this._isObjectParams(n)){var r=n;n=r.properties,t=r.time,i=r.onComplete}PropertyChecker.propertiesMust(n)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_unset",properties:n,onComplete:i},t):this._queue.push(["userUnset",[n,t,i]])):(logger.warn("calling userUnset failed due to invalid arguments"),_.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}}},{key:"logoutEvent",value:function(){this.track("$MPLogout",{})}},{key:"loginEvent",value:function(){this.track("$MPLogin",{})}},{key:"registerEvent",value:function(){this.track("$MPRegister",{})}},{key:"getQuery",value:function(){return PlatformAPI.getAppOptions().query||{}}},{key:"setQuery",value:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}},{key:"getPlatForm",value:function(){var e=this.getQuery();return e.ksUnitId||e.ksCampaignId||e.ksChannel?"kuaishou":e.clue_token||e.ad_id||e.creative_id||e.request_id||e.advertiser_id?"bytedance":e.gdt_vid?"tencent":""}},{key:"sendNetWork",value:function(e,t){return new Promise(function(i,n){PlatformAPI.request({url:e,method:"POST",data:t,header:{"content-type":"application/json"},success:function(e){200!==e.statusCode?n(e):i(e.data)},fail:function(e){n(e)}})})}},{key:"register",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._isReady()){if(null==e||!e.name)throw new Error("name must be required");if(null==e||!e.channel)throw new Error("channel must be required");if((null==e||!e.version)&&0!==(null==e?void 0:e.version))throw new Error("version must be required");if(!_.isNumber(null==e?void 0:e.version)||"number"!=typeof(null==e?void 0:e.version))throw new Error("version must be type: Number");var t=this.getPlatForm(),i={client_id:this.appId,name:e.name,channel:e.channel,version:e.version,media_type:t||"tencent",wx_openid:(null==e?void 0:e.wx_openid)||"",wx_unionid:(null==e?void 0:e.wx_unionid)||"",click_id:(null==e?void 0:e.click_id)||"",ad_data:{}},n=this.getQuery();"kuaishou"===t?i.ad_data={callback:(null==n?void 0:n.callback)||"",ksCampaignId:(null==n?void 0:n.ksCampaignId)||"",ksUnitId:(null==n?void 0:n.ksUnitId)||"",ksCreativeId:(null==n?void 0:n.ksCreativeId)||"",ksChannel:(null==n?void 0:n.ksChannel)||""}:"bytedance"===t?i.ad_data={clue_token:(null==n?void 0:n.clue_token)||"",ad_id:(null==n?void 0:n.ad_id)||"",creative_id:(null==n?void 0:n.creative_id)||"",advertiser_id:(null==n?void 0:n.advertiser_id)||"",request_id:(null==n?void 0:n.request_id)||"",req_id:(null==n?void 0:n.req_id)||"",project_id:(null==n?void 0:n.project_id)||"",promotion_id:(null==n?void 0:n.promotion_id)||"",mid1:(null==n?void 0:n.mid1)||"",mid2:(null==n?void 0:n.mid2)||"",mid3:(null==n?void 0:n.mid3)||"",mid4:(null==n?void 0:n.mid4)||"",mid5:(null==n?void 0:n.mid5)||""}:"tencent"===t&&(i.ad_data={gdt_vid:(null==n?void 0:n.gdt_vid)||""}),null!=n&&n.turbo_promoted_object_id&&(i.promoted_object_id=n.turbo_promoted_object_id);var r="".concat(Config.BASE_URL,"/user/register/?access_token=").concat(this.accessToken);return this.sendNetWork(r,i)}}},{key:"handleEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._isReady()){var t={event_type:e.event_type};if(null!=e&&e.properties&&(t.properties=e.properties),t.use_client_time=(null==e?void 0:e.use_client_time)||!1,t.use_client_time&&(null==e||!e.timestamp))throw new Error("timestamp must be required");null!=e&&e.timestamp&&(t.timestamp=e.timestamp),null!=e&&e.trace_id&&(t.trace_id=e.trace_id),t.timestamp=(null==e?void 0:e.timestamp)||(new Date).getTime();var i="".concat(Config.BASE_URL,"/event/handle_event/?access_token=").concat(this.accessToken,"&client_id=").concat(this.appId);return this.sendNetWork(i,t)}}},{key:"getUser",value:function(){if(this._isReady()){var e={user_list:[this.appId]},t="".concat(Config.BASE_URL,"/user/get/?access_token=").concat(this.accessToken);return this.sendNetWork(t,e)}}},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setDistinctId(e)}}},{key:"getDistinctId",value:function(){return this.store.getDistinctId()}},{key:"login",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setAccountId(e)}}},{key:"getAccountId",value:function(){return this.store.getAccountId()}},{key:"logout",value:function(){this._hasDisabled()||this.store.setAccountId(null)}},{key:"setSuperProperties",value:function(e){this._hasDisabled()||(PropertyChecker.propertiesMust(e)||!this.config.strict?this.store.setSuperProperties(e):logger.warn("setSuperProperties parameter must be a valid property value"))}},{key:"registerApp",value:function(e){this.setSuperProperties(e)}},{key:"clearSuperProperties",value:function(){this._hasDisabled()||this.store.setSuperProperties({},!0)}},{key:"unsetSuperProperty",value:function(e){if(!this._hasDisabled()&&_.isString(e)){var t=this.getSuperProperties();delete t[e],this.store.setSuperProperties(t,!0)}}},{key:"getSuperProperties",value:function(){return this.store.getSuperProperties()}},{key:"getPresetProperties",value:function(){var e=systemInformation.properties,t={},i=e.$os;t.os=_.isUndefined(i)?"":i;var n=e.$screen_width;t.screenWidth=_.isUndefined(n)?0:n;var r=e.$screen_height;t.screenHeight=_.isUndefined(r)?0:r;var a=e.$network_type;t.networkType=_.isUndefined(a)?"":a;var s=e.$model;t.deviceModel=_.isUndefined(s)?"":s;var o=e.$os_version;t.osVersion=_.isUndefined(o)?"":o,t.deviceId=this.getDeviceId();var c=0-(new Date).getTimezoneOffset()/60;t.zoneOffset=c;var u=e.$manufacturer;return t.manufacturer=_.isUndefined(u)?"":u,t.toEventPresetProperties=function(){return{$app_id:this.appId,$model:t.deviceModel,$screen_width:t.screenWidth,$screen_height:t.screenHeight,$os:t.os,$os_version:t.osVersion,$network_type:t.networkType,$manufacturer:t.manufacturer}},t}},{key:"setDynamicSuperProperties",value:function(e){this._hasDisabled()||("function"==typeof e?PropertyChecker.properties(e())||!this.config.strict?this.dynamicProperties=e:logger.warn("A dynamic public property must return a valid property value"):logger.warn("setDynamicSuperProperties parameter must be a function type"))}},{key:"timeEvent",value:function(e,t){this._hasDisabled()||(t=_.isDate(t)?t:new Date,this._isReady()?PropertyChecker.event(e)||!this.config.strict?this.store.setEventTimer(e,t.getTime()):logger.warn("calling timeEvent failed due to invalid eventName: "+e):this._queue.push(["timeEvent",[e,t]]))}},{key:"getDeviceId",value:function(){return systemInformation.properties.$device_id}},{key:"enableTracking",value:function(e){this.enabled=e,this.store._set("ta_enabled",e)}},{key:"optOutTracking",value:function(){this.store.setSuperProperties({},!0),this.store.setDistinctId(_.UUID()),this.store.setAccountId(null),this._queue.splice(0,this._queue.length),this.isOptOut=!0,this.store._set("ta_isOptOut",!0)}},{key:"optOutTrackingAndDeleteUser",value:function(){var e=new Date;this._sendRequest({type:"user_del"},e),this.optOutTracking()}},{key:"optInTracking",value:function(){this.isOptOut=!1,this.store._set("ta_isOptOut",!1)}},{key:"setTrackStatus",value:function(e){switch(e){case"PAUSE":this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!1);break;case"STOP":this.eventSaveOnly=!1,this.optOutTracking(!0);break;case"SAVE_ONLY":case"NORMAL":default:this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!0)}}}]),ThinkingDataAPI}(),DEFAULT_CONFIG$1={name:"GravityEngine",enableLog:!0,enableNative:!1},ThinkingDataAPIForNative=function(){function ThinkingDataAPIForNative(e){_classCallCheck(this,ThinkingDataAPIForNative),e.appId=e.clientId?_.checkAppId(e.clientId):_.checkAppId(e.appid),e.accessToken=e.accessToken,e.serverUrl="https://turbo.api.plutus-cat.com/event_center/api/v1/eventv2/collect/?access_token=".concat(e.accessToken);var t=_.extend({},DEFAULT_CONFIG$1);_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)}return _createClass(ThinkingDataAPIForNative,[{key:"_isNativePlatform",value:function(){return!(_.isUndefined(this.nativeProxy)||!this._isIOS()&&!this._isAndroid()||!this.config.enableNative)}},{key:"_isIOS",value:function(){return"Conch-ios"===conchConfig.getOS()}},{key:"_isAndroid",value:function(){return"Conch-android"===conchConfig.getOS()}},{key:"_init",value:function(e){this.name=e.name,this.appId=e.clientId||e.appid,this.accessToken=e.accessToken;var t=e.serverUrl||e.server_url;this.serverUrl=t,this.serverDebugUrl=t+"/data_debug",this.configUrl=t+"/config";try{this._isIOS()?this.nativeProxy=PlatformClass.createClass("LayaProxyApi"):this._isAndroid()&&(this.nativeProxy=PlatformClass.createClass("demo.LayaProxyApi"))}catch(e){console.log("[laya log] native createClass failed, err = "+e)}finally{this._isNativePlatform()?(this.initInstanceForNative(this.name,e,this.appId),this._readStorage(e)):this.taJs=new ThinkingAnalyticsAPIForJS(e)}}},{key:"_readStorage",value:function(e){var t=this,i=e.persistenceName,n=e.persistenceNameOld;e.isChildInstance&&(i=e.persistenceName+"_"+e.name,n=e.persistenceNameOld+"_"+e.name),this._state=PlatformAPI.getStorage(i)||{},_.isEmptyObject(this._state)&&(this._state=PlatformAPI.getStorage(n)||{}),_.isEmptyObject(this._state)?PlatformAPI.getStorage(i,!0,function(e){_.isEmptyObject(e)?PlatformAPI.getStorage(n,!0,function(e){t._state=_.extend2Layers({},e,t._state)}):t._state=_.extend2Layers({},e,t._state),t._state.distinct_id&&t.identifyForNative(t._state.distinct_id),t._state.account_id&&t.loginForNative(t._state.account_id)}):(this._state.distinct_id&&this.identifyForNative(this._state.distinct_id),this._state.account_id&&this.loginForNative(this._state.account_id))}},{key:"initInstance",value:function(e,t){return this._isNativePlatform()?(_.isUndefined(t)?this[e]=new ThinkingAnalyticsAPI(this.config):this[e]=new ThinkingAnalyticsAPI(t),this[e]):(this[e]=this.taJs.initInstance(e,t),this[e])}},{key:"lightInstance",value:function(e){return this[e]}},{key:"init",value:function(){if(this._isNativePlatform()){var e=window,t=this;return e.__autoTrackCallback=function(e){if(_.isFunction(t.config.autoTrack.callback)){var i=t.config.autoTrack.callback(e);return JSON.stringify(i)}return"{}"},void this.startThinkingAnalyticsForNative()}this.taJs.init()}},{key:"track",value:function(e,t,i,n){this._isNativePlatform()?this.trackForNative(e,t,i,this.appId):this.taJs.track(e,t,i,n)}},{key:"trackUpdate",value:function(e){this._isNativePlatform()?this.trackUpdateForNative(e,this.appId):this.taJs.trackUpdate(e)}},{key:"trackOverwrite",value:function(e){this._isNativePlatform()?this.trackOverwriteForNative(e,this.appId):this.taJs.trackOverwrite(e)}},{key:"trackFirstEvent",value:function(e){this._isNativePlatform()?this.trackFirstEventForNative(e,this.appId):this.taJs.trackFirstEvent(e)}},{key:"register",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._isNativePlatform())return this.taJs.register(e)}},{key:"handleEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._isNativePlatform())return this.taJs.handleEvent(e)}},{key:"getUser",value:function(){if(!this._isNativePlatform())return this.taJs.getUser()}},{key:"registerApp",value:function(e){if(!this._isNativePlatform())return this.taJs.registerApp(e)}},{key:"registerEvent",value:function(){if(!this._isNativePlatform())return this.taJs.registerEvent()}},{key:"loginEvent",value:function(){if(!this._isNativePlatform())return this.taJs.loginEvent()}},{key:"logoutEvent",value:function(){if(!this._isNativePlatform())return this.taJs.logoutEvent()}},{key:"userSet",value:function(e,t,i){this._isNativePlatform()?this.userSetForNative(e,this.appId):this.taJs.userSet(e,t,i)}},{key:"userSetOnce",value:function(e,t,i){this._isNativePlatform()?this.userSetOnceForNative(e,this.appId):this.taJs.userSetOnce(e,t,i)}},{key:"userUnset",value:function(e,t,i){this._isNativePlatform()?this.userUnsetForNative(e,this.appId):this.taJs.userUnset(e,t,i)}},{key:"userDel",value:function(e,t){this._isNativePlatform()?this.userDelForNative(this.appId):this.taJs.userDel(e,t)}},{key:"userAdd",value:function(e,t,i){this._isNativePlatform()?this.userAddForNative(e,this.appId):this.taJs.userAdd(e,t,i)}},{key:"userAppend",value:function(e,t,i){this._isNativePlatform()?this.userAppendForNative(e,this.appId):this.taJs.userAppend(e,t,i)}},{key:"userUniqAppend",value:function(e,t,i){this._isNativePlatform()?this.userUniqAppendForNative(e,this.appId):this.taJs.userUniqAppend(e,t,i)}},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){this._isNativePlatform()?this.identifyForNative(e,this.appId):this.taJs.identify(e)}},{key:"getDistinctId",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getDistinctIdForNative(e,this.appId);e(this.taJs.getDistinctId())}return this.taJs.getDistinctId()}},{key:"login",value:function(e){this._isNativePlatform()?this.loginForNative(e,this.appId):this.taJs.login(e)}},{key:"getAccountId",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getAccountIdForNative(e,this.appId);e(this.taJs.getAccountId())}return this.taJs.getAccountId()}},{key:"logout",value:function(){this._isNativePlatform()?this.logoutForNative(this.appId):this.taJs.logout()}},{key:"setSuperProperties",value:function(e){this._isNativePlatform()?this.setSuperPropertiesForNative(e,this.appId):this.taJs.setSuperProperties(e)}},{key:"clearSuperProperties",value:function(){this._isNativePlatform()?this.clearSuperPropertiesForNative(this.appId):this.taJs.clearSuperProperties()}},{key:"unsetSuperProperty",value:function(e){this._isNativePlatform()?this.unsetSuperPropertyForNative(e,this.appId):this.taJs.unsetSuperProperty(e)}},{key:"getSuperProperties",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getSuperPropertiesForNative(e,this.appId);e(this.taJs.getSuperProperties())}return this.taJs.getSuperProperties()}},{key:"getPresetProperties",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getPresetPropertiesForNative(e,this.appId);e(this.taJs.getPresetProperties())}return this.taJs.getPresetProperties()}},{key:"setDynamicSuperProperties",value:function(e){this._isNativePlatform()?"function"==typeof e?this.dynamicProperties=e:logger.warn("setDynamicSuperProperties parameter must be a function type"):this.taJs.setDynamicSuperProperties(e)}},{key:"timeEvent",value:function(e,t){return this._isNativePlatform()?this.timeEventForNative(e,this.appId):this.taJs.timeEvent(e,t)}},{key:"getDeviceId",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getDeviceIdForNative(e,this.appId);e(this.taJs.getDeviceId())}return this.taJs.getDeviceId()}},{key:"enableTracking",value:function(e){this._isNativePlatform()?this.enableTrackingForNative(e,this.appId):this.taJs.enableTracking(e)}},{key:"optOutTracking",value:function(){this._isNativePlatform()?this.optOutTrackingForNative(this.appId):this.taJs.optOutTracking()}},{key:"optOutTrackingAndDeleteUser",value:function(){this._isNativePlatform()?this.optOutTrackingAndDeleteUserForNative(this.appId):this.taJs.optOutTrackingAndDeleteUser()}},{key:"optInTracking",value:function(){this._isNativePlatform()?this.optInTrackingForNative(this.appId):this.taJs.optInTracking()}},{key:"setTrackStatus",value:function(e){this._isNativePlatform()?this.setTrackStatusForNative(e,this.appId):this.taJs.setTrackStatus(e)}},{key:"trackForNative",value:function(e,t,i,n){var r=_.isDate(i)?_.formatDate(i):"";e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?{}:t,r=_.isUndefined(r)?"":r,n=_.isUndefined(n)?"":n;var a=_.extend(t,this.dynamicProperties?this.dynamicProperties():{});a=_.encodeDates(a),this._isIOS()?this.nativeProxy.call("track:properties:time:appId:",e,JSON.stringify(a),r,n):this._isAndroid()&&this.nativeProxy.call("track",e,JSON.stringify(a),r,n)}},{key:"trackUpdateForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e.properties=_.extend(_.isUndefined(e.properties)?{}:e.properties,this.dynamicProperties?this.dynamicProperties():{}),e.properties=_.encodeDates(e.properties),this._isIOS()?this.nativeProxy.call("trackUpdate:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("trackUpdate",JSON.stringify(e),t)}},{key:"trackFirstEventForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e.properties=_.extend(_.isUndefined(e.properties)?{}:e.properties,this.dynamicProperties?this.dynamicProperties():{}),e.properties=_.encodeDates(e.properties),this._isIOS()?this.nativeProxy.call("trackFirstEvent:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("trackFirstEvent",JSON.stringify(e),t)}},{key:"trackOverwriteForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e.properties=_.extend(_.isUndefined(e.properties)?{}:e.properties,this.dynamicProperties?this.dynamicProperties():{}),e.properties=_.encodeDates(e.properties),this._isIOS()?this.nativeProxy.call("trackOverwrite:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("trackOverwrite",JSON.stringify(e),t)}},{key:"timeEventForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("timeEvent:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("timeEvent",e,t)}},{key:"loginForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("login:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("login",e,t)}},{key:"logoutForNative",value:function(e){e=_.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("logout:",e):this._isAndroid()&&this.nativeProxy.call("logout",e)}},{key:"setSuperPropertiesForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e),this._isIOS()?this.nativeProxy.call("setSuperProperties:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("setSuperProperties",JSON.stringify(e),t)}},{key:"getSuperPropertiesForNative",value:function(e,t){t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack(function(t){e(JSON.parse(t))},"getSuperProperties:",t):this._isAndroid()&&this.nativeProxy.callWithBack(function(t){e(JSON.parse(t))},"getSuperProperties",t)}},{key:"unsetSuperPropertyForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("unsetSuperProperty:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("unsetSuperProperty",e,t)}},{key:"clearSuperPropertiesForNative",value:function(e){e=_.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("clearSuperProperties:",e):this._isAndroid()&&this.nativeProxy.call("clearSuperProperties",e)}},{key:"userSetForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e),this._isIOS()?this.nativeProxy.call("userSet:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userSet",JSON.stringify(e),t)}},{key:"userSetOnceForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e),this._isIOS()?this.nativeProxy.call("userSetOnce:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userSetOnce",JSON.stringify(e),t)}},{key:"userAppendForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e),this._isIOS()?this.nativeProxy.call("userAppend:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userAppend",JSON.stringify(e),t)}},{key:"userUniqAppendForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e),this._isIOS()?this.nativeProxy.call("userUniqAppend:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userUniqAppend",JSON.stringify(e),t)}},{key:"userAddForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e),this._isIOS()?this.nativeProxy.call("userAdd:appId:",JSON.stringify(e),t):this._isAndroid()&&this.nativeProxy.call("userAdd",JSON.stringify(e),t)}},{key:"userUnsetForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("userUnset:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("userUnset",e,t)}},{key:"userDelForNative",value:function(e){e=_.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("userDel:",e):this._isAndroid()&&this.nativeProxy.call("userDel",e)}},{key:"authorizeOpenIDForNative",value:function(e,t){this.identifyForNative(e,t)}},{key:"identifyForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("identify:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("identify",e,t)}},{key:"initInstanceForNative",value:function(e,t,i){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?{}:t,i=_.isUndefined(i)?"":i,this._isIOS()?(this.nativeProxy.call("setCustomerLibInfoWithLibName:libVersion:",Config.LIB_NAME,Config.LIB_VERSION),_.isUndefined(t)?this.nativeProxy.call("initInstance:appId:",e,i):this.nativeProxy.call("initInstance:config:",e,JSON.stringify(t))):this._isAndroid()&&(this.nativeProxy.call("setCustomerLibInfo",Config.LIB_NAME,Config.LIB_VERSION),_.isUndefined(t)?this.nativeProxy.call("initInstanceAppId",e,i):this.nativeProxy.call("initInstanceConfig",e,JSON.stringify(t)))}},{key:"lightInstanceForNative",value:function(e,t,i){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack(function(e){i(e)},"lightInstance:appId:",e,t):this._isAndroid()&&this.nativeProxy.callWithBack(function(e){i(e)},"lightInstance",e,t)}},{key:"startThinkingAnalyticsForNative",value:function(e){e=_.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("startThinkingAnalytics:",e):this._isAndroid()&&this.nativeProxy.call("startThinkingAnalytics",e)}},{key:"getDeviceIdForNative",value:function(e,t){t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack(function(t){e(t)},"getDeviceId:",t):this._isAndroid()&&this.nativeProxy.callWithBack(function(t){e(t)},"getDeviceId",t)}},{key:"getDistinctIdForNative",value:function(e,t){t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack(function(t){e(t)},"getDistinctId:",t):this._isAndroid()&&this.nativeProxy.callWithBack(function(t){e(t)},"getDistinctId",t)}},{key:"getAccountIdForNative",value:function(e,t){t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack(function(t){e(t)},"getAccountId:",t):this._isAndroid()&&this.nativeProxy.callWithBack(function(t){e(t)},"getAccountId",t)}},{key:"getPresetPropertiesForNative",value:function(e,t){function callWithBack(t){var i=JSON.parse(t),n={},r=i["#os"];n.os=_.isUndefined(r)?"":r;var a=i["#screen_width"];n.screenWidth=_.isUndefined(a)?0:a;var s=i["#screen_height"];n.screenHeight=_.isUndefined(s)?0:s;var o=i["#network_type"];n.networkType=_.isUndefined(o)?"":o;var c=i["#device_model"];n.deviceModel=_.isUndefined(c)?"":c;var u=i["#os_version"];n.osVersion=_.isUndefined(u)?"":u;var l=i["#device_id"];n.deviceId=_.isUndefined(l)?"":l;var p=i["#zone_offset"];n.zoneOffset=_.isUndefined(p)?"":p;var h=i["#manufacturer"];n.manufacturer=_.isUndefined(h)?"":h,n.toEventPresetProperties=function(){return{"#device_model":n.deviceModel,"#device_id":n.deviceId,"#screen_width":n.screenWidth,"#screen_height":n.screenHeight,"#os":n.os,"#os_version":n.osVersion,"#network_type":n.networkType,"#zone_offset":n.zoneOffset,"#manufacturer":n.manufacturer}},e(n)}t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.callWithBack(callWithBack,"getPresetProperties:",t):this._isAndroid()&&this.nativeProxy.callWithBack(callWithBack,"getPresetProperties",t)}},{key:"enableTrackingForNative",value:function(e,t){e=!_.isUndefined(e)&&e,t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("enableTracking:appId:",e.toString(),t):this._isAndroid()&&this.nativeProxy.call("enableTracking",e.toString(),t)}},{key:"optOutTrackingForNative",value:function(e){e=_.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("optOutTracking:",e):this._isAndroid()&&this.nativeProxy.call("optOutTracking",e)}},{key:"optOutTrackingAndDeleteUserForNative",value:function(e){e=_.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("optOutTrackingAndDeleteUser:",e):this._isAndroid()&&this.nativeProxy.call("optOutTrackingAndDeleteUser",e)}},{key:"optInTrackingForNative",value:function(e){e=_.isUndefined(e)?"":e,this._isIOS()?this.nativeProxy.call("optInTracking:",e):this._isAndroid()&&this.nativeProxy.call("optInTracking",e)}},{key:"setTrackStatusForNative",value:function(e,t){t=_.isUndefined(t)?"":t,this._isIOS()?this.nativeProxy.call("setTrackStatus:appId:",e,t):this._isAndroid()&&this.nativeProxy.call("setTrackStatus",e,t)}}]),ThinkingDataAPIForNative}();window.ThinkingAnalyticsAPI=ThinkingDataAPIForNative,window.ThinkingAnalyticsAPIForJS=ThinkingDataAPI,module.exports=ThinkingDataAPIForNative;