"use strict";function ownKeys(t,e){var n,i=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)),i}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _regeneratorRuntime(){_regeneratorRuntime=function(){return s};var s={},e=Object.prototype,c=e.hasOwnProperty,u=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},i=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",r=t.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function o(e,t,n,i){var r,a,s,o,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype),i=new b(i||[]);return u(t,"_invoke",{value:(r=e,a=n,s=i,o="suspendedStart",function(e,t){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===e)throw t;return S()}for(s.method=e,s.arg=t;;){var n=s.delegate;if(n){n=function e(t,n){var i=n.method,r=t.iterator[i];if(void 0===r)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=void 0,e(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;i=l(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,p;r=i.arg;return r?r.done?(n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,p):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}(n,s);if(n){if(n===p)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if("suspendedStart"===o)throw o="completed",s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);o="executing";n=l(r,a,s);if("normal"===n.type){if(o=s.done?"completed":"suspendedYield",n.arg===p)continue;return{value:n.arg,done:s.done}}"throw"===n.type&&(o="completed",s.method="throw",s.arg=n.arg)}})}),t}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}s.wrap=o;var p={};function f(){}function h(){}function d(){}var t={},g=(a(t,i,function(){return this}),Object.getPrototypeOf),g=g&&g(g(P([]))),m=(g&&g!==e&&c.call(g,i)&&(t=g),d.prototype=f.prototype=Object.create(t));function _(e){["next","throw","return"].forEach(function(t){a(e,t,function(e){return this._invoke(t,e)})})}function y(s,o){var t;u(this,"_invoke",{value:function(n,i){function e(){return new o(function(e,t){!function t(e,n,i,r){var a,e=l(s[e],s,n);if("throw"!==e.type)return(n=(a=e.arg).value)&&"object"==typeof n&&c.call(n,"__await")?o.resolve(n.__await).then(function(e){t("next",e,i,r)},function(e){t("throw",e,i,r)}):o.resolve(n).then(function(e){a.value=e,i(a)},function(e){return t("throw",e,i,r)});r(e.arg)}(n,i,e,t)})}return t=t?t.then(e,e):e()}})}function v(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(v,this),this.reset(!0)}function P(t){if(t){var n,e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:S}}function S(){return{value:void 0,done:!0}}return u(m,"constructor",{value:h.prototype=d,configurable:!0}),u(d,"constructor",{value:h,configurable:!0}),h.displayName=a(d,r,"GeneratorFunction"),s.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,r,"GeneratorFunction")),e.prototype=Object.create(m),e},s.awrap=function(e){return{__await:e}},_(y.prototype),a(y.prototype,n,function(){return this}),s.AsyncIterator=y,s.async=function(e,t,n,i,r){void 0===r&&(r=Promise);var a=new y(o(e,t,n,i),r);return s.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},_(m),a(m,r,"Generator"),a(m,i,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),s.keys=function(e){var t,n=Object(e),i=[];for(t in n)i.push(t);return i.reverse(),function e(){for(;i.length;){var t=i.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},s.values=P,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var i=this;function e(e,t){return a.type="throw",a.arg=n,i.next=e,t&&(i.method="next",i.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t],a=r.completion;if("root"===r.tryLoc)return e("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),o=c.call(r,"finallyLoc");if(s&&o){if(this.prev<r.catchLoc)return e(r.catchLoc,!0);if(this.prev<r.finallyLoc)return e(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return e(r.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return e(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var a=(r=r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc?null:r)?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,i,r=this.tryEntries[t];if(r.tryLoc===e)return"throw"===(n=r.completion).type&&(i=n.arg,k(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},s}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,n,i,r,a,s){try{var o=e[a](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(i,r)}function _asyncToGenerator(o){return function(){var e=this,s=arguments;return new Promise(function(t,n){var i=o.apply(e,s);function r(e){asyncGeneratorStep(i,t,n,r,a,"next",e)}function a(e){asyncGeneratorStep(i,t,n,r,a,"throw",e)}r(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _createForOfIteratorHelper(e,t){var n,i,r,a,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return i=!(n=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return n=e.done,e},e:function(e){i=!0,r=e},f:function(){try{n||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(e)||(s=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}var Config={LIB_VERSION:"3.4.4",LIB_NAME:"MG",LIB_STACK:"egret",BASE_URL:"https://backend.gravity-engine.com/event_center/api/v1"},_={},ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,nativeToString=ObjProto.toString,nativeHasOwnProperty=Object.prototype.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIsArray=Array.isArray,breaker={},logger=(_.isNumber=function(e){return"number"==typeof e?0==e-e:"string"==typeof e&&""!==e.trim()&&(Number.isFinite?Number.isFinite(+e):isFinite(+e))},_.each=function(e,t,n){if(null==e)return!1;if(nativeForEach&&e.forEach===nativeForEach)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,r=e.length;i<r;i++)if(i in e&&t.call(n,e[i],i,e)===breaker)return!1}else for(var a in e)if(nativeHasOwnProperty.call(e,a)&&t.call(n,e[a],a,e)===breaker)return!1},_.extend=function(n){return _.each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(n[t]=e[t])}),n},_.extend2Layers=function(n){return _.each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(_.isObject(e[t])&&_.isObject(n[t])?_.extend(n[t],e[t]):n[t]=e[t])}),n},_.isArray=nativeIsArray||function(e){return"[object Array]"===nativeToString.call(e)},_.isFunction=function(e){try{return"function"==typeof e}catch(e){return!1}},_.isPromise=function(e){return"[object Promise]"===nativeToString.call(e)&&null!=e},_.isObject=function(e){return"[object Object]"===nativeToString.call(e)&&null!=e},_.isEmptyObject=function(e){if(_.isObject(e)){for(var t in e)if(nativeHasOwnProperty.call(e,t))return!1;return!0}return!1},_.isUndefined=function(e){return void 0===e},_.isString=function(e){return"[object String]"===nativeToString.call(e)},_.isDate=function(e){return"[object Date]"===nativeToString.call(e)},_.isBoolean=function(e){return"[object Boolean]"===nativeToString.call(e)},_.isNumber=function(e){return"[object Number]"===nativeToString.call(e)&&/[\d\.]+/.test(String(e))},_.isJSONString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},_.decodeURIComponent=function(t){var n="";try{n=decodeURIComponent(t)}catch(e){n=t}return n},_.encodeURIComponent=function(t){var n="";try{n=encodeURIComponent(t)}catch(e){n=t}return n},_.utf8Encode=function(e){for(var t,n="",i=t=0,r=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,a=0;a<r;a++){var s=e.charCodeAt(a),o=null;s<128?t++:o=127<s&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(i<t&&(n+=e.substring(i,t)),n+=o,i=t=a+1)}return i<t&&(n+=e.substring(i,e.length)),n},_.base64Encode=function(e){var t,n,i,r,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,o=0,c="",u=[];if(!e)return e;for(e=_.utf8Encode(e);t=(r=e.charCodeAt(s++)<<16|e.charCodeAt(s++)<<8|e.charCodeAt(s++))>>12&63,n=r>>6&63,i=63&r,u[o++]=a.charAt(r>>18&63)+a.charAt(t)+a.charAt(n)+a.charAt(i),s<e.length;);switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},_.encodeDates=function(i){return _.each(i,function(e,t){if(_.isDate(e))i[t]=_.formatDate(e);else if(_.isObject(e))i[t]=_.encodeDates(e);else if(_.isArray(e))for(var n=0;n<e.length;n++)_.isDate(e[n])&&(i[t][n]=_.formatDate(e[n]))}),i},_.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+((e=e.getMilliseconds())<100&&9<e?"0"+e:e<10?"00"+e:e)},_.searchObjDate=function(n){try{(_.isObject(n)||_.isArray(n))&&_.each(n,function(e,t){_.isObject(e)||_.isArray(e)?_.searchObjDate(n[t]):_.isDate(e)&&(n[t]=_.formatDate(e))})}catch(e){logger.warn(e)}},_.UUID=function(){var e=(new Date).getTime();return String(Math.random()).replace(".","").slice(1,11)+"-"+e},_.UUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},_.setMpPlatform=function(e){_.mpPlatform=e},_.getMpPlatform=function(){return _.mpPlatform},_.createExtraHeaders=function(){return{"GE-Integration-Type":Config.LIB_NAME,"GE-Integration-Version":Config.LIB_VERSION,"GE-Integration-Count":"1","GE-Integration-Extra":_.getMpPlatform()}},_.checkAppId=function(e){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return"";return e=e.replace(/\s*/g,"")},_.checkUrl=function(e){return e=e.replace(/\s*/g,""),e=_.url("basic",e)},_.url=function(){function r(){return new RegExp(/(.*?)\.?([^.]*?)\.(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|net\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function a(e,t){var n=e.charAt(0),t=t.split(n);return n===e?t:t[(e=parseInt(e.substring(1),10))<0?t.length+e:e-1]}function s(e,t){for(var n,i=e.charAt(0),r=t.split("&"),a=[],s={},o=e.substring(1),c=0,u=r.length;c<u;c++)if(""!==(a=(a=r[c].match(/(.*?)=(.*)/))||[r[c],r[c],""])[1].replace(/\s/g,"")){if(a[2]=(n=a[2]||"",_.decodeURIComponent(n.replace(/\+/g," "))),o===a[1])return a[2];(n=a[1].match(/(.*)\[([0-9]+)\]/))?(s[n[1]]=s[n[1]]||[],s[n[1]][n[2]]=a[2]):s[a[1]]=a[2]}return i===e?s:s[o]}return function(e,t){var n,i={};if("tld?"===e)return r();if(t=t||window.location.toString(),!e)return t;if(e=e.toString(),t.match(/^mailto:([^/].+)/))n=t.match(/^mailto:([^/].+)/),i.protocol="mailto",i.email=n[1];else{if((t=t.match(/(.*?)\/#!(.*)/)?(n=t.match(/(.*?)\/#!(.*)/))[1]+n[2]:t).match(/(.*?)#(.*)/)&&(n=t.match(/(.*?)#(.*)/),i.hash=n[2],t=n[1]),i.hash&&e.match(/^#/))return s(e,i.hash);if(t.match(/(.*?)\?(.*)/)&&(n=t.match(/(.*?)\?(.*)/),i.query=n[2],t=n[1]),i.query&&e.match(/^\?/))return s(e,i.query);if(t.match(/(.*?):?\/\/(.*)/)&&(n=t.match(/(.*?):?\/\/(.*)/),i.protocol=n[1].toLowerCase(),t=n[2]),t.match(/(.*?)(\/.*)/)&&(n=t.match(/(.*?)(\/.*)/),i.path=n[2],t=n[1]),i.path=(i.path||"").replace(/^([^/])/,"/$1").replace(/\/$/,""),(e=e.match(/^[-0-9]+$/)?e.replace(/^([^/])/,"/$1"):e).match(/^\//))return a(e,i.path.substring(1));if((n=(n=a("/-1",i.path.substring(1)))&&n.match(/(.*?)\.(.*)/))&&(i.file=n[0],i.filename=n[1],i.fileext=n[2]),t.match(/(.*):([0-9]+)$/)&&(n=t.match(/(.*):([0-9]+)$/),i.port=n[2],t=n[1]),t.match(/(.*?)@(.*)/)&&(n=t.match(/(.*?)@(.*)/),i.auth=n[1],t=n[2]),i.auth&&(n=i.auth.match(/(.*):(.*)/),i.user=n?n[1]:i.auth,i.pass=n?n[2]:void 0),i.hostname=t.toLowerCase(),"."===e.charAt(0))return a(e,i.hostname);r()&&(n=i.hostname.match(r()))&&(i.tld=n[3],i.domain=n[2]?n[2]+"."+n[3]:void 0,i.sub=n[1]||void 0);t=i.port?":"+i.port:"";i.protocol=i.protocol||window.location.protocol.replace(":",""),i.port=i.port||("https"===i.protocol?"443":"80"),i.protocol=i.protocol||("443"===i.port?"https":"http"),i.basic=i.protocol+"://"+i.hostname+t}return e in i?i[e]:"{}"===e?i:""}}(),_.createString=function(e){for(var t=e,n=Math.random().toString(36).substr(2);n.length<t;)n+=Math.random().toString(36).substr(2);return n=n.substr(0,e)},_.createAesKey=function(){return _.createString(16)},_.setQuery=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")},_.generateEncryptyData=function(e,t){if(void 0!==t){var n=t.publicKey,t=t.version;if(void 0!==n&&void 0!==t&&"undefined"!=typeof CryptoJS&&"undefined"!=typeof JSEncrypt){var i=_.createAesKey();try{var r=CryptoJS.enc.Utf8.parse(i),a=CryptoJS.enc.Utf8.parse(JSON.stringify(e)),s=_.isUndefined(CryptoJS.pad.Pkcs7)?CryptoJS.pad.PKCS7:CryptoJS.pad.Pkcs7,o=CryptoJS.AES.encrypt(a,r,{mode:CryptoJS.mode.ECB,padding:s}).toString(),c=new JSEncrypt,u=(c.setPublicKey(n),c.encrypt(i));return!1===u?(logger.warn("私钥加密失败，返回原数据"),e):{pkv:t,ekey:u,payload:o}}catch(e){logger.warn("数据加密失败，返回原数据: "+e)}}}return e},"object"===_typeof(logger)?logger:{}),PlatformProxy=(logger.info=function(){if("object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&logger.enabled)try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}},logger.warn=function(){if("object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&logger.enabled)try{return console.warn.apply(console,arguments)}catch(e){console.warn(arguments[0])}},function(){function e(){_classCallCheck(this,e),this.config={persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_mg"}}return _createClass(e,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,n){e=localStorage.getItem(e);if(!t)return _.isJSONString(e)?JSON.parse(e):{};_.isJSONString(e)?n(JSON.parse(e)):n({})}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"_setSystemProxy",value:function(e){this._sysCallback=e}},{key:"getSystemInfo",value:function(e){var t={mp_platform:"web",system:this._getOs(),screenWidth:window.screen.width,screenHeight:window.screen.height,systemLanguage:navigator.language};this._sysCallback&&(t=_.extend(t,this._sysCallback(e))),e.success(t),e.complete()}},{key:"_getOs",value:function(){var e=navigator.userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"MacOS":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"ChromeOS":""}},{key:"getNetworkType",value:function(e){e.complete()}},{key:"onNetworkStatusChange",value:function(){}},{key:"request",value:function(e){var t={},n=new XMLHttpRequest;if(n.open(e.method,e.url),e.header)for(var i in e.header)n.setRequestHeader(i,e.header[i]);return n.onreadystatechange=function(){4===n.readyState&&200===n.status?(t.statusCode=200,_.isJSONString(n.responseText)&&(t.data=JSON.parse(n.responseText)),e.success(t)):200!==n.status&&(t.errMsg="network error",e.fail(t))},n.ontimeout=function(){t.errMsg="timeout",e.fail(t)},n.send(e.data),n}},{key:"initAutoTrackInstance",value:function(e,t){this.instance=e,this.autoTrack=t.autoTrack;var n=this;"onpagehide"in window?window.onpagehide=function(){n.onPageHide(!0)}:window.onbeforeunload=function(){n.onPageHide(!0)},n.onPageShow(),n.autoTrack.appHide&&n.instance.timeEvent("ta_page_hide"),"onvisibilitychange"in document&&(document.onvisibilitychange=function(){document.hidden?n.onPageHide(!1):(n.onPageShow(),n.autoTrack.appHide&&n.instance.timeEvent("ta_page_hide"))})}},{key:"setGlobal",value:function(e,t){window[t]=e}},{key:"getAppOptions",value:function(){}},{key:"showToast",value:function(){}},{key:"onPageShow",value:function(){var e;this.autoTrack.appShow&&(_.extend(e={},this.autoTrack.properties),_.isFunction(this.autoTrack.callback)&&_.extend(e,this.autoTrack.callback("appShow")),this.instance._internalTrack("ta_page_show",e))}},{key:"onPageHide",value:function(e){var t;this.autoTrack.appHide&&(_.extend(t={},this.autoTrack.properties),_.isFunction(this.autoTrack.callback)&&_.extend(t,this.autoTrack.callback("appHide")),this.instance._internalTrack("ta_page_hide",t,new Date,null,e))}}],[{key:"createInstance",value:function(){return new e}}]),e}()),AutoTrackBridge=function(){function n(e,t){_classCallCheck(this,n),this.taInstance=e,this.config=t||{},this.referrer="Directly open",this.config.isPlugin?(e.App=function(){App.apply(this,arguments)},inension(e.Page)):(t=App,App=this._initAppExtention(t),e=Page,Page=this._initPageExtension(e))}return _createClass(n,[{key:"_initPageExtension",value:function(a){var s=this;return function(e){var t=e.onLoad,n=e.onShow,i=e.onShareAppMessage,r={};return e.onLoad=function(e){r=e||{},"function"==typeof t&&t.call(this,e)},e.onShow=function(e){s.onPageShow(r),"function"==typeof n&&n.call(this,e)},"function"==typeof i&&(e.onShareAppMessage=function(e){e=i.call(this,e);return s.onPageShare(e)}),a(e)}}},{key:"_initAppExtention",value:function(r){var a=this;return function(e){var t=e.onLaunch,n=e.onShow,i=e.onHide;return e.onLaunch=function(e){a.onAppLaunch(e,this),"function"==typeof t&&t.call(this,e)},e.onShow=function(e){a.onAppShow(e),"function"==typeof n&&n.call(this,e)},e.onHide=function(){a.onAppHide(),"function"==typeof i&&i.call(this)},r(e)}}},{key:"onAppLaunch",value:function(e,t){this._setAutoTrackProperties(e),_.isUndefined(t)||(t[this.taInstance.name]=this.taInstance),this.config.appLaunch&&(t={},e&&e.path&&(t.$url_query=_.setQuery(e.query),t.$scene=String(e.scene)),this.taInstance._internalTrack("$MPLaunch",t))}},{key:"onAppShow",value:function(e){var t;this.config.appHide&&this.taInstance.timeEvent("$MPHide"),this._setAutoTrackProperties(e),this.config.appShow&&(t={},e&&e.path&&(t.$url_path=this._getPath(e.path),t.$url_query=_.setQuery(e.query),t.$scene=String(e.scene)),_.extend(t,this.config.properties),_.isFunction(this.config.callback)&&_.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("$MPShow",t))}},{key:"onAppHide",value:function(){var e;this.config.appHide&&(_.extend(e={},this.config.properties),_.isFunction(this.config.callback)&&_.extend(e,this.config.callback("appHide")),this.taInstance._internalTrack("$MPHide",e))}},{key:"_getCurrentPath",value:function(){var e="Not to get";try{var t=getCurrentPages(),e=t[t.length-1].route}catch(e){logger.info(e)}return e}},{key:"_setAutoTrackProperties",value:function(e){this.taInstance._setAutoTrackProperties({})}},{key:"_getPath",value:function(e){return"string"==typeof e?e.replace(/^\//,""):"Abnormal values"}},{key:"onPageShare",value:function(e){if(this.config.pageShare){var t=1;try{t=getCurrentPages().length}catch(e){t=1}this.taInstance._internalTrack("$MPShare",{$share_method:"转发消息卡片",$share_depth:t,$url_path:this._getCurrentPath()})}return _.isObject(e)?e:{}}},{key:"onPageShow",value:function(e){var t;this.config.pageShow&&(e={$url_path:(t=this._getCurrentPath())||"The system did not get a value",$url_query:_.setQuery(e)},this.referrer=t,this.taInstance._internalTrack("$MPViewScreen",e))}}]),n}(),AutoTrackBridge$1=function(){function r(e,t,n){var i=this,e=(_classCallCheck(this,r),this.taInstance=e,this.config=t||{},n.getLaunchOptionsSync());this._onShow(e),this.startTracked=!0,n.onShow(function(e){i._onShow(e)}),n.onHide(function(){var e;i.startTracked=!1,i.config.appHide&&(_.extend(e={},i.config.properties),_.isFunction(i.config.callback)&&_.extend(e,i.config.callback("appHide")),i.taInstance._internalTrack("$MPHide",e))})}return _createClass(r,[{key:"_onShow",value:function(e){var t;this.startTracked||(this.config.appHide&&this.taInstance.timeEvent("$MPHide"),this.config.appShow&&(_.extend(t={},this.config.properties),_.isFunction(this.config.callback)&&_.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("$MPShow",_objectSpread2(_objectSpread2({},t),{},{$scene:String(e.scene),$url_query:_.setQuery(PlatformAPI.getAppOptions().query)}))))}}]),r}(),PlatformProxy$1=function(){function i(e,t,n){_classCallCheck(this,i),this.api=e,this.config=t,this._config=n}return _createClass(i,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,n){if(!t)return"dd_mp"===this._config.platform?(t=this.api.getStorageSync({key:e}),_.isJSONString(t.data)?JSON.parse(t.data):{}):(t=this.api.getStorageSync(e),_.isJSONString(t)?JSON.parse(t):{});this.api.getStorage({key:e,success:function(e){e=_.isJSONString(e.data)?JSON.parse(e.data):{};n(e)},fail:function(){logger.warn("getStorage faild"),n({})}})}},{key:"setStorage",value:function(e,t){this.api.setStorage({key:e,data:t})}},{key:"_getPlatform",value:function(){return""}},{key:"getSystemInfo",value:function(t){var n=this._config.mpPlatform;this.api.getSystemInfo({success:function(e){_.isFunction(n)?e.mp_platform=n(e):e.mp_platform=n,t.success(e),"wechat"===n&&t.complete()},complete:function(){t.complete()}})}},{key:"getNetworkType",value:function(t){_.isFunction(this.api.getNetworkType)?this.api.getNetworkType({success:function(e){t.success(e)},complete:function(){t.complete()}}):(t.success({}),t.complete())}},{key:"onNetworkStatusChange",value:function(e){_.isFunction(this.api.onNetworkStatusChange)?this.api.onNetworkStatusChange(e):e({})}},{key:"request",value:function(t){var e;return"ali_mp"===this._config.platform||"dd_mp"===this._config.platform?((e=_.extend({},t)).headers=t.header,e.success=function(e){e.statusCode=e.status,t.success(e)},e.fail=function(e){e.errMsg=e.errorMessage,t.fail(e)},"dd_mp"===this._config.platform?this.api.httpRequest(e):this.api.request(e)):this.api.request(t)}},{key:"initAutoTrackInstance",value:function(e,t){return _.isObject(t.autoTrack)&&(t.autoTrack.isPlugin=t.is_plugin),new(this._config.mp?AutoTrackBridge:AutoTrackBridge$1)(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){this._config.mp?logger.warn("GravityAnalytics: we do not set global name for GE instance when you do not enable auto track."):GameGlobal[t]=e}},{key:"getAppOptions",value:function(e){var t={};try{t=this.api.getLaunchOptionsSync()}catch(e){logger.warn("Cannot get launch options.")}if(_.isFunction(e))try{this._config.mp?this.api.onAppShow(e):this.api.onShow(e)}catch(e){logger.warn("Cannot register onShow callback.")}return t}},{key:"showToast",value:function(e){var t;_.isFunction(this.api.showToast)&&(t={title:e},"dd_mp"!==this._config.platform&&"ali_mp"!==this._config.platform||(t.content=e),this.api.showToast(t))}}],[{key:"createInstance",value:function(){return this._createInstance("R_CURRENT_PLATFORM")}},{key:"_createInstance",value:function(e){switch(e){case"wechat_mp":return new i(wx,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_wechat"},{mpPlatform:"wechat",mp:!0,platform:e});case"wechat_mg":return new i(wx,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_wechat_game"},{mpPlatform:"wechat",platform:e});case"qq_mp":return new i(qq,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qq"},{mpPlatform:"qq",mp:!0,platform:e});case"qq_mg":return new i(qq,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qq_game"},{mpPlatform:"qq",platform:e});case"baidu_mp":return new i(swan,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_swan"},{mpPlatform:function(e){return e.host},mp:!0,platform:e});case"baidu_mg":return new i(swan,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_swan_game"},{mpPlatform:function(e){return e.host},platform:e});case"tt_mg":return new i(tt,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tt_game"},{mpPlatform:function(e){return e.appName},platform:e});case"tt_mp":return new i(tt,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tt"},{mpPlatform:function(e){return e.appName},mp:!0,platform:e});case"ali_mp":return new i(my,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_ali"},{mpPlatform:function(e){return e.app},mp:!0,platform:e});case"dd_mp":return new i(dd,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_dd"},{mpPlatform:"dingding",mp:!0,platform:e});case"bl_mg":return new i(bl,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_mg"},{mpPlatform:"bilibili",platform:e});case"kuaishou_mp":return new i(ks,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_kuaishou"},{mpPlatform:"kuaishou",mp:!0,platform:e});case"qh360_mg":return new i(qh,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qh360"},{mpPlatform:"qh360",platform:e});case"tb_mp":return new i(my,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_tb"},{mpPlatform:"tb",mp:!0,platform:e});case"jd_mp":return new i(jd,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_jd"},{mpPlatform:"jd",mp:!0,platform:e});case"qh360_mp":return new i(qh,{persistenceName:"GravityEngine",persistenceNameOld:"GravityEngine_qh360"},{mpPlatform:"qh360",mp:!0,platform:e});case"WEB":return new PlatformProxy.createInstance}}}]),i}(),AutoTrackBridge$2=_createClass(function e(t,n){var i=this;_classCallCheck(this,e),this.taInstance=t,this.config=n||{},this.config.appShow&&this.taInstance._internalTrack("$MPShow"),this.config.appHide&&this.taInstance.timeEvent("$MPHide"),qg.onShow(function(){var e;i.config.appHide&&i.taInstance.timeEvent("$MPHide"),i.config.appShow&&(_.extend(e={},i.config.properties),_.isFunction(i.config.callback)&&_.extend(e,i.config.callback("appShow")),i.taInstance._internalTrack("$MPShow"))}),qg.onHide(function(){var e;i.config.appHide&&(_.extend(e={},i.config.properties),_.isFunction(i.config.callback)&&_.extend(e,i.config.callback("appHide")),i.taInstance._internalTrack("$MPHide"))})}),PlatformProxy$2=function(){function e(){_classCallCheck(this,e),this.config={persistenceName:"gravityengine",persistenceNameOld:"gravityengine_qg_vivo_game",asyncPersistence:!0}}return _createClass(e,[{key:"getConfig",value:function(){return this.config||{}}},{key:"getStorage",value:function(e,t,n){if(!t)return t=qg.getStorageSync({key:e}),_.isJSONString(t)?JSON.parse(t):{};qg.getStorage({key:e,success:function(e){e=_.isJSONString(e)?JSON.parse(e):{};n(e)},fail:function(){n({})}})}},{key:"setStorage",value:function(e,t){qg.setStorage({key:e,value:t})}},{key:"getSystemInfo",value:function(i){qg.getSystemInfo({success:function(e){var t=e,n=[e.osType,e.osVersionName].join(" ");t.brand=e.manufacturer,t.system=n,t.mp_platform="vivo_qg",i.success(t)},complete:function(){i.complete()}})}},{key:"getNetworkType",value:function(n){qg.getNetworkType({success:function(e){var t=e;t.networkType=e.type,n.success(t)},complete:function(){n.complete()}})}},{key:"onNetworkStatusChange",value:function(n){qg.subscribeNetworkStatus({callback:function(e){var t=e;t.networkType=e.type,n(t)}})}},{key:"request",value:function(t){return qg.request({url:t.url,data:t.data,method:t.method,header:t.header,success:function(e){t.success(e)},fail:function(e){t.fail(e)}})}},{key:"initAutoTrackInstance",value:function(e,t){return new AutoTrackBridge$2(e,t.autoTrack)}},{key:"setGlobal",value:function(e,t){globalThis[t]=e}},{key:"getAppOptions",value:function(){return{}}},{key:"showToast",value:function(e){qg.showToast({message:e,duration:0})}}],[{key:"createInstance",value:function(){return new e}}]),e}(),AutoTrackBridge$3=_createClass(function e(t,n,i){var r=this;_classCallCheck(this,e),this.taInstance=t,this.config=n||{},this.config.appShow&&(_.extend(t={},this.config.properties),_.isFunction(this.config.callback)&&_.extend(t,this.config.callback("appShow")),this.taInstance._internalTrack("$MPShow",t)),this.config.appHide&&this.taInstance.timeEvent("$MPHide"),i.onShow(function(){var e;r.config.appHide&&r.taInstance.timeEvent("$MPHide"),r.config.appShow&&(_.extend(e={},r.config.properties),_.isFunction(r.config.callback)&&_.extend(e,r.config.callback("appShow")),r.taInstance._internalTrack("$MPShow",e))}),i.onHide(function(){var e;r.config.appHide&&(_.extend(e={},r.config.properties),_.isFunction(r.config.callback)&&_.extend(e,r.config.callback("appHide")),r.taInstance._internalTrack("$MPHide",e))})}),PlatformProxy$3=function(){function i(e,t,n){_classCallCheck(this,i),this.api=e,this.config=t,this._config=n}return _createClass(i,[{key:"getConfig",value:function(){return this.config||{}}},{key:"getStorage",value:function(e,t,n){e=localStorage.getItem(e);if(!t)return _.isJSONString(e)?JSON.parse(e):{};_.isJSONString(e)?n(JSON.parse(e)):n({})}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"getSystemInfo",value:function(t){var n=this._config.mpPlatform;this.api.getSystemInfo({success:function(e){e.mp_platform=n,t.success(e)},complete:function(){t.complete()}})}},{key:"getNetworkType",value:function(t){this.api.getNetworkType({success:function(e){t.success(e)},complete:function(){t.complete()}})}},{key:"onNetworkStatusChange",value:function(t){this.api.onNetworkStatusChange({callback:function(e){t(e)}})}},{key:"request",value:function(e){var t={},n=new XMLHttpRequest;if(n.open(e.method,e.url),e.header)for(var i in e.header)n.setRequestHeader(i,e.header[i]);return n.onreadystatechange=function(){4===n.readyState&&200===n.status?(t.statusCode=200,_.isJSONString(n.responseText)&&(t.data=JSON.parse(n.responseText)),e.success(t)):200!==n.status&&(t.errMsg="network error",e.fail(t))},n.ontimeout=function(){t.errMsg="timeout",e.fail(t)},n.send(e.data),n}},{key:"initAutoTrackInstance",value:function(e,t){return new AutoTrackBridge$3(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){globalThis[t]=e}},{key:"getAppOptions",value:function(){return this.api.getLaunchOptionsSync()}},{key:"showToast",value:function(e){this.api.showToast({title:e,icon:"none",duration:2e3})}}],[{key:"createInstance",value:function(){return this._createInstance("R_CURRENT_PLATFORM")}},{key:"_createInstance",value:function(e){switch(e){case"oppo":return new i(qg,{persistenceName:"gravityengine",persistenceNameOld:"gravityengine_qg_oppo_game"},{mpPlatform:"oppo_qg"});case"huawei":return new i(hbs,{persistenceName:"gravityengine",persistenceNameOld:"gravityengine_qg_huawei_game"},{mpPlatform:"huawei_qg"});case"mz":return new i(qg,{persistenceName:"gravityengine",persistenceNameOld:"gravityengine_qg_mz_game"},{mpPlatform:"mz"});case"xiaomi":return new i(qg,{persistenceName:"gravityengine",persistenceNameOld:"gravityengine_qg"},{mpPlatform:"xiaomi"})}}}]),i}(),PlatformProxyEgret=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createInstance",value:function(){var a;return egret.Capabilities.runtimeType===egret.RuntimeType.WXGAME?PlatformProxy$1._createInstance("wechat_mg"):egret.Capabilities.runtimeType===egret.RuntimeType.BAIDUGAME?PlatformProxy$1._createInstance("baidu_mg"):egret.Capabilities.runtimeType===egret.RuntimeType.QQGAME?PlatformProxy$1._createInstance("qq_mg"):egret.Capabilities.runtimeType===egret.RuntimeType.VIVOGAME?PlatformProxy$2.createInstance():egret.Capabilities.runtimeType===egret.RuntimeType.OPPOGAME?PlatformProxy$3._createInstance("oppo"):egret.Capabilities.runtimeType===egret.RuntimeType.QGAME?PlatformProxy$3._createInstance("xiaomi"):egret.Capabilities.runtimeType===egret.RuntimeType.FASTGAME?PlatformProxy$3._createInstance("huawei"):egret.Capabilities.runtimeType===egret.RuntimeType.QHGAME?PlatformProxy$1._createInstance("qh360_mg"):egret.Capabilities.runtimeType===egret.RuntimeType.TTGAME?PlatformProxy$1._createInstance("tt_mg"):egret.Capabilities.runtimeType===egret.RuntimeType.MYGAME?PlatformProxy$1._createInstance("ali_mp"):egret.Capabilities.runtimeType===egret.RuntimeType.TBCREATIVEAPP?PlatformProxy$1._createInstance("tb_mp"):((a=PlatformProxy.createInstance())._sysCallback=function(){return{system:egret.Capabilities.os.replace(/\s*/g,""),mp_platform:egret.Capabilities.runtimeType}},a.request=function(t){var n={},e="GET"===t.method?egret.HttpMethod.GET:egret.HttpMethod.POST,i=new egret.HttpRequest;if(i.timeout=1e4,i.responseType=egret.HttpResponseType.TEXT,i.open(t.url,e),t.header)for(var r in t.header)i.setRequestHeader(r,t.header[r]);return i.send(t.data),i.addEventListener(egret.Event.COMPLETE,function(e){n.statusCode=200;e=e.currentTarget.response;_.isJSONString(e)&&(n.data=JSON.parse(e)),t.success(n)},a),i.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){n.errMsg="network error",t.fail(n)},a),i},a)}}]),e}(),PlatformAPI=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"_getCurrentPlatform",value:function(){return this.currentPlatform||(this.currentPlatform=PlatformProxyEgret.createInstance())}},{key:"getConfig",value:function(){return this._getCurrentPlatform().getConfig()}},{key:"getStorage",value:function(e,t,n){return this._getCurrentPlatform().getStorage(e,t,n)}},{key:"setStorage",value:function(e,t){return this._getCurrentPlatform().setStorage(e,t)}},{key:"getSystemInfo",value:function(e){return this._getCurrentPlatform().getSystemInfo(e)}},{key:"getNetworkType",value:function(e){return this._getCurrentPlatform().getNetworkType(e)}},{key:"onNetworkStatusChange",value:function(e){this._getCurrentPlatform().onNetworkStatusChange(e)}},{key:"request",value:function(e){return this._getCurrentPlatform().request(e)}},{key:"initAutoTrackInstance",value:function(e,t){return this._getCurrentPlatform().initAutoTrackInstance(e,t)}},{key:"setGlobal",value:function(e,t){e&&t&&this._getCurrentPlatform().setGlobal(e,t)}},{key:"getAppOptions",value:function(e){return this._getCurrentPlatform().getAppOptions(e)}},{key:"showDebugToast",value:function(e){this._getCurrentPlatform().showToast(e)}}]),e}(),KEY_NAME_MATCH_REGEX=/^\$?[a-zA-Z][a-zA-Z0-9_]{0,49}$/,PropertyChecker=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"stripProperties",value:function(e){return _.isObject(e)&&_.each(e,function(e,t){_.isString(e)||_.isNumber(e)||_.isDate(e)||_.isBoolean(e)||_.isArray(e)||_.isObject(e)||logger.warn("Your data -",t,e,"- format does not meet requirements and may not be stored correctly. Attribute values only support String, Number, Date, Boolean, Array, Object")}),e}},{key:"_checkPropertiesKey",value:function(e){var n=!0;return _.each(e,function(e,t){KEY_NAME_MATCH_REGEX.test(t)||(logger.warn("Invalid KEY: "+t),n=!1)}),n}},{key:"event",value:function(e){return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger.warn("Check the parameter format. The eventName must start with an English letter and contain no more than 50 characters including letters, digits, and underscores: "+e),!1)}},{key:"propertyName",value:function(e){return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger.warn("Check the parameter format. PropertyName must start with a letter and contain letters, digits, and underscores (_). The value is a string of no more than 50 characters: "+e),!1)}},{key:"properties",value:function(e){return this.stripProperties(e),!(e&&(_.isObject(e)?!this._checkPropertiesKey(e)&&(logger.warn("Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters"),1):(logger.warn("properties can be none, but it must be an object"),1)))}},{key:"propertiesMust",value:function(e){return this.stripProperties(e),void 0===e||!_.isObject(e)||_.isEmptyObject(e)?(logger.warn("properties must be an object with a value"),!1):!!this._checkPropertiesKey(e)||(logger.warn("Check the parameter format. The properties key must start with a letter, contain digits, letters, and underscores (_), and contain a maximum of 50 characters"),!1)}},{key:"userId",value:function(e){return!(!_.isString(e)||!/^.{1,64}$/.test(e))||(logger.warn("The user ID must be a string of less than 64 characters and cannot be null"),!1)}},{key:"userAddProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isNumber(e[t]))return logger.warn("The attributes of userAdd need to be Number"),!1;return!0}},{key:"userAppendProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isArray(e[t]))return logger.warn("The attribute of userAppend must be Array"),!1;return!0}}]),e}(),HttpTask=function(){function s(e,t,n,i,r,a){_classCallCheck(this,s),this.data=e,this.serverUrl=t,this.callback=a,this.debugMode=r,this.tryCount=_.isNumber(n)?n:1,this.permissionTryCount=6,this.timeout=_.isNumber(i)?i:3e3,this.taClassName="HttpTask"}return _createClass(s,[{key:"run",value:function(){var n=this,e=_.createExtraHeaders(),t=(e["content-type"]="application/json","debug"===this.debugMode&&(e["Turbo-Debug-Mode"]=1),PlatformAPI.request({url:this.serverUrl,method:"POST",data:this.data,header:e,success:function(e){var t;0===(null==e||null==(t=e.data)?void 0:t.code)?n.onSuccess(e):n.onFailed(e)},fail:function(e){n.onFailed(e)}}));setTimeout(function(){(_.isObject(t)||_.isPromise(t))&&_.isFunction(t.abort)&&t.abort()},this.timeout)}},{key:"onSuccess",value:function(e){var t,n;200===e.statusCode?(n="Data Verified",null!=e&&null!=(t=e.data)&&null!=(t=t.extra)&&null!=(t=t.errors)&&t.length&&(n=e.data.extra.errors),this.callback({code:null==e||null==(t=e.data)?void 0:t.code,msg:n})):this.callback({code:-3,msg:e.statusCode})}},{key:"onFailed",value:function(e){var t,n=this;2e3===(null==e||null==(t=e.data)?void 0:t.code)&&0<--this.permissionTryCount?setTimeout(function(){n.run()},6e3):0<--this.tryCount?setTimeout(function(){n.run()},1e3):this.callback({code:-3,msg:"".concat(null==e||null==(t=e.data)?void 0:t.msg,"：").concat(null==e||null==(t=e.data)||null==(e=t.extra)?void 0:e.error)})}}]),s}(),SenderQueue=function(){function e(){_classCallCheck(this,e),this.items=[],this.isRunning=!1,this.showDebug=!1}return _createClass(e,[{key:"enqueue",value:function(e,t,n){var i=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],r="debug"===n.debugMode,a=this,e=new HttpTask(JSON.stringify(e),t,n.maxRetries,n.sendTimeout,n.debugMode,function(e){a.isRunning=!1,_.isFunction(n.callback)&&n.callback(e),a._runNext(r),r&&logger.info("code ".concat(e.code," and msg is ").concat(e.msg))});!0===i?(this.items.push(e),this._runNext(r)):e.run()}},{key:"_dequeue",value:function(){return this.items.shift()}},{key:"_runNext",value:function(e){if(0<this.items.length&&!this.isRunning)if(this.isRunning=!0,e)this._dequeue().run();else{for(var t=this.items.splice(0,this.items.length),e=t[0],n=JSON.parse(e.data),i=1;i<t.length;i++){var r=t[i],r=JSON.parse(r.data);n.event_list=n.event_list.concat(r.event_list)}var a=(new Date).getTime();n.$flush_time=a,new HttpTask(JSON.stringify(n),e.serverUrl,e.tryCount,e.timeout,null==e?void 0:e.debugMode,e.callback).run()}}}]),e}(),senderQueue=new SenderQueue,DEFAULT_CONFIG={name:"GravityEngine",is_plugin:!1,maxRetries:3,sendTimeout:5e3,enablePersistence:!0,asyncPersistence:!1,strict:!1,debugMode:"none"},systemInformation={properties:{$lib_version:Config.LIB_VERSION,$lib:Config.LIB_STACK},getSystemInfo:function(e){var n=this;PlatformAPI.onNetworkStatusChange(function(e){n.properties.$network_type=e.networkType}),PlatformAPI.getNetworkType({success:function(e){n.properties.$network_type=e.networkType},complete:function(){PlatformAPI.getSystemInfo({success:function(e){logger.info(JSON.stringify(e,null,4));var t={$manufacturer:e.brand,$brand:e.brand,$model:e.model,$screen_width:Number(e.screenWidth),$screen_height:Number(e.screenHeight),$system_language:e.language,$os:e.platform,$os_version:e.system};_.extend(n.properties,t),_.setMpPlatform(e.mp_platform)},complete:function(){e()}})}})}},GravityEnginePersistence=function(){function e(t,n){var i=this;_classCallCheck(this,e),this.enabled=t.enablePersistence,this.enabled?(t.isChildInstance?(this.name=t.persistenceName+"_"+t.name,this.nameOld=t.persistenceNameOld+"_"+t.name):(this.name=t.persistenceName,this.nameOld=t.persistenceNameOld),t.asyncPersistence?(this._state={},PlatformAPI.getStorage(this.name,!0,function(e){_.isEmptyObject(e)?PlatformAPI.getStorage(i.nameOld,!0,function(e){i._state=_.extend2Layers({},e,i._state),i._init(t,n),i._save()}):(i._state=_.extend2Layers({},e,i._state),i._init(t,n),i._save())})):(this._state=PlatformAPI.getStorage(this.name)||{},_.isEmptyObject(this._state)&&(this._state=PlatformAPI.getStorage(this.nameOld)||{}),this._init(t,n))):(this._state={},this._init(t,n))}return _createClass(e,[{key:"_init",value:function(e,t){this.getDistinctId()||this.setDistinctId(_.UUID()),e.isChildInstance||this.getDeviceId()||this._setDeviceId(_.UUID()),this.initComplete=!0,"function"==typeof t&&t(),this._save()}},{key:"_save",value:function(){this.enabled&&this.initComplete&&PlatformAPI.setStorage(this.name,JSON.stringify(this._state))}},{key:"_set",value:function(e,t){var n,i=this;"string"==typeof e?(n={})[e]=t:"object"===_typeof(e)&&(n=e),_.each(n,function(e,t){i._state[t]=e}),this._save()}},{key:"_get",value:function(e){return this._state[e]}},{key:"setEventTimer",value:function(e,t){var n=this._state.event_timers||{};n[e]=t,this._set("event_timers",n)}},{key:"removeEventTimer",value:function(e){var t=(this._state.event_timers||{})[e];return _.isUndefined(t)||(delete this._state.event_timers[e],this._save()),t}},{key:"getDeviceId",value:function(){return this._state.device_id}},{key:"_setDeviceId",value:function(e){this.getDeviceId()?logger.warn("cannot modify the device id."):this._set("device_id",e)}},{key:"getDistinctId",value:function(){return this._state.distinct_id}},{key:"setDistinctId",value:function(e){this._set("distinct_id",e)}},{key:"getAccountId",value:function(){return this._state.account_id}},{key:"setAccountId",value:function(e){this._set("account_id",e)}},{key:"getSuperProperties",value:function(){return this._state.props||{}}},{key:"setSuperProperties",value:function(e,t){t=t?e:_.extend(this.getSuperProperties(),e);this._set("props",t)}}]),e}();function getPlatFormName(){return PlatformAPI.getConfig().persistenceNameOld}var GravityEngineAPI=function(){function n(e){_classCallCheck(this,n),e.appId=_.checkAppId(e.clientId),e.accessToken=e.accessToken,e.appId?e.accessToken||console.warn("GravityAnalytics: accessToken must be required"):console.warn("GravityAnalytics: clientId must be required"),e.serverUrl="".concat(Config.BASE_URL,"/event/collect/?access_token=").concat(e.accessToken);var t=_.extend({},DEFAULT_CONFIG,PlatformAPI.getConfig());_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)}var i,e;return _createClass(n,[{key:"_init",value:function(e){var t=this,n=(this.name=e.name,this.appId=e.clientId,this.accessToken=e.accessToken,e.serverUrl||e.server_url);this.serverUrl=n,this.serverDebugUrl=n,this.configUrl=n+"/config",this.autoTrackProperties={},this._queue=[],this.config.syncBatchSize=100,this.config.syncInterval=60,e.isChildInstance?this._state={}:(logger.enabled="debug"===e.debugMode,this.instances=[],this._state={getSystemInfo:!1,initComplete:!1},systemInformation.getSystemInfo(function(){t._updateState({getSystemInfo:!0})}),PlatformAPI.setGlobal(this,this.name)),this.store=new GravityEnginePersistence(e,function(){t.config.asyncPersistence&&_.isFunction(t.config.persistenceComplete)&&t.config.persistenceComplete(t),t._updateState()}),this.enabled=!_.isBoolean(this.store._get("ge_enabled"))||this.store._get("ge_enabled"),this.isOptOut=!!_.isBoolean(this.store._get("ge_isOptOut"))&&this.store._get("ge_isOptOut"),"GravityEngine_wechat_game"===getPlatFormName()&&e.autoTrack.appLaunch&&this.track("$MPLaunch",{$url_query:this.setQuery(this.getQuery()),$scene:String(PlatformAPI.getAppOptions().scene)}),!e.isChildInstance&&e.autoTrack&&(this.autoTrack=PlatformAPI.initAutoTrackInstance(this,e))}},{key:"updateConfig",value:function(e,t){}},{key:"initInstance",value:function(e,t){if(!this.config.isChildInstance)return _.isString(e)&&e!==this.name&&_.isUndefined(this[e])?(t=new n(_.extend({},this.config,{enablePersistence:!1,isChildInstance:!0,name:e},t)),this[e]=t,this.instances.push(e),this[e]._state=this._state,t):void logger.warn("initInstance() failed due to the name is invalid: "+e);logger.warn("initInstance() cannot be called on child instance")}},{key:"lightInstance",value:function(e){return this[e]}},{key:"_setAutoTrackProperties",value:function(e){_.extend(this.autoTrackProperties,e)}},{key:"init",value:function(){if(this._state.initComplete)return!1;this._updateState({initComplete:!0})}},{key:"_isReady",value:function(){return this._state.getSystemInfo&&this._state.initComplete&&this.store.initComplete&&this.config.appId&&this.config.accessToken}},{key:"_updateState",value:function(e){var t=this;_.isObject(e)&&_.extend(this._state,e),this._onStateChange(),_.each(this.instances,function(e){t[e]._onStateChange()})}},{key:"_onStateChange",value:function(){var t=this;this._isReady()&&this._queue&&0<this._queue.length&&(_.each(this._queue,function(e){t[e[0]].apply(t,slice.call(e[1]))}),this._queue=[])}},{key:"_hasDisabled",value:function(){var e=!this.enabled||this.isOptOut;return e&&logger.info("GravityEngine is Pause or Stop!"),e}},{key:"_sendRequest",value:function(e,t,n){var i,r;this._hasDisabled()||(!_.isUndefined(this.config.disableEventList)&&this.config.disableEventList.includes(e.eventName)?logger.info("disabled Event : "+e.eventName):(t=_.isDate(t)?t:new Date,(t={event_list:[{type:e.type,time:Date.now()}]}).event_list[0].event=e.eventName,"track"===e.type?(t.event_list[0].properties=_.extend({},systemInformation.properties,this.autoTrackProperties,this.store.getSuperProperties(),this.dynamicProperties?this.dynamicProperties():{}),i=this.store.removeEventTimer(e.eventName),_.isUndefined(i)||(i=(new Date).getTime()-i,86400<(i=parseFloat((i/1e3).toFixed(3)))?i=86400:i<0&&(i=0),t.event_list[0].properties.$event_duration=i)):t.event_list[0].properties={},_.isObject(e.properties)&&!_.isEmptyObject(e.properties)&&_.extend(t.event_list[0].properties,e.properties),_.searchObjDate(t.event_list[0]),t.client_id=this.appId,logger.info(JSON.stringify(t,null,4)),i=this.serverUrl,_.isBoolean(this.config.enableEncrypt)&&1==this.config.enableEncrypt&&(t.event_list[0]=_.generateEncryptyData(t.event_list[0],void 0)),n?(n=new FormData,"debug"===this.config.debugMode?(n.append("source","client"),n.append("appid",this.appId),n.append("deviceId",this.getDeviceId()),n.append("data",JSON.stringify(t.event_list[0]))):(r=_.base64Encode(JSON.stringify(t)),n.append("data",r)),navigator.sendBeacon(i,n),_.isFunction(e.onComplete)&&e.onComplete({statusCode:200})):senderQueue.enqueue(t,i,{maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:e.onComplete,debugMode:this.config.debugMode})))}},{key:"_isObjectParams",value:function(e){return _.isObject(e)&&_.isFunction(e.onComplete)}},{key:"track",value:function(e,t,n,i){var r;this._hasDisabled()||(this._isObjectParams(e)&&(e=(r=e).eventName,t=r.properties,n=r.time,i=r.onComplete),PropertyChecker.event(e)&&PropertyChecker.properties(t)||!this.config.strict?this._internalTrack(e,t,n,i):_.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}},{key:"_internalTrack",value:function(e,t,n,i,r){this._hasDisabled()||(n=_.isDate(n)?n:new Date,this._isReady()?this._sendRequest({type:"track",eventName:e,properties:t,onComplete:i},n,r):this._queue.push(["_internalTrack",[e,t,n,i]]))}},{key:"userSet",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_set",properties:e,onComplete:n},t):this._queue.push(["userSet",[e,t,n]])):(logger.warn("calling userSet failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userSetOnce",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_set_once",properties:e,onComplete:n},t):this._queue.push(["userSetOnce",[e,t,n]])):(logger.warn("calling userSetOnce failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userAdd",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_increment",properties:e,onComplete:n},t):this._queue.push(["userAdd",[e,t,n]])):(logger.warn("calling userAdd failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userNumberMax",value:function(e,t,n){if(!this._hasDisabled()){var i,r,a;for(r in this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),e)if("number"!=typeof e[r])return a="The key ".concat(r," must be type of number"),console.warn(a),void(_.isFunction(n)&&n({code:-1,msg:a}));PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_number_max",properties:e,onComplete:n},t):this._queue.push(["userNumberMax",[e,t,n]])):(logger.warn("calling userNumberMax failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"}))}}},{key:"userNumberMin",value:function(e,t,n){if(!this._hasDisabled()){var i,r,a;for(r in this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),e)if("number"!=typeof e[r])return a="The key ".concat(r," must be type of number"),console.warn(a),void(_.isFunction(n)&&n({code:-1,msg:a}));PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_number_min",properties:e,onComplete:n},t):this._queue.push(["userNumberMin",[e,t,n]])):(logger.warn("calling userNumberMin failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"}))}}},{key:"userDel",value:function(e,t){var n,i={};this._hasDisabled()||(this._isObjectParams(i)&&(i=(n=i).properties,e=n.time,t=n.onComplete),PropertyChecker.propertiesMust(i)||!this.config.strict?(e=_.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_delete",properties:i,onComplete:t},e):this._queue.push(["userDel",[i,e,t]])):(logger.warn("calling userDel failed due to invalid arguments"),_.isFunction(t)&&t({code:-1,msg:"invalid parameters"})))}},{key:"userAppend",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_append",properties:e,onComplete:n},t):this._queue.push(["userAppend",[e,t,n]])):(logger.warn("calling userAppend failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userUniqAppend",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.userAppendProperties(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_uniq_append",properties:e,onComplete:n},t):this._queue.push(["userUniqAppend",[e,t,n]])):(logger.warn("calling userAppend failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userUnset",value:function(e,t,n){var i,e=_defineProperty({},e,null);this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"profile",eventName:"profile_unset",properties:e,onComplete:n},t):this._queue.push(["userUnset",[e,t,n]])):(logger.warn("calling userUnset failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"logoutEvent",value:function(){this.track("$MPLogout",{})}},{key:"loginEvent",value:function(){this.track("$MPLogin",{})}},{key:"registerEvent",value:function(){this.track("$MPRegister",{})}},{key:"payEvent",value:function(e,t,n,i,r){if("number"!=typeof e)throw new Error("pay_amount must be a number");if("string"!=typeof t)throw new Error("pay_type must be a string");if("string"!=typeof n)throw new Error("order_id must be a string");if("string"!=typeof i)throw new Error("pay_reason must be a string");if("string"!=typeof r)throw new Error("pay_method must be a string");this.track("$PayEvent",{$pay_amount:e,$pay_type:t,$order_id:n,$pay_reason:i,$pay_method:r})}},{key:"adShowEvent",value:function(e,t){if("string"!=typeof e)throw new Error("ad_type must be a string");if("string"!=typeof t)throw new Error("ad_unit_id must be a string");this.track("$AdShow",{$ad_type:e,$ad_unit_id:t,$adn_type:"wechat"})}},{key:"getQuery",value:function(){return PlatformAPI.getAppOptions().query||{}}},{key:"setQuery",value:function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")}},{key:"sendNetWork",value:function(e,i){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"POST";return new Promise(function(t,n){PlatformAPI.request({url:e,method:r,data:i,header:{"content-type":"application/json"},success:function(e){200===e.statusCode?t(e.data):n(e)},fail:function(e){n(e)}})})}},{key:"_errorPromise",value:function(e){return Promise.reject(new Error(e))}},{key:"register",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,i,r,a,s,o,c,u,l,p,f=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<f.length&&void 0!==f[0]?f[0]:{},n="",this._state.initComplete?null!=t&&t.name?null!=t&&t.version||0===(null==t?void 0:t.version)?_.isNumber(null==t?void 0:t.version)&&"number"==typeof(null==t?void 0:t.version)||(n="version must be type: Number"):n="version must be required":n="name must be required":n="register must be called after init",n)return e.abrupt("return",this._errorPromise(n));e.next=5;break;case 5:return n=this.getQuery(),i=(null==t?void 0:t.channel)||"base_channel",a={client_id:this.appId,name:t.name,channel:i,version:t.version,wx_openid:(null==t?void 0:t.wx_openid)||"",wx_unionid:(null==t?void 0:t.wx_unionid)||"",ad_data:n},null!=n&&n.turbo_promoted_object_id&&(a.promoted_object_id=n.turbo_promoted_object_id),r="".concat(Config.BASE_URL,"/user/register/?access_token=").concat(this.accessToken),e.next=12,this.sendNetWork(r,a);case 12:return r=e.sent,this.registerEvent(),a=systemInformation.properties,l=new Date,p=l.getFullYear(),s=("0"+(l.getMonth()+1)).slice(-2),o=("0"+l.getDate()).slice(-2),c=("0"+l.getHours()).slice(-2),u=("0"+l.getMinutes()).slice(-2),l=("0"+l.getSeconds()).slice(-2),p="".concat(p,"-").concat(s,"-").concat(o," ").concat(c,":").concat(u,":").concat(l),this.userSetOnce({$channel:i,$manufacturer:a.$manufacturer,$model:a.$model,$brand:a.$brand,$os:a.$os,$first_visit_time:p}),e.abrupt("return",r);case 25:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"handleEvent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t="",n=(this._state.initComplete||(t="handleEvent must be called after init"),{event_type:e.event_type});if(null!=e&&e.properties&&(n.properties=e.properties),n.use_client_time=(null==e?void 0:e.use_client_time)||!1,t=!n.use_client_time||null!=e&&e.timestamp?t:"timestamp must be required")return this._errorPromise(t);null!=e&&e.timestamp&&(n.timestamp=e.timestamp),null!=e&&e.trace_id&&(n.trace_id=e.trace_id),n.timestamp=(null==e?void 0:e.timestamp)||(new Date).getTime();t="".concat(Config.BASE_URL,"/event/handle_event/?access_token=").concat(this.accessToken,"&client_id=").concat(this.appId);return this.sendNetWork(t,n)}},{key:"queryUser",value:function(){var e,t="";return(t=this._state.initComplete?t:"queryUser must be called after init")?this._errorPromise(t):(t={user_list:[this.appId]},e="".concat(Config.BASE_URL,"/user/get/?access_token=").concat(this.accessToken),this.sendNetWork(e,t))}},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setDistinctId(e)}}},{key:"getDistinctId",value:function(){return this.store.getDistinctId()}},{key:"login",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setAccountId(e)}}},{key:"getBytedanceEcpmRecords",value:(i=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n,a){var i,r,s,o,c,u=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r="",t?n?a||(r="ad_unit_id must be required"):r="mp_id must be required":r="open_id must be required",r)return e.abrupt("return",this._errorPromise(r));e.next=4;break;case 4:return r=_.formatDate(new Date).slice(0,13),s="".concat(Config.BASE_URL,"/event/dy/get_ecpm/?open_id=").concat(t,"&mp_id=").concat(n,"&date_hour=").concat(r,"&access_token=").concat(this.accessToken),e.next=8,this.sendNetWork(s,{},"GET");case 8:if(null!=(o=e.sent)&&null!=(s=o.data)&&null!=(i=s.records)&&i.length){e.next=11;break}return e.abrupt("return");case 11:c=o.data.records.filter(function(e){return"send"===e.event_name}),PlatformAPI.getStorage("bytedance_ecpm_records",!0,function(e){var t,n=Array.isArray(e)?e:[],e=c.filter(function(e){return!n.includes(e.id)}),i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var r=t.value.cost/1e5*1e3;r%1!=0&&(r=+r.toFixed(2)),u.track("$AdShow",{$ecpm:r,$ad_type:"reward",$ad_unit_id:a,$adn_type:"bytedance"})}}catch(e){i.e(e)}finally{i.f()}e=n.concat(e.map(function(e){return e.id}));PlatformAPI.setStorage("bytedance_ecpm_records",JSON.stringify(e))});case 13:case"end":return e.stop()}},e,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"getAccountId",value:function(){return this.store.getAccountId()}},{key:"logout",value:function(){this._hasDisabled()||this.store.setAccountId(null)}},{key:"setSuperProperties",value:function(e){this._hasDisabled()||(PropertyChecker.propertiesMust(e)||!this.config.strict?this.store.setSuperProperties(e):logger.warn("setSuperProperties parameter must be a valid property value"))}},{key:"registerApp",value:function(e){this.setSuperProperties(e)}},{key:"clearSuperProperties",value:function(){this._hasDisabled()||this.store.setSuperProperties({},!0)}},{key:"unsetSuperProperty",value:function(e){var t;this._hasDisabled()||_.isString(e)&&(delete(t=this.getSuperProperties())[e],this.store.setSuperProperties(t,!0))}},{key:"getSuperProperties",value:function(){return this.store.getSuperProperties()}},{key:"getPresetProperties",value:function(){var e=systemInformation.properties,t={},n=e.$system_language,n=(t.system_language=_.isUndefined(n)?"":n,e.$os),n=(t.os=_.isUndefined(n)?"":n,e.$screen_width),n=(t.screenWidth=_.isUndefined(n)?0:n,e.$screen_height),n=(t.screenHeight=_.isUndefined(n)?0:n,e.$network_type),n=(t.networkType=_.isUndefined(n)?"":n,e.$model),n=(t.deviceModel=_.isUndefined(n)?"":n,e.$os_version),n=(t.osVersion=_.isUndefined(n)?"":n,t.deviceId=this.getDeviceId(),0-(new Date).getTimezoneOffset()/60),n=(t.zoneOffset=n,e.$manufacturer),n=(t.manufacturer=_.isUndefined(n)?"":n,e.$manufacturer);return t.brand=_.isUndefined(n)?"":n,t.toEventPresetProperties=function(){return{$app_id:this.appId,$model:t.deviceModel,$screen_width:t.screenWidth,$screen_height:t.screenHeight,$system_language:t.system_language,$os:t.os,$os_version:t.osVersion,$network_type:t.networkType,$manufacturer:t.manufacturer,$brand:t.manufacturer}},t}},{key:"setDynamicSuperProperties",value:function(e){this._hasDisabled()||("function"==typeof e?PropertyChecker.properties(e())||!this.config.strict?this.dynamicProperties=e:logger.warn("A dynamic public property must return a valid property value"):logger.warn("setDynamicSuperProperties parameter must be a function type"))}},{key:"timeEvent",value:function(e,t){this._hasDisabled()||(t=_.isDate(t)?t:new Date,this._isReady()?PropertyChecker.event(e)||!this.config.strict?this.store.setEventTimer(e,t.getTime()):logger.warn("calling timeEvent failed due to invalid eventName: "+e):this._queue.push(["timeEvent",[e,t]]))}},{key:"getDeviceId",value:function(){return systemInformation.properties.$device_id}},{key:"enableTracking",value:function(e){this.enabled=e,this.store._set("ta_enabled",e)}},{key:"optOutTracking",value:function(){this.store.setSuperProperties({},!0),this.store.setDistinctId(_.UUID()),this.store.setAccountId(null),this._queue.splice(0,this._queue.length),this.isOptOut=!0,this.store._set("ge_isOptOut",!0)}},{key:"optOutTrackingAndDeleteUser",value:function(){var e=new Date;this._sendRequest({type:"user_del"},e),this.optOutTracking()}},{key:"optInTracking",value:function(){this.isOptOut=!1,this.store._set("ge_isOptOut",!1)}},{key:"setTrackStatus",value:function(e){switch(e){case"PAUSE":this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!1);break;case"STOP":this.eventSaveOnly=!1,this.optOutTracking(!0);break;default:this.eventSaveOnly=!1,this.optInTracking(),this.enableTracking(!0)}}}]),n}(),DEFAULT_CONFIG$1={name:"GravityEngine",enableLog:!0,enableNative:!1},GravityEngineAPIForNative=function(){function n(e){_classCallCheck(this,n),e.appId=_.checkAppId(e.clientId),e.accessToken=e.accessToken,e.appId?e.accessToken||console.warn("GravityAnalytics: accessToken must be required"):console.warn("GravityAnalytics: clientId must be required"),e.serverUrl="".concat(Config.BASE_URL,"/event/collect/?access_token=").concat(e.accessToken);var t=_.extend({},DEFAULT_CONFIG$1);_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)}return _createClass(n,[{key:"_isNativePlatform",value:function(){return!(!this._isIOS()&&!this._isAndroid()||!this.config.enableNative)}},{key:"_isIOS",value:function(){return"iOS"===egret.Capabilities.os&&egret.Capabilities.runtimeType===egret.RuntimeType.RUNTIME2}},{key:"_isAndroid",value:function(){return"Android"===egret.Capabilities.os&&egret.Capabilities.runtimeType===egret.RuntimeType.RUNTIME2}},{key:"_init",value:function(e){this.name=e.name,this.appId=e.clientId,this.accessToken=e.accessToken;var t=e.serverUrl||e.server_url;this.serverUrl=t,this.serverDebugUrl=t+"/data_debug",this.configUrl=t+"/config",this._isNativePlatform()?(this.initInstanceForNative(this.name,e,this.appId),this._readStorage(e)):this.geJs=new GravityAnalyticsAPIForJS(e)}},{key:"_readStorage",value:function(e){var t=this,n=e.persistenceName,i=e.persistenceNameOld;e.isChildInstance&&(n=e.persistenceName+"_"+e.name,i=e.persistenceNameOld+"_"+e.name),this._state=PlatformAPI.getStorage(n)||{},_.isEmptyObject(this._state)&&(this._state=PlatformAPI.getStorage(i)||{}),_.isEmptyObject(this._state)?PlatformAPI.getStorage(n,!0,function(e){_.isEmptyObject(e)?PlatformAPI.getStorage(i,!0,function(e){t._state=_.extend2Layers({},e,t._state)}):t._state=_.extend2Layers({},e,t._state),t._state.distinct_id&&t.identifyForNative(t._state.distinct_id),t._state.account_id&&t.loginForNative(t._state.account_id)}):(this._state.distinct_id&&this.identifyForNative(this._state.distinct_id),this._state.account_id&&this.loginForNative(this._state.account_id))}},{key:"initInstance",value:function(e,t){return this._isNativePlatform()?_.isUndefined(t)?this[e]=new GravityAnalyticsAPI(this.config):this[e]=new GravityAnalyticsAPI(t):this[e]=this.geJs.initInstance(e,t),this[e]}},{key:"lightInstance",value:function(e){return this[e]}},{key:"init",value:function(){var e,t;this._isNativePlatform()?(e=window,t=this,e.__autoTrackCallback=function(e){return _.isFunction(t.config.autoTrack.callback)?(e=t.config.autoTrack.callback(e),JSON.stringify(e)):"{}"},this.startGravityAnalyticsForNative()):this.geJs.init()}},{key:"track",value:function(e,t,n,i){this._isNativePlatform()?this.trackForNative(e,t,n,this.appId):this.geJs.track(e,t,n,i)}},{key:"register",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this._isNativePlatform())return this.geJs.register(e)}},{key:"handleEvent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this._isNativePlatform())return this.geJs.handleEvent(e)}},{key:"queryUser",value:function(){if(!this._isNativePlatform())return this.geJs.queryUser()}},{key:"registerApp",value:function(e){if(!this._isNativePlatform())return this.geJs.registerApp(e)}},{key:"registerEvent",value:function(){if(!this._isNativePlatform())return this.geJs.registerEvent()}},{key:"loginEvent",value:function(){if(!this._isNativePlatform())return this.geJs.loginEvent()}},{key:"logoutEvent",value:function(){if(!this._isNativePlatform())return this.geJs.logoutEvent()}},{key:"payEvent",value:function(e,t,n,i,r){if(!this._isNativePlatform())return this.geJs.payEvent(e,t,n,i,r)}},{key:"adShowEvent",value:function(e,t){if(!this._isNativePlatform())return this.geJs.adShowEvent(e,t)}},{key:"userSet",value:function(e,t,n){this._isNativePlatform()?this.userSetForNative(e,this.appId):this.geJs.userSet(e,t,n)}},{key:"userSetOnce",value:function(e,t,n){this._isNativePlatform()?this.userSetOnceForNative(e,this.appId):this.geJs.userSetOnce(e,t,n)}},{key:"userUnset",value:function(e,t,n){this._isNativePlatform()?this.userUnsetForNative(e,this.appId):this.geJs.userUnset(e,t,n)}},{key:"userDel",value:function(e,t){this._isNativePlatform()?this.userDelForNative(this.appId):this.geJs.userDel(e,t)}},{key:"userAdd",value:function(e,t,n){this._isNativePlatform()?this.userAddForNative(e,this.appId):this.geJs.userAdd(e,t,n)}},{key:"userNumberMax",value:function(e,t,n){this._isNativePlatform()||this.geJs.userNumberMax(e,t,n)}},{key:"userNumberMin",value:function(e,t,n){this._isNativePlatform()||this.geJs.userNumberMin(e,t,n)}},{key:"userAppend",value:function(e,t,n){this._isNativePlatform()?this.userAppendForNative(e,this.appId):this.geJs.userAppend(e,t,n)}},{key:"userUniqAppend",value:function(e,t,n){this._isNativePlatform()?this.userUniqAppendForNative(e,this.appId):this.geJs.userUniqAppend(e,t,n)}},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){this._isNativePlatform()?this.identifyForNative(e,this.appId):this.geJs.identify(e)}},{key:"getDistinctId",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getDistinctIdForNative(e,this.appId);e(this.geJs.getDistinctId())}return this.geJs.getDistinctId()}},{key:"login",value:function(e){this._isNativePlatform()?this.loginForNative(e,this.appId):this.geJs.login(e)}},{key:"getAccountId",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getAccountIdForNative(e,this.appId);e(this.geJs.getAccountId())}return this.geJs.getAccountId()}},{key:"logout",value:function(){this._isNativePlatform()?this.logoutForNative(this.appId):this.geJs.logout()}},{key:"setSuperProperties",value:function(e){this._isNativePlatform()?this.setSuperPropertiesForNative(e,this.appId):this.geJs.setSuperProperties(e)}},{key:"clearSuperProperties",value:function(){this._isNativePlatform()?this.clearSuperPropertiesForNative(this.appId):this.geJs.clearSuperProperties()}},{key:"unsetSuperProperty",value:function(e){this._isNativePlatform()?this.unsetSuperPropertyForNative(e,this.appId):this.geJs.unsetSuperProperty(e)}},{key:"getSuperProperties",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getSuperPropertiesForNative(e,this.appId);e(this.geJs.getSuperProperties())}return this.geJs.getSuperProperties()}},{key:"getPresetProperties",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getPresetPropertiesForNative(e,this.appId);e(this.geJs.getPresetProperties())}return this.geJs.getPresetProperties()}},{key:"setDynamicSuperProperties",value:function(e){this._isNativePlatform()?"function"==typeof e?this.dynamicProperties=e:logger.warn("setDynamicSuperProperties parameter must be a function type"):this.geJs.setDynamicSuperProperties(e)}},{key:"timeEvent",value:function(e,t){return this._isNativePlatform()?this.timeEventForNative(e,this.appId):this.geJs.timeEvent(e,t)}},{key:"getDeviceId",value:function(e){if(!_.isUndefined(e)){if(this._isNativePlatform())return void this.getDeviceIdForNative(e,this.appId);e(this.geJs.getDeviceId())}return this.geJs.getDeviceId()}},{key:"enableTracking",value:function(e){this._isNativePlatform()?this.enableTrackingForNative(e,this.appId):this.geJs.enableTracking(e)}},{key:"optOutTracking",value:function(){this._isNativePlatform()?this.optOutTrackingForNative(this.appId):this.geJs.optOutTracking()}},{key:"optOutTrackingAndDeleteUser",value:function(){this._isNativePlatform()?this.optOutTrackingAndDeleteUserForNative(this.appId):this.geJs.optOutTrackingAndDeleteUser()}},{key:"optInTracking",value:function(){this._isNativePlatform()?this.optInTrackingForNative(this.appId):this.geJs.optInTracking()}},{key:"setTrackStatus",value:function(e){this._isNativePlatform()?this.setTrackStatusForNative(e,this.appId):this.geJs.setTrackStatus(e)}},{key:"trackForNative",value:function(e,t,n,i){n=_.isDate(n)?_.formatDate(n):"",e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?{}:t,n=_.isUndefined(n)?"":n,i=_.isUndefined(i)?"":i,t=_.extend(t,this.dynamicProperties?this.dynamicProperties():{}),t=_.encodeDates(t),e={eventName:e,properties:JSON.stringify(t),formatTime:n,appId:i},t=JSON.stringify(e);egret.ExternalInterface.call("track",t)}},{key:"timeEventForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t;e=JSON.stringify({eventName:e,appId:t});egret.ExternalInterface.call("timeEvent",e)}},{key:"loginForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t;e=JSON.stringify({accoundId:e,appId:t});egret.ExternalInterface.call("login",e)}},{key:"logoutForNative",value:function(e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.call("logout",e)}},{key:"setSuperPropertiesForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e);e={properties:JSON.stringify(e),appId:t},t=JSON.stringify(e);egret.ExternalInterface.call("setSuperProperties",t)}},{key:"getSuperPropertiesForNative",value:function(t,e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.addCallback("getSuperProperties",function(e){t(JSON.parse(e))}),egret.ExternalInterface.call("getSuperProperties",e)}},{key:"unsetSuperPropertyForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t;e=JSON.stringify({property:e,appId:t});egret.ExternalInterface.call("unsetSuperProperty",e)}},{key:"clearSuperPropertiesForNative",value:function(e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.call("clearSuperProperties",e)}},{key:"userSetForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e);e={properties:JSON.stringify(e),appId:t},t=JSON.stringify(e);egret.ExternalInterface.call("userSet",t)}},{key:"userSetOnceForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e);e={properties:JSON.stringify(e),appId:t},t=JSON.stringify(e);egret.ExternalInterface.call("userSetOnce",t)}},{key:"userAppendForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e);e={properties:JSON.stringify(e),appId:t},t=JSON.stringify(e);egret.ExternalInterface.call("userAppend",t)}},{key:"userUniqAppendForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e);e={properties:JSON.stringify(e),appId:t},t=JSON.stringify(e);egret.ExternalInterface.call("userUniqAppend",t)}},{key:"userAddForNative",value:function(e,t){e=_.isUndefined(e)?{}:e,t=_.isUndefined(t)?"":t,e=_.encodeDates(e);e={properties:JSON.stringify(e),appId:t},t=JSON.stringify(e);egret.ExternalInterface.call("userAdd",t)}},{key:"userUnsetForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t;e=JSON.stringify({property:e,appId:t});egret.ExternalInterface.call("userUnset",e)}},{key:"userDelForNative",value:function(e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.call("userDel",e)}},{key:"authorizeOpenIDForNative",value:function(e,t){this.identifyForNative(e,t)}},{key:"identifyForNative",value:function(e,t){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t;e=JSON.stringify({distinctId:e,appId:t});egret.ExternalInterface.call("identify",e)}},{key:"initInstanceForNative",value:function(e,t,n){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?{}:t,n=_.isUndefined(n)?"":n,egret.ExternalInterface.call("setCustomerLibInfo",JSON.stringify({libName:Config.LIB_NAME,libVersion:Config.LIB_VERSION})),_.isUndefined(t)?(n=JSON.stringify({name:e,appId:n}),egret.ExternalInterface.call("initInstanceAppId",n)):(n={name:e,config:JSON.stringify(t)},e=JSON.stringify(n),egret.ExternalInterface.call("initInstanceConfig",e))}},{key:"lightInstanceForNative",value:function(e,t,n){e=_.isUndefined(e)?"":e,t=_.isUndefined(t)?"":t;e=JSON.stringify({name:e,appId:t});egret.ExternalInterface.addCallback("lightInstance",function(e){n(e)}),egret.ExternalInterface.call("lightInstance",e)}},{key:"startGravityAnalyticsForNative",value:function(e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.call("startGravityAnalytics",e)}},{key:"getDeviceIdForNative",value:function(t,e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.addCallback("getDeviceId",function(e){t(e)}),egret.ExternalInterface.call("getDeviceId",e)}},{key:"getDistinctIdForNative",value:function(t,e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.addCallback("getDistinctId",function(e){t(e)}),egret.ExternalInterface.call("getDistinctId",e)}},{key:"getAccountIdForNative",value:function(t,e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.addCallback("getAccountId",function(e){t(e)}),egret.ExternalInterface.call("getAccountId",e)}},{key:"getPresetPropertiesForNative",value:function(i,e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.addCallback("getPresetProperties",function(e){var e=JSON.parse(e),t={},n=e.$system_language,n=(t.system_language=_.isUndefined(n)?"":n,e.$os),n=(t.os=_.isUndefined(n)?"":n,e.$screen_width),n=(t.screenWidth=_.isUndefined(n)?0:n,e.$screen_height),n=(t.screenHeight=_.isUndefined(n)?0:n,e.$network_type),n=(t.networkType=_.isUndefined(n)?"":n,e.$device_model),n=(t.deviceModel=_.isUndefined(n)?"":n,e.$os_version),n=(t.osVersion=_.isUndefined(n)?"":n,e.$device_id),n=(t.deviceId=_.isUndefined(n)?"":n,e.$zone_offset),n=(t.zoneOffset=_.isUndefined(n)?"":n,e.$manufacturer),n=(t.manufacturer=_.isUndefined(n)?"":n,e.$manufacturer);t.brand=_.isUndefined(n)?"":n,t.toEventPresetProperties=function(){return{$device_model:t.deviceModel,$device_id:t.deviceId,$screen_width:t.screenWidth,$screen_height:t.screenHeight,$system_language:t.system_language,$os:t.os,$os_version:t.osVersion,$network_type:t.networkType,$zone_offset:t.zoneOffset,$manufacturer:t.manufacturer,$brand:t.manufacturer}},i(t)}),egret.ExternalInterface.call("getPresetProperties",e)}},{key:"enableTrackingForNative",value:function(e,t){e=!_.isUndefined(e)&&e,t=_.isUndefined(t)?"":t;e={enabled:e.toString(),appId:t},t=JSON.stringify(e);egret.ExternalInterface.call("enableTracking",t)}},{key:"optOutTrackingForNative",value:function(e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.call("optOutTracking",e)}},{key:"optOutTrackingAndDeleteUserForNative",value:function(e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.call("optOutTrackingAndDeleteUser",e)}},{key:"optInTrackingForNative",value:function(e){e=_.isUndefined(e)?"":e;e=JSON.stringify({appId:e});egret.ExternalInterface.call("optInTracking",e)}},{key:"setTrackStatusForNative",value:function(e,t){t=_.isUndefined(t)?"":t;e=JSON.stringify({status:e,appId:t});egret.ExternalInterface.call("setTrackStatus",e)}}]),n}();window.GravityAnalyticsAPI=GravityEngineAPIForNative,window.GravityAnalyticsAPIForJS=GravityEngineAPI;